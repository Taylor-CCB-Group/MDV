(()=>{function t(t,n){let e=t.length-1;e=0===e?1:e;let a=t.reduce(((t,e)=>t+Math.pow(e-n,2)),0);return Math.sqrt(a/e)}onmessage=function(n){const e=n.data[3],a=new Uint8Array(n.data[2]),r=new Uint8Array(n.data[0]),l=new Uint8Array(n.data[1]);let o=null;o="sankey"===e.method?function(t,n,e,a,r){const l=r.values.length,o=r.values2.length,s=e.length,i=new Array(l),u=r.values.map(((t,n)=>"A"+n)),h=r.values2.map(((t,n)=>"B"+n));for(let t=0;t<l;t++)i[t]=new Array(o).fill(0);const d=[];let c=0;for(let r=0;r<s;r++)0!==n[r]&&n[r]!==t[r]||(i[e[r]][a[r]]++,c++);const f=new Set,m=new Set,g=Math.round(c/300);for(let t=0;t<l;t++)for(let n=0;n<o;n++){const e=i[t][n];0!==e&&(f.add(u[t]),m.add(h[n]),d.push({source:u[t],target:h[n],value:e<g?g:e,trueValue:e}))}const y=Math.min(f.size,m.size),w=Array.from(f).map((t=>({id:t,ind:t.substring(1),param:0}))),A=Array.from(m).map((t=>({id:t,ind:t.substring(1),param:1})));return{links:d,nodes:w.concat(A),minNodes:y}}(r,l,a,new Uint8Array(n.data[4]),e):"proportion"===e.method?function(n,e,a,r,l){const o=l.values.length,s=l.values2.length,i=l.cats?new Uint8Array(l.cats):null,u=a.length,h=new Array(o),d=l.diviser?l.diviser:new Array(o);for(let t=0;t<o;t++)h[t]=new Array(s).fill(0),d[t]=new Array(s).fill(0);const c=l.category;for(let t=0;t<u;t++)if(d[a[t]][r[t]]++,0===e[t]){if(i&&i[t]!==c)continue;h[a[t]][r[t]]++}let f=0,m=1e7;for(let n=0;n<d.length;n++){const e=d[n],a=h[n],r=[],o=[];let s=0,i=0,u=1e7;for(let t=0;t<e.length;t++){if(0===e[t])continue;const h=l.denominators?a[t]/l.denominators[t]:a[t]/e[t]*100;r.push([h,n,t,Math.floor(6*Math.random())]),o.push(h),s+=h,i=Math.max(i,h),u=Math.min(u,h)}r.av=s/r.length,r.std=t(o,r.av),r.max=i,r.min=u,h[n]=r,f=Math.max(f,i),m=Math.min(m,u)}return h.max=f,h.min=m,h}(0,l,a,new Uint8Array(n.data[4]),e):function(t,n,e,a){const r=new Array(a.values.length).fill(0),l=e.length;for(let a=0;a<l;a++)0!==n[a]&&n[a]!==t[a]||r[e[a]]++;return r}(r,l,a,e),postMessage(o)}})();