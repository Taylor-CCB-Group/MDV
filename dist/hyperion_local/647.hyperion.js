(self.webpackChunkciview2=self.webpackChunkciview2||[]).push([[647],{4128:(s,t,e)=>{"use strict";e.r(t),e.d(t,{default:()=>n});var i=e(8456),a=e(5892),h=e(9564);const n=class{constructor(s,t,e){this.canvas=s,this.height=this.canvas.height,this.width=this.canvas.width,this.config=t,(0,i.$L)(t.url,{pool:!1}).then((s=>{this._setUp(s,e)}))}setSize(s,t,e){this.height=t,this.width=s;const i=this.getViewState(e.x_scale,e.y_scale,e.offset);this.deck.setProps({height:t,width:s,viewState:i})}setPanZoom(s,t,e){const i=this.getViewState(t,e,s);this.deck.setProps({viewState:i})}getViewState(s,t,e){const a=Math.log2(t),h=Math.log2(s);let n=1/s*this.native_x/2;n-=e[0];let l=1/t*this.native_y/2;return l+=this.native_y-e[1],{height:this.native_y,width:this.native_x,id:i.ys,target:[n,l,0],zoom:[h,a]}}setChannel(s){const t=this.layers[0].props;for(let e=0;e<t.selections.length;e++)if(t.selections[e].c===s.index){t.colors[e]=(0,a.$W)(s.color),t.contrastLimits[e]=s.contrastLimits,t.channelsVisible[e]=s.channelsVisible;break}this.layers=[this.layers[0]],this.deck.setProps({layers:[this.layers]})}removeChannel(s){const t=this.layers[0].props;let e=0;for(let i of t.selections){if(i.c===s.index)break;e++}t.colors.splice(e,1),t.selections.splice(e,1),t.contrastLimits.splice(e,1),t.channelsVisible.splice(e,1),this.createLayers(t),this.deck.setProps({layers:[this.layers]})}addChannel(s){const t=this.layers[0].props;return t.channelsVisible.push(!0),s.color=s.color||"#ff00ff",s.contrastLimits=s.contrastLimit||[20,100],s.channelsVisible=!0,t.colors.push((0,a.$W)(s.color)),t.contrastLimits.push(s.contrastLimits),t.selections.push({z:0,t:0,c:s.index}),this.createLayers(t),this.deck.setProps({layers:[this.layers]}),s.name=this.channels[s.index].Name,s}_setUp(s,t){this.native_x=s.metadata.Pixels.SizeX,this.native_y=s.metadata.Pixels.SizeY,this.extensions=[new i.Gl],this.channels=s.metadata.Pixels.Channels,this.loader=s.data,this.transparentColor=[255,255,255,0];const e=this.getViewState(t.x_scale,t.y_scale,t.offset);this.detailView=new i.O6({id:i.ys,height:this.native_y,width:this.native_x});const a=this.config,n=(a.image_properties,this.detailView.getDeckGlView());this.createLayers(a.image_properties),this.deck=new h.Z({canvas:this.canvas,layers:[this.layers],views:[n],viewState:e,width:this.width,height:this.height,useDevicePixels:!1})}createLayers(s){const t={id:i.ys},e={loader:this.loader,contrastLimits:s.contrastLimits.slice(0),colors:s.colors.slice(0),channelsVisible:s.channelsVisible.slice(0),selections:s.selections.slice(0),extensions:this.extensions,transparentColor:this.transparentColor};this.layers=this.detailView.getLayers({viewStates:t,props:e})}}},9521:()=>{},9214:()=>{},1555:()=>{},2913:()=>{},8419:()=>{}}]);