(()=>{function t(t,n){return t+Math.round((n-t)/2)}function n(t,n,a,e=2){const o=a[1]-a[0];return n.map((function(n){let r=0,l=0;for(let s=0;s<t.length;s++){let i=t[s];if(!isNaN(i)){i=(i-a[0])/o,i=i<0?0:i>1?1:i;let t=n-i;r+=Math.abs(t/=e)<=1?.75*(1-t*t)/e:0,l++}}return r/l}))}function a(t,n,a=2){return n.map((function(n){let e=0,o=0;for(let r=0;r<t.length;r++){let l=t[r];if(!isNaN(l)){let t=n-l;e+=Math.abs(t/=a)<=1?.75*(1-t*t)/a:0,o++}}return e/o}))}onmessage=function(e){if("multi"===e.data[4].analysis)return void this.postMessage(function(n){const a=[];for(let t of n.data[2])a.push(new Float32Array(t));const e=a.length,o=n.data[4],r=o.scaleVals;for(let t of r)t.push(t[1]-t[0]);new Uint8Array(n.data[0]);const l=new Uint8Array(n.data[1]),s=l.length,i=new Array(e),c=new Uint8Array(n.data[3]),f=o.cat;let u=0;for(let t=0;t<s;t++)c[t]===f&&0===l[t]&&u++;for(let t=0;t<e;t++)i[t]=new Float32Array(u);count=0;for(let t=0;t<s;t++)if(c[t]===f&&0===l[t]){for(let n=0;n<e;n++){let e=(a[n][t]-r[n][0])/r[n][2];i[n][count]=e<0?0:e>1?1:e}count++}const h=[];let d=Number.MAX_VALUE,m=Number.MIN_VALUE;for(let n=0;n<e;n++){const a=i[n],e=a.length;a.sort();const o=t(0,e),r=a[o],l=a[t(0,o)],s=a[t(o+1,e)],c=s-l;let f=l-1.5*c,u=s+1.5*c;f=f<a[0]?a[0]:f,u=u>a[e-1]?a[e-1]:u,d=Math.min(d,f),m=Math.max(m,u),h.push({max:u,min:f,Q1:l,Q3:s,med:r,id:n})}return h.max=m,h.min=d,h}(e));const o=new Uint8Array(e.data[0]),r=new Uint8Array(e.data[1]),l=new Uint8Array(e.data[2]),s=new Float32Array(e.data[3]),i=e.data[4],c=s.length,f=i.values.length,u=new Array(f).fill(0);for(let t=0;t<c;t++)0!==r[t]&&r[t]!==o[t]||u[l[t]]++;const h=[];for(let t=0;t<f;t++)h.push(new Float32Array(u[t]));const d=new Array(f).fill(0),m=new Float32Array(i.xPos);for(let t=0;t<c;t++){if(0!==r[t]&&r[t]!==o[t])continue;const n=l[t];h[n][d[n]++]=s[t]}const A=[];if("boxplot"===i.analysis){const n={};for(let a=0;a<f;a++){const e=h[a],o=e.length;if(0==o)continue;e.sort();const r=t(0,o),l=e[r],s=e[t(0,r)],i=e[t(r+1,o)],c=i-s;let f=s-1.5*c,u=i+1.5*c;f=f<e[0]?e[0]:f,u=u>e[o-1]?e[o-1]:u,n[a]=A.length,A.push({max:u,min:f,Q1:s,Q3:i,med:l,id:a})}for(let t=0;t<c;t++){const a=n[l[t]];void 0!==a&&(m[t]=50*a+4+42*Math.random())}}else{const t={};for(let e=0;e<f;e++){let o=null;o=i.scaletrim?n(h[e],i.ticks,i.scaletrim,i.bandwidth||7):a(h[e],i.ticks,i.bandwidth||7);const r=Math.max(...o);0===r||isNaN(r)||(o.id=e,o.max=r,t[e]=[A.length,r,o],A.push(o))}i.ticks[i.ticks.length-1],i.ticks[0],i.ticks[1];for(let n=0;n<c;n++){const a=t[l[n]];a&&(m[n]=50*a[0]+4+42*Math.random())}}postMessage(A)}})();