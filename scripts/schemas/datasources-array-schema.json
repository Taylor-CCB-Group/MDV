{
  "$ref": "#/definitions/datasources-array-schema",
  "definitions": {
    "datasources-array-schema": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Human-readable name for the datasource"
          },
          "size": {
            "type": "integer",
            "exclusiveMinimum": 0,
            "description": "Number of rows in the datasource"
          },
          "columns": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Human-readable name for the column displayed to users"
                },
                "field": {
                  "type": "string",
                  "description": "Unique identifier for the column used internally"
                },
                "datatype": {
                  "type": "string",
                  "enum": [
                    "integer",
                    "double",
                    "text",
                    "text16",
                    "unique",
                    "multitext",
                    "int32"
                  ],
                  "description": "Data type defining how the column values are stored and processed"
                },
                "values": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "For text/multitext columns: array of possible values, with raw data containing indices into this array"
                },
                "colors": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Array of hex color codes mapped to values or interpolated for numeric data"
                },
                "stringLength": {
                  "type": "integer",
                  "exclusiveMinimum": 0,
                  "description": "For unique columns: length of longest value; for multitext: max values per item"
                },
                "colorLogScale": {
                  "type": "boolean",
                  "description": "Whether to use logarithmic scaling for color mapping of numeric columns"
                },
                "editable": {
                  "type": "boolean",
                  "description": "Whether users can edit values in this column"
                },
                "is_url": {
                  "type": "boolean",
                  "description": "Whether this column contains URL links (for unique and text columns)"
                },
                "minMax": {
                  "type": "array",
                  "minItems": 2,
                  "maxItems": 2,
                  "items": [
                    {
                      "type": "number"
                    },
                    {
                      "type": "number"
                    }
                  ],
                  "description": "For numeric columns: [minimum, maximum] values for optimization"
                },
                "quantiles": {
                  "type": "object",
                  "properties": {
                    "0.05": {
                      "type": "array",
                      "minItems": 2,
                      "maxItems": 2,
                      "items": [
                        {
                          "type": "number"
                        },
                        {
                          "type": "number"
                        }
                      ],
                      "description": "5th and 95th percentiles"
                    },
                    "0.01": {
                      "type": "array",
                      "minItems": 2,
                      "maxItems": 2,
                      "items": [
                        {
                          "type": "number"
                        },
                        {
                          "type": "number"
                        }
                      ],
                      "description": "1st and 99th percentiles"
                    },
                    "0.001": {
                      "type": "array",
                      "minItems": 2,
                      "maxItems": 2,
                      "items": [
                        {
                          "type": "number"
                        },
                        {
                          "type": "number"
                        }
                      ],
                      "description": "0.1st and 99.9th percentiles"
                    }
                  },
                  "required": [
                    "0.05",
                    "0.01",
                    "0.001"
                  ],
                  "additionalProperties": false,
                  "description": "Pre-calculated quantiles for efficient color scaling and outlier handling"
                },
                "data": {
                  "description": "Column data as array or SharedArrayBuffer - usually loaded on demand"
                },
                "delimiter": {
                  "type": "string",
                  "description": "Delimiter character for multitext columns (default: comma)"
                },
                "subgroup": {
                  "type": "string",
                  "description": "Subgroup identifier for rows-as-columns queries"
                },
                "sgindex": {
                  "type": "string",
                  "description": "Unique identifier for rows-as-columns data"
                },
                "sgtype": {
                  "type": "string",
                  "description": "Data type for rows-as-columns (e.g., 'sparse')"
                }
              },
              "required": [
                "name",
                "field",
                "datatype"
              ],
              "additionalProperties": false,
              "description": "Configuration for a single column in a datasource, defining its properties, data type, and behavior"
            },
            "description": "Array of column configurations defining the data structure"
          },
          "columnGroups": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Human-readable name for the column group"
                },
                "columns": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Array of column field names belonging to this group"
                }
              },
              "required": [
                "name",
                "columns"
              ],
              "additionalProperties": false,
              "description": "Logical grouping of related columns for organizational purposes"
            },
            "description": "Logical groupings of related columns"
          },
          "links": {
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "interactions": {
                  "allOf": [
                    {
                      "type": "object",
                      "properties": {
                        "pivot_column": {
                          "type": "string",
                          "description": "Column defining the scope of interactions (e.g., region, condition, sample)"
                        },
                        "interaction_columns": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "description": "Two columns specifying the interacting entities (e.g., cell types)"
                        },
                        "is_single_region": {
                          "type": "boolean",
                          "description": "Whether interactions are within single regions (true) or across conditions (false)"
                        }
                      },
                      "required": [
                        "pivot_column",
                        "interaction_columns",
                        "is_single_region"
                      ]
                    },
                    {
                      "type": "object",
                      "properties": {
                        "spatial_connectivity_map": {
                          "type": "object",
                          "properties": {
                            "link_length": {
                              "type": "string",
                              "description": "Column name for link length in spatial connectivity maps"
                            },
                            "link_thickness": {
                              "type": "string",
                              "description": "Column name for link thickness in spatial connectivity maps"
                            },
                            "link_color": {
                              "type": "string",
                              "description": "Column name for link color in spatial connectivity maps"
                            },
                            "node_size": {
                              "type": "string",
                              "description": "Column name for node size in spatial connectivity maps"
                            }
                          },
                          "required": [
                            "link_length",
                            "link_thickness",
                            "link_color",
                            "node_size"
                          ],
                          "additionalProperties": false,
                          "description": "Default column mappings for spatial connectivity map charts"
                        },
                        "interaction_matrix": {
                          "type": "object",
                          "properties": {
                            "groups": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "description": "Column names for grouping interactions in matrix charts"
                            }
                          },
                          "required": [
                            "groups"
                          ],
                          "additionalProperties": false,
                          "description": "Default grouping configuration for interaction matrix charts"
                        },
                        "cell_radial_chart": {
                          "type": "object",
                          "properties": {
                            "link_thickness": {
                              "type": "string",
                              "description": "Column name for link thickness in radial charts"
                            }
                          },
                          "required": [
                            "link_thickness"
                          ],
                          "additionalProperties": false,
                          "description": "Default column mapping for cell radial charts"
                        }
                      },
                      "description": "Default chart configurations for interaction visualization types"
                    }
                  ],
                  "description": "Configuration for interaction data between entities"
                },
                "rows_as_columns": {
                  "type": "object",
                  "properties": {
                    "name_column": {
                      "type": "string",
                      "description": "Column in linked datasource containing unique identifiers (e.g., gene names)"
                    },
                    "name": {
                      "type": "string",
                      "description": "Human-readable name for the rows-as-columns data (e.g., 'Gene Scores')"
                    },
                    "subgroups": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string",
                            "description": "Internal name for the subgroup"
                          },
                          "type": {
                            "type": "string",
                            "description": "Data type for the subgroup (e.g., 'sparse' for sparse matrices)"
                          },
                          "label": {
                            "type": "string",
                            "description": "Human-readable label for the subgroup"
                          }
                        },
                        "required": [
                          "name",
                          "label"
                        ],
                        "additionalProperties": false,
                        "description": "Configuration for a subgroup within rows-as-columns data (e.g., gene expression scores)"
                      },
                      "description": "Dictionary of available data subgroups"
                    }
                  },
                  "required": [
                    "name_column",
                    "name",
                    "subgroups"
                  ],
                  "additionalProperties": false,
                  "description": "Configuration for treating rows as columns"
                },
                "columns": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Array of column names to link from another datasource"
                },
                "index": {
                  "type": "string",
                  "description": "Column name used as index for linking datasources"
                },
                "access_data": {
                  "type": "boolean",
                  "description": "Whether this datasource can access data from the linked datasource"
                },
                "sync_column_colors": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "link_to": {
                        "type": "string",
                        "description": "Column name in the linked datasource to sync colors from"
                      },
                      "col": {
                        "type": "string",
                        "description": "Column name in the current datasource to sync colors to"
                      }
                    },
                    "required": [
                      "link_to",
                      "col"
                    ],
                    "additionalProperties": false
                  },
                  "description": "Configuration for synchronizing column colors"
                },
                "valueset": {
                  "type": "object",
                  "properties": {
                    "source_column": {
                      "type": "string",
                      "description": "Column in source datasource containing values to filter by"
                    },
                    "dest_column": {
                      "type": "string",
                      "description": "Column in destination datasource to apply filtering to"
                    }
                  },
                  "required": [
                    "source_column",
                    "dest_column"
                  ],
                  "additionalProperties": false,
                  "description": "Configuration for valueset-based filtering"
                }
              },
              "additionalProperties": false,
              "description": "Configuration for different types of relationships between datasources"
            },
            "description": "Relationships with other datasources"
          },
          "images": {
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "base_url": {
                  "type": "string",
                  "description": "Base URL where images are stored - image key and type will be appended"
                },
                "key_column": {
                  "type": "string",
                  "description": "Column name containing the keys used to construct image URLs"
                },
                "type": {
                  "type": "string",
                  "description": "Image file extension (e.g., 'png', 'jpg')"
                }
              },
              "required": [
                "base_url",
                "key_column",
                "type"
              ],
              "additionalProperties": false,
              "description": "Configuration for a set of images associated with datasource rows"
            },
            "description": "Thumbnail images associated with datasource rows"
          },
          "large_images": {
            "$ref": "#/definitions/datasources-array-schema/items/properties/images",
            "description": "High-resolution images for detailed viewing"
          },
          "regions": {
            "type": "object",
            "properties": {
              "position_fields": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Column names containing x,y coordinates for spatial data"
              },
              "region_field": {
                "type": "string",
                "description": "Column name identifying which region each data point belongs to"
              },
              "default_color": {
                "type": "string",
                "description": "Default column to use for color mapping in spatial visualizations"
              },
              "scale_unit": {
                "type": "string",
                "description": "Unit of measurement for spatial scale (e.g., 'mm', 'μm')"
              },
              "scale": {
                "type": "number",
                "description": "Scale factor converting pixel coordinates to real-world units"
              },
              "base_url": {
                "type": "string",
                "description": "Base URL where region images are stored"
              },
              "all_regions": {
                "type": "object",
                "additionalProperties": {
                  "type": "object",
                  "properties": {
                    "roi": {
                      "type": "object",
                      "properties": {
                        "min_x": {
                          "type": "number",
                          "description": "Minimum x coordinate of the region"
                        },
                        "max_x": {
                          "type": "number",
                          "description": "Maximum x coordinate of the region"
                        },
                        "min_y": {
                          "type": "number",
                          "description": "Minimum y coordinate of the region"
                        },
                        "max_y": {
                          "type": "number",
                          "description": "Maximum y coordinate of the region"
                        }
                      },
                      "required": [
                        "min_x",
                        "max_x",
                        "min_y",
                        "max_y"
                      ],
                      "additionalProperties": false,
                      "description": "Bounding box defining the spatial extent of this region"
                    },
                    "default_image": {
                      "type": [
                        "string",
                        "null"
                      ],
                      "description": "Name of the default background image to display (null = no image)"
                    },
                    "images": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "object",
                        "properties": {
                          "file": {
                            "type": "string",
                            "description": "Filename of the image"
                          },
                          "position": {
                            "type": "array",
                            "minItems": 2,
                            "maxItems": 2,
                            "items": [
                              {
                                "type": "number"
                              },
                              {
                                "type": "number"
                              }
                            ],
                            "description": "[x, y] offset position of the image within the region"
                          },
                          "height": {
                            "type": "number",
                            "description": "Height of the image in pixels"
                          },
                          "width": {
                            "type": "number",
                            "description": "Width of the image in pixels"
                          },
                          "name": {
                            "type": "string",
                            "description": "Human-readable name for the image"
                          }
                        },
                        "required": [
                          "file",
                          "position",
                          "height",
                          "width",
                          "name"
                        ],
                        "additionalProperties": false,
                        "description": "Metadata for a background image within a spatial region"
                      },
                      "description": "Dictionary of available background images for this region"
                    },
                    "ome_tiff": {
                      "type": "string",
                      "description": "Filename of the OME-TIFF image associated with this region"
                    }
                  },
                  "required": [
                    "roi",
                    "images"
                  ],
                  "additionalProperties": false,
                  "description": "Configuration for a single spatial region with its boundaries and associated images"
                },
                "description": "Dictionary of all regions, keyed by region identifier"
              }
            },
            "required": [
              "position_fields",
              "region_field",
              "all_regions"
            ],
            "additionalProperties": false,
            "description": "Spatial regions configuration for spatial data"
          },
          "interactions": {
            "$ref": "#/definitions/datasources-array-schema/items/properties/links/additionalProperties/properties/interactions",
            "description": "Interaction data configuration"
          },
          "offsets": {
            "type": "object",
            "properties": {
              "param": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Column names that can be transformed (typically ['x', 'y'])"
              },
              "groups": {
                "type": "string",
                "description": "Column name identifying groups that can have different transformations"
              },
              "background_filter": {
                "type": "string",
                "description": "Column name for filtering transformations by spatial context (e.g., 'ROI')"
              },
              "values": {
                "type": "object",
                "additionalProperties": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "object",
                    "properties": {
                      "rotation": {
                        "type": "number",
                        "description": "Rotation angle in degrees (positive = clockwise)"
                      },
                      "offset": {
                        "type": "array",
                        "minItems": 2,
                        "maxItems": 2,
                        "items": [
                          {
                            "type": "number"
                          },
                          {
                            "type": "number"
                          }
                        ],
                        "description": "[x, y] translation offset in coordinate units"
                      },
                      "rotation_center": {
                        "type": "array",
                        "minItems": 2,
                        "maxItems": 2,
                        "items": [
                          {
                            "type": "number"
                          },
                          {
                            "type": "number"
                          }
                        ],
                        "description": "[x, y] center point for rotation (relative to data bounds)"
                      }
                    },
                    "additionalProperties": false,
                    "description": "Spatial transformation parameters for aligning data groups"
                  }
                },
                "description": "Nested dictionary: {filter_value: {group_value: transformation}}"
              }
            },
            "required": [
              "param",
              "groups"
            ],
            "additionalProperties": false,
            "description": "Spatial transformation configuration"
          },
          "genome_browser": {
            "type": "object",
            "properties": {
              "default_parameters": {
                "type": "object",
                "additionalProperties": {},
                "description": "Default parameters for the genome browser widget"
              },
              "default_track": {
                "type": "object",
                "properties": {
                  "label": {
                    "type": "string",
                    "description": "Human-readable name for the track"
                  },
                  "url": {
                    "type": "string",
                    "description": "URL to the track data file (gzipped BED format with tabix index)"
                  }
                },
                "required": [
                  "label",
                  "url"
                ],
                "additionalProperties": false,
                "description": "Primary track showing datasource features"
              },
              "default_track_parameters": {
                "type": "object",
                "additionalProperties": {},
                "description": "Parameters for the default feature track"
              },
              "location_fields": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Column names for [chromosome, start, end] genomic coordinates"
              },
              "default_tracks": {
                "type": "array",
                "items": {
                  "type": "object",
                  "additionalProperties": {}
                },
                "description": "Additional tracks to display by default"
              },
              "atac_bam_track": {
                "type": "object",
                "properties": {
                  "url": {
                    "type": "string",
                    "description": "URL to the BAM file containing ATAC-seq reads"
                  },
                  "cluster_read": {
                    "type": "string",
                    "description": "Column name in linked datasource for clustering reads by barcode"
                  }
                },
                "required": [
                  "url",
                  "cluster_read"
                ],
                "additionalProperties": false,
                "description": "ATAC-seq BAM track configuration if applicable"
              }
            },
            "required": [
              "default_track",
              "location_fields"
            ],
            "additionalProperties": false,
            "description": "Genome browser integration configuration"
          },
          "tree_diagram": {
            "type": "object",
            "additionalProperties": {},
            "description": "Tree diagram visualization configuration"
          },
          "avivator": {
            "type": "boolean",
            "description": "Whether Avivator image viewer integration is enabled"
          },
          "row_data_loader": {
            "type": "boolean",
            "description": "Whether to use row-based data loading"
          },
          "binary_data_loader": {
            "type": "boolean",
            "description": "Whether to use binary data loading for performance"
          },
          "deeptools": {
            "type": "object",
            "additionalProperties": {},
            "description": "DeepTools integration configuration"
          }
        },
        "required": [
          "name",
          "size",
          "columns"
        ],
        "additionalProperties": false,
        "description": "Complete configuration for a datasource including data structure, relationships, and visualization options"
      },
      "description": "Array of multiple datasource configurations"
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}