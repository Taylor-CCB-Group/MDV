"use strict";(self.webpackChunkciview2=self.webpackChunkciview2||[]).push([[10],{5010:(t,e,i)=>{i.r(e),i.d(e,{default:()=>re});var r=-2,s=-3,n=-5,a=13,o=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],h=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],l=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],d=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function p(){}function g(){this.was=[0]}p.prototype.inflateInit=function(t,e){return t||(t=15),e&&(e=!1),this.istate=new g,this.istate.inflateInit(this,e?-t:t)},p.prototype.inflate=function(t){return null==this.istate?r:this.istate.inflate(this,t)},p.prototype.inflateEnd=function(){if(null==this.istate)return r;var t=istate.inflateEnd(this);return this.istate=null,t},p.prototype.inflateSync=function(){return istate.inflateSync(this)},p.prototype.inflateSetDictionary=function(t,e){return istate.inflateSetDictionary(this,t,e)},g.prototype.inflateReset=function(t){return null==t||null==t.istate?r:(t.total_in=t.total_out=0,t.msg=null,t.istate.mode=0!=t.istate.nowrap?7:0,t.istate.blocks.reset(t,null),0)},g.prototype.inflateEnd=function(t){return null!=this.blocks&&this.blocks.free(t),this.blocks=null,0},g.prototype.inflateInit=function(t,e){t.msg=null,this.blocks=null;let i=0;return e<0&&(e=-e,1),e<8||e>15?(this.inflateEnd(t),r):(this.wbits=e,t.istate.blocks=new v(t,0!=t.istate.nowrap?null:this,1<<e),this.inflateReset(t),0)},g.prototype.inflate=function(t,e){var i,o;if(null==t||null==t.istate||null==t.next_in)return r;for(e=4==e?n:0,i=n;;)switch(t.istate.mode){case 0:if(0==t.avail_in)return i;if(i=e,t.avail_in--,t.total_in++,8!=(15&(t.istate.method=t.next_in[t.next_in_index++]))){t.istate.mode=a,t.msg="unknown compression method",t.istate.marker=5;break}if(8+(t.istate.method>>4)>t.istate.wbits){t.istate.mode=a,t.msg="invalid window size",t.istate.marker=5;break}t.istate.mode=1;case 1:if(0==t.avail_in)return i;if(i=e,t.avail_in--,t.total_in++,o=255&t.next_in[t.next_in_index++],((t.istate.method<<8)+o)%31!=0){t.istate.mode=a,t.msg="incorrect header check",t.istate.marker=5;break}if(0==(32&o)){t.istate.mode=7;break}t.istate.mode=2;case 2:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need=(255&t.next_in[t.next_in_index++])<<24&4278190080,t.istate.mode=3;case 3:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<16&16711680,t.istate.mode=4;case 4:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<8&65280,t.istate.mode=5;case 5:return 0==t.avail_in?i:(i=e,t.avail_in--,t.total_in++,t.istate.need+=255&t.next_in[t.next_in_index++],t.adler=t.istate.need,t.istate.mode=6,2);case 6:return t.istate.mode=a,t.msg="need dictionary",t.istate.marker=0,r;case 7:if((i=t.istate.blocks.proc(t,i))==s){t.istate.mode=a,t.istate.marker=0;break}if(0==i&&(i=e),1!=i)return i;if(i=e,t.istate.blocks.reset(t,t.istate.was),0!=t.istate.nowrap){t.istate.mode=12;break}t.istate.mode=8;case 8:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need=(255&t.next_in[t.next_in_index++])<<24&4278190080,t.istate.mode=9;case 9:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<16&16711680,t.istate.mode=10;case 10:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<8&65280,t.istate.mode=11;case 11:if(0==t.avail_in)return i;if(i=e,t.avail_in--,t.total_in++,t.istate.need+=255&t.next_in[t.next_in_index++],t.istate.was[0]!=t.istate.need){t.istate.mode=a,t.msg="incorrect data check",t.istate.marker=5;break}t.istate.mode=12;case 12:return 1;case a:return s;default:return r}},g.prototype.inflateSetDictionary=function(t,e,i){var n=0,a=i;return null==t||null==t.istate||6!=t.istate.mode?r:t._adler.adler32(1,e,0,i)!=t.adler?s:(t.adler=t._adler.adler32(0,null,0,0),a>=1<<t.istate.wbits&&(n=i-(a=(1<<t.istate.wbits)-1)),t.istate.blocks.set_dictionary(e,n,a),t.istate.mode=7,0)};var m=[0,0,255,255];g.prototype.inflateSync=function(t){var e,i,o,h,l;if(null==t||null==t.istate)return r;if(t.istate.mode!=a&&(t.istate.mode=a,t.istate.marker=0),0==(e=t.avail_in))return n;for(i=t.next_in_index,o=t.istate.marker;0!=e&&o<4;)t.next_in[i]==m[o]?o++:o=0!=t.next_in[i]?0:4-o,i++,e--;return t.total_in+=i-t.next_in_index,t.next_in_index=i,t.avail_in=e,t.istate.marker=o,4!=o?s:(h=t.total_in,l=t.total_out,this.inflateReset(t),t.total_in=h,t.total_out=l,t.istate.mode=7,0)},g.prototype.inflateSyncPoint=function(t){return null==t||null==t.istate||null==t.istate.blocks?r:t.istate.blocks.sync_point()};var _=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function v(t,e,i){this.hufts=new Int32Array(4320),this.window=new Uint8Array(i),this.end=i,this.checkfn=e,this.mode=0,this.reset(t,null),this.left=0,this.table=0,this.index=0,this.blens=null,this.bb=new Int32Array(1),this.tb=new Int32Array(1),this.codes=new w,this.last=0,this.bitk=0,this.bitb=0,this.read=0,this.write=0,this.check=0,this.inftree=new b}function w(){}function b(){}function y(t,e,i,r,s){return t[0]=9,e[0]=5,i[0]=h,r[0]=l,0}v.prototype.reset=function(t,e){e&&(e[0]=this.check),6==this.mode&&this.codes.free(t),this.mode=0,this.bitk=0,this.bitb=0,this.read=this.write=0,this.checkfn&&(t.adler=this.check=t._adler.adler32(0,null,0,0))},v.prototype.proc=function(t,e){var i,n,h,l,c,f,u;for(l=t.next_in_index,c=t.avail_in,n=this.bitb,h=this.bitk,u=(f=this.write)<this.read?this.read-f-1:this.end-f;;)switch(this.mode){case 0:for(;h<3;){if(0==c)return this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e);e=0,c--,n|=(255&t.next_in[l++])<<h,h+=8}switch(i=7&n,this.last=1&i,i>>>1){case 0:n>>>=3,n>>>=i=7&(h-=3),h-=i,this.mode=1;break;case 1:y(m=new Int32Array(1),v=new Int32Array(1),w=[],b=[]),this.codes.init(m[0],v[0],w[0],0,b[0],0,t),n>>>=3,h-=3,this.mode=6;break;case 2:n>>>=3,h-=3,this.mode=3;break;case 3:return n>>>=3,h-=3,this.mode=a,t.msg="invalid block type",e=s,this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e)}break;case 1:for(;h<32;){if(0==c)return this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e);e=0,c--,n|=(255&t.next_in[l++])<<h,h+=8}if((~n>>>16&65535)!=(65535&n))return this.mode=a,t.msg="invalid stored block lengths",e=s,this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e);this.left=65535&n,n=h=0,this.mode=0!=left?2:0!=this.last?7:0;break;case 2:if(0==c)return this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,write=f,this.inflate_flush(t,e);if(0==u&&(f==end&&0!=read&&(u=(f=0)<this.read?this.read-f-1:this.end-f),0==u&&(this.write=f,e=this.inflate_flush(t,e),u=(f=this.write)<this.read?this.read-f-1:this.end-f,f==this.end&&0!=this.read&&(u=(f=0)<this.read?this.read-f-1:this.end-f),0==u)))return this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e);if(e=0,(i=this.left)>c&&(i=c),i>u&&(i=u),k(t.next_in,l,window,f,i),l+=i,c-=i,f+=i,u-=i,0!=(this.left-=i))break;this.mode=0!=this.last?7:0;break;case 3:for(;h<14;){if(0==c)return this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e);e=0,c--,n|=(255&t.next_in[l++])<<h,h+=8}if(this.table=i=16383&n,(31&i)>29||(i>>5&31)>29)return this.mode=9,t.msg="too many length or distance symbols",e=s,this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e);if(i=258+(31&i)+(i>>5&31),null==this.blens||this.blens.length<i)this.blens=new Int32Array(i);else for(var d=0;d<i;d++)this.blens[d]=0;n>>>=14,h-=14,this.index=0,this.mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;h<3;){if(0==c)return this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e);e=0,c--,n|=(255&t.next_in[l++])<<h,h+=8}this.blens[_[this.index++]]=7&n,n>>>=3,h-=3}for(;this.index<19;)this.blens[_[this.index++]]=0;if(this.bb[0]=7,0!=(i=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,t)))return(e=i)==s&&(this.blens=null,this.mode=9),this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,write=f,this.inflate_flush(t,e);this.index=0,this.mode=5;case 5:for(;i=this.table,this.index<258+(31&i)+(i>>5&31);){var p,g;for(i=this.bb[0];h<i;){if(0==c)return this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e);e=0,c--,n|=(255&t.next_in[l++])<<h,h+=8}if(i=this.hufts[3*(this.tb[0]+(n&o[i]))+1],(g=this.hufts[3*(this.tb[0]+(n&o[i]))+2])<16)n>>>=i,h-=i,this.blens[this.index++]=g;else{for(d=18==g?7:g-14,p=18==g?11:3;h<i+d;){if(0==c)return this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e);e=0,c--,n|=(255&t.next_in[l++])<<h,h+=8}if(h-=i,p+=(n>>>=i)&o[d],n>>>=d,h-=d,(d=this.index)+p>258+(31&(i=this.table))+(i>>5&31)||16==g&&d<1)return this.blens=null,this.mode=9,t.msg="invalid bit length repeat",e=s,this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e);g=16==g?this.blens[d-1]:0;do{this.blens[d++]=g}while(0!=--p);this.index=d}}this.tb[0]=-1;var m=new Int32Array(1),v=new Int32Array(1),w=new Int32Array(1),b=new Int32Array(1);if(m[0]=9,v[0]=6,i=this.table,0!=(i=this.inftree.inflate_trees_dynamic(257+(31&i),1+(i>>5&31),this.blens,m,v,w,b,this.hufts,t)))return i==s&&(this.blens=null,this.mode=a),e=i,this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e);this.codes.init(m[0],v[0],this.hufts,w[0],this.hufts,b[0],t),this.mode=6;case 6:if(this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,1!=(e=this.codes.proc(this,t,e)))return this.inflate_flush(t,e);if(e=0,this.codes.free(t),l=t.next_in_index,c=t.avail_in,n=this.bitb,h=this.bitk,u=(f=this.write)<this.read?this.read-f-1:this.end-f,0==this.last){this.mode=0;break}this.mode=7;case 7:if(this.write=f,e=this.inflate_flush(t,e),u=(f=this.write)<this.read?this.read-f-1:this.end-f,this.read!=this.write)return this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e);this.mode=12;case 8:return e=1,this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e);case 9:return e=s,this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e);default:return e=r,this.bitb=n,this.bitk=h,t.avail_in=c,t.total_in+=l-t.next_in_index,t.next_in_index=l,this.write=f,this.inflate_flush(t,e)}},v.prototype.free=function(t){this.reset(t,null),this.window=null,this.hufts=null},v.prototype.set_dictionary=function(t,e,i){k(t,e,window,0,i),this.read=this.write=i},v.prototype.sync_point=function(){return 1==this.mode},v.prototype.inflate_flush=function(t,e){var i,r,s;return r=t.next_out_index,(i=((s=this.read)<=this.write?this.write:this.end)-s)>t.avail_out&&(i=t.avail_out),0!=i&&e==n&&(e=0),t.avail_out-=i,t.total_out+=i,null!=this.checkfn&&(t.adler=this.check=t._adler.adler32(this.check,this.window,s,i)),k(this.window,s,t.next_out,r,i),r+=i,(s+=i)==this.end&&(s=0,this.write==this.end&&(this.write=0),(i=this.write-s)>t.avail_out&&(i=t.avail_out),0!=i&&e==n&&(e=0),t.avail_out-=i,t.total_out+=i,null!=this.checkfn&&(t.adler=this.check=t._adler.adler32(this.check,this.window,s,i)),k(this.window,s,t.next_out,r,i),r+=i,s+=i),t.next_out_index=r,this.read=s,e},w.prototype.init=function(t,e,i,r,s,n,a){this.mode=0,this.lbits=t,this.dbits=e,this.ltree=i,this.ltree_index=r,this.dtree=s,this.dtree_index=n,this.tree=null},w.prototype.proc=function(t,e,i){var n,a,h,l,c,f,u,d=0,p=0,g=0;for(g=e.next_in_index,l=e.avail_in,d=t.bitb,p=t.bitk,f=(c=t.write)<t.read?t.read-c-1:t.end-c;;)switch(this.mode){case 0:if(f>=258&&l>=10&&(t.bitb=d,t.bitk=p,e.avail_in=l,e.total_in+=g-e.next_in_index,e.next_in_index=g,t.write=c,i=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,t,e),g=e.next_in_index,l=e.avail_in,d=t.bitb,p=t.bitk,f=(c=t.write)<t.read?t.read-c-1:t.end-c,0!=i)){this.mode=1==i?7:9;break}this.need=this.lbits,this.tree=this.ltree,this.tree_index=this.ltree_index,this.mode=1;case 1:for(n=this.need;p<n;){if(0==l)return t.bitb=d,t.bitk=p,e.avail_in=l,e.total_in+=g-e.next_in_index,e.next_in_index=g,t.write=c,t.inflate_flush(e,i);i=0,l--,d|=(255&e.next_in[g++])<<p,p+=8}if(a=3*(this.tree_index+(d&o[n])),d>>>=this.tree[a+1],p-=this.tree[a+1],0==(h=this.tree[a])){this.lit=this.tree[a+2],this.mode=6;break}if(0!=(16&h)){this.get=15&h,this.len=this.tree[a+2],this.mode=2;break}if(0==(64&h)){this.need=h,this.tree_index=a/3+this.tree[a+2];break}if(0!=(32&h)){this.mode=7;break}return this.mode=9,e.msg="invalid literal/length code",i=s,t.bitb=d,t.bitk=p,e.avail_in=l,e.total_in+=g-e.next_in_index,e.next_in_index=g,t.write=c,t.inflate_flush(e,i);case 2:for(n=this.get;p<n;){if(0==l)return t.bitb=d,t.bitk=p,e.avail_in=l,e.total_in+=g-e.next_in_index,e.next_in_index=g,t.write=c,t.inflate_flush(e,i);i=0,l--,d|=(255&e.next_in[g++])<<p,p+=8}this.len+=d&o[n],d>>=n,p-=n,this.need=this.dbits,this.tree=this.dtree,this.tree_index=this.dtree_index,this.mode=3;case 3:for(n=this.need;p<n;){if(0==l)return t.bitb=d,t.bitk=p,e.avail_in=l,e.total_in+=g-e.next_in_index,e.next_in_index=g,t.write=c,t.inflate_flush(e,i);i=0,l--,d|=(255&e.next_in[g++])<<p,p+=8}if(a=3*(this.tree_index+(d&o[n])),d>>=this.tree[a+1],p-=this.tree[a+1],0!=(16&(h=this.tree[a]))){this.get=15&h,this.dist=this.tree[a+2],this.mode=4;break}if(0==(64&h)){this.need=h,this.tree_index=a/3+this.tree[a+2];break}return this.mode=9,e.msg="invalid distance code",i=s,t.bitb=d,t.bitk=p,e.avail_in=l,e.total_in+=g-e.next_in_index,e.next_in_index=g,t.write=c,t.inflate_flush(e,i);case 4:for(n=this.get;p<n;){if(0==l)return t.bitb=d,t.bitk=p,e.avail_in=l,e.total_in+=g-e.next_in_index,e.next_in_index=g,t.write=c,t.inflate_flush(e,i);i=0,l--,d|=(255&e.next_in[g++])<<p,p+=8}this.dist+=d&o[n],d>>=n,p-=n,this.mode=5;case 5:for(u=c-this.dist;u<0;)u+=t.end;for(;0!=this.len;){if(0==f&&(c==t.end&&0!=t.read&&(f=(c=0)<t.read?t.read-c-1:t.end-c),0==f&&(t.write=c,i=t.inflate_flush(e,i),f=(c=t.write)<t.read?t.read-c-1:t.end-c,c==t.end&&0!=t.read&&(f=(c=0)<t.read?t.read-c-1:t.end-c),0==f)))return t.bitb=d,t.bitk=p,e.avail_in=l,e.total_in+=g-e.next_in_index,e.next_in_index=g,t.write=c,t.inflate_flush(e,i);t.window[c++]=t.window[u++],f--,u==t.end&&(u=0),this.len--}this.mode=0;break;case 6:if(0==f&&(c==t.end&&0!=t.read&&(f=(c=0)<t.read?t.read-c-1:t.end-c),0==f&&(t.write=c,i=t.inflate_flush(e,i),f=(c=t.write)<t.read?t.read-c-1:t.end-c,c==t.end&&0!=t.read&&(f=(c=0)<t.read?t.read-c-1:t.end-c),0==f)))return t.bitb=d,t.bitk=p,e.avail_in=l,e.total_in+=g-e.next_in_index,e.next_in_index=g,t.write=c,t.inflate_flush(e,i);i=0,t.window[c++]=this.lit,f--,this.mode=0;break;case 7:if(p>7&&(p-=8,l++,g--),t.write=c,i=t.inflate_flush(e,i),f=(c=t.write)<t.read?t.read-c-1:t.end-c,t.read!=t.write)return t.bitb=d,t.bitk=p,e.avail_in=l,e.total_in+=g-e.next_in_index,e.next_in_index=g,t.write=c,t.inflate_flush(e,i);this.mode=8;case 8:return i=1,t.bitb=d,t.bitk=p,e.avail_in=l,e.total_in+=g-e.next_in_index,e.next_in_index=g,t.write=c,t.inflate_flush(e,i);case 9:return i=s,t.bitb=d,t.bitk=p,e.avail_in=l,e.total_in+=g-e.next_in_index,e.next_in_index=g,t.write=c,t.inflate_flush(e,i);default:return i=r,t.bitb=d,t.bitk=p,e.avail_in=l,e.total_in+=g-e.next_in_index,e.next_in_index=g,t.write=c,t.inflate_flush(e,i)}},w.prototype.free=function(t){},w.prototype.inflate_fast=function(t,e,i,r,n,a,h,l){var c,f,u,d,p,g,m,_,v,w,b,y,x,S,C,A;m=l.next_in_index,_=l.avail_in,p=h.bitb,g=h.bitk,w=(v=h.write)<h.read?h.read-v-1:h.end-v,b=o[t],y=o[e];do{for(;g<20;)_--,p|=(255&l.next_in[m++])<<g,g+=8;if(0!=(d=(f=i)[A=3*((u=r)+(c=p&b))]))for(;;){if(p>>=f[A+1],g-=f[A+1],0!=(16&d)){for(d&=15,x=f[A+2]+(p&o[d]),p>>=d,g-=d;g<15;)_--,p|=(255&l.next_in[m++])<<g,g+=8;for(d=(f=n)[A=3*((u=a)+(c=p&y))];;){if(p>>=f[A+1],g-=f[A+1],0!=(16&d)){for(d&=15;g<d;)_--,p|=(255&l.next_in[m++])<<g,g+=8;if(S=f[A+2]+(p&o[d]),p>>=d,g-=d,w-=x,v>=S)C=v-S,h.window[v++]=h.window[C++],h.window[v++]=h.window[C++],x-=2;else{C=v-S;do{C+=h.end}while(C<0);if(x>(d=h.end-C)){if(x-=d,v-C>0&&d>v-C)do{h.window[v++]=h.window[C++]}while(0!=--d);else k(h.window,C,h.window,v,d),v+=d,C+=d,d=0;C=0}}do{h.window[v++]=h.window[C++]}while(0!=--x);break}if(0!=(64&d))return l.msg="invalid distance code",_+=x=g>>3<(x=l.avail_in-_)?g>>3:x,m-=x,g-=x<<3,h.bitb=p,h.bitk=g,l.avail_in=_,l.total_in+=m-l.next_in_index,l.next_in_index=m,h.write=v,s;c+=f[A+2],d=f[A=3*(u+(c+=p&o[d]))]}break}if(0!=(64&d))return 0!=(32&d)?(_+=x=g>>3<(x=l.avail_in-_)?g>>3:x,m-=x,g-=x<<3,h.bitb=p,h.bitk=g,l.avail_in=_,l.total_in+=m-l.next_in_index,l.next_in_index=m,h.write=v,1):(l.msg="invalid literal/length code",_+=x=g>>3<(x=l.avail_in-_)?g>>3:x,m-=x,g-=x<<3,h.bitb=p,h.bitk=g,l.avail_in=_,l.total_in+=m-l.next_in_index,l.next_in_index=m,h.write=v,s);if(c+=f[A+2],0==(d=f[A=3*(u+(c+=p&o[d]))])){p>>=f[A+1],g-=f[A+1],h.window[v++]=f[A+2],w--;break}}else p>>=f[A+1],g-=f[A+1],h.window[v++]=f[A+2],w--}while(w>=258&&_>=10);return _+=x=g>>3<(x=l.avail_in-_)?g>>3:x,m-=x,g-=x<<3,h.bitb=p,h.bitk=g,l.avail_in=_,l.total_in+=m-l.next_in_index,l.next_in_index=m,h.write=v,0},b.prototype.huft_build=function(t,e,i,r,a,o,h,l,c,f,u){var d,p,g,m,_,v,w,b,y,x,S,C,A,T,I;x=0,_=i;do{this.c[t[e+x]]++,x++,_--}while(0!=_);if(this.c[0]==i)return h[0]=-1,l[0]=0,0;for(b=l[0],v=1;v<=15&&0==this.c[v];v++);for(w=v,b<v&&(b=v),_=15;0!=_&&0==this.c[_];_--);for(g=_,b>_&&(b=_),l[0]=b,T=1<<v;v<_;v++,T<<=1)if((T-=this.c[v])<0)return s;if((T-=this.c[_])<0)return s;for(this.c[_]+=T,this.x[1]=v=0,x=1,A=2;0!=--_;)this.x[A]=v+=this.c[x],A++,x++;_=0,x=0;do{0!=(v=t[e+x])&&(this.v[this.x[v]++]=_),x++}while(++_<i);for(i=this.x[g],this.x[0]=_=0,x=0,m=-1,C=-b,this.u[0]=0,S=0,I=0;w<=g;w++)for(d=this.c[w];0!=d--;){for(;w>C+b;){if(m++,I=(I=g-(C+=b))>b?b:I,(p=1<<(v=w-C))>d+1&&(p-=d+1,A=w,v<I))for(;++v<I&&!((p<<=1)<=this.c[++A]);)p-=this.c[A];if(I=1<<v,this.hn[0]+I>1440)return s;this.u[m]=S=this.hn[0],this.hn[0]+=I,0!=m?(this.x[m]=_,this.r[0]=v,this.r[1]=b,v=_>>>C-b,this.r[2]=S-this.u[m-1]-v,k(this.r,0,c,3*(this.u[m-1]+v),3)):h[0]=S}for(this.r[1]=w-C,x>=i?this.r[0]=192:u[x]<r?(this.r[0]=this.v[x]<256?0:96,this.r[2]=this.v[x++]):(this.r[0]=o[this.v[x]-r]+16+64,this.r[2]=a[this.v[x++]-r]),p=1<<w-C,v=_>>>C;v<I;v+=p)k(this.r,0,c,3*(S+v),3);for(v=1<<w-1;0!=(_&v);v>>>=1)_^=v;for(_^=v,y=(1<<C)-1;(_&y)!=this.x[m];)m--,y=(1<<(C-=b))-1}return 0!=T&&1!=g?n:0},b.prototype.inflate_trees_bits=function(t,e,i,r,a){var o;return this.initWorkArea(19),this.hn[0]=0,(o=this.huft_build(t,0,19,19,null,null,i,e,r,this.hn,this.v))==s?a.msg="oversubscribed dynamic bit lengths tree":o!=n&&0!=e[0]||(a.msg="incomplete dynamic bit lengths tree",o=s),o},b.prototype.inflate_trees_dynamic=function(t,e,i,r,a,o,h,l,p){var g;return this.initWorkArea(288),this.hn[0]=0,0!=(g=this.huft_build(i,0,t,257,c,f,o,r,l,this.hn,this.v))||0==r[0]?(g==s?p.msg="oversubscribed literal/length tree":-4!=g&&(p.msg="incomplete literal/length tree",g=s),g):(this.initWorkArea(288),0!=(g=this.huft_build(i,t,e,0,u,d,h,a,l,this.hn,this.v))||0==a[0]&&t>257?(g==s?p.msg="oversubscribed distance tree":g==n?(p.msg="incomplete distance tree",g=s):-4!=g&&(p.msg="empty distance tree with lengths",g=s),g):0)},b.prototype.initWorkArea=function(t){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(t),this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16)),this.v.length<t&&(this.v=new Int32Array(t));for(var e=0;e<t;e++)this.v[e]=0;for(e=0;e<16;e++)this.c[e]=0;for(e=0;e<3;e++)this.r[e]=0;k(this.c,0,this.u,0,15),k(this.c,0,this.x,0,16)};var x="function"==typeof new Uint8Array(1).subarray;function k(t,e,i,r,s){if(0!=s){if(!t)throw"Undef src";if(!i)throw"Undef dest";0==e&&s==t.length?S(t,i,r):x?S(t.subarray(e,e+s),i,r):1==t.BYTES_PER_ELEMENT&&s>100?S(new Uint8Array(t.buffer,t.byteOffset+e,s),i,r):function(t,e,i,r,s){for(var n=0;n<s;++n)i[r+n]=t[e+n]}(t,e,i,r,s)}}function S(t,e,i){e.set(t,i)}function C(t,e,i,r){t=e?new Uint8Array(t,e,i):new Uint8Array(t);var s=new p;s.inflateInit(15,!0),s.next_in=t,s.next_in_index=0,s.avail_in=t.length;for(var n=[],a=0;;){var o=new Uint8Array(32e3);s.next_out=o,s.next_out_index=0,s.avail_out=o.length;var h=s.inflate(0);if(0!=h&&1!=h)throw s.msg;if(0!=s.avail_out){var l=new Uint8Array(o.length-s.avail_out);k(o,0,l,0,o.length-s.avail_out),o=l}if(n.push(o),a+=o.length,1==h)break}if(r&&(r[0]=(e||0)+s.next_in_index),1==n.length)return n[0].buffer;for(var c=new Uint8Array(a),f=0,u=0;u<n.length;++u){var d=n[u];k(d,0,c,f,d.length),f+=d.length}return c.buffer}var A={Huffman:{},Util:{},CRC32:{},CompressionMethod:{DEFLATE:8,RESERVED:15},Zip:function(t){t=t||{},this.files=[],this.comment=t.comment,this.password}};A.Zip.CompressionMethod={STORE:0,DEFLATE:8},A.Zip.OperatingSystem={MSDOS:0,UNIX:3,MACINTOSH:7},A.Zip.Flags={ENCRYPT:1,DESCRIPTOR:8,UTF8:2048},A.Zip.FileHeaderSignature=[80,75,1,2],A.Zip.LocalFileHeaderSignature=[80,75,3,4],A.Zip.CentralDirectorySignature=[80,75,5,6],A.Zip.prototype.addFile=function(t,e){(e=e||{}).filename;var i,r=t.length,s=0;if(t instanceof Array&&(t=new Uint8Array(t)),"number"!=typeof e.compressionMethod&&(e.compressionMethod=A.Zip.CompressionMethod.DEFLATE),e.compress)switch(e.compressionMethod){case A.Zip.CompressionMethod.STORE:break;case A.Zip.CompressionMethod.DEFLATE:s=A.CRC32.calc(t),t=this.deflateWithOption(t,e),i=!0;break;default:throw new Error("unknown compression method:"+e.compressionMethod)}this.files.push({buffer:t,option:e,compressed:i,encrypted:!1,size:r,crc32:s})},A.Zip.prototype.setPassword=function(t){this.password=t},A.Zip.prototype.compress=function(){var t,e,i,r,s,n,a,o,h,l,c,f,u,d,p,g,m,_,v,w,b,y,x,k,S,C,T=this.files,I=0,E=0;for(x=0,k=T.length;x<k;++x){if(d=(t=T[x]).option.filename?t.option.filename.length:0,p=t.option.extraField?t.option.extraField.length:0,g=t.option.comment?t.option.comment.length:0,!t.compressed)switch(t.crc32=A.CRC32.calc(t.buffer),t.option.compressionMethod){case A.Zip.CompressionMethod.STORE:break;case A.Zip.CompressionMethod.DEFLATE:t.buffer=this.deflateWithOption(t.buffer,t.option),t.compressed=!0;break;default:throw new Error("unknown compression method:"+t.option.compressionMethod)}if(void 0!==t.option.password||void 0!==this.password){for(y=this.createEncryptionKey(t.option.password||this.password),w=t.buffer,(b=new Uint8Array(w.length+12)).set(w,12),w=b,S=0;S<12;++S)w[S]=this.encode(y,11===x?255&t.crc32:256*Math.random()|0);for(C=w.length;S<C;++S)w[S]=this.encode(y,w[S]);t.buffer=w}I+=30+d+t.buffer.length,E+=46+d+g}for(n=22+(this.comment?this.comment.length:0),e=new Uint8Array(I+E+n),i=0,s=(r=I)+E,x=0,k=T.length;x<k;++x)d=(t=T[x]).option.filename?t.option.filename.length:0,p=0,g=t.option.comment?t.option.comment.length:0,a=i,e[i++]=A.Zip.LocalFileHeaderSignature[0],e[i++]=A.Zip.LocalFileHeaderSignature[1],e[i++]=A.Zip.LocalFileHeaderSignature[2],e[i++]=A.Zip.LocalFileHeaderSignature[3],e[r++]=A.Zip.FileHeaderSignature[0],e[r++]=A.Zip.FileHeaderSignature[1],e[r++]=A.Zip.FileHeaderSignature[2],e[r++]=A.Zip.FileHeaderSignature[3],e[r++]=20,e[r++]=t.option.os||A.Zip.OperatingSystem.MSDOS,e[i++]=e[r++]=20,e[i++]=e[r++]=0,o=0,(t.option.password||this.password)&&(o|=A.Zip.Flags.ENCRYPT),e[i++]=e[r++]=255&o,e[i++]=e[r++]=o>>8&255,h=t.option.compressionMethod,e[i++]=e[r++]=255&h,e[i++]=e[r++]=h>>8&255,l=t.option.date||new Date,e[i++]=e[r++]=(7&l.getMinutes())<<5|l.getSeconds()/2|0,e[i++]=e[r++]=l.getHours()<<3|l.getMinutes()>>3,e[i++]=e[r++]=(l.getMonth()+1&7)<<5|l.getDate(),e[i++]=e[r++]=(l.getFullYear()-1980&127)<<1|l.getMonth()+1>>3,c=t.crc32,e[i++]=e[r++]=255&c,e[i++]=e[r++]=c>>8&255,e[i++]=e[r++]=c>>16&255,e[i++]=e[r++]=c>>24&255,f=t.buffer.length,e[i++]=e[r++]=255&f,e[i++]=e[r++]=f>>8&255,e[i++]=e[r++]=f>>16&255,e[i++]=e[r++]=f>>24&255,u=t.size,e[i++]=e[r++]=255&u,e[i++]=e[r++]=u>>8&255,e[i++]=e[r++]=u>>16&255,e[i++]=e[r++]=u>>24&255,e[i++]=e[r++]=255&d,e[i++]=e[r++]=d>>8&255,e[i++]=e[r++]=255&p,e[i++]=e[r++]=p>>8&255,e[r++]=255&g,e[r++]=g>>8&255,e[r++]=0,e[r++]=0,e[r++]=0,e[r++]=0,e[r++]=0,e[r++]=0,e[r++]=0,e[r++]=0,e[r++]=255&a,e[r++]=a>>8&255,e[r++]=a>>16&255,e[r++]=a>>24&255,(m=t.option.filename)&&(e.set(m,i),e.set(m,r),i+=d,r+=d),(_=t.option.extraField)&&(e.set(_,i),e.set(_,r),i+=p,r+=p),(v=t.option.comment)&&(e.set(v,r),r+=g),e.set(t.buffer,i),i+=t.buffer.length;return e[s++]=A.Zip.CentralDirectorySignature[0],e[s++]=A.Zip.CentralDirectorySignature[1],e[s++]=A.Zip.CentralDirectorySignature[2],e[s++]=A.Zip.CentralDirectorySignature[3],e[s++]=0,e[s++]=0,e[s++]=0,e[s++]=0,e[s++]=255&k,e[s++]=k>>8&255,e[s++]=255&k,e[s++]=k>>8&255,e[s++]=255&E,e[s++]=E>>8&255,e[s++]=E>>16&255,e[s++]=E>>24&255,e[s++]=255&I,e[s++]=I>>8&255,e[s++]=I>>16&255,e[s++]=I>>24&255,g=this.comment?this.comment.length:0,e[s++]=255&g,e[s++]=g>>8&255,this.comment&&(e.set(this.comment,s),s+=g),e},A.Zip.prototype.deflateWithOption=function(t,e){return new A.RawDeflate(t,e.deflateOption).compress()},A.Zip.prototype.getByte=function(t){var e=65535&t[2]|2;return e*(1^e)>>8&255},A.Zip.prototype.encode=function(t,e){var i=this.getByte(t);return this.updateKeys(t,e),i^e},A.Zip.prototype.updateKeys=function(t,e){t[0]=A.CRC32.single(t[0],e),t[1]=1+(6681*(20173*(t[1]+(255&t[0]))>>>0)>>>0)>>>0,t[2]=A.CRC32.single(t[2],t[1]>>>24)},A.Zip.prototype.createEncryptionKey=function(t){var e,i,r=[305419896,591751049,878082192];for(r=new Uint32Array(r),e=0,i=t.length;e<i;++e)this.updateKeys(r,255&t[e]);return r},A.Huffman.buildHuffmanTable=function(t){var e,i,r,s,n,a,o,h,l,c,f,u=t.length,d=0,p=Number.POSITIVE_INFINITY;for(h=0,l=u;h<l;++h)t[h]>d&&(d=t[h]),t[h]<p&&(p=t[h]);for(e=1<<d,i=new Uint32Array(e),r=1,s=0,n=2;r<=d;){for(h=0;h<u;++h)if(t[h]===r){for(a=0,o=s,c=0;c<r;++c)a=a<<1|1&o,o>>=1;for(f=r<<16|h,c=a;c<e;c+=n)i[c]=f;++s}++r,s<<=1,n<<=1}return[i,d,p]};var T=A.Huffman.buildHuffmanTable;A.RawInflate=function(t,e){switch(this.buffer,this.blocks=[],this.bufferSize=32768,this.totalpos=0,this.ip=0,this.bitsbuf=0,this.bitsbuflen=0,this.input=new Uint8Array(t),this.output,this.op,this.bfinal=!1,this.bufferType=A.RawInflate.BufferType.ADAPTIVE,this.resize=!1,!e&&(e={})||(e.index&&(this.ip=e.index),e.bufferSize&&(this.bufferSize=e.bufferSize),e.bufferType&&(this.bufferType=e.bufferType),e.resize&&(this.resize=e.resize)),this.bufferType){case A.RawInflate.BufferType.BLOCK:this.op=A.RawInflate.MaxBackwardLength,this.output=new Uint8Array(A.RawInflate.MaxBackwardLength+this.bufferSize+A.RawInflate.MaxCopyLength);break;case A.RawInflate.BufferType.ADAPTIVE:this.op=0,this.output=new Uint8Array(this.bufferSize);break;default:throw new Error("invalid inflate mode")}},A.RawInflate.BufferType={BLOCK:0,ADAPTIVE:1},A.RawInflate.prototype.decompress=function(){for(;!this.bfinal;)this.parseBlock();switch(this.bufferType){case A.RawInflate.BufferType.BLOCK:return this.concatBufferBlock();case A.RawInflate.BufferType.ADAPTIVE:return this.concatBufferDynamic();default:throw new Error("invalid inflate mode")}},A.RawInflate.MaxBackwardLength=32768,A.RawInflate.MaxCopyLength=258,A.RawInflate.Order=new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),A.RawInflate.LengthCodeTable=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),A.RawInflate.LengthExtraTable=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),A.RawInflate.DistCodeTable=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),A.RawInflate.DistExtraTable=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),A.RawInflate.FixedLiteralLengthTable=function(){var t,e,i=new Uint8Array(288);for(t=0,e=i.length;t<e;++t)i[t]=t<=143?8:t<=255?9:t<=279?7:8;return T(i)}(),A.RawInflate.FixedDistanceTable=function(){var t,e,i=new Uint8Array(30);for(t=0,e=i.length;t<e;++t)i[t]=5;return T(i)}(),A.RawInflate.prototype.parseBlock=function(){var t=this.readBits(3);switch(1&t&&(this.bfinal=!0),t>>>=1){case 0:this.parseUncompressedBlock();break;case 1:this.parseFixedHuffmanBlock();break;case 2:this.parseDynamicHuffmanBlock();break;default:throw new Error("unknown BTYPE: "+t)}},A.RawInflate.prototype.readBits=function(t){var e,i=this.bitsbuf,r=this.bitsbuflen,s=this.input,n=this.ip;if(n+(t-r+7>>3)>=s.length)throw new Error("input buffer is broken");for(;r<t;)i|=s[n++]<<r,r+=8;return e=i&(1<<t)-1,i>>>=t,r-=t,this.bitsbuf=i,this.bitsbuflen=r,this.ip=n,e},A.RawInflate.prototype.readCodeByTable=function(t){for(var e,i,r=this.bitsbuf,s=this.bitsbuflen,n=this.input,a=this.ip,o=n.length,h=t[0],l=t[1];s<l&&!(a>=o);)r|=n[a++]<<s,s+=8;if((i=(e=h[r&(1<<l)-1])>>>16)>s)throw new Error("invalid code length: "+i);return this.bitsbuf=r>>i,this.bitsbuflen=s-i,this.ip=a,65535&e},A.RawInflate.prototype.parseUncompressedBlock=function(){var t,e,i=this.input,r=this.ip,s=this.output,n=this.op,a=i.length,o=s.length;if(this.bitsbuf=0,this.bitsbuflen=0,r+1>=a)throw new Error("invalid uncompressed block header: LEN");if(t=i[r++]|i[r++]<<8,r+1>=a)throw new Error("invalid uncompressed block header: NLEN");if(t===~(i[r++]|i[r++]<<8))throw new Error("invalid uncompressed block header: length verify");if(r+t>i.length)throw new Error("input buffer is broken");switch(this.bufferType){case A.RawInflate.BufferType.BLOCK:for(;n+t>s.length;)t-=e=o-n,s.set(i.subarray(r,r+e),n),n+=e,r+=e,this.op=n,s=this.expandBufferBlock(),n=this.op;break;case A.RawInflate.BufferType.ADAPTIVE:for(;n+t>s.length;)s=this.expandBufferAdaptive({fixRatio:2});break;default:throw new Error("invalid inflate mode")}s.set(i.subarray(r,r+t),n),n+=t,r+=t,this.ip=r,this.op=n,this.output=s},A.RawInflate.prototype.parseFixedHuffmanBlock=function(){switch(this.bufferType){case A.RawInflate.BufferType.ADAPTIVE:this.decodeHuffmanAdaptive(A.RawInflate.FixedLiteralLengthTable,A.RawInflate.FixedDistanceTable);break;case A.RawInflate.BufferType.BLOCK:this.decodeHuffmanBlock(A.RawInflate.FixedLiteralLengthTable,A.RawInflate.FixedDistanceTable);break;default:throw new Error("invalid inflate mode")}},A.RawInflate.prototype.parseDynamicHuffmanBlock=function(){var t,e,i,r,s,n,a,o,h,l=this.readBits(5)+257,c=this.readBits(5)+1,f=this.readBits(4)+4,u=new Uint8Array(A.RawInflate.Order.length);for(o=0;o<f;++o)u[A.RawInflate.Order[o]]=this.readBits(3);for(t=T(u),r=new Uint8Array(l+c),o=0,h=l+c;o<h;)switch(s=this.readCodeByTable(t)){case 16:for(a=3+this.readBits(2);a--;)r[o++]=n;break;case 17:for(a=3+this.readBits(3);a--;)r[o++]=0;n=0;break;case 18:for(a=11+this.readBits(7);a--;)r[o++]=0;n=0;break;default:r[o++]=s,n=s}switch(e=T(r.subarray(0,l)),i=T(r.subarray(l)),this.bufferType){case A.RawInflate.BufferType.ADAPTIVE:this.decodeHuffmanAdaptive(e,i);break;case A.RawInflate.BufferType.BLOCK:this.decodeHuffmanBlock(e,i);break;default:throw new Error("invalid inflate mode")}},A.RawInflate.prototype.decodeHuffmanBlock=function(t,e){var i=this.output,r=this.op;this.currentLitlenTable=t;for(var s,n,a,o,h=i.length-A.RawInflate.MaxCopyLength,l=A.RawInflate.LengthCodeTable,c=A.RawInflate.LengthExtraTable,f=A.RawInflate.DistCodeTable,u=A.RawInflate.DistExtraTable;256!==(s=this.readCodeByTable(t));)if(s<256)r>=h&&(this.op=r,i=this.expandBufferBlock(),r=this.op),i[r++]=s;else for(o=l[n=s-257],c[n]>0&&(o+=this.readBits(c[n])),a=f[s=this.readCodeByTable(e)],u[s]>0&&(a+=this.readBits(u[s])),r>=h&&(this.op=r,i=this.expandBufferBlock(),r=this.op);o--;)i[r]=i[r++-a];for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=r},A.RawInflate.prototype.decodeHuffmanAdaptive=function(t,e){var i=this.output,r=this.op;this.currentLitlenTable=t;for(var s,n,a,o,h=i.length,l=A.RawInflate.LengthCodeTable,c=A.RawInflate.LengthExtraTable,f=A.RawInflate.DistCodeTable,u=A.RawInflate.DistExtraTable;256!==(s=this.readCodeByTable(t));)if(s<256)r>=h&&(h=(i=this.expandBufferAdaptive()).length),i[r++]=s;else for(o=l[n=s-257],c[n]>0&&(o+=this.readBits(c[n])),a=f[s=this.readCodeByTable(e)],u[s]>0&&(a+=this.readBits(u[s])),r+o>h&&(h=(i=this.expandBufferAdaptive()).length);o--;)i[r]=i[r++-a];for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=r},A.RawInflate.prototype.expandBufferBlock=function(t){var e=new Uint8Array(this.op-A.RawInflate.MaxBackwardLength),i=this.op-A.RawInflate.MaxBackwardLength,r=this.output;return e.set(r.subarray(A.RawInflate.MaxBackwardLength,e.length)),this.blocks.push(e),this.totalpos+=e.length,r.set(r.subarray(i,i+A.RawInflate.MaxBackwardLength)),this.op=A.RawInflate.MaxBackwardLength,r},A.RawInflate.prototype.expandBufferAdaptive=function(t){var e,i,r,s=this.input.length/this.ip+1|0,n=this.input,a=this.output;return t&&("number"==typeof t.fixRatio&&(s=t.fixRatio),"number"==typeof t.addRatio&&(s+=t.addRatio)),i=s<2?(r=(n.length-this.ip)/this.currentLitlenTable[2]/2*258|0)<a.length?a.length+r:a.length<<1:a.length*s,(e=new Uint8Array(i)).set(a),this.output=e,this.output},A.RawInflate.prototype.concatBufferBlock=function(){var t,e,i,r,s,n=0,a=this.totalpos+(this.op-A.RawInflate.MaxBackwardLength),o=this.output,h=this.blocks,l=new Uint8Array(a);if(0===h.length)return this.output.subarray(A.RawInflate.MaxBackwardLength,this.op);for(e=0,i=h.length;e<i;++e)for(r=0,s=(t=h[e]).length;r<s;++r)l[n++]=t[r];for(e=A.RawInflate.MaxBackwardLength,i=this.op;e<i;++e)l[n++]=o[e];return this.blocks=[],this.buffer=l,this.buffer},A.RawInflate.prototype.concatBufferDynamic=function(){var t,e=this.op;return this.resize?(t=new Uint8Array(e)).set(this.output.subarray(0,e)):t=this.output.subarray(0,e),this.buffer=t,this.buffer},T=A.Huffman.buildHuffmanTable,A.RawInflateStream=function(t,e,i){this.blocks=[],this.bufferSize=i||65e3,this.totalpos=0,this.ip=void 0===e?0:e,this.bitsbuf=0,this.bitsbuflen=0,this.input=new Uint8Array(t),this.output=new Uint8Array(this.bufferSize),this.op=0,this.bfinal=!1,this.blockLength,this.resize=!1,this.litlenTable,this.distTable,this.sp=0,this.status=A.RawInflateStream.Status.INITIALIZED,this.ip_,this.bitsbuflen_,this.bitsbuf_},A.RawInflateStream.BlockType={UNCOMPRESSED:0,FIXED:1,DYNAMIC:2},A.RawInflateStream.Status={INITIALIZED:0,BLOCK_HEADER_START:1,BLOCK_HEADER_END:2,BLOCK_BODY_START:3,BLOCK_BODY_END:4,DECODE_BLOCK_START:5,DECODE_BLOCK_END:6},A.RawInflateStream.prototype.decompress=function(t,e){var i=!1;for(void 0!==t&&(this.input=t),void 0!==e&&(this.ip=e);!i;)switch(this.status){case A.RawInflateStream.Status.INITIALIZED:case A.RawInflateStream.Status.BLOCK_HEADER_START:this.readBlockHeader()<0&&(i=!0);break;case A.RawInflateStream.Status.BLOCK_HEADER_END:case A.RawInflateStream.Status.BLOCK_BODY_START:switch(this.currentBlockType){case A.RawInflateStream.BlockType.UNCOMPRESSED:this.readUncompressedBlockHeader()<0&&(i=!0);break;case A.RawInflateStream.BlockType.FIXED:this.parseFixedHuffmanBlock()<0&&(i=!0);break;case A.RawInflateStream.BlockType.DYNAMIC:this.parseDynamicHuffmanBlock()<0&&(i=!0)}break;case A.RawInflateStream.Status.BLOCK_BODY_END:case A.RawInflateStream.Status.DECODE_BLOCK_START:switch(this.currentBlockType){case A.RawInflateStream.BlockType.UNCOMPRESSED:this.parseUncompressedBlock()<0&&(i=!0);break;case A.RawInflateStream.BlockType.FIXED:case A.RawInflateStream.BlockType.DYNAMIC:this.decodeHuffman()<0&&(i=!0)}break;case A.RawInflateStream.Status.DECODE_BLOCK_END:this.bfinal?i=!0:this.status=A.RawInflateStream.Status.INITIALIZED}return this.concatBuffer()},A.RawInflateStream.MaxBackwardLength=32768,A.RawInflateStream.MaxCopyLength=258,A.RawInflateStream.Order=new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),A.RawInflateStream.LengthCodeTable=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),A.RawInflateStream.LengthExtraTable=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),A.RawInflateStream.DistCodeTable=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),A.RawInflateStream.DistExtraTable=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),A.RawInflateStream.FixedLiteralLengthTable=function(){var t,e,i=new Uint8Array(288);for(t=0,e=i.length;t<e;++t)i[t]=t<=143?8:t<=255?9:t<=279?7:8;return T(i)}(),A.RawInflateStream.FixedDistanceTable=function(){var t,e,i=new Uint8Array(30);for(t=0,e=i.length;t<e;++t)i[t]=5;return T(i)}(),A.RawInflateStream.prototype.readBlockHeader=function(){var t;if(this.status=A.RawInflateStream.Status.BLOCK_HEADER_START,this.save_(),(t=this.readBits(3))<0)return this.restore_(),-1;switch(1&t&&(this.bfinal=!0),t>>>=1){case 0:this.currentBlockType=A.RawInflateStream.BlockType.UNCOMPRESSED;break;case 1:this.currentBlockType=A.RawInflateStream.BlockType.FIXED;break;case 2:this.currentBlockType=A.RawInflateStream.BlockType.DYNAMIC;break;default:throw new Error("unknown BTYPE: "+t)}this.status=A.RawInflateStream.Status.BLOCK_HEADER_END},A.RawInflateStream.prototype.readBits=function(t){for(var e,i=this.bitsbuf,r=this.bitsbuflen,s=this.input,n=this.ip;r<t;){if(s.length<=n)return-1;i|=(e=s[n++])<<r,r+=8}return e=i&(1<<t)-1,i>>>=t,r-=t,this.bitsbuf=i,this.bitsbuflen=r,this.ip=n,e},A.RawInflateStream.prototype.readCodeByTable=function(t){for(var e,i,r=this.bitsbuf,s=this.bitsbuflen,n=this.input,a=this.ip,o=t[0],h=t[1];s<h;){if(n.length<=a)return-1;r|=n[a++]<<s,s+=8}if((i=(e=o[r&(1<<h)-1])>>>16)>s)throw new Error("invalid code length: "+i);return this.bitsbuf=r>>i,this.bitsbuflen=s-i,this.ip=a,65535&e},A.RawInflateStream.prototype.readUncompressedBlockHeader=function(){var t,e=this.input,i=this.ip;if(this.status=A.RawInflateStream.Status.BLOCK_BODY_START,i+4>=e.length)return-1;if((t=e[i++]|e[i++]<<8)==~(e[i++]|e[i++]<<8))throw new Error("invalid uncompressed block header: length verify");this.bitsbuf=0,this.bitsbuflen=0,this.ip=i,this.blockLength=t,this.status=A.RawInflateStream.Status.BLOCK_BODY_END},A.RawInflateStream.prototype.parseUncompressedBlock=function(){var t=this.input,e=this.ip,i=this.output,r=this.op,s=this.blockLength;for(this.status=A.RawInflateStream.Status.DECODE_BLOCK_START;s--;){if(r===i.length&&(i=this.expandBuffer({fixRatio:2})),e>=t.length)return this.ip=e,this.op=r,this.blockLength=s+1,-1;i[r++]=t[e++]}return s<0&&(this.status=A.RawInflateStream.Status.DECODE_BLOCK_END),this.ip=e,this.op=r,0},A.RawInflateStream.prototype.parseFixedHuffmanBlock=function(){return this.status=A.RawInflateStream.Status.BLOCK_BODY_START,this.litlenTable=A.RawInflateStream.FixedLiteralLengthTable,this.distTable=A.RawInflateStream.FixedDistanceTable,this.status=A.RawInflateStream.Status.BLOCK_BODY_END,0},A.RawInflateStream.prototype.save_=function(){this.ip_=this.ip,this.bitsbuflen_=this.bitsbuflen,this.bitsbuf_=this.bitsbuf},A.RawInflateStream.prototype.restore_=function(){this.ip=this.ip_,this.bitsbuflen=this.bitsbuflen_,this.bitsbuf=this.bitsbuf_},A.RawInflateStream.prototype.parseDynamicHuffmanBlock=function(){var t,e,i,r,s=new Uint8Array(A.RawInflateStream.Order.length);if(this.status=A.RawInflateStream.Status.BLOCK_BODY_START,this.save_(),t=this.readBits(5)+257,e=this.readBits(5)+1,i=this.readBits(4)+4,t<0||e<0||i<0)return this.restore_(),-1;try{(function(){var n,a,o,h,l,c,f=0;for(l=0;l<i;++l){if((n=this.readBits(3))<0)throw new Error("not enough input");s[A.RawInflateStream.Order[l]]=n}for(r=T(s),h=new Uint8Array(t+e),l=0,c=t+e;l<c;){if((a=this.readCodeByTable(r))<0)throw new Error("not enough input");switch(a){case 16:if((n=this.readBits(2))<0)throw new Error("not enough input");for(o=3+n;o--;)h[l++]=f;break;case 17:if((n=this.readBits(3))<0)throw new Error("not enough input");for(o=3+n;o--;)h[l++]=0;f=0;break;case 18:if((n=this.readBits(7))<0)throw new Error("not enough input");for(o=11+n;o--;)h[l++]=0;f=0;break;default:h[l++]=a,f=a}}new Uint8Array(t),new Uint8Array(e),this.litlenTable=T(h.subarray(0,t)),this.distTable=T(h.subarray(t))}).call(this)}catch(t){return this.restore_(),-1}return this.status=A.RawInflateStream.Status.BLOCK_BODY_END,0},A.RawInflateStream.prototype.decodeHuffman=function(){var t,e,i,r,s,n=this.output,a=this.op,o=this.litlenTable,h=this.distTable,l=n.length;for(this.status=A.RawInflateStream.Status.DECODE_BLOCK_START;;){if(this.save_(),(t=this.readCodeByTable(o))<0)return this.op=a,this.restore_(),-1;if(256===t)break;if(t<256)a===l&&(l=(n=this.expandBuffer()).length),n[a++]=t;else{if(e=t-257,r=A.RawInflateStream.LengthCodeTable[e],A.RawInflateStream.LengthExtraTable[e]>0){if((s=this.readBits(A.RawInflateStream.LengthExtraTable[e]))<0)return this.op=a,this.restore_(),-1;r+=s}if((t=this.readCodeByTable(h))<0)return this.op=a,this.restore_(),-1;if(i=A.RawInflateStream.DistCodeTable[t],A.RawInflateStream.DistExtraTable[t]>0){if((s=this.readBits(A.RawInflateStream.DistExtraTable[t]))<0)return this.op=a,this.restore_(),-1;i+=s}for(a+r>=l&&(l=(n=this.expandBuffer()).length);r--;)n[a]=n[a++-i];if(this.ip===this.input.length)return this.op=a,-1}}for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=a,this.status=A.RawInflateStream.Status.DECODE_BLOCK_END},A.RawInflateStream.prototype.expandBuffer=function(t){var e,i,r,s=this.input.length/this.ip+1|0,n=this.input,a=this.output;return t&&("number"==typeof t.fixRatio&&(s=t.fixRatio),"number"==typeof t.addRatio&&(s+=t.addRatio)),i=s<2?(r=(n.length-this.ip)/this.litlenTable[2]/2*258|0)<a.length?a.length+r:a.length<<1:a.length*s,(e=new Uint8Array(i)).set(a),this.output=e,this.output},A.RawInflateStream.prototype.concatBuffer=function(){var t,e,i=this.op;return t=this.resize?new Uint8Array(this.output.subarray(this.sp,i)):this.output.subarray(this.sp,i),this.sp=i,i>A.RawInflateStream.MaxBackwardLength+this.bufferSize&&(this.op=this.sp=A.RawInflateStream.MaxBackwardLength,e=this.output,this.output=new Uint8Array(this.bufferSize+A.RawInflateStream.MaxBackwardLength),this.output.set(e.subarray(i-A.RawInflateStream.MaxBackwardLength,i))),t},A.Inflate=function(t,e){var i,r;if(this.input=t,this.ip=0,this.rawinflate,this.verify,!e&&(e={})||(e.index&&(this.ip=e.index),e.verify&&(this.verify=e.verify)),i=t[this.ip++],r=t[this.ip++],(15&i)!==A.CompressionMethod.DEFLATE)throw new Error("unsupported compression method");if(this.method=A.CompressionMethod.DEFLATE,((i<<8)+r)%31!=0)throw new Error("invalid fcheck flag:"+((i<<8)+r)%31);if(32&r)throw new Error("fdict flag is not supported");this.rawinflate=new A.RawInflate(t,{index:this.ip,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})},A.Inflate.BufferType=A.RawInflate.BufferType,A.Inflate.prototype.decompress=function(){var t,e=this.input;if(t=this.rawinflate.decompress(),this.ip=this.rawinflate.ip,this.verify&&(e[this.ip++]<<24|e[this.ip++]<<16|e[this.ip++]<<8|e[this.ip++])>>>0!==A.Adler32(t))throw new Error("invalid adler-32 checksum");return t},A.InflateStream=function(t){this.input=void 0===t?new Uint8Array:t,this.ip=0,this.rawinflate=new A.RawInflateStream(this.input,this.ip),this.method,this.output=this.rawinflate.output},A.InflateStream.prototype.decompress=function(t){var e;if(void 0!==t){var i=new Uint8Array(this.input.length+t.length);i.set(this.input,0),i.set(t,this.input.length),this.input=i}return void 0===this.method&&this.readHeader()<0?new Uint8Array:(e=this.rawinflate.decompress(this.input,this.ip),0!==this.rawinflate.ip&&(this.input=this.input.subarray(this.rawinflate.ip),this.ip=0),e)},A.InflateStream.prototype.readHeader=function(){var t=this.ip,e=this.input,i=e[t++],r=e[t++];if(void 0===i||void 0===r)return-1;if((15&i)!==A.CompressionMethod.DEFLATE)throw new Error("unsupported compression method");if(this.method=A.CompressionMethod.DEFLATE,((i<<8)+r)%31!=0)throw new Error("invalid fcheck flag:"+((i<<8)+r)%31);if(32&r)throw new Error("fdict flag is not supported");this.ip=t},A.Gunzip=function(t,e){this.input=t,this.ip=0,this.member=[],this.decompressed=!1},A.Gunzip.prototype.getMembers=function(){return this.decompressed||this.decompress(),this.member.slice()},A.Gunzip.prototype.decompress=function(){for(var t=this.input.length;this.ip<t;)this.decodeMember();return this.decompressed=!0,this.concatMember()},A.Gunzip.prototype.decodeMember=function(){var t,e,i,r,s,n,a,o,h,l=new A.GunzipMember,c=this.input,f=this.ip;if(l.id1=c[f++],l.id2=c[f++],31!==l.id1||139!==l.id2)throw new Error("invalid file signature:"+l.id1+","+l.id2);if(l.cm=c[f++],8!==l.cm)throw new Error("unknown compression method: "+l.cm);if(l.flg=c[f++],o=c[f++]|c[f++]<<8|c[f++]<<16|c[f++]<<24,l.mtime=new Date(1e3*o),l.xfl=c[f++],l.os=c[f++],(l.flg&A.Gzip.FlagsMask.FEXTRA)>0&&(l.xlen=c[f++]|c[f++]<<8,f=this.decodeSubField(f,l.xlen)),(l.flg&A.Gzip.FlagsMask.FNAME)>0){for(a=[],n=0;(s=c[f++])>0;)a[n++]=String.fromCharCode(s);l.name=a.join("")}if((l.flg&A.Gzip.FlagsMask.FCOMMENT)>0){for(a=[],n=0;(s=c[f++])>0;)a[n++]=String.fromCharCode(s);l.comment=a.join("")}if((l.flg&A.Gzip.FlagsMask.FHCRC)>0&&(l.crc16=65535&A.CRC32.calc(c,0,f),l.crc16!==(c[f++]|c[f++]<<8)))throw new Error("invalid header crc16");if(t=c[c.length-4]|c[c.length-3]<<8|c[c.length-2]<<16|c[c.length-1]<<24,c.length-f-4-4<512*t&&(r=t),e=new A.RawInflate(c,{index:f,bufferSize:r}),l.data=i=e.decompress(),f=e.ip,l.crc32=h=(c[f++]|c[f++]<<8|c[f++]<<16|c[f++]<<24)>>>0,A.CRC32.calc(i)!==h)throw new Error("invalid CRC-32 checksum: 0x"+A.CRC32.calc(i).toString(16)+" / 0x"+h.toString(16));if(l.isize=t=(c[f++]|c[f++]<<8|c[f++]<<16|c[f++]<<24)>>>0,(4294967295&i.length)!==t)throw new Error("invalid input size: "+(4294967295&i.length)+" / "+t);this.member.push(l),this.ip=f},A.Gunzip.prototype.decodeSubField=function(t,e){return t+e},A.Gunzip.prototype.concatMember=function(){var t,e,i,r=this.member,s=0,n=0;for(t=0,e=r.length;t<e;++t)n+=r[t].data.length;for(i=new Uint8Array(n),t=0;t<e;++t)i.set(r[t].data,s),s+=r[t].data.length;return i},A.GunzipMember=function(){this.id1,this.id2,this.cm,this.flg,this.mtime,this.xfl,this.os,this.crc16,this.xlen,this.crc32,this.isize,this.name,this.comment,this.data},A.GunzipMember.prototype.getName=function(){return this.name},A.GunzipMember.prototype.getData=function(){return this.data},A.GunzipMember.prototype.getMtime=function(){return this.mtime},A.Gzip=function(t,e){this.input=t,this.ip=0,this.output,this.op=0,this.flags={},this.filename,this.comment,this.deflateOptions,e&&(e.flags&&(this.flags=e.flags),"string"==typeof e.filename&&(this.filename=e.filename),"string"==typeof e.comment&&(this.comment=e.comment),e.deflateOptions&&(this.deflateOptions=e.deflateOptions)),this.deflateOptions||(this.deflateOptions={})},A.Gzip.DefaultBufferSize=32768,A.Gzip.prototype.compress=function(){var t,e,i,r,s,n,a,o,h=new Uint8Array(A.Gzip.DefaultBufferSize),l=0,c=this.input,f=this.ip,u=this.filename,d=this.comment;if(h[l++]=31,h[l++]=139,h[l++]=8,t=0,this.flags.fname&&(t|=A.Gzip.FlagsMask.FNAME),this.flags.fcomment&&(t|=A.Gzip.FlagsMask.FCOMMENT),this.flags.fhcrc&&(t|=A.Gzip.FlagsMask.FHCRC),h[l++]=t,e=(Date.now?Date.now():+new Date)/1e3|0,h[l++]=255&e,h[l++]=e>>>8&255,h[l++]=e>>>16&255,h[l++]=e>>>24&255,h[l++]=0,h[l++]=A.Gzip.OperatingSystem.UNKNOWN,void 0!==this.flags.fname){for(a=0,o=u.length;a<o;++a)(n=u.charCodeAt(a))>255&&(h[l++]=n>>>8&255),h[l++]=255&n;h[l++]=0}if(this.flags.comment){for(a=0,o=d.length;a<o;++a)(n=d.charCodeAt(a))>255&&(h[l++]=n>>>8&255),h[l++]=255&n;h[l++]=0}return this.flags.fhcrc&&(i=65535&A.CRC32.calc(h,0,l),h[l++]=255&i,h[l++]=i>>>8&255),this.deflateOptions.outputBuffer=h,this.deflateOptions.outputIndex=l,h=(s=new A.RawDeflate(c,this.deflateOptions)).compress(),(l=s.op)+8>h.buffer.byteLength?(this.output=new Uint8Array(l+8),this.output.set(new Uint8Array(h.buffer)),h=this.output):h=new Uint8Array(h.buffer),r=A.CRC32.calc(c),h[l++]=255&r,h[l++]=r>>>8&255,h[l++]=r>>>16&255,h[l++]=r>>>24&255,o=c.length,h[l++]=255&o,h[l++]=o>>>8&255,h[l++]=o>>>16&255,h[l++]=o>>>24&255,this.ip=f,l<h.length&&(this.output=h=h.subarray(0,l)),h},A.Gzip.OperatingSystem={FAT:0,AMIGA:1,VMS:2,UNIX:3,VM_CMS:4,ATARI_TOS:5,HPFS:6,MACINTOSH:7,Z_SYSTEM:8,CP_M:9,TOPS_20:10,NTFS:11,QDOS:12,ACORN_RISCOS:13,UNKNOWN:255},A.Gzip.FlagsMask={FTEXT:1,FHCRC:2,FEXTRA:4,FNAME:8,FCOMMENT:16},A.Heap=function(t){this.buffer=new Uint16Array(2*t),this.length=0},A.Heap.prototype.getParent=function(t){return 2*((t-2)/4|0)},A.Heap.prototype.getChild=function(t){return 2*t+2},A.Heap.prototype.push=function(t,e){var i,r,s,n=this.buffer;for(i=this.length,n[this.length++]=e,n[this.length++]=t;i>0&&(r=this.getParent(i),n[i]>n[r]);)s=n[i],n[i]=n[r],n[r]=s,s=n[i+1],n[i+1]=n[r+1],n[r+1]=s,i=r;return this.length},A.Heap.prototype.pop=function(){var t,e,i,r,s,n=this.buffer;for(e=n[0],t=n[1],this.length-=2,n[0]=n[this.length],n[1]=n[this.length+1],s=0;!((r=this.getChild(s))>=this.length)&&(r+2<this.length&&n[r+2]>n[r]&&(r+=2),n[r]>n[s]);)i=n[s],n[s]=n[r],n[r]=i,i=n[s+1],n[s+1]=n[r+1],n[r+1]=i,s=r;return{index:t,value:e,length:this.length}},A.RawDeflate=function(t,e){this.compressionType=A.RawDeflate.CompressionType.DYNAMIC,this.lazy=0,this.freqsLitLen,this.freqsDist,this.input=t instanceof Array?new Uint8Array(t):t,this.output,this.op=0,e&&(e.lazy&&(this.lazy=e.lazy),"number"==typeof e.compressionType&&(this.compressionType=e.compressionType),e.outputBuffer&&(this.output=e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.op=e.outputIndex)),this.output||(this.output=new Uint8Array(32768))},A.RawDeflate.CompressionType={NONE:0,FIXED:1,DYNAMIC:2,RESERVED:3},A.RawDeflate.Lz77MinLength=3,A.RawDeflate.Lz77MaxLength=258,A.RawDeflate.WindowSize=32768,A.RawDeflate.MaxCodeLength=16,A.RawDeflate.HUFMAX=286,A.RawDeflate.FixedHuffmanTable=function(){var t,e=[];for(t=0;t<288;t++)switch(!0){case t<=143:e.push([t+48,8]);break;case t<=255:e.push([t-144+400,9]);break;case t<=279:e.push([t-256+0,7]);break;case t<=287:e.push([t-280+192,8]);break;default:throw"invalid literal: "+t}return e}(),A.RawDeflate.prototype.compress=function(){var t,e,i,r=this.input;switch(this.compressionType){case A.RawDeflate.CompressionType.NONE:for(e=0,i=r.length;e<i;)e+=(t=r.subarray(e,e+65535)).length,this.makeNocompressBlock(t,e===i);break;case A.RawDeflate.CompressionType.FIXED:this.output=this.makeFixedHuffmanBlock(r,!0),this.op=this.output.length;break;case A.RawDeflate.CompressionType.DYNAMIC:this.output=this.makeDynamicHuffmanBlock(r,!0),this.op=this.output.length;break;default:throw"invalid compression type"}return this.output},A.RawDeflate.prototype.makeNocompressBlock=function(t,e){var i,r,s,n,a=this.output,o=this.op;for(a=new Uint8Array(this.output.buffer);a.length<=o+t.length+5;)a=new Uint8Array(a.length<<1);return a.set(this.output),i=e?1:0,r=A.RawDeflate.CompressionType.NONE,a[o++]=i|r<<1,n=65536+~(s=t.length)&65535,a[o++]=255&s,a[o++]=s>>>8&255,a[o++]=255&n,a[o++]=n>>>8&255,a.set(t,o),o+=t.length,a=a.subarray(0,o),this.op=o,this.output=a,a},A.RawDeflate.prototype.makeFixedHuffmanBlock=function(t,e){var i,r,s,n=new A.BitStream(new Uint8Array(this.output.buffer),this.op);return i=e?1:0,r=A.RawDeflate.CompressionType.FIXED,n.writeBits(i,1,!0),n.writeBits(r,2,!0),s=this.lz77(t),this.fixedHuffman(s,n),n.finish()},A.RawDeflate.prototype.makeDynamicHuffmanBlock=function(t,e){var i,r,s,n,a,o,h,l,c,f,u,d,p,g,m,_,v,w=new A.BitStream(new Uint8Array(this.output.buffer),this.op),b=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],y=new Array(19);for(i=e?1:0,r=A.RawDeflate.CompressionType.DYNAMIC,w.writeBits(i,1,!0),w.writeBits(r,2,!0),s=this.lz77(t),h=this.getLengths_(this.freqsLitLen,15),l=this.getCodesFromLengths_(h),c=this.getLengths_(this.freqsDist,7),f=this.getCodesFromLengths_(c),n=286;n>257&&0===h[n-1];n--);for(a=30;a>1&&0===c[a-1];a--);for(u=this.getTreeSymbols_(n,h,a,c),d=this.getLengths_(u.freqs,7),_=0;_<19;_++)y[_]=d[b[_]];for(o=19;o>4&&0===y[o-1];o--);for(p=this.getCodesFromLengths_(d),w.writeBits(n-257,5,!0),w.writeBits(a-1,5,!0),w.writeBits(o-4,4,!0),_=0;_<o;_++)w.writeBits(y[_],3,!0);for(_=0,v=u.codes.length;_<v;_++)if(g=u.codes[_],w.writeBits(p[g],d[g],!0),g>=16){switch(_++,g){case 16:m=2;break;case 17:m=3;break;case 18:m=7;break;default:throw"invalid code: "+g}w.writeBits(u.codes[_],m,!0)}return this.dynamicHuffman(s,[l,h],[f,c],w),w.finish()},A.RawDeflate.prototype.dynamicHuffman=function(t,e,i,r){var s,n,a,o,h,l,c,f;for(h=e[0],l=e[1],c=i[0],f=i[1],s=0,n=t.length;s<n;++s)if(a=t[s],r.writeBits(h[a],l[a],!0),a>256)r.writeBits(t[++s],t[++s],!0),o=t[++s],r.writeBits(c[o],f[o],!0),r.writeBits(t[++s],t[++s],!0);else if(256===a)break;return r},A.RawDeflate.prototype.fixedHuffman=function(t,e){var i,r,s;for(i=0,r=t.length;i<r;i++)if(s=t[i],A.BitStream.prototype.writeBits.apply(e,A.RawDeflate.FixedHuffmanTable[s]),s>256)e.writeBits(t[++i],t[++i],!0),e.writeBits(t[++i],5),e.writeBits(t[++i],t[++i],!0);else if(256===s)break;return e},A.RawDeflate.Lz77Match=function(t,e){this.length=t,this.backwardDistance=e},A.RawDeflate.Lz77Match.LengthCodeTable=function(t){return new Uint32Array(t)}(function(){var t,e,i=[];for(t=3;t<=258;t++)e=r(t),i[t]=e[2]<<24|e[1]<<16|e[0];function r(t){switch(!0){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case t<=12:return[265,t-11,1];case t<=14:return[266,t-13,1];case t<=16:return[267,t-15,1];case t<=18:return[268,t-17,1];case t<=22:return[269,t-19,2];case t<=26:return[270,t-23,2];case t<=30:return[271,t-27,2];case t<=34:return[272,t-31,2];case t<=42:return[273,t-35,3];case t<=50:return[274,t-43,3];case t<=58:return[275,t-51,3];case t<=66:return[276,t-59,3];case t<=82:return[277,t-67,4];case t<=98:return[278,t-83,4];case t<=114:return[279,t-99,4];case t<=130:return[280,t-115,4];case t<=162:return[281,t-131,5];case t<=194:return[282,t-163,5];case t<=226:return[283,t-195,5];case t<=257:return[284,t-227,5];case 258===t:return[285,t-258,0];default:throw"invalid length: "+t}}return i}()),A.RawDeflate.Lz77Match.prototype.getDistanceCode_=function(t){var e;switch(!0){case 1===t:e=[0,t-1,0];break;case 2===t:e=[1,t-2,0];break;case 3===t:e=[2,t-3,0];break;case 4===t:e=[3,t-4,0];break;case t<=6:e=[4,t-5,1];break;case t<=8:e=[5,t-7,1];break;case t<=12:e=[6,t-9,2];break;case t<=16:e=[7,t-13,2];break;case t<=24:e=[8,t-17,3];break;case t<=32:e=[9,t-25,3];break;case t<=48:e=[10,t-33,4];break;case t<=64:e=[11,t-49,4];break;case t<=96:e=[12,t-65,5];break;case t<=128:e=[13,t-97,5];break;case t<=192:e=[14,t-129,6];break;case t<=256:e=[15,t-193,6];break;case t<=384:e=[16,t-257,7];break;case t<=512:e=[17,t-385,7];break;case t<=768:e=[18,t-513,8];break;case t<=1024:e=[19,t-769,8];break;case t<=1536:e=[20,t-1025,9];break;case t<=2048:e=[21,t-1537,9];break;case t<=3072:e=[22,t-2049,10];break;case t<=4096:e=[23,t-3073,10];break;case t<=6144:e=[24,t-4097,11];break;case t<=8192:e=[25,t-6145,11];break;case t<=12288:e=[26,t-8193,12];break;case t<=16384:e=[27,t-12289,12];break;case t<=24576:e=[28,t-16385,13];break;case t<=32768:e=[29,t-24577,13];break;default:throw"invalid distance"}return e},A.RawDeflate.Lz77Match.prototype.toLz77Array=function(){var t,e=this.length,i=this.backwardDistance,r=[],s=0;return t=A.RawDeflate.Lz77Match.LengthCodeTable[e],r[s++]=65535&t,r[s++]=t>>16&255,r[s++]=t>>24,t=this.getDistanceCode_(i),r[s++]=t[0],r[s++]=t[1],r[s++]=t[2],r},A.RawDeflate.prototype.lz77=function(t){var e,i,r,s,n,a,o,h,l,c={},f=A.RawDeflate.WindowSize,u=new Uint16Array(2*t.length),d=0,p=0,g=new Uint32Array(286),m=new Uint32Array(30),_=this.lazy;function v(t,e){var i,r,s=t.toLz77Array();for(i=0,r=s.length;i<r;++i)u[d++]=s[i];g[s[0]]++,m[s[3]]++,p=t.length+e-1,h=null}for(g[256]=1,e=0,i=t.length;e<i;++e){for(n=0,r=0,s=A.RawDeflate.Lz77MinLength;r<s&&e+r!==i;++r)n=n<<8|t[e+r];if(void 0===c[n]&&(c[n]=[]),a=c[n],p-- >0)a.push(e);else{for(;a.length>0&&e-a[0]>f;)a.shift();if(e+A.RawDeflate.Lz77MinLength>=i){for(h&&v(h,-1),r=0,s=i-e;r<s;++r)l=t[e+r],u[d++]=l,++g[l];break}a.length>0?(o=this.searchLongestMatch_(t,e,a),h?h.length<o.length?(l=t[e-1],u[d++]=l,++g[l],v(o,0)):v(h,-1):o.length<_?h=o:v(o,0)):h?v(h,-1):(l=t[e],u[d++]=l,++g[l]),a.push(e)}}return u[d++]=256,g[256]++,this.freqsLitLen=g,this.freqsDist=m,u.subarray(0,d)},A.RawDeflate.prototype.searchLongestMatch_=function(t,e,i){var r,s,n,a,o,h,l=0,c=t.length;t:for(a=0,h=i.length;a<h;a++){if(r=i[h-a-1],n=A.RawDeflate.Lz77MinLength,l>A.RawDeflate.Lz77MinLength){for(o=l;o>A.RawDeflate.Lz77MinLength;o--)if(t[r+o-1]!==t[e+o-1])continue t;n=l}for(;n<A.RawDeflate.Lz77MaxLength&&e+n<c&&t[r+n]===t[e+n];)++n;if(n>l&&(s=r,l=n),n===A.RawDeflate.Lz77MaxLength)break}return new A.RawDeflate.Lz77Match(l,e-s)},A.RawDeflate.prototype.getTreeSymbols_=function(t,e,i,r){var s,n,a,o,h,l,c=new Uint32Array(t+i),f=new Uint32Array(316),u=new Uint8Array(19);for(n=0,s=0;s<t;s++)c[n++]=e[s];for(s=0;s<i;s++)c[n++]=r[s];for(h=0,s=0,o=c.length;s<o;s+=n){for(n=1;s+n<o&&c[s+n]===c[s];++n);if(a=n,0===c[s])if(a<3)for(;a-- >0;)f[h++]=0,u[0]++;else for(;a>0;)(l=a<138?a:138)>a-3&&l<a&&(l=a-3),l<=10?(f[h++]=17,f[h++]=l-3,u[17]++):(f[h++]=18,f[h++]=l-11,u[18]++),a-=l;else if(f[h++]=c[s],u[c[s]]++,--a<3)for(;a-- >0;)f[h++]=c[s],u[c[s]]++;else for(;a>0;)(l=a<6?a:6)>a-3&&l<a&&(l=a-3),f[h++]=16,f[h++]=l-3,u[16]++,a-=l}return{codes:f.subarray(0,h),freqs:u}},A.RawDeflate.prototype.getLengths_=function(t,e){var i,r,s,n,a,o=t.length,h=new A.Heap(2*A.RawDeflate.HUFMAX),l=new Uint8Array(o);for(n=0;n<o;++n)t[n]>0&&h.push(n,t[n]);if(i=new Array(h.length/2),r=new Uint32Array(h.length/2),1===i.length)return l[h.pop().index]=1,l;for(n=0,a=h.length/2;n<a;++n)i[n]=h.pop(),r[n]=i[n].value;for(s=this.reversePackageMerge_(r,r.length,e),n=0,a=i.length;n<a;++n)l[i[n].index]=s[n];return l},A.RawDeflate.prototype.reversePackageMerge_=function(t,e,i){var r,s,n,a,o,h=new Uint16Array(i),l=new Uint8Array(i),c=new Uint8Array(e),f=new Array(i),u=new Array(i),d=new Array(i),p=(1<<i)-e,g=1<<i-1;function m(t){var i=u[t][d[t]];i===e?(m(t+1),m(t+1)):--c[i],++d[t]}for(h[i-1]=e,s=0;s<i;++s)p<g?l[s]=0:(l[s]=1,p-=g),p<<=1,h[i-2-s]=(h[i-1-s]/2|0)+e;for(h[0]=l[0],f[0]=new Array(h[0]),u[0]=new Array(h[0]),s=1;s<i;++s)h[s]>2*h[s-1]+l[s]&&(h[s]=2*h[s-1]+l[s]),f[s]=new Array(h[s]),u[s]=new Array(h[s]);for(r=0;r<e;++r)c[r]=i;for(n=0;n<h[i-1];++n)f[i-1][n]=t[n],u[i-1][n]=n;for(r=0;r<i;++r)d[r]=0;for(1===l[i-1]&&(--c[0],++d[i-1]),s=i-2;s>=0;--s){for(r=0,a=0,o=d[s+1],n=0;n<h[s];n++)(a=f[s+1][o]+f[s+1][o+1])>t[r]?(f[s][n]=a,u[s][n]=e,o+=2):(f[s][n]=t[r],u[s][n]=r,++r);d[s]=0,1===l[s]&&m(s)}return c},A.RawDeflate.prototype.getCodesFromLengths_=function(t){var e,i,r,s,n=new Uint16Array(t.length),a=[],o=[],h=0;for(e=0,i=t.length;e<i;e++)a[t[e]]=1+(0|a[t[e]]);for(e=1,i=A.RawDeflate.MaxCodeLength;e<=i;e++)o[e]=h,h+=0|a[e],h<<=1;for(e=0,i=t.length;e<i;e++)for(h=o[t[e]],o[t[e]]+=1,n[e]=0,r=0,s=t[e];r<s;r++)n[e]=n[e]<<1|1&h,h>>>=1;return n},A.Unzip=function(t,e){e=e||{},this.input=t instanceof Array?new Uint8Array(t):t,this.ip=0,this.eocdrOffset,this.numberOfThisDisk,this.startDisk,this.totalEntriesThisDisk,this.totalEntries,this.centralDirectorySize,this.centralDirectoryOffset,this.commentLength,this.comment,this.fileHeaderList,this.filenameToIndex,this.verify=e.verify||!1,this.password=e.password},A.Unzip.CompressionMethod=A.Zip.CompressionMethod,A.Unzip.FileHeaderSignature=A.Zip.FileHeaderSignature,A.Unzip.LocalFileHeaderSignature=A.Zip.LocalFileHeaderSignature,A.Unzip.CentralDirectorySignature=A.Zip.CentralDirectorySignature,A.Unzip.FileHeader=function(t,e){this.input=t,this.offset=e,this.length,this.version,this.os,this.needVersion,this.flags,this.compression,this.time,this.date,this.crc32,this.compressedSize,this.plainSize,this.fileNameLength,this.extraFieldLength,this.fileCommentLength,this.diskNumberStart,this.internalFileAttributes,this.externalFileAttributes,this.relativeOffset,this.filename,this.extraField,this.comment},A.Unzip.FileHeader.prototype.parse=function(){var t=this.input,e=this.offset;if(t[e++]!==A.Unzip.FileHeaderSignature[0]||t[e++]!==A.Unzip.FileHeaderSignature[1]||t[e++]!==A.Unzip.FileHeaderSignature[2]||t[e++]!==A.Unzip.FileHeaderSignature[3])throw new Error("invalid file header signature");this.version=t[e++],this.os=t[e++],this.needVersion=t[e++]|t[e++]<<8,this.flags=t[e++]|t[e++]<<8,this.compression=t[e++]|t[e++]<<8,this.time=t[e++]|t[e++]<<8,this.date=t[e++]|t[e++]<<8,this.crc32=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.compressedSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.plainSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.fileNameLength=t[e++]|t[e++]<<8,this.extraFieldLength=t[e++]|t[e++]<<8,this.fileCommentLength=t[e++]|t[e++]<<8,this.diskNumberStart=t[e++]|t[e++]<<8,this.internalFileAttributes=t[e++]|t[e++]<<8,this.externalFileAttributes=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,this.relativeOffset=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.filename=String.fromCharCode.apply(null,t.subarray(e,e+=this.fileNameLength)),this.extraField=t.subarray(e,e+=this.extraFieldLength),this.comment=t.subarray(e,e+this.fileCommentLength),this.length=e-this.offset},A.Unzip.LocalFileHeader=function(t,e){this.input=t,this.offset=e,this.length,this.needVersion,this.flags,this.compression,this.time,this.date,this.crc32,this.compressedSize,this.plainSize,this.fileNameLength,this.extraFieldLength,this.filename,this.extraField},A.Unzip.LocalFileHeader.Flags=A.Zip.Flags,A.Unzip.LocalFileHeader.prototype.parse=function(){var t=this.input,e=this.offset;if(t[e++]!==A.Unzip.LocalFileHeaderSignature[0]||t[e++]!==A.Unzip.LocalFileHeaderSignature[1]||t[e++]!==A.Unzip.LocalFileHeaderSignature[2]||t[e++]!==A.Unzip.LocalFileHeaderSignature[3])throw new Error("invalid local file header signature");this.needVersion=t[e++]|t[e++]<<8,this.flags=t[e++]|t[e++]<<8,this.compression=t[e++]|t[e++]<<8,this.time=t[e++]|t[e++]<<8,this.date=t[e++]|t[e++]<<8,this.crc32=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.compressedSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.plainSize=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.fileNameLength=t[e++]|t[e++]<<8,this.extraFieldLength=t[e++]|t[e++]<<8,this.filename=String.fromCharCode.apply(null,t.subarray(e,e+=this.fileNameLength)),this.extraField=t.subarray(e,e+=this.extraFieldLength),this.length=e-this.offset},A.Unzip.prototype.searchEndOfCentralDirectoryRecord=function(){var t,e=this.input;for(t=e.length-12;t>0;--t)if(e[t]===A.Unzip.CentralDirectorySignature[0]&&e[t+1]===A.Unzip.CentralDirectorySignature[1]&&e[t+2]===A.Unzip.CentralDirectorySignature[2]&&e[t+3]===A.Unzip.CentralDirectorySignature[3])return void(this.eocdrOffset=t);throw new Error("End of Central Directory Record not found")},A.Unzip.prototype.parseEndOfCentralDirectoryRecord=function(){var t,e=this.input;if(this.eocdrOffset||this.searchEndOfCentralDirectoryRecord(),t=this.eocdrOffset,e[t++]!==A.Unzip.CentralDirectorySignature[0]||e[t++]!==A.Unzip.CentralDirectorySignature[1]||e[t++]!==A.Unzip.CentralDirectorySignature[2]||e[t++]!==A.Unzip.CentralDirectorySignature[3])throw new Error("invalid signature");this.numberOfThisDisk=e[t++]|e[t++]<<8,this.startDisk=e[t++]|e[t++]<<8,this.totalEntriesThisDisk=e[t++]|e[t++]<<8,this.totalEntries=e[t++]|e[t++]<<8,this.centralDirectorySize=(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)>>>0,this.centralDirectoryOffset=(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)>>>0,this.commentLength=e[t++]|e[t++]<<8,this.comment=e.subarray(t,t+this.commentLength)},A.Unzip.prototype.parseFileHeader=function(){var t,e,i,r,s=[],n={};if(!this.fileHeaderList){for(void 0===this.centralDirectoryOffset&&this.parseEndOfCentralDirectoryRecord(),t=this.centralDirectoryOffset,i=0,r=this.totalEntries;i<r;++i)(e=new A.Unzip.FileHeader(this.input,t)).parse(),t+=e.length,s[i]=e,n[e.filename]=i;if(this.centralDirectorySize<t-this.centralDirectoryOffset)throw new Error("invalid file header size");this.fileHeaderList=s,this.filenameToIndex=n}},A.Unzip.prototype.getFileData=function(t,e){e=e||{};var i,r,s,n,a,o,h,l,c=this.input,f=this.fileHeaderList;if(f||this.parseFileHeader(),void 0===f[t])throw new Error("wrong index");if(r=f[t].relativeOffset,(i=new A.Unzip.LocalFileHeader(this.input,r)).parse(),r+=i.length,s=i.compressedSize,0!=(i.flags&A.Unzip.LocalFileHeader.Flags.ENCRYPT)){if(!e.password&&!this.password)throw new Error("please set password");for(o=this.createDecryptionKey(e.password||this.password),h=r,l=r+12;h<l;++h)this.decode(o,c[h]);for(h=r+=12,l=r+(s-=12);h<l;++h)c[h]=this.decode(o,c[h])}switch(i.compression){case A.Unzip.CompressionMethod.STORE:n=this.input.subarray(r,r+s);break;case A.Unzip.CompressionMethod.DEFLATE:n=new A.RawInflate(this.input,{index:r,bufferSize:i.plainSize}).decompress();break;default:throw new Error("unknown compression type")}if(this.verify&&(a=A.CRC32.calc(n),i.crc32!==a))throw new Error("wrong crc: file=0x"+i.crc32.toString(16)+", data=0x"+a.toString(16));return n},A.Unzip.prototype.getFilenames=function(){var t,e,i,r=[];for(this.fileHeaderList||this.parseFileHeader(),t=0,e=(i=this.fileHeaderList).length;t<e;++t)r[t]=i[t].filename;return r},A.Unzip.prototype.decompress=function(t,e){var i;if(this.filenameToIndex||this.parseFileHeader(),void 0===(i=this.filenameToIndex[t]))throw new Error(t+" not found");return this.getFileData(i,e)},A.Unzip.prototype.setPassword=function(t){this.password=t},A.Unzip.prototype.decode=function(t,e){return e^=this.getByte(t),this.updateKeys(t,e),e},A.Unzip.prototype.updateKeys=A.Zip.prototype.updateKeys,A.Unzip.prototype.createDecryptionKey=A.Zip.prototype.createEncryptionKey,A.Unzip.prototype.getByte=A.Zip.prototype.getByte,A.Util.stringToByteArray=function(t){var e,i,r=t.split("");for(e=0,i=r.length;e<i;e++)r[e]=(255&r[e].charCodeAt(0))>>>0;return r},A.Adler32=function(t){return"string"==typeof t&&(t=A.Util.stringToByteArray(t)),A.Adler32.update(1,t)},A.Adler32.update=function(t,e){for(var i,r=65535&t,s=t>>>16&65535,n=e.length,a=0;n>0;){n-=i=n>A.Adler32.OptimizationParameter?A.Adler32.OptimizationParameter:n;do{s+=r+=e[a++]}while(--i);r%=65521,s%=65521}return(s<<16|r)>>>0},A.Adler32.OptimizationParameter=1024,A.BitStream=function(t,e){if(this.index="number"==typeof e?e:0,this.bitindex=0,this.buffer=t instanceof Uint8Array?t:new Uint8Array(A.BitStream.DefaultBlockSize),2*this.buffer.length<=this.index)throw new Error("invalid index");this.buffer.length<=this.index&&this.expandBuffer()},A.BitStream.DefaultBlockSize=32768,A.BitStream.prototype.expandBuffer=function(){var t=this.buffer,e=t.length,i=new Uint8Array(e<<1);return i.set(t),this.buffer=i},A.BitStream.prototype.writeBits=function(t,e,i){var r,s=this.buffer,n=this.index,a=this.bitindex,o=s[n];if(i&&e>1&&(t=e>8?function(t){return A.BitStream.ReverseTable[255&t]<<24|A.BitStream.ReverseTable[t>>>8&255]<<16|A.BitStream.ReverseTable[t>>>16&255]<<8|A.BitStream.ReverseTable[t>>>24&255]}(t)>>32-e:A.BitStream.ReverseTable[t]>>8-e),e+a<8)o=o<<e|t,a+=e;else for(r=0;r<e;++r)o=o<<1|t>>e-r-1&1,8==++a&&(a=0,s[n++]=A.BitStream.ReverseTable[o],o=0,n===s.length&&(s=this.expandBuffer()));s[n]=o,this.buffer=s,this.bitindex=a,this.index=n},A.BitStream.prototype.finish=function(){var t=this.buffer,e=this.index;return this.bitindex>0&&(t[e]<<=8-this.bitindex,t[e]=A.BitStream.ReverseTable[t[e]],e++),t.subarray(0,e)},A.BitStream.ReverseTable=function(){var t,e=new Uint8Array(256);for(t=0;t<256;++t)e[t]=function(t){var e=t,i=7;for(t>>>=1;t;t>>>=1)e<<=1,e|=1&t,--i;return(e<<i&255)>>>0}(t);return e}(),A.CRC32.calc=function(t,e,i){return A.CRC32.update(t,0,e,i)},A.CRC32.update=function(t,e,i,r){var s=A.CRC32.Table,n="number"==typeof i?i:i=0,a="number"==typeof r?r:t.length;for(e^=4294967295,n=7&a;n--;++i)e=e>>>8^s[255&(e^t[i])];for(n=a>>3;n--;i+=8)e=(e=(e=(e=(e=(e=(e=(e=e>>>8^s[255&(e^t[i])])>>>8^s[255&(e^t[i+1])])>>>8^s[255&(e^t[i+2])])>>>8^s[255&(e^t[i+3])])>>>8^s[255&(e^t[i+4])])>>>8^s[255&(e^t[i+5])])>>>8^s[255&(e^t[i+6])])>>>8^s[255&(e^t[i+7])];return(4294967295^e)>>>0},A.CRC32.single=function(t,e){return(A.CRC32.Table[255&(t^e)]^t>>>8)>>>0},A.CRC32.Table_=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],A.CRC32.Table=new Uint32Array(A.CRC32.Table_),A.Deflate=function(t,e){this.input=t,this.output=new Uint8Array(A.Deflate.DefaultBufferSize),this.compressionType=A.Deflate.CompressionType.DYNAMIC,this.rawDeflate;var i,r={};for(i in!e&&(e={})||"number"==typeof e.compressionType&&(this.compressionType=e.compressionType),e)r[i]=e[i];r.outputBuffer=this.output,this.rawDeflate=new A.RawDeflate(this.input,r)},A.Deflate.DefaultBufferSize=32768,A.Deflate.CompressionType=A.RawDeflate.CompressionType,A.Deflate.compress=function(t,e){return new A.Deflate(t,e).compress()},A.Deflate.prototype.compress=function(){var t,e,i,r,s,n,a=0;if(n=this.output,(t=A.CompressionMethod.DEFLATE)!==A.CompressionMethod.DEFLATE)throw new Error("invalid compression method");if(e=Math.LOG2E*Math.log(A.RawDeflate.WindowSize)-8<<4|t,n[a++]=e,t!==A.CompressionMethod.DEFLATE)throw new Error("invalid compression method");switch(this.compressionType){case A.Deflate.CompressionType.NONE:r=0;break;case A.Deflate.CompressionType.FIXED:r=1;break;case A.Deflate.CompressionType.DYNAMIC:r=2;break;default:throw new Error("unsupported compression type")}return i=r<<6|0,i|=31-(256*e+i)%31,n[a++]=i,s=A.Adler32(this.input),this.rawDeflate.op=a,a=(n=this.rawDeflate.compress()).length,(n=new Uint8Array(n.buffer)).length<=a+4&&(this.output=new Uint8Array(n.length+4),this.output.set(n),n=this.output),(n=n.subarray(0,a+4))[a++]=s>>24&255,n[a++]=s>>16&255,n[a++]=s>>8&255,n[a++]=255&s,n};let I=!1;try{navigator}catch(Zt){I=!0}class E{static load(t,e){return new Promise((function(i,r){var s,n,a,o,h=new XMLHttpRequest,l=e.sendData,c=e.method||(l?"POST":"GET"),f=e.range,u=e.responseType,d=e.contentType,p=e.mimeType,g=e.headers,m=(!I&&0==navigator.vendor.indexOf("Apple")&&/\sSafari\//.test(navigator.userAgent),e.withCredentials);if(h.open(c,t),f){var _=f.size?f.start+f.size-1:"";h.setRequestHeader("Range","bytes="+f.start+"-"+_)}if(d&&h.setRequestHeader("Content-Type",d),p&&h.overrideMimeType(p),u&&(h.responseType=u),g)for(s=Object.keys(g),o=0;o<s.length;o++)a=g[n=s[o]],h.setRequestHeader(n,a);!0===m&&(h.withCredentials=!0),h.timeout=3e4,h.onload=function(e){0==h.status||h.status>=200&&h.status<=300?f&&206!=h.status?v("ERROR: range-byte header was ignored for url: "+t):i(h.response,h):416===h.status?v("Unsatisfiable range"):v("Error accessing resource: "+h.status)},h.onerror=function(e){v("Error accessing resource: "+t+" Status: "+h.status)},h.ontimeout=function(t){v("Timed out")},h.onabort=function(t){console.log("Aborted"),r(new igv.AbortLoad)};try{h.send(l)}catch(t){r(t)}function v(t){if(!r)throw Error(t);r(t)}}))}static loadArrayBuffer(t,e){return void 0===e&&(e={}),e.responseType="arraybuffer",E.load(t,e)}static loadJson(t,e){return"POST"==(e.method||(e.sendData?"POST":"GET"))&&(e.contentType="application/json"),new Promise((function(i,r){E.load(t,e).then((function(t){i(t?JSON.parse(t):t)})).catch(r)}))}static loadString(t,e){var i,r,s;return void 0===e&&(e={}),r=(s=t.indexOf("?"))>0?t.substring(0,s):t,0==(i=e.bgz?2:r.endsWith(".gz")?1:0)?(e.mimeType="text/plain; charset=x-user-defined",E.load(t,e)):(e.responseType="arraybuffer",new Promise((function(r,s){E.load(t,e).then((function(t){var e=E.arrayBufferToString(t,i);r(e)})).catch(s)})))}static loadStringFromFile(t,e){return new Promise((function(i,r){var s=new FileReader;e.range,s.onload=function(r){var n,a;n=e.bgz?2:t.name.endsWith(".gz")?1:0,a=E.arrayBufferToString(s.result,n),i(a,t)},s.onerror=function(e){console.log("reject uploading local file "+t.name),r(null,s)},s.readAsArrayBuffer(t)}))}static isCrossDomain(t){var e=window.location.origin;return!t.startsWith(e)}static arrayBufferToString(t,e){for(var i,r="",s=0,n=(i=1===e?new A.Gunzip(new Uint8Array(t)).decompress():2===e?new Uint8Array(R(t)):new Uint8Array(t)).length;s<n;s++)r+=String.fromCharCode(i[s]);return r}}let R=function(t,e){var i=[],r=[0],s=0;e=e||t.byteLength-18;const n=[];for(;r[0]<e;){var a=new Uint8Array(t,r[0],18),o=a[11]<<8|a[10],h=(a[12],a[13],a[15],a[14],a[17]<<8|a[16]+1);n.push(h);var l=12+o+r[0],c=t.byteLength-l;if(c<h+8)break;var f=C(t,l,c,r);r[0]+=8,s+=f.byteLength,i.push(f)}if(1==i.length)return i.blockLengths=n,i[0];for(var u=new Uint8Array(s),d=0,p=0;p<i.length;++p){var g=new Uint8Array(i[p]);k(g,0,u,d,g.length),d+=g.length}return u.buffer.blockLengths=n,u.buffer};class D{constructor(t,e,i){this.path=t.url,this.contentLength=e,this.bufferSize=i||512e3,this.range={start:-1,size:-1},this.config=t}dataViewForRange(t,e){var i=this;return new Promise((function(r,s){var n,a;function o(t,e,i){var s=t.data.byteLength,n=e.start-t.range.start,a=i?new Uint8Array(t.data,n,s-n):new DataView(t.data,n,s-n);r(a)}i.data&&i.range.start<=t.start&&i.range.start+i.range.size>=t.start+t.size?o(i,t,e):(n=Math.max(i.bufferSize,t.size),a=i.contentLength>0&&t.start+n>i.contentLength?{start:t.start}:{start:t.start,size:n},E.loadArrayBuffer(i.path,Object.assign(i.config,{range:a})).then((function(r){i.data=r,i.range=a,o(i,t,e)})).catch(s))}))}}class L{constructor(t,e){this.reader=new M(t),this.bufferedReader=new D(t),this.create_feature=e||L.createFeature}getFeatures(t,e,i,r,s){this.st=(new Date).getTime();var n=this;return new Promise((function(a,o){n.features&&r?a(n.features):n.reader.getZoomHeaders().then((function(r){var h,l=n.reader,c=n.bufferedReader,f=s.bpPerPixel,u=L.zoomLevelForScale(f,r);u&&"BigWig"===l.type?(h=u.indexOffset,n.decodeFunction=L.decodeZoomData):(h=l.header.fullIndexOffset,"BigWig"===l.type?n.decodeFunction=L.decodeWigData:n.decodeFunction=n.decodeBedData),l.loadRPTree(h).then((function(r){var s=n.reader.chromTree.dictionary[t];void 0===s?a(null):r.findLeafItemsOverlapping(s,e,i).then((function(r){var h=[];r&&0!=r.length||a([]),r.forEach((function(r){h.push(new Promise((function(a,o){var h=[];c.dataViewForRange({start:r.dataOffset,size:r.dataSize},!0).then((function(r){var o=new A.Inflate(r).decompress();n.decodeFunction(new DataView(o.buffer),t,s,e,i,h),a(h)})).catch(o)})))})),Promise.all(h).then((function(t){(new Date).getTime(),n.st;var e,i=t[0];if(t.length>1)for(e=1;e<t.length;e++)i=i.concat(t[e]);i.sort((function(t,e){return t.start-e.start})),n.features=i,a(i)})).catch(o)})).catch((function(t){o(t)}))})).catch((function(t){o(t)}))})).catch((function(t){o(t)}))}))}getDefaultRange(){return null!=this.reader.totalSummary?this.reader.totalSummary.defaultRange:void 0}static zoomLevelForScale(t,e){var i,r,s=null;for(i=0;i<e.length;i++)if((r=e[i]).reductionLevel>t){s=r;break}return null==s&&(s=e[e.length-1]),s&&s.reductionLevel<4*t?s:null}static decodeWigData(t,e,i,r,s,n){var a,o=new U(t),h=o.getInt(),l=o.getInt(),c=o.getInt(),f=o.getInt(),u=o.getInt(),d=o.getByte(),p=(o.getByte(),o.getUShort());if(h===i)for(;p-- >0;){switch(d){case 1:l=o.getInt(),c=o.getInt(),a=o.getFloat();break;case 2:l=o.getInt(),a=o.getFloat(),c=l+u;break;case 3:a=o.getFloat(),c=l+u,l+=f}if(l>=s)break;c>r&&Number.isFinite(a)&&n.push({chr:e,start:l,end:c,value:a})}}static decodeZoomData(t,e,i,r,s,n){for(var a,o,h,l,c,f=new U(t);f.remLength()>=32;)if(f.getInt()===i){if(a=f.getInt(),o=f.getInt(),h=f.getInt(),f.getFloat(),f.getFloat(),l=f.getFloat(),f.getFloat(),c=0==h?0:l/h,a>=s&&a<1e9){console.log("should have broken");break}o>r&&Number.isFinite(c)&&n.push({chr:e,start:a,end:o,value:c})}}decodeBedData(t,e,i,r,s,n){for(var a,o,h,l,c,f=new U(t);f.remLength()>=13;)f.getInt()==i&&(a=f.getInt(),o=f.getInt(),h=f.getString(),c={chr:e,start:a,end:o},a<s&&o>=r&&(n.push(c),l=h.split("\t"),this.create_feature(l,c)))}static createFeature(t,e){if(t.length>0&&(e.name=t[0]),t.length>1&&(e.score=parseFloat(t[1])),t.length>2&&(e.strand=t[2]),t.length>3&&(e.cdStart=parseInt(t[3])),t.length>4&&(e.cdEnd=parseInt(t[4])),t.length,t.length>8){exonCount=parseInt(t[6]),exonSizes=t[7].split(","),exonStarts=t[8].split(","),exons=[];for(var i=0;i<exonCount;i++)eStart=start+parseInt(exonStarts[i]),eEnd=eStart+parseInt(exonSizes[i]),exons.push({start:eStart,end:eEnd});e.exons=exons}}}class M{constructor(t){this.path=t.url,this.headPath=t.headURL||this.path,this.rpTreeCache={},this.config=JSON.parse(JSON.stringify(t))}getZoomHeaders(){var t=this;return new Promise((function(e,i){t.zoomLevelHeaders?e(t.zoomLevelHeaders):t.loadHeader().then((function(){e(t.zoomLevelHeaders)})).catch((function(t){i(t)}))}))}loadHeader(){var t=this;return new Promise((function(e,i){E.loadArrayBuffer(t.path,Object.assign(t.config,{range:{start:0,size:64}})).then((function(r){if(r){t.littleEndian=!0;var s=new U(new DataView(r));if(2291137574===(n=s.getUInt()))t.type="BigWig";else if(2273964779==n)t.type="BigBed";else{var n;t.littleEndian=!1,s.littleEndian=!1,s.position=0,654085990===(n=s.getUInt())?t.type="BigWig":3958540679==n&&(t.type="BigBed")}t.header={},t.header.bwVersion=s.getUShort(),t.header.nZoomLevels=s.getUShort(),t.header.chromTreeOffset=s.getLong(),t.header.fullDataOffset=s.getLong(),t.header.fullIndexOffset=s.getLong(),t.header.fieldCount=s.getUShort(),t.header.definedFieldCount=s.getUShort(),t.header.autoSqlOffset=s.getLong(),t.header.totalSummaryOffset=s.getLong(),t.header.uncompressBuffSize=s.getInt(),t.header.reserved=s.getLong(),t.loadZoomHeadersAndChrTree().then(e).catch(i)}})).catch((function(t){i(t)}))}))}loadZoomHeadersAndChrTree(){var t=64,e=this;return new Promise((function(i,r){var s={start:t,size:e.header.fullDataOffset-t+5};E.loadArrayBuffer(e.path,Object.assign(e.config,{range:s})).then((function(r){var s,n,a=e.header.nZoomLevels,o=new U(new DataView(r));for(e.zoomLevelHeaders=[],e.firstZoomDataOffset=Number.MAX_VALUE,s=0;s<a;s++)n=new F(a-s,o),e.firstZoomDataOffset=Math.min(n.dataOffset,e.firstZoomDataOffset),e.zoomLevelHeaders.push(n);e.header.autoSqlOffset>0&&(o.position=e.header.autoSqlOffset-t,e.autoSql=o.getString()),e.header.totalSummaryOffset>0&&(o.position=e.header.totalSummaryOffset-t,e.totalSummary=new N(o)),e.header.chromTreeOffset>0&&(o.position=e.header.chromTreeOffset-t,e.chromTree=new H(o,t)),o.position=e.header.fullDataOffset-t,e.dataCount=o.getInt(),i()})).catch((function(t){r(t)}))}))}loadRPTree(t){var e=this;return new Promise((function(i,r){var s=e.rpTreeCache[t];s?i(s):(s=new P(t,e.contentLength,e.config,e.littleEndian),e.rpTreeCache[t]=s,s.load().then((function(){i(s)})).catch(r))}))}}class F{constructor(t,e){this.index=t,this.reductionLevel=e.getInt(),this.reserved=e.getInt(),this.dataOffset=e.getLong(),this.indexOffset=e.getLong()}}const B=512e3;class P{constructor(t,e,i,r){this.config=i,this.filesize=e,this.fileOffset=t,this.path=i.url,this.littleEndian=r}load(){var t=this;return new Promise((function(e,i){var r=t.fileOffset+48,s=new D(t.config,t.filesize,B);t.readNode(r,s).then((function(i){t.rootNode=i,e(t)})).catch(i)}))}readNode(t,e){var i=this;return new Promise((function(r,s){e.dataViewForRange({start:t,size:4},!1).then((function(n){var a=new U(n,i.littleEndian),o=1===a.getByte(),h=(a.getByte(),a.getUShort()),l={start:t+=4,size:h*(o?32:24)};e.dataViewForRange(l,!1).then((function(t){var e,i=new Array(h),s=new U(t);if(o){for(e=0;e<h;e++){var n={isLeaf:!0,startChrom:s.getInt(),startBase:s.getInt(),endChrom:s.getInt(),endBase:s.getInt(),dataOffset:s.getLong(),dataSize:s.getLong()};i[e]=n}r(new O(i))}else{for(e=0;e<h;e++)n={isLeaf:!1,startChrom:s.getInt(),startBase:s.getInt(),endChrom:s.getInt(),endBase:s.getInt(),childOffset:s.getLong()},i[e]=n;r(new O(i))}})).catch(s)})).catch(s)}))}findLeafItemsOverlapping(t,e,i){var r=this;return new Promise((function(s,n){var a=[],o=new Set,h=new D(r.config,r.filesize,B);o.add(0),function l(c,f){P.overlaps(c,t,e,i)&&c.items.forEach((function(s){P.overlaps(s,t,e,i)&&(s.isLeaf?a.push(s):s.childNode?l(s.childNode):(o.add(s.childOffset),r.readNode(s.childOffset,h).then((function(t){s.childNode=t,l(t,s.childOffset)})).catch(n)))})),null!=f&&o.delete(f),0===o.size&&s(a)}(r.rootNode,0)}))}static overlaps(t,e,i,r){return t?(e>t.startChrom||e==t.startChrom&&r>=t.startBase)&&(e<t.endChrom||e==t.endChrom&&i<t.endBase):(console.log("null item"),!1)}}class O{constructor(t){this.items=t;var e,i,r=Number.MAX_VALUE,s=0,n=Number.MAX_VALUE,a=0;for(e=0;e<t.length;e++)i=t[e],r=Math.min(r,i.startChrom),s=Math.max(s,i.endChrom),n=Math.min(n,i.startBase),a=Math.max(a,i.endBase);this.startChrom=r,this.endChrom=s,this.startBase=n,this.endBase=a}}class U{constructor(t,e){this.littleEndian=e||!0,this.position=0,this.view=t,this.length=t.byteLength}available(){return this.length-this.position}remLength(){return this.length-this.position}hasNext(){return this.position<this.length-1}getByte(){var t=this.view.getUint8(this.position,this.littleEndian);return this.position++,t}getShort(){var t=this.view.getInt16(this.position,this.littleEndian);return this.position+=2,t}getUShort(){var t=this.view.getUint16(this.position,this.littleEndian);return this.position+=2,t}getInt(){var t=this.view.getInt32(this.position,this.littleEndian);return this.position+=4,t}getUInt(){var t=this.view.getUint32(this.position,this.littleEndian);return this.position+=4,t}getLong(){var t=[];t[0]=this.view.getUint8(this.position),t[1]=this.view.getUint8(this.position+1),t[2]=this.view.getUint8(this.position+2),t[3]=this.view.getUint8(this.position+3),t[4]=this.view.getUint8(this.position+4),t[5]=this.view.getUint8(this.position+5),t[6]=this.view.getUint8(this.position+6),t[7]=this.view.getUint8(this.position+7);var e=0;if(this.littleEndian)for(var i=t.length-1;i>=0;i--)e=256*e+t[i];else for(i=0;i<t.length;i++)e=256*e+t[i];return this.position+=8,e}getString(t){for(var e,i="";0!=(e=this.view.getUint8(this.position++))&&(i+=String.fromCharCode(e),!t||i.length!=t););return i}getFixedLengthString(t){var e,i,r="";for(e=0;e<t;e++)(i=this.view.getUint8(this.position++))>0&&(r+=String.fromCharCode(i));return r}getFixedLengthTrimmedString(t){var e,i,r="";for(e=0;e<t;e++)(i=this.view.getUint8(this.position++))>32&&(r+=String.fromCharCode(i));return r}getFloat(){var t=this.view.getFloat32(this.position,this.littleEndian);return this.position+=4,t}getDouble(){var t=this.view.getFloat64(this.position,this.littleEndian);return this.position+=8,t}skip(t){return this.position+=t,this.position}getVPointer(){var t=this.position,e=this.view.getUint8(t+1)<<8|this.view.getUint8(t),i=4294967296*(255&this.view.getUint8(t+6))+16777216*(255&this.view.getUint8(t+5))+65536*(255&this.view.getUint8(t+4))+256*(255&this.view.getUint8(t+3))+(255&this.view.getUint8(t+2));return this.position+=8,new z(i,e)}}class z{constructor(t,e){this.block=t,this.offset=e}isLessThan(t){return this.block<t.block||this.block===t.block&&this.offset<t.offset}isGreaterThan(t){return this.block>t.block||this.block===t.block&&this.offset>t.offset}print(){return this.block+":"+this.offset}}class N{constructor(t){t?(this.basesCovered=t.getLong(),this.minVal=t.getDouble(),this.maxVal=t.getDouble(),this.sumData=t.getDouble(),this.sumSquares=t.getDouble(),this.computeStats()):(this.basesCovered=0,this.minVal=0,this.maxVal=0,this.sumData=0,this.sumSquares=0,this.mean=0,this.stddev=0)}computeStats(){var t=this.basesCovered;t>0&&(this.mean=this.sumData/t,this.stddev=Math.sqrt(this.sumSquares/(t-1)),this.minVal<0&&(this.mean,this.stddev),this.maxVal>0&&(this.mean,this.stddev),this.defaultRange={min:0,max:this.mean+3*this.stddev})}updateStats(t){this.basesCovered+=t.count,this.sumData+=status.sumData,this.sumSquares+=sumSquares,this.minVal=MIN(_minVal,min),this.maxVal=MAX(_maxVal,max),computeStats.call(this)}}class H{constructor(t,e){this.header={},this.header.magic=t.getInt(),this.header.blockSize=t.getInt(),this.header.keySize=t.getInt(),this.header.valSize=t.getInt(),this.header.itemCount=t.getLong(),this.header.reserved=t.getLong(),this.dictionary={},function t(i,r,s,n){r>=0&&(i.position=r);var a,o,h,l,c,f=i.getByte(),u=(i.getByte(),i.getUShort());if(1==f)for(a=0;a<u;a++)o=i.getFixedLengthTrimmedString(s),h=i.getInt(),i.getInt(),n[o]=h;else for(a=0;a<u;a++)o=i.getFixedLengthTrimmedString(s),l=i.getLong()-e,c=i.position,t(i,l,s,n),i.position=c}(t,-1,this.header.keySize,this.dictionary),this.header.keySize}}let q={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};class W{static addAlphaToRGB(t,e){return t.startsWith("rgb")?t.replace("rgb","rgba").replace(")",", "+e+")"):(console.log(t+" is not an rgb style string"),t)}static presentAlert(t,e){let i=$("<div>").css({position:"absolute","background-color":"white"}).attr("class","mlv-alert").appendTo(t);$("<div>").css({display:"flex","justify-content":"center"}).appendTo(i).append($('<i class="fas fa-exclamation-circle"></i>').css({color:"red","font-size":"16px","text-align":"center"})),i.append($("<div>"+e+"</div>").css({color:"red","font-size":"14px","text-align":"center"}));let r=Math.round(t.width()/2-i.width()/2),s=Math.round(t.height()/2-i.height()/2);i.css({left:r+"px",top:s+"px"})}static spinner(t){var e;return e=$('<i class="fa fa-lg fa-spinner fa-spin igv-spinner">').css({position:"absolute",top:"50%",left:"50%"}),t&&e.css("font-size",t),e[0]}static getSpinnerObjectWithParentElement(t){return t.find("div.igv-spinner-container")}static startSpinnerAtParentElement(t){t.children(".fa-spinner").show()}static stopSpinnerAtParentElement(t){t.children(".fa-spinner").hide()}static parseUri(t){for(var e=q,i=e.parser[e.strictMode?"strict":"loose"].exec(t),r={},s=14;s--;)r[e.key[s]]=i[s]||"";return r[e.q.name]={},r[e.key[12]].replace(e.q.parser,(function(t,i,s){i&&(r[e.q.name][i]=s)})),r}static domElementRectAsString(t){return" x "+t.clientLeft+" y "+t.clientTop+" w "+t.clientWidth+" h "+t.clientHeight}static isNumber(t){return""!==t&&void 0!==t&&!isNaN(parseFloat(t))&&isFinite(t)}static guid(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}static random(t,e){return Math.random()*(e-t)+t}static numberFormatter(t){var e=String(t).split(/[.,]/);return e[0].split("").reverse().reduce((function(t,e,i){return i%3==0?t+","+e:t+e})).split("").reverse().join("")+(e[1]?"."+e[1]:"")}static numberUnFormatter(t){return t.split(",").join().replace(",","","g")}static translateMouseCoordinates(t,e){var i=$.event.fix(t);return{x:i.pageX-$(e).offset().left,y:i.pageY-$(e).offset().top}}static formatPopoverText(t){var e='<table class="igv-popover-table">';return t.forEach((function(t){t.name?e+='<tr><td class="igv-popover-td"><div class="igv-popoverNameValue"><span class="igv-popoverName">'+t.name+'</span><span class="igv-popoverValue">'+t.value+"</span></div></td></tr>":e+="<tr><td>"+t.toString()+"</td></tr>"})),e+="</table>"}static throttle(t,e,i){var r,s;return e||(e=200),function(){var n=i||this,a=+new Date,o=arguments;r&&a<r+e?(clearTimeout(s),s=setTimeout((function(){r=a,t.apply(n,o)}),e)):(r=a,t.apply(n,o))}}static splitStringRespectingQuotes(t,e){var i,r,s=[],n=t.length,a=0,o=!1;if(n>0)for(s[a]=t.charAt(0),i=1;i<n;i++)'"'===(r=t.charAt(i))?o=!o:o||r!==e?s[a]+=r:s[++a]="";return s}static addAjaxExtensions(){$.ajaxTransport("+binary",(function(t,e,i){return{send:function(e,i){var r=new XMLHttpRequest,s=t.url,n=t.type;if(t.data,r.addEventListener("load",(function(){var e={};e[t.dataType]=r.response,i(r.status,r.statusText,e,r.getAllResponseHeaders())})),r.open(n,s),r.responseType="arraybuffer",t.headers)for(var a in t.headers)t.headers.hasOwnProperty(a)&&r.setRequestHeader(a,t.headers[a])},abort:function(){i.abort()}}}))}static isStringOrNumber(t){return!(!t.substring&&!t.toFixed)}static constrainBBox(t,e){var i,r,s={},n={};return n.left=n.top=0,n.right=e.outerWidth(),n.bottom=e.outerHeight(),r=t.offset(),s.left=r.left-e.offset().left,s.top=r.top-e.offset().top,s.right=s.left+t.outerWidth(),s.bottom=s.top+t.outerHeight(),(i=s.bottom-n.bottom)>0&&(r.top-=i,s.top-=i,s.bottom-=i,(i=s.top-n.top)<0&&(r.top-=i)),r}static log(t){igv.enableLogging&&console&&console.log&&console.log(t)}}let V=function(t,e,i){return new Promise((function(r,s){E.loadArrayBuffer(t,{headers:e.headers,withCredentials:e.withCredentials}).then((function(e){var s,n,a,o,h,l,c,f,u,d,p,g,m,_,v=[],w=Number.MAX_VALUE,b=0;if(e){if(i&&(e=new A.Gunzip(new Uint8Array(e)).decompress().buffer),!(21578050===(s=(h=new U(new DataView(e))).getInt())||i&&21578324===s))throw new Error(t+" is not a "+(i?"tabix":"bai")+" file");if(o=h.getInt(),i)for(h.getInt(),h.getInt(),h.getInt(),h.getInt(),h.getInt(),h.getInt(),h.getInt(),_={},g=0;g<o;g++){_[h.getString()]=g}for(m=0;m<o;++m){for(l={},c=[],n=h.getInt(),p=0;p<n;++p)if(37450==(f=h.getInt()))y=h.getInt(),u=h.getVPointer(),d=h.getVPointer(),h.getLong(),h.getLong();else{l[f]=[];var y=h.getInt();for(g=0;g<y;g++)u=h.getVPointer(),d=h.getVPointer(),u&&d&&(u.block<w&&(w=u.block),d.block>b&&(b=d.block),l[f].push([u,d]))}for(a=h.getInt(),g=0;g<a;g++)u=h.getVPointer(),c.push(u);n>0&&(v[m]={binIndex:l,linearIndex:c})}r(new G(v,w,b,_,i))}else r(null)})).catch(s)}))};class G{constructor(t,e,i,r,s){this.firstAlignmentBlock=e,this.indices=t,this.lastAlignmentBlock=i,this.sequenceIndexMap=r,this.tabix=s}getBlocksForRange(t,e,i){const r=this.indices[t];if(!r)return[];const s=r.linearIndex,n=s.length,a=Math.max(e>>14,0),o=Math.min(i>>14,n-1);return[{minv:s[a],maxv:s[o],bin:1}]}blocksForRange(t,e,i){var r,s,n,a,o,h,l,c,f=this.indices[t];if(f){for(r=G.reg2bins(e,i),s=[],r.forEach((function(t){if(f.binIndex[t])for(var e=f.binIndex[t],i=e.length,r=0;r<i;++r){var n=e[r][0],a=e[r][1];s.push({minv:n,maxv:a,bin:t})}})),n=f.linearIndex.length,a=null,o=Math.min(e>>14,n-1),h=Math.min(i>>14,n-1),c=o;c<=h;++c)(l=f.linearIndex[c])&&(a&&!l.isLessThan(a)||(a=l));return function(t,e){var i=[],r=null;return 0===t.length?t:(t.sort((function(t,e){var i=t.minv.block-e.minv.block;return 0!=i?i:t.minv.offset-e.minv.offset})),t.forEach((function(t){e&&!t.maxv.isGreaterThan(e)||(null===r?(i.push(t),r=t):t.minv.block-r.maxv.block<65e3?t.maxv.isGreaterThan(r.maxv)&&(r.maxv=t.maxv):(i.push(t),r=t))})),i)}(s,a)}return[]}static reg2bins(t,e){var i,r=[];for(e>=1<<29&&(e=1<<29),--e,r.push(0),i=1+(t>>26);i<=1+(e>>26);++i)r.push(i);for(i=9+(t>>23);i<=9+(e>>23);++i)r.push(i);for(i=73+(t>>20);i<=73+(e>>20);++i)r.push(i);for(i=585+(t>>17);i<=585+(e>>17);++i)r.push(i);for(i=4681+(t>>14);i<=4681+(e>>14);++i)r.push(i);return r}}var Z=["=","A","C","x","G","x","x","x","T","x","x","x","x","x","x","N"],j=["M","I","D","N","S","H","P","=","X","?","?","?","?","?","?","?"];const X=65536;class K{constructor(t){this.bamPath=t.url,this.baiPath=t.indexURL||this.bamPath+".bai",this.headPath=t.headURL||this.bamPath,this.alignments=[],this.features=[],this.alignmentBuffer=new SharedArrayBuffer(8e6),this.alignments=new Int32Array(this.alignmentBuffer),this.pointer=0,this.config=t,this.fragmentThreshold=50}async getAlignments(t,e,i){if(this.store&&t===this.store[0]&&e>=this.store[1]&&i<=this.store[2])return this.features;this.index||await this.readHeader(),this.pointer=0;const r=this.chrToIndex[t],s=this.index.blocksForRange(r,e,i);return s?0===s.length?[]:(await Promise.all(s.map((async t=>{var s=t.minv.block,n={start:s,size:t.maxv.block+X-s+1};const a=await E.loadArrayBuffer(this.bamPath,{headers:this.config.headers,range:n,withCredentials:this.config.withCredentials});var o=new Uint8Array(new ht(a));this.addAlignments(o,t.minv.offset,e,i,r)}))),this.store=[t,e,i],this.calculateCategories(),this.features):[]}setCategories(t,e){this.catData=t,this.catNames=e}setFilter(t,e){this.filter=t,this.localFilter=e}calculateFragmentSize(){const t=this.store[1],e=this.store[2]-this.store[1];this.features=[];for(let t=0;t<3;t++)this.features.push(new Uint16Array(e));for(let e=0;e<this.pointer;e+=4){let i=this.alignments[e]-t;const r=i+this.alignments[e+1];i<0&&(i=0);let s=this.features[0];if(this.alignments[e+3]>this.fragmentThreshold&&(s=this.features[1]),r>i)for(let t=i;t<r;t++)s[t]++,this.features[2][t]++;else for(let t=r;t<i;t++)s[t]++,this.features[2][t]++}this.features.store=this.store}calculateCategories(){const t=this.catNames.length,e=this.store[1],i=this.store[2]-this.store[1];this.features=[];for(let e=0;e<t;e++)this.features.push(new Uint16Array(i));if(this.cut_window=0,performance.now(),this.cut_window){const t=this.cut_window;for(let i=0;i<this.pointer;i+=4){let r=this.alignments[i]-e,s=r-t;const n=r+t;s<0&&(s=0);const a=this.alignments[i+2];if(this.filter&&0!==this.filter[a]&&this.filter[a]!==this.localFilter[a])continue;const o=this.features[this.catData[a]];for(let t=s;t<n;t++)o[t]++}}else for(let t=0;t<this.pointer;t+=4){if(this.size_filter_on&&this.alignments[t+3]>this.size_filter)continue;let i=this.alignments[t]-e;const r=i+this.alignments[t+1];i<0&&(i=0);const s=this.alignments[t+2];if(this.filter&&0!==this.filter[s]&&this.filter[s]!==this.localFilter[s])continue;const n=this.features[this.catData[s]];if(r>i)for(let t=i;t<r;t++)n[t]++;else for(let t=r;t<i;t++)n[t]++}this.features.store=this.store}getIdsInRange(t){const e=Math.round(t.start),i=Math.round(t.end),r=this.alignments,s=new Set;for(let t=0;t<this.alignments.length;t+=3)if(!(r[t]<e)){if(r[t]>i)break;s.add(r[t+2])}return s}addAlignments(t,e,i,r,s){for(var n,a,o,h,l,c,f,u,d,p,g;;){if((n=e+J(t,e)+4)>t.length)return;if(o=J(t,e+4),h=J(t,e+8),o<0)return;if(o>s||h>r)return;if(o<s)continue;l=255&J(t,e+12),u=65535&(c=J(t,e+16));const v=!(16&(4294901760&c)>>16);d=J(t,e+20);const w=Math.abs(J(t,e+32));for(g=e+36+l,p=0,f=0;f<u;++f){var m=J(t,g),_=j[15&m];"M"!=_&&"EQ"!=_&&"X"!=_&&"D"!=_&&"N"!=_&&"="!=_||(p+=m>>4),g+=4}h+p<i||(v||(h+=p,p=-p),this.alignments[this.pointer++]=h,this.alignments[this.pointer++]=p,g+=d+1>>1,g+=d,a=_t(new Uint8Array(t.buffer.slice(g,n))),this.catIndex[a.CB],this.alignments[this.pointer++]=this.catIndex[a.CB],this.alignments[this.pointer++]=Math.abs(w),g+=n),e=n}}async readHeader(){var t=this,e=(await Q(this)).firstAlignmentBlock+X;const i=await E.loadArrayBuffer(t.bamPath,{headers:t.config.headers,range:{start:0,size:e},withCredentials:t.config.withCredentials});for(var r=new ht(i,e),s=new Uint8Array(r),n=(J(s,0),J(s,4)),a=0;a<n;++a)String.fromCharCode(s[a+8]);var o=J(s,n+8),h=n+12;for(t.chrToIndex={},t.indexToChr=[],a=0;a<o;++a){for(var l=J(s,h),c="",f=0;f<l-1;++f)c+=String.fromCharCode(s[h+4+f]);J(s,h+l+4),t.chrToIndex[c]=a,t.indexToChr.push(c),h=h+8+l}}}class Y{constructor(t,e){this.config=t,this.parent=e,this.ac_class=lt,e.ac_class&&(this.ac_class=parent_class),this.filter=t.filter||new ot,this.bamPath=t.url,this.baiPath=t.indexURL||this.bamPath+".bai",this.headPath=t.headURL||this.bamPath,this.samplingWindowSize=void 0===t.samplingWindowSize?100:t.samplingWindowSize,this.samplingDepth=void 0===t.samplingDepth?2500:t.samplingDepth,this.samplingDepth>2500&&(igv.log("Warning: attempt to set sampling depth > maximum value of 2500"),this.samplingDepth=2500),t.viewAsPairs?this.pairsSupported=!0:this.pairsSupported=void 0===t.pairsSupported||t.pairsSupported}readAlignments(t,e,i){var r=this;return new Promise((function(n,a){var o;(o=r,new Promise((function(t,e){o.chrToIndex?t(o.chrToIndex):o.readHeader().then((function(){t(o.chrToIndex)})).catch(e)}))).then((function(o){var h=o[t],l=new r.ac_class(t,e,i,r.samplingWindowSize,r.samplingDepth,r.pairsSupported,r.parent);void 0===h?n(l):Q(r).then((function(t){var o=t.blocksForRange(h,e,i),c=[];if(!o)return n(null),void a("Error reading bam index");0!==o.length?(o.forEach((function(t){c.push(new Promise((function(n,a){var o=t.minv.block,c={start:o,size:t.maxv.block+X-o+1};E.loadArrayBuffer(r.bamPath,{headers:r.config.headers,range:c,withCredentials:r.config.withCredentials}).then((function(a){!function(t,e,i,n,a,o,h){for(var l,c,f,u,d,p,g,m,_,v,w,b,y,x,k,S,C,A,T,I,E,R,D;;){if((l=e+J(t,e)+4)>t.length)return;if(c=new nt,u=J(t,e+4),d=J(t,e+8),u<0)return;if(u>o||d>a)return;if(!(u<o)){for(g=(65280&(p=J(t,e+12)))>>8,m=255&p,v=(4294901760&(_=J(t,e+16)))>>16,w=65535&_,c.flags=v,c.strand=!(16&v),b=J(t,e+20),y=J(t,e+24),x=J(t,e+28),c.fragmentLength=J(t,e+32),k="",S=0;S<m-1;++S)k+=String.fromCharCode(t[e+36+S]);for(C=e+36+m,A=0,T="",E=[],I=0;I<w;++I){var L=J(t,C),M=L>>4,F=j[15&L];"M"!=F&&"EQ"!=F&&"X"!=F&&"D"!=F&&"N"!=F&&"="!=F||(A+=M),T=T+M+F,C+=4,E.push({len:M,ltr:F})}if(c.cigar=T,c.lengthOnRef=A,!(c.start+c.lengthOnRef<n)){for(R="",D=b+1>>1,S=0;S<D;++S){var B=t[C+S];R+=Z[(240&B)>>4],R+=Z[15&B]}if(R=R.substring(0,b),C+=D,c.seq=R,1===b&&"*"===String.fromCharCode(t[C+S]+33));else for(c.qual=[],S=0;S<b;++S)c.qual.push(t[C+S]);C+=b,c.start=d,c.mq=g,c.readName=k,c.chr=r.indexToChr[u],y>=0&&(c.mate={chr:r.indexToChr[y],position:x,strand:!(32&v)}),c.tagBA=new Uint8Array(t.buffer.slice(C,l)),C+=l,(!n||c.start<=a&&c.start+c.lengthOnRef>=n&&h.pass(c))&&(void 0!==o&&u!=o||(f=s(c,E),c.blocks=f.blocks,c.insertions=f.insertions,i.push(c))),e=l}}}}(new Uint8Array(new ht(a)),t.minv.offset,l,e,i,h,r.filter),n(l)})).catch((function(t){a(t)}))})))})),Promise.all(c).then((function(t){l.finish(),n(l)})).catch((function(t){a(t)}))):n(l)})).catch(a)})).catch(a)}));function s(t,e){for(var i,r,s,n,a=[],o=0,h=t.start,l=e.length,c=0;c<l;c++){var f=e[c];switch(f.ltr){case"H":case"P":break;case"S":o+=f.len,n="S";break;case"N":h+=f.len,n="N";break;case"D":h+=f.len,n="D";break;case"I":r="*"===t.seq?"*":t.seq.substr(o,f.len),s=t.qual?t.qual.slice(o,f.len):void 0,void 0===i&&(i=[]),i.push({start:h,len:f.len,seq:r,qual:s}),o+=f.len;break;case"M":case"EQ":case"=":case"X":r="*"===t.seq?"*":t.seq.substr(o,f.len),s=t.qual?t.qual.slice(o,f.len):void 0,a.push({start:h,len:f.len,seq:r,qual:s,gapType:n}),o+=f.len,h+=f.len;break;default:console.log("Error processing cigar element: "+f.len+f.ltr)}}return{blocks:a,insertions:i}}}readHeader(){var t=this;return new Promise((function(e,i){Q(t).then((function(r){var s=r.firstAlignmentBlock+X;E.loadArrayBuffer(t.bamPath,{headers:t.config.headers,range:{start:0,size:s},withCredentials:t.config.withCredentials}).then((function(i){for(var r=new ht(i,s),n=new Uint8Array(r),a=(J(n,0),J(n,4)),o=0;o<a;++o)String.fromCharCode(n[o+8]);var h=J(n,a+8),l=a+12;for(t.chrToIndex={},t.indexToChr=[],o=0;o<h;++o){for(var c=J(n,l),f="",u=0;u<c-1;++u)f+=String.fromCharCode(n[l+4+u]);J(n,l+c+4),t.chrToIndex[f]=o,t.indexToChr.push(f),l=l+8+c}e()})).catch(i)})).catch(i)}))}}function Q(t){return new Promise((function(e,i){t.index?e(t.index):V(t.baiPath,t.config).then((function(i){t.index=i,e(t.index)})).catch(i)}))}function J(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}function tt(t,e){return t[e+1]<<8|t[e]}class et{constructor(t,e){this.config=t,this.alignmentContainer=void 0,this.maxRows=t.maxRows||1e3,t.seq_url&&(this.sequence_source=new Dt(t.seq_url)),this.parent=e,this.pack_alignments=!0,"ga4gh"===t.sourceType?this.bamReader=new igv.Ga4ghAlignmentReader(t):this.bamReader=new Y(t,e),this.viewAsPairs=!0}setViewAsPairs(t){var e,i,r;if(this.viewAsPairs!==t&&(this.viewAsPairs=t,this.alignmentContainer)){var s,n=this.alignmentContainer;t?(e=n.packedAlignmentRows,i={},r=[],e.forEach((function(t){t.alignments.forEach((function(t){var e;rt(t)?(e=i[t.readName])?(e.setSecondAlignment(t),i[t.readName]=void 0):(e=new igv.PairedAlignment(t),i[t.readName]=e,r.push(e)):r.push(t)}))})),s=r):s=it(n.packedAlignmentRows),n.packedAlignmentRows=st(s,n.start,n.end,this.maxRows)}}getAlignments(t,e,i){var r=this;return new Promise((function(s,n){r.alignmentContainer&&r.alignmentContainer.contains(t,e,i)?s(r.alignmentContainer):r.bamReader.readAlignments(t,e,i).then((function(t){var e=r.config.maxRows||500,i=t.alignments;r.viewAsPairs||(i=it([{alignments:i}])),r.parent.display_alignments&&(t.packedAlignmentRows=st(i,t.start,t.end,e)),t.alignments=void 0,r.alignmentContainer=t,r.sequence_source?r.sequence_source.getSequence(t.chr,t.start,t.end).then((function(e){e&&(t.coverageMap.refSeq=e,t.sequence=e,s(t))})).catch(n):s(t)})).catch(n)}))}}function it(t){var e=[];return t.forEach((function(t){t.alignments.forEach((function(t){t instanceof gt?(t.firstAlignment&&e.push(t.firstAlignment),t.secondAlignment&&e.push(t.secondAlignment)):e.push(t)}))})),e}function rt(t){return t.isPaired()&&t.isMateMapped()&&t.chr===t.mate.chr&&(t.isFirstOfPair()||t.isSecondOfPair())&&!(t.isSecondary()||t.isSupplementary())}function st(t,e,i,r){if(t){if(t.sort((function(t,e){return t.start-e.start})),0===t.length)return[];var s,n,a,o,h=[],l=0,c=0,f=e,u=[],d=Math.max(e,t[0].start);for(t.forEach((function(t){var e=Math.max(0,t.start-d);void 0===h[e]&&(h[e]=[]),h[e].push(t)}));l<t.length&&u.length<r;){for(s=new mt;f<=i;){for(a=void 0;!a&&f<=i;)void 0===h[n=f-d]?++f:a=h[n];if(!a)break;o=a.pop(),0===a.length&&(h[n]=void 0),s.alignments.push(o),f=o.start+o.lengthOnRef+8,++l}if(s.alignments.length>0&&u.push(s),f=d,l===c)break;c=l}return u}}class nt{constructor(){this.hidden=!1}isMapped(){return 0==(4&this.flags)}isPaired(){return 0!=(1&this.flags)}isProperPair(){return 0!=(2&this.flags)}isFirstOfPair(){return 0!=(64&this.flags)}isSecondOfPair(){return 0!=(128&this.flags)}isSecondary(){return 0!=(256&this.flags)}isSupplementary(){return 0!=(2048&this.flags)}isFailsVendorQualityCheck(){return 0!=(512&this.flags)}isDuplicate(){return 0!=(1024&this.flags)}isMateMapped(){return 0==(8&this.flags)}isNegativeStrand(){return 0!=(16&this.flags)}isMateNegativeStrand(){return 0!=(32&this.flags)}tags(){return this.tagDict||(this.tagBA?(this.tagDict=function(t){for(var e=0,i=t.length,r={};e<i;){var s,n=String.fromCharCode(t[e])+String.fromCharCode(t[e+1]),a=String.fromCharCode(t[e+2]);if("A"==a)s=String.fromCharCode(t[e+3]),e+=4;else if("i"===a||"I"===a)s=J(t,e+3),e+=7;else if("c"===a||"C"===a)s=t[e+3],e+=4;else if("s"===a||"S"===a)s=tt(t,e+3),e+=5;else if("f"===a)s=at(t,e+3),e+=7;else{if("Z"!==a){s="Error unknown type: "+a,r[n]=s;break}for(e+=3,s="";;){var o=t[e++];if(0===o)break;s+=String.fromCharCode(o)}}r[n]=s}return r}(this.tagBA),this.tagBA=void 0):this.tagDict={}),this.tagDict}popupData(t){var e,i,r=[];if(this.insertions)for(var s=0;s<this.insertions.length;s+=1){var n=this.insertions[s].start;if(t==n||t==n-1)return r.push({name:"Insertion",value:this.insertions[s].seq}),r.push({name:"Location",value:n}),r}for(var a in r.push({name:"Read Name",value:this.readName}),r.push("<hr>"),r.push({name:"Alignment Start",value:igv.numberFormatter(1+this.start),borderTop:!0}),r.push({name:"Read Strand",value:!0===this.strand?"(+)":"(-)",borderTop:!0}),r.push({name:"Cigar",value:this.cigar}),r.push({name:"Mapped",value:o(this.isMapped())}),r.push({name:"Mapping Quality",value:this.mq}),r.push({name:"Secondary",value:o(this.isSecondary())}),r.push({name:"Supplementary",value:o(this.isSupplementary())}),r.push({name:"Duplicate",value:o(this.isDuplicate())}),r.push({name:"Failed QC",value:o(this.isFailsVendorQualityCheck())}),this.isPaired()&&(r.push("<hr>"),r.push({name:"First in Pair",value:!this.isSecondOfPair(),borderTop:!0}),r.push({name:"Mate is Mapped",value:o(this.isMateMapped())}),this.isMateMapped()&&(r.push({name:"Mate Chromosome",value:this.mate.chr}),r.push({name:"Mate Start",value:this.mate.position+1}),r.push({name:"Mate Strand",value:!0===this.mate.strand?"(+)":"(-)"}),r.push({name:"Insert Size",value:this.fragmentLength}))),r.push("<hr>"),e=!0,i=this.tags())i.hasOwnProperty(a)&&(e?(r.push({name:a,value:i[a],borderTop:!0}),e=!1):r.push({name:a,value:i[a]}));return r;function o(t){return t?"Yes":"No"}}}function at(t,e){return new DataView(t.buffer).getFloat32(e,!0)}class ot{constructor(t){t||(t={}),this.vendorFailed=void 0===t.vendorFailed||t.vendorFailed,this.duplicates=void 0===t.duplicates||t.duplicates,this.secondary=t.secondary||!1,this.supplementary=t.supplementary||!1,this.mqThreshold=void 0===t.mqThreshold?0:t.mqThreshold}pass(t){return!(this.vendorFailed&&t.isFailsVendorQualityCheck()||this.duplicates&&t.isDuplicate()||this.secondary&&t.isSecondary()||this.supplementary&&t.isSupplementary()||t.mq<this.mqThreshold)}}class ht{constructor(t,e){for(let e in t)console.log(e);var i=[],r=[0],s=0;for(e=e||t.byteLength-18;r[0]<e;){var n=new Uint8Array(t,r[0],18),a=n[11]<<8|n[10],o=(n[12],n[13],n[15],n[14],n[17]<<8|n[16]+1),h=12+a+r[0],l=t.byteLength-h;if(l<o+8)break;var c=C(t,h,l,r);r[0]+=8,s+=c.byteLength,i.push(c)}if(1==i.length)return i[0];for(var f=new Uint8Array(s),u=0,d=0;d<i.length;++d){var p=new Uint8Array(i[d]);k(p,0,f,u,p.length),u+=p.length}return f.buffer}}class lt{constructor(t,e,i,r,s,n,a){this.parent=a,this.chr=t,this.start=e,this.end=i,this.length=i-e,this.parent.cm_class?this.coverageMap=new this.parent.cm_class(t,e,i,a):this.coverageMap=new ut(t,e,i,a),this.alignments=[],this.raw_alignments=[],this.downsampledIntervals=[],this.samplingWindowSize=void 0===r?100:r,this.samplingDepth=void 0===s?50:s,this.pairsSupported=n,this.paired=!1,this.pairsCache={},this.downsampledReads=new Set,this.currentBucket=new ft(this.start,this.start+this.samplingWindowSize,this),this.filter=function(t){return t.isMapped()&&!t.isFailsVendorQualityCheck()}}push(t){!1!==this.filter(t)&&(t.tagBA&&(t.tagBA=_t(t.tagBA)),this.parent.keep_raw_alignments&&this.raw_alignments.push(t),this.coverageMap.incCounts(t),this.parent.display_alignments&&(this.pairsSupported&&this.downsampledReads.has(t.readName)||(t.start>=this.currentBucket.end&&(ct.call(this),this.currentBucket=new ft(t.start,t.start+this.samplingWindowSize,this)),this.currentBucket.addAlignment(t))))}forEach(t){this.alignments.forEach(t)}finish(){if(void 0!==this.currentBucket&&ct.call(this),this.pairsSupported){var t=[],e=this.downsampledReads;this.alignments.forEach((function(i){e.has(i.readName)||t.push(i)})),this.alignments=t}this.alignments.sort((function(t,e){return t.start-e.start})),this.pairsCache=void 0,this.downsampledReads=void 0}contains(t,e,i){return this.chr==t&&this.start<=e&&this.end>=i}hasDownsampledIntervals(){return this.downsampledIntervals&&this.downsampledIntervals.length>0}}function ct(){this.alignments=this.alignments.concat(this.currentBucket.alignments),this.currentBucket.downsampledCount>0&&this.downsampledIntervals.push(new pt(this.currentBucket.start,this.currentBucket.end,this.currentBucket.downsampledCount)),this.paired=this.paired||this.currentBucket.paired}class ft{constructor(t,e,i){this.start=t,this.end=e,this.alignments=[],this.downsampledCount=0,this.samplingDepth=i.samplingDepth,this.pairsSupported=i.pairsSupported,this.downsampledReads=i.downsampledReads,this.pairsCache=i.pairsCache}addAlignment(t){var e,i,r,s;this.alignments.length<this.samplingDepth?this.pairsSupported&&rt(t)?(s=this.pairsCache[t.readName])?(s.setSecondAlignment(t),this.pairsCache[t.readName]=void 0):(s=new gt(t),this.paired=!0,this.pairsCache[t.readName]=s,this.alignments.push(s)):this.alignments.push(t):(e=this.samplingDepth/(this.samplingDepth+this.downsampledCount+1),Math.random()<e?(i=Math.floor(Math.random()*(this.alignments.length-1)),r=this.alignments[i],this.pairsSupported&&rt(t)?(void 0!==this.pairsCache[r.readName]&&(this.pairsCache[r.readName]=void 0),s=new gt(t),this.paired=!0,this.pairsCache[t.readName]=s,this.alignments[i]=s):this.alignments[i]=t,this.downsampledReads.add(r.readName)):this.downsampledReads.add(t.readName),this.downsampledCount++)}}class ut{constructor(t,e,i,r){this.chr=t,this.bpStart=e,this.length=i-e,this.parent=r,this.coverage=new Array(this.length),this.maximum=0}incCounts(t){var e=this;function i(i){var r,s,n,a,o;for(n=i.start-e.bpStart,a=0;a<i.len;n++,a++)e.coverage[n]||(e.coverage[n]=new dt),s=i.seq.charAt(a),r=t.strand?"pos"+s:"neg"+s,o=i.qual[a],e.coverage[n][r]+=1,e.coverage[n]["qual"+s]+=o,e.coverage[n].total+=1,e.coverage[n].qual+=o,e.maximum=Math.max(e.coverage[n].total,e.maximum)}void 0===t.blocks?i(t):t.blocks.forEach((function(t){i(t)}))}}ut.threshold=.2,ut.qualityWeight=!0;class dt{constructor(){this.posA=0,this.negA=0,this.posT=0,this.negT=0,this.posC=0,this.negC=0,this.posG=0,this.negG=0,this.posN=0,this.negN=0,this.pos=0,this.neg=0,this.qualA=0,this.qualT=0,this.qualC=0,this.qualG=0,this.qualN=0,this.qual=0,this.total=0}isMismatch(t){var e,i=this,r=ut.threshold*(ut.qualityWeight&&this.qual?this.qual:this.total);return e=0,["A","T","C","G"].forEach((function(r){r!==t&&(e+=ut.qualityWeight&&i.qual?i["qual"+r]:i["pos"+r]+i["neg"+r])})),e>=r}}class pt{constructor(t,e,i){this.start=t,this.end=e,this.counts=i}popupData(t){return[{name:"start",value:this.start+1},{name:"end",value:this.end},{name:"# downsampled:",value:this.counts}]}}class gt{constructor(t){this.firstAlignment=t,this.chr=t.chr,this.readName=t.readName,t.start<t.mate.position?(this.start=t.start,this.end=Math.max(t.mate.position,t.start+t.lengthOnRef),this.connectingStart=t.start+t.lengthOnRef,this.connectingEnd=t.mate.position):(this.start=t.mate.position,this.end=t.start+t.lengthOnRef,this.connectingStart=t.mate.position,this.connectingEnd=t.start),this.lengthOnRef=this.end-this.start}setSecondAlignment(t){this.secondAlignment=t,t.start>this.firstAlignment.start?(this.end=t.start+t.lengthOnRef,this.connectingEnd=t.start):(this.start=t.start,this.connectingStart=t.start+t.lengthOnRef),this.lengthOnRef=this.end-this.start}popupData(t){var e=[];return e=e.concat(this.firstAlignment.popupData(t)),this.secondAlignment&&(e.push("-------------------------------"),e=e.concat(this.secondAlignment.popupData(t))),e}isPaired(){return!0}firstOfPairStrand(){return this.firstAlignment.isFirstOfPair()?this.firstAlignment.strand:this.secondAlignment?this.secondAlignment.strand:this.firstAlignment.strand}}class mt{constructor(){this.alignments=[],this.score=void 0}findCenterAlignment(t,e){var i=void 0;return this.alignments.forEach((function(r){void 0===i&&(r.start+r.lengthOnRef<t||r.start>e||(i=r))})),i}updateScore(t,e,i){this.score=this.caculateScore(t,1+t,e,i)}caculateScore(t,e,i,r){var s,n;return void 0===(n=this.findCenterAlignment(t,e))?Number.MAX_VALUE:"NUCLEOTIDE"===r.sort?(s=void 0,n.blocks.forEach((function(e){var r,n,a,o,h,l=i.sequence,c=i.coverageMap;if("*"!==e.seq)for(var f=0,u=e.start-i.start,d=e.start,p=e.seq.length;f<p;f++,u++,d++)t===d&&(r=l.charAt(u),"="===(n=e.seq.charAt(f))&&(n=r),"N"===n?s=2:n===r?s=3:"X"===n||n!==r?(o=(a=c.coverage[d-c.bpStart])["pos"+n]+a["neg"+n],h=a.qual?a.qual:0,s=-(o+h/1e3)):console.log("BamAlignmentRow.caculateScore - huh?"));else s=3})),void 0===s?Number.MAX_VALUE:s):"STRAND"===r.sort?n.strand?1:-1:"START"===r.sort?n.start:Number.MAX_VALUE}}function _t(t){for(var e=0,i=t.length,r={};e<i;){var s,n=String.fromCharCode(t[e])+String.fromCharCode(t[e+1]),a=String.fromCharCode(t[e+2]);if("A"==a)s=String.fromCharCode(t[e+3]),e+=4;else if("i"===a||"I"===a)s=J(t,e+3),e+=7;else if("c"===a||"C"===a)s=t[e+3],e+=4;else if("s"===a||"S"===a)s=tt(t,e+3),e+=5;else if("f"===a)s=at(t,e+3),e+=7;else{if("Z"!==a){s="Error unknown type: "+a,r[n]=s;break}for(e+=3,s="";;){var o=t[e++];if(0===o)break;s+=String.fromCharCode(o)}}r[n]=s}return r}class vt{constructor(t){this.config=t||{}}getFileHeader(){return this.is_indexed=!0,new Promise((function(t,e){t()}))}getFeatures(t,e,i,r,s){if(this.is_indexed)return this._getFeatures(t,e,i,r,s);var n=this;return new Promise((function(a,o){n.getFileHeader().then((function(){n._getFeatures(t,e,i,r,s).then((function(t){a(t)})).catch(o)})).catch(o)}))}_getFeatures(t,e,i,r,s){0===e&&(e=1);var n=this;return n.time=Date.now(),new Promise((function(a,o){n.featureCache&&t!==n.featureCache.range.chr&&(n.featureCache=null);var h=new Rt(t,e,i),l=n.featureCache,c=n.config.maxRows||500;let f=!1;if(l?void 0!==l.range&&(f=l.range.rangesToGet(h)):f={all:[e,i]},f){let l=[],u=[];for(let e in f){let i=f[e];l.push(n.retrieveFeatures(t,i[0],i[1],r,s)),u.push([e,f[e]])}Promise.all(l).then((function(r){let s=[];n.featureCache&&(s=n.featureCache.allFeatures());let o=0;for(let t of r){if(null===t&&(t=[]),"left"===u[o][0]){let e=u[o][1][1],i=0;for(let r=t.length-1;r>=0&&!(t[r].end<e);r--)i++;0!==i&&t.splice(-i)}if("right"===u[o][0]){let e=u[o][1][0],i=0;for(i=0;i<t.length&&!(t[i].start>e);i++);0!==i&&t.splice(0,i)}o++,s=s.concat(t)}let l=n.featureCache?n.featureCache.range:h;n.featureCache=new Ct(s,l),vt.packFeatures(s,c),a(n.featureCache.queryFeatures(t,e,i))})).catch((function(t){o(t)}))}else a(n.featureCache.queryFeatures(t,e,i))}))}static packFeatures(t,e){if(null!=t&&0!==t.length){var i={},r=[];t.forEach((function(t){var e=t.chr,s=i[e];s||(s=[],i[e]=s,r.push(e)),s.push(t)})),r.forEach((function(t){!function(t,e){var i=[];t.sort((function(t,e){return t.start-e.start})),i.push(-1e3),t.forEach((function(t){var r,s=Math.min(i.length,e),n=t.start;for(r=0;r<s;r++)if(n>=i[r])return t.row=r,void(i[r]=t.end);t.row=r,i[r]=t.end}))}(i[t],e)}))}}}class wt extends vt{constructor(t,e){super(t),this.reader=new yt(t,e)}retrieveFeatures(t,e,i){return this.reader.readFeatures(t,e,i)}getFileHeader(){var t=this;return new Promise((function(e,i){t.reader.readHeader().then((function(){t.is_indexed=!0,e()})).catch(i)}))}}class bt extends vt{constructor(t,e){t.sourceType="gtex",super(t),this.header=!0,this.feature_source=new L(t,e)}retrieveFeatures(t,e,i,r,s){return this.feature_source.getFeatures(t,e,i,!1,s)}}class yt{constructor(t,e){if(this.config=t||{},t.localFile)this.localFile=t.localFile,this.filename=t.localFile.name;else{this.url=t.url,this.indexURL=t.indexURL,this.headURL=t.headURL||this.filename;var i=W.parseUri(t.url);this.filename=i.file,this.path=i.path}this.format=t.format,this.parser=this.getParser(this.format,e)}getParser(t,e){switch(t){case"vcf":return new VcfParser;case"seg":return new SegParser;default:return new St(t,e,this.config)}}isIndexable(){var t=this.config.indexURL,e=this.type,i=this.config.indexed;return t||"wig"!=e&&0!=i}loadIndex(){var t=this.indexURL;return this.filename.endsWith(".gz")?(t||(t=this.url+".tbi"),V(t,this.config,!0)):(t||(t=this.url+".idx"),loadTribbleIndex(t,this.config))}loadFeaturesNoIndex(){var t=this;return new Promise((function(e,i){var r=t.parser,s={headers:t.config.headers,withCredentials:t.config.withCredentials};function n(i){t.header=r.parseHeader(i),t.header instanceof String&&t.header.startsWith("##gff-version 3")&&(t.format="gff3"),e(r.parseFeatures(i))}t.localFile?E.loadStringFromFile(t.localFile,s).then(n).catch(i):E.loadString(t.url,s).then(n).catch(i)}))}loadFeaturesWithIndex(t,e,i){var r=this;return new Promise((function(s,n){var a,o=r.index,h=o&&o.tabix?o.sequenceIndexMap[t]:t,l=[];(a=o.getBlocksForRange(h,e,i))&&0!==a.length?(a.forEach((function(s){l.push(new Promise((function(n,a){var h,l=s.minv.block,c=s.minv.offset,f=s.maxv.block+(o.tabix?65536:0),u={headers:r.config.headers,range:{start:l,size:f-l+1},withCredentials:r.config.withCredentials};h=function(s){var a,h;a=o.tabix?E.arrayBufferToString(R(s)):s,h=c?a.slice(c):a;var l=r.parser.parseFeatures(h,t,e,i);n(l)},r.localFile?E.loadStringFromFile(r.localFile,u).then(h).catch(a):o.tabix?E.loadArrayBuffer(r.url,u).then(h).catch(a):E.loadString(r.url,u).then(h).catch(a)})))})),Promise.all(l).then((function(t){var e,i;if(1===t.length)i=t[0];else{for(i=t[0],e=1;e<t.length;e++)i=i.concat(t[e]);i.sort((function(t,e){return t.start-e.start}))}s(i)})).catch(n)):s(null)}))}getIndex(){var t=this,e=this.isIndexable();return new Promise((function(i,r){void 0===t.indexed&&e?t.loadIndex().then((function(e){e?(t.index=e,t.indexed=!0):t.indexed=!1,i(t.index)})).catch(r):i(t.index)}))}readHeader(){var t=this;return new Promise((function(e,i){t.header?e(t.header):t.getIndex().then((function(r){if(r){var s={headers:t.config.headers,bgz:r.tabix,range:{start:0,size:65e3},withCredentials:t.config.withCredentials},n=function(i){t.header=t.parser.parseHeader(i),e(t.header)};t.localFile?E.loadStringFromFile(t.localFile,s).then(n):E.loadString(t.url,s).then(n).catch(i)}else t.loadFeaturesNoIndex(void 0).then((function(i){var r=t.header||{};r.features=i,e(r)})).catch(error)})).catch(i)}))}readFeatures(t,e,i){var r=this;return new Promise((function(s,n){function a(t){s(t)}r.index?r.loadFeaturesWithIndex(t,e,i).then(a).catch(n):r.loadFeaturesNoIndex().then(a)}))}}const xt=Number.MAX_VALUE,kt=["Name","gene_name","gene","gene_id","alias","locus"];class St{constructor(t,e,i){this.format=t,this.nameField=i?i.nameField:void 0,this.skipRows=0,e?(this.delimiter=/\s+/,this.decode=function(t,i){let r={chr:t[0],start:parseInt(t[1]),end:parseInt(t[2])};return e(t.slice(3),r),r}):"generic"===i.decode_function?this.decode=function(t,e){let i={chr:t[0],start:parseInt(t[1]),end:parseInt(t[2])};return i.data=t.slice(3),i}:(this.decode="decodeRefflat"===i.decode_function?St.decodeRefflat:St.decodeBed,this.delimiter=/\s+/)}parseHeader(t){var e,i,r,s=t.split("\n"),n=s.length;for(i=0;i<n;i++){if(!((e=s[i]).startsWith("track")||e.startsWith("#")||e.startsWith("browser"))){r={};break}e.startsWith("track")?r=this.parseTrackLine(e):e.startsWith("##gff-version 3")&&(this.format="gff3",r||(r={}),r.format="gff3")}return r}parseFeatures(t,e,i,r){if(!t)return null;var s,n,a,o,h,l,c=t.split("\n"),f=c.length,u=[],d=0,p=(this.decode,this.format),g=this.delimiter||"\t";for(h=this.skipRows;h<f;h++)if(!((o=c[h]).startsWith("track")||o.startsWith("#")||o.startsWith("browser")))if("wig"===p&&o.startsWith("fixedStep"))s=this.parseFixedStep(o);else if("wig"===p&&o.startsWith("variableStep"))s=this.parseVariableStep(o);else if(!((a=c[h].split(g)).length<1||"wig"!==p&&a.length<3))if(n=this.decode(a,s)){if(n.chr!==e||n.end<i||n.start>r)continue;u.length<xt?u.push(n):(l=Math.floor(Math.random()*d))<xt&&(u[l]=n),d++}else console.log(null);return u}static parseFixedStep(t){var e=t.split(/\s+/);return{format:"fixedStep",chrom:e[1].split("=")[1],start:parseInt(e[2].split("=")[1],10),step:parseInt(e[3].split("=")[1],10),span:e.length>4?parseInt(e[4].split("=")[1],10):1,index:0}}static parseVariableStep(t){var e=t.split(/\s+/);return{format:"variableStep",chrom:e[1].split("=")[1],span:e.length>2?parseInt(e[2].split("=")[1],10):1}}static parseTrackLine(t){var e,i,r,s={},n=t.split(/(?:")([^"]+)(?:")|([^\s"]+)(?=\s+|$)/g),a=[];for(e=1;e<n.length;e++)n[e]&&0!==n[e].trim().length&&((i=n[e].trim()).endsWith("=")>0?r=i:r?(a.push(r+i),r=void 0):a.push(i));return a.forEach((function(t){if(t){var e=t.split("=",2);2==e.length&&(s[e[0]]=e[1])}})),s}static decodeBed(t,e){var i,r,s,n,a,o,h,l,c,f,u,d;if(t.length<3)return null;if(f={chr:t[0],start:i=parseInt(t[1]),end:t.length>2?parseInt(t[2]):i+1,score:1e3},t.length>3){a=(n=t[3].replace(/"/g,"")).split(";");for(var p=0;p<a.length;p++){var g=a[p].split("=");"gene_id"==g[0]&&(r=g[1]),"gene_name"==g[0]&&(s=g[1])}f.id=r||n,f.name=s||n}if(t.length>4&&(f.score=parseFloat(t[4])),t.length>5&&(f.strand=t[5]),t.length>6&&(f.cdStart=parseInt(t[6])),t.length>7&&(f.cdEnd=parseInt(t[7])),t.length,t.length>11){for(o=parseInt(t[9]),h=t[10].split(","),l=t[11].split(","),c=[],p=0;p<o;p++){var m={start:u=i+parseInt(l[p]),end:d=u+parseInt(h[p])};(f.cdStart>d||f.cdEnd<f.cdStart)&&(m.utr=!0),f.cdStart>=u&&f.cdStart<=d&&(m.cdStart=f.cdStart),f.cdEnd>=u&&f.cdEnd<=d&&(m.cdEnd=f.cdEnd),c.push(m)}f.exons=c}return f}static decodeRefflat(t,e){if(t.length<10)return null;if(void 0===t[10])return console.log(t[1]),null;for(var i={chr:t[2],start:parseInt(t[4]),end:parseInt(t[5]),id:t[1],name:t[0],strand:t[3],cdStart:parseInt(t[6]),cdEnd:parseInt(t[7])},r=parseInt(t[8]),s=t[9].split(","),n=t[10].split(","),a=[],o=0;o<r;o++){let t={start:parseInt(s[o]),end:parseInt(n[o])};(i.cdStart>t.end||i.cdEnd<i.cdStart)&&(t.utr=!0),i.cdStart>=t.start&&i.cdStart<=t.end&&(t.cdStart=i.cdStart),i.cdEnd>=t.start&&i.cdEnd<=t.end&&(t.cdEnd=i.cdEnd),a.push(t)}return i.exons=a,i}static decodePeak(t,e){var i,r,s,n,a,o,h;return t.length<9?null:(i=t[0],r=parseInt(t[1]),s=parseInt(t[2]),a=t[3],o=parseFloat(t[4]),n=t[5].trim(),h=parseFloat(t[6]),0===o&&(o=h),{chr:i,start:r,end:s,name:a,score:o,strand:n,signal:h,pValue:parseFloat(t[7]),qValue:parseFloat(t[8])})}static decodeBedGraph(t,e){return t.length<3?null:{chr:t[0],start:parseInt(t[1]),end:parseInt(t[2]),value:parseFloat(t[3])}}static decodeWig(t,e){var i,r,s;return"fixedStep"===e.format?(r=(i=e.index*e.step+e.start)+e.span,s=parseFloat(t[0]),++e.index,isNaN(s)?null:{chr:e.chrom,start:i,end:r,value:s}):"variableStep"===e.format?t.length<2?null:(r=(i=parseInt(t[0],10))+e.span,s=parseFloat(t[1]),isNaN(s)?null:{chr:e.chrom,start:i,end:r,value:s}):decodeBedGraph(t)}static decodeAneu(t,e){var i,r,s,n;return t.length<4?null:(i=t[1],r=parseInt(t[2]),s=t.length>3?parseInt(t[3]):r+1,n={chr:i,start:r,end:s},t.length>4&&(n.score=parseFloat(t[4]),n.value=n.score),n.popupData=function(){return[{name:"Name",value:n.name}]},n)}static decodeFusionJuncSpan(t,e){var i=t[0],r=t[1],s=parseInt(t[2]),n=parseInt(t[3]),a=parseInt(t[4]),o=parseInt(t[5]),h=t[6],l={chr:i,name:r,junction_left:s,junction_right:n,num_junction_reads:a,num_spanning_frags:o,spanning_frag_coords:[],start:-1,end:-1},c=s,f=n;if(o>0)for(var u=h.split(","),d=0;d<u.length;d++){var p=u[d].split("-"),g=p[0],m=p[1];g<c&&(c=g),m>f&&(f=m),l.spanning_frag_coords.push({left:g,right:m})}return l.start=c,l.end=f,l.popupData=function(){return[{name:"Name",value:l.name}]},l}static decodeGtexGWAS(t,e){return t.length<8?null:{chr:t[0],start:parseInt(t[1])-1,end:parseInt(t[3].split(":")[1]),pvalue:parseFloat(t[5])}}static decodeGFF(t,e){var i,r,s,n,a,o,h,l,c,f,u,d,p=this.format;if(t.length<9)return null;i=t[0],a=t[2],r=parseInt(t[3])-1,s=parseInt(t[4]),o="."===t[5]?0:parseFloat(t[5]),n=t[6],"."===t[7]||parseInt(t[7]),h=t[8];var g="gff3"===p?"=":/\s+/,m={};if(h.split(";").forEach((function(t){var e,i,r=t.trim().split(g,2);2==r.length&&(e=r[0].trim(),(i=r[1].trim()).startsWith('"')&&i.endsWith('"')&&(i=i.substr(1,i.length-2)),"ID"===r[0]?l=r[1]:"Parent"===r[0]?c=r[1]:"color"===r[0].toLowerCase()?f=igv.createColorString(r[1]):"transcript_id"===r[0]&&(l=r[1]),m[e]=i)})),this.nameField)u=m[this.nameField];else for(d=0;d<kt.length;d++)if(m.hasOwnProperty(kt[d])){this.nameField=kt[d],u=m[this.nameField];break}return{id:l,parent:c,name:u,type:a,chr:i,start:r,end:s,score:o,strand:n,color:f,attributeString:h,popupData:function(){var t,e,i=this.attributeString.split(";"),r=[];return i.forEach((function(i){var s=i.trim().split(g,2);2===s.length&&void 0!==s[1]&&(t=s[0].trim(),(e=s[1].trim()).startsWith('"')&&e.endsWith('"')&&(e=e.substr(1,e.length-2)),r.push({name:t,value:e}))})),r}}}decodeCustom(t,e){var i,r,s,n,a=this.format,o=a.coords||0;return t.length<3?null:(r=t[a.chr],s=parseInt(t[a.start])-o,n=void 0!==a.end?parseInt(t[a.end]):s+1,i={chr:r,start:s,end:n},a.fields&&a.fields.forEach((function(e,r){r!=a.chr&&r!=a.start&&r!=a.end&&(i[e]=t[r])})),i)}}class Ct{constructor(t,e){this.treeMap=Ct.buildTreeMap(t),this.range=e}queryFeatures(t,e,i){var r,s,n,a,o,h,l;return(h=this.treeMap[t])?0==(l=h.findOverlapping(e,i)).length?[]:(r=[],l.forEach((function(t){for(s=t.value,a=s.length,o=0;o<a&&!((n=s[o]).start>i);o++)n.end>=e&&r.push(n)})),r):[]}allFeatures(){var t=[],e=this.treeMap;if(e)for(var i in e)e.hasOwnProperty(i)&&e[i].mapIntervals((function(e){t=t.concat(e.value)}));return t}static buildTreeMap(t){var e={},i=[],r={};if(t){t.forEach((function(t){var r,s=t.chr;(r=e[s])||(i.push(s),r=[],e[s]=r),r.push(t)}));for(let t=0;t<i.length;t++){let s=i[t];r[s]=Ct.buildIntervalTree(e[s])}}return r}static buildIntervalTree(t){var e,i,r,s,n,a,o,h;for(n=new Tt,o=t.length,a=Math.max(10,Math.round(o/100)),t.sort((function(t,e){return t.start===e.start?0:t.start>e.start?1:-1})),e=0;e<o;e+=a)i=Math.min(o,e+a),r=(h=t.slice(e,i))[0].start,s=r,h.forEach((function(t){s=Math.max(s,t.end)})),n.insert(r,s,h);return n}}let At={color:1};At.parent=At,At.left=At,At.right=At;class Tt{constructor(){this.root=At}insert(t,e,i){var r=new It(t,e,i),s=new Et(r);for(this.treeInsert(s),s.color=2;s!=this.root&&2==s.parent.color;){var n;s.parent==s.parent.parent.left?2==(n=s.parent.parent.right).color?(s.parent.color=1,n.color=1,s.parent.parent.color=2,s=s.parent.parent):(s==s.parent.right&&(s=s.parent,this.leftRotate(s)),s.parent.color=1,s.parent.parent.color=2,this.rightRotate(s.parent.parent)):2==(n=s.parent.parent.left).color?(s.parent.color=1,n.color=1,s.parent.parent.color=2,s=s.parent.parent):(s==s.parent.left&&(s=s.parent,this.rightRotate(s)),s.parent.color=1,s.parent.parent.color=2,this.leftRotate(s.parent.parent))}this.root.color=1}findOverlapping(t,e){var i=new It(t,e,0);if(this.root===At)return[];var r=this.searchAll(i,this.root,[]);return r.length>1&&r.sort((function(t,e){return t.low-e.low})),r}logIntervals(){!function t(e,i){for(var r="",s=0;s<i;s++)r+=" ";console.log(r+e.interval.low+" "+e.interval.high),i+=5,e.left!=At&&t(e.left,i),e.right!=At&&t(e.right,i)}(this.root,0)}mapIntervals(t){!function e(i){t(i.interval),i.left!=At&&e(i.left),i.right!=At&&e(i.right)}(this.root)}searchAll(t,e,i){return e.interval.overlaps(t)&&i.push(e.interval),e.left!=At&&e.left.max>=t.low&&this.searchAll(t,e.left,i),e.right!=At&&e.right.min<=t.high&&this.searchAll(t,e.right,i),i}leftRotate(t){var e=t.right;t.right=e.left,e.left!=At&&(e.left.parent=t),e.parent=t.parent,t.parent==At?this.root=e:t.parent.left==t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e,this.applyUpdate(t)}rightRotate(t){var e=t.left;t.left=e.right,e.right!=At&&(e.right.parent=t),e.parent=t.parent,t.parent==At?this.root=e:t.parent.right==t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e,this.applyUpdate(t)}treeInsert(t){for(var e=this.root,i=At;e!=At;)i=e,e=t.interval.low<=e.interval.low?e.left:e.right;t.parent=i,i==At?(this.root=t,t.left=t.right=At):t.interval.low<=i.interval.low?i.left=t:i.right=t,this.applyUpdate(t)}applyUpdate(t){for(;t!=At;){var e=t.left.max>t.right.max?t.left.max:t.right.max,i=t.interval.high;t.max=e>i?e:i;var r=t.left.min<t.right.min?t.left.min:t.right.min,s=t.interval.low;t.min=r<s?r:s,t=t.parent}}}class It{constructor(t,e,i){this.low=t,this.high=e,this.value=i}equals(t){return!!t&&(this==t||this.low==otherInterval.low&&this.high==otherInterval.high)}compareTo(t){return this.low<t.low?-1:this.low>t.low?1:this.high<t.high?-1:this.high>t.high?1:0}overlaps(t){try{return this.low<=t.high&&t.low<=this.high}catch(t){igv.presentAlert(t)}}}class Et{constructor(t){this.parent=At,this.left=At,this.right=At,this.interval=t,this.color=2}}class Rt{constructor(t,e,i,r){this.chr=t,this.start=e,this.end=i,this.features=r}contains(t,e,i){return this.chr==t&&this.start<=e&&this.end>=i}containsRange(t){return this.chr===t.chr&&this.start<=t.start&&this.end>=t.end}rangesToGet(t){let e=!1,i={};return this.chr!==t.chr?(i.all=[t.start,t.end],e=!0,this.start=t.start,this.end=t.end):(t.start<this.start&&(i.left=[t.start,this.start],e=!0,this.start=t.start),t.end>this.end&&(i.right=[this.end,t.end],e=!0,this.end=t.end)),!!e&&i}}class Dt{constructor(t){this.file=t,this.indexed=!0,this.indexed&&(this.indexFile=this.file+".fai")}init(){var t=this;return t.indexed?new Promise((function(e,i){t.getIndex().then((function(i){var r=0;t.chromosomes={},t.chromosomeNames.forEach((function(e){var i=t.index[e].size;t.chromosomes[e]=new igv.Chromosome(e,r++,i)})),e()})).catch(i)})):t.loadAll()}getSequence(t,e,i){return this.indexed?this.getSequenceIndexed(t,e,i):getSequenceNonIndexed.this(t,e,i)}getSequenceIndexed(t,e,i){var r=this;return new Promise((function(s,n){var a=r.interval;if(a&&a.contains(t,e,i))s(f(a,e,i));else{var o=e,h=i;if(i-e<1e5){var l=i-e,c=Math.round(e+l/2);o=Math.max(0,c-5e4),h=c+5e4}r.readSequence(t,o,h).then((function(n){r.interval=new Rt(t,o,h,n),s(f(r.interval,e,i))})).catch(n)}function f(t,e,i){var r=e-t.start,s=i-e;return t.features?t.features.substr(r,s):null}}))}getSequenceNonIndexed(t,e,i){var r=this;return new Promise((function(s,n){var a=r.sequences[t];a&&a.length>i&&s(a.substring(e,i))}))}getIndex(){var t=this;return new Promise((function(e,i){t.index?e(t.index):E.load(t.indexFile,{}).then((function(i){var r=i.split("\n"),s=r.length,n=0;for(t.chromosomeNames=[],t.index={};n<s;){var a=r[n++].split("\t");if(5==a.length){var o=a[0],h={size:parseInt(a[1]),position:parseInt(a[2]),basesPerLine:parseInt(a[3]),bytesPerLine:parseInt(a[4])};t.chromosomeNames.push(o),t.index[o]=h}}e&&e(t.index)})).catch(i)}))}loadAll(){var t=this;return new Promise((function(e,i){t.chromosomeNames=[],t.chromosomes={},t.sequences={},E.load(t.file,{withCredentials:t.withCredentials}).then((function(i){for(var r,s,n=i.splitLines(),a=n.length,o=0,h="",l=0;o<a;)(r=n[o++].trim()).startsWith("#")||0===r.length||(r.startsWith(">")?(h&&(t.chromosomeNames.push(s),t.sequences[s]=h,t.chromosomes[s]=new igv.Chromosome(s,l++,h.length)),s=r.substr(1).split("\\s+")[0],h=""):h+=r);e()}))}))}readSequence(t,e,i){var r=this;return new Promise((function(s,n){r.getIndex().then((function(){var a=r.index[t];if(a){var o=Math.max(0,e),h=Math.min(a.size,i),l=a.bytesPerLine,c=a.basesPerLine,f=a.position,u=l-c,d=Math.floor(o/c),p=Math.floor(h/c),g=o-d*c,m=f+d*l+g,_=f+p*l+(h-p*c)-1-m+1;_<=0&&s(null),E.load(r.file,{range:{start:m,size:_}}).then((function(t){var e,i="",r=0,n=t.length;for(g>0&&(e=Math.min(h-o,c-g),i+=t.substr(r,e),r+=e+u);r<n;)e=Math.min(c,n-r),i+=t.substr(r,e),r+=e+u;s(i)})).catch(n)}else console.log("No index entry for chr: "+t),r.interval=new Rt(t,e,i,null),s(null)})).catch(n)}))}}class Lt{constructor(t){this.config=t}_setFeatureSource(){}drawScale(t){}getConfig(){return JSON.parse(JSON.stringify(this.config))}setConfigAttribute(t,e){this.config[t]=e,"url"===t&&this._setFeatureSource()}setColorFunction(t){this.color_function=t}getFeatureAt(t,e,i,r){return null}setConfig(t){this.config.url!==t.url?(this.config=t,this._setFeatureSource()):this._setFeatureSource()}getFeatures(t,e,i,r,s){return this.feature_source.getFeatures(t,e,i,r,s)}getSettings(t){return[{type:"slider",min:10,max:1e3,label:"Height",current_value:this.config.height,func:e=>{this.setConfigAttribute("height",e),t.update()}}]}static calculateLabel(t){"string"!=typeof t&&(t=t[0]);let e=t.split("/"),i=e[e.length-1];return e=i.split("."),i=e[0],i}addExtraControls(t,e){}static getTypeFromURL(t){let e={};return"string"!=typeof t||(t.endsWith("bw")?(e.type="bigwig",e.format="wig"):t.endsWith(".bed.gz")?(e.type="bed",e.format="feature"):t.endsWith(".bb")&&!e.type?(e.type="bigbed",e.format="feature"):t.endsWith(".fasta")?(e.type="fasta",e.format="sequence"):t.endsWith(".bam")&&(e.type="bam",e.format="alignment")),e}static parseConfig(t){let e=JSON.parse(JSON.stringify(t));if(!e.type&&e.url){let t=Lt.getTypeFromURL(e.url);t.type&&(e.type=t.type,e.format=t.format)}return"bed"!==e.type&&"bigbed"!==e.type||(e.format="feature"),!e.short_label&&e.url&&(e.short_label=Lt.calculateLabel(e.url)),e.track_id||(e.track_id=e.url),"feature"===e.format&&(e.displayMode=e.displayMode||"COLLAPSED",e.labelDisplayMode="SLANT",e.squishedCallHeight=e.squishedCallHeight||30,e.expandedCallHeight=e.expandedCallHeight||15,e.featureHeight=e.featureHeight||12),"wig"!==e.format&&"bigwig"!==e.type||(e.scale||(e.scale="dynamic"),e.min_y||(e.min_y=0),e.max_y||(e.max_y=100),e.height||(e.height=100)),"bam"===e.type&&(e.featureHeight||(e.featureHeight=12)),e.height||(e.height=100),e.color||"bam"===e.type&&(e.color="#D3D3D3"),e.opacity||(e.opacity=1),e}drawMessage(t){const e=t.context;e.save(),e.font="15px Verdana";const i=e.measureText(t.features),r=t.top+t.height/2+20;e.fillStyle=t.textColor;for(let s=0;s<t.pixelWidth;s+=i.width+10)e.fillText(t.features,s,r);e.restore()}static getTrack(t){t=Lt.parseConfig(t);let e=Lt.track_types[t.type];if(!e)throw new Error("Track type "+t.type+" not recognised");return new e.class(t)}}Lt.custom_tracks={},Lt.track_types={};class Mt extends Lt{constructor(t){t||(t={track_id:"ruler"+Mt.count,format:"ruler",short_label:"Ruler",type:"ruler"}),super(t),this.height=30,this.config.height=30,this.name="",this.disableButtons=!0,this.ignoreTrackMenu=!0,this.order=-Number.MAX_VALUE,Mt.count++}getFeatures(t,e,i){return new Promise((function(t,e){t([])}))}drawFeatures(t){var e,i,r,s,n,a,o=t.context;e={textAlign:"center",font:"10px PT Sans",fillStyle:t.textColor,strokeStyle:t.textColor},i=Math.floor(1100*t.bpPerPixel),s=(r=Mt.findSpacing(i)).majorTick,n=Math.floor(t.bpStart/s)-1,a=0;let h=t.top+this.height;for(Ot.setProperties(o,e);a<t.pixelWidth;){var l=Math.floor(n*s),c=2;a=Math.round((l-1-t.bpStart+.5)/t.bpPerPixel);var f=u(l/r.unitMultiplier,0)+" "+r.majorUnit;n%1==0&&Ot.fillText(o,f,a,h-15),Ot.strokeLine(o,a,h-10,a,h-c),n++}function u(t,e){var i=10;switch(e){case 0:i=1;break;case 1:i=10;break;case 2:i=100;break;default:i=1e3}var r=""+Math.abs(Math.round(t*i)/i);-1==r.indexOf(".")&&(r+=".");for(var s=r.substr(0,r.indexOf(".")),n=s-0,a=r.substr(r.indexOf("."));a.length-1<e;)a+="0";if("."==a&&(a=""),n>=1e3){var o=s.length;s=parseInt(""+n/1e3)+","+s.substring(o-3,o)}n>=1e6&&(o=s.length,s=parseInt(""+n/1e6)+","+s.substring(o-7,o));var h=s+a;return t<0&&(h="("+h+")"),h}return Ot.strokeLine(o,0,h-c,t.pixelWidth,h-c),h}static findSpacing(t){if(t<10)return new Ft(1,"",1);var e,i,r=Math.floor((e=t,i=Math.log(10),Math.log(e)/i)),s="",n=1;r>9&&(s="gb",n=1e9),r>6?(s="mb",n=1e6):r>3&&(s="kb",n=1e3);var a=t/Math.pow(10,r-1);return new Ft(a<25?Math.pow(10,r-1):Math.pow(10,r)/2,s,n)}}Mt.count=0,Lt.track_types.ruler={class:Mt,name:"Ruler"};class Ft{constructor(t,e,i){this.majorTick=t,this.majorUnit=e,this.unitMultiplier=i}}class Bt extends Lt{constructor(t){super(t),this._setFeatureSource(),this.filter_function=null,this.color_function=null}_setFeatureSource(){this.feature_source=new wt(this.config)}setFilterFunction(t){this.filter_function=t}getCurrentFeatures(t,e,i){return this.feature_source.featureCache.queryFeatures(t,e,i)}drawFeatures(t){let e=0;var i,r=t.features,s=t.context,n=t.bpPerPixel,a=t.bpStart,o=t.pixelWidth,h=(t.pixelHeight,a+o*n+1);let l=0;t.top&&(l=t.top),this.top=l;let c=this.config,f=0+o;this.config.squishedCallHeight=this.config.featureHeight+10,this.config.expandedCallHeight=this.config.featureHeight/2+2;let u=null;if(r.length>5e4&&(u=Math.round(r.length/5e4)+1),r){let m=this.config.opacity?this.config.opacity:1;s.globalAlpha=m;for(var d,p=0,g=r.length;p<g;p++){if(u&&p%u!=0)continue;if(d=r[p],this.filter_function&&!this.filter_function(d)){d.display=!1;continue}if(d.display=!0,d.end<a)continue;if(d.start>h)break;let g=this.calculateFeatureCoordinates(d,a,n),m=c.featureHeight;"SQUISHED"===c.displayMode&&null!=d.row?(m=c.featureHeight/2,i=c.expandedCallHeight*d.row+2):i="EXPANDED"===c.displayMode&&null!=d.row?c.squishedCallHeight*d.row+5:5,(i+=l)+m>e&&(e=i+m),g.py=i,g.h=m;let _={bpPerPixel:n,bpStart:a,pixelWidth:o};this.color_function&&(d.color=this.color_function(d)),this.renderFeature(d,g,s,_,t.textColor),this.renderFeatureLabel(s,d,g.px,g.px1,i,0,f,t.textColor)}s.globalAlpha=1}else console.log("No feature list");return this.bottom=e,"COLLAPSED"===this.config.displayMode&&(e+=25),e}renderFeatureLabel(t,e,i,r,s,n,a,o){let h=this.config;var l,c,f,u,d,p;r<n||i>a?(f=i,u=r):(f=Math.max(i,n),u=Math.min(r,a));let g=e.name;this.label_function&&(g=this.label_function(e)),u-f>t.measureText(g).width&&"SQUISHED"!=h.displayMode&&g&&(l={font:"10px PT Sans",textAlign:"center",fillStyle:h.color||o,strokeStyle:h.color||o},"COLLAPSED"===h.displayMode&&"SLANT"===h.labelDisplayMode&&(c={rotate:{angle:45}},delete l.textAlign),d=f+(u-f)/2,p=function(t,e){return e?t+h.featureHeight+14:t+h.featureHeight+7}(s,c),Ot.fillText(t,g,d,p,l,c))}calculateFeatureCoordinates(t,e,i){var r=Math.round((t.start-1-e)/i),s=Math.round((t.end-e)/i),n=s-r;return n<3&&(n=3,r-=1),{px:r,px1:s,pw:n}}renderFeature(t,e,i,r,s){var n,a,o,h,l,c,f,u,d,p,g,m=this.config.color||s;t.color&&(m=t.color),i.fillStyle=m,i.strokeStyle=m,p=(o=e.py+e.h/2)-(g=e.h/2)/2;let _=t.exons?t.exons.length:0;if(0==_)i.fillRect(e.px,e.py,e.pw,e.h);else{for(e.px=Math.max(e.px,0),e.px1=Math.min(e.px1,r.pixelWidth),Ot.strokeLine(i,e.px+1,o,e.px1-1,o),h="+"==t.strand?1:-1,a=e.px+10;a<e.px1;a+=20)Ot.strokeLine(i,a-2*h,o-2,a,o),Ot.strokeLine(i,a-2*h,o+2,a,o);for(n=0;n<_;n++)if(l=t.exons[n],c=Math.round((l.start-r.bpStart)/r.bpPerPixel),f=Math.round((l.end-r.bpStart)/r.bpPerPixel),d=Math.max(1,f-c),l.utr)i.fillRect(c,p,d,g);else if(l.cdStart&&(u=Math.round((l.cdStart-r.bpStart)/r.bpPerPixel),i.fillRect(c,p,u-c,g),d-=u-c,c=u),l.cdEnd&&(u=Math.round((l.cdEnd-r.bpStart)/r.bpPerPixel),i.fillRect(u,p,f-u,g),d-=f-u,f=u),i.fillRect(c,e.py,d,e.h),d>25){for(i.fillStyle="white",i.strokeStyle="white",a=c+10;a<f;a+=20)Ot.strokeLine(i,a-2*h,o-2,a,o),Ot.strokeLine(i,a-2*h,o+2,a,o);i.fillStyle=m,i.strokeStyle=m}}}getFeatureAt(t,e,i,r){let s=i.y-this.top;if(this.feature_source.featureCache){var n,a=2*r,o=this.feature_source.featureCache.queryFeatures(e,t-a,t+a);if("COLLAPSED"!=this.config.displayMode)n=Math.floor("SQUISHED"===this.config.displayMode?s/this.config.expandedCallHeight:s/this.config.squishedCallHeight);else if(s<5||s>5+this.config.featureHeight)return;if(o&&o.length>0)for(let e of o)if(e.end>=t-a&&e.start<=t+a&&(void 0===n||void 0===e.row||n===e.row)&&e.display)return e}return null}}Lt.track_types.bed={class:Bt,name:"bed(tabix)"},Lt.track_types.bigbed={class:class extends Bt{constructor(t){super(t)}_setFeatureSource(){this.feature_source=new bt(this.config)}},name:"BigBed"};class Pt extends Lt{constructor(t){t.format="wig",super(t),this._setFeatureSource()}_setFeatureSource(){this.feature_source=new L(this.config)}drawScale(t,e,i){if(this.config.scale_link_to&&this.config.group)return;let r=this.top,s=this.bottom;e.fillStyle=i,e.strokeStyle=i,e.beginPath(),e.moveTo(0,r),e.lineTo(0,s),e.moveTo(0,r),e.lineTo(20,r),e.moveTo(0,s),e.lineTo(20,s),e.font="12px Arial",e.stroke(),e.textBaseline="top",null!=this.max_y&&(e.fillText(this.max_y.toFixed(2),20,r),e.textBaseline="alphabetic",e.fillText(this.min_y,20,s))}drawFeatures(t){let e,i=this,r=t.features,s=i.config.color,n=t.context,a=t.bpPerPixel,o=t.bpStart,h=t.pixelWidth,l=t.pixelHeight,c=t.top,f=o+h*a+1;if(l=this.config.group?t.height:this.config.height,s||(s="black"),i.prev_coords={x:0,y:0},r){if(i.scale_link_to){let t=i.scale_link_to.config;t&&(i.config.scale=t.scale,i.max_y=i.scale_link_to.max_y,i.min_y=i.scale_link_to.min_y)}else if(i.set_scale)i.min_y=i.set_scale.min,i.max_y=i.set_scale.max;else if(void 0===i.max_y&&"automatic"===i.config.scale||"dynamic"===i.config.scale){var u=function(t){var e=0,i=-Number.MAX_VALUE;return t.forEach((function(t){e=Math.min(e,t.value),i=Math.max(i,t.value)})),{min:e,max:i}}(r);i.min_y=u.min,i.max_y=u.max}else"fixed"===i.config.scale&&(i.min_y=i.config.min_y,i.max_y=i.config.max_y);if(e=i.max_y-i.min_y,n.globalAlpha=this.config.opacity?this.config.opacity:1,i.is_line){let t=(1-i.config.value/e)*l;Ot.strokeLine(n,0,t,h,t,{strokeStyle:i.config.color,lineWidth:i.config.width?i.config.width:1})}else r.forEach((function(t,r,h){var u,d,p,g,m,_,v;t.end<o||t.start>f||(t.end===t.start&&(t.start-=1),p=Math.floor((t.start-o)/a),v=Math.floor((t.end-o)/a),m=Math.max(0,v-p),function(t,e){return t>0&&e<0||t<0&&e>0}(i.min_y,i.max_y)?t.value<0?(u=i.max_y/e,d=-t.value/e):(u=(i.max_y-t.value)/e,d=t.value/e):i.min_y<0?(u=0,d=-t.value/e):(u=1-(t.value-i.min_y)/e,d=(t.value+i.min_y)/e),g=(g=u*l+c)<c?c:g,_=(_=d*l)>l?l:_,"line"===i.config.display?(i.prev_coords.x&&Ot.strokeLine(n,p,g,i.prev_coords.x,i.prev_coords.y,{strokeStyle:s,lineWidth:3}),i.prev_coords.x=p,i.prev_coords.y=g):Ot.fillRect(n,p,g,m,_,{fillStyle:s}))}));if(n.globalAlpha=1,i.config.threshold){let t=c+(1-i.config.threshold/e)*l;Ot.strokeLine(n,0,t,h,t,{strokeStyle:"black",lineWidth:1})}}return this.top=c,this.bottom=c+l,this.bottom}}Lt.track_types.bigwig={class:Pt,name:"BigWig"},Lt.track_types.line={class:class extends Pt{constructor(t){super(t),this.is_line=!0}getFeatures(t,e,i){return new Promise((function(t,e){t([])}))}},name:"Line Track"},Lt.track_types.fasta={class:class extends Lt{constructor(t){super(t),this._setFeatureSource(t),this.sequenceType=t.sequenceType||"dna",this.height=15}_setFeatureSource(t){this.feature_source=new Dt(t.url)}getFeatures(t,e,i,r,s){let n=this;return new Promise((function(r,a){s.bpPerPixel>1?r(null):n.feature_source.getSequence(t,e,i).then(r).catch(a)}))}drawFeatures(t){var e,i,r,s,n,a,o,h,l,c,f=t.features,u=t.context,d=t.bpPerPixel,p=t.bpStart,g=p+t.pixelWidth*d+1;let m=t.top;if(f)for(e=f.length,i=1/d,r=m+this.height/2,s=p;s<=g;s++)(n=s-p)<e&&(a=f[n],o=Math.floor(n*i),h=Math.floor((n+1)*i),l=Math.round((o+h)/2),(c=this.color?this.color:"dna"===this.sequenceType?Ot.nucleotideColors[a]:"rgb(0, 0, 150)")||(c="gray"),d>.18?Ot.fillRect(u,o,m,h-o,10,{fillStyle:c}):Ot.strokeText(u,a,l,r,{strokeStyle:c,font:"normal 10px Arial",textAlign:"center"}));return m+10}},name:"Fasta"};class Ot{static setProperties(t,e){for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];t[i]=r}}static strokeLine(t,e,i,r,s,n){e=Math.floor(e)+.5,i=Math.floor(i)+.5,r=Math.floor(r)+.5,s=Math.floor(s)+.5,t.save(),n&&Ot.setProperties(t,n),t.beginPath(),t.moveTo(e,i),t.lineTo(r,s),t.stroke(),t.restore()}static fillRect(t,e,i,r,s,n){e=Math.round(e),i=Math.round(i),n&&(t.save(),Ot.setProperties(t,n)),t.fillRect(e,i,r,s),n&&t.restore()}static fillPolygon(t,e,i,r){t.save(),r&&Ot.setProperties(t,r),Ot.doPath(t,e,i),t.fill(),t.restore()}static strokePolygon(t,e,i,r){t.save(),r&&Ot.setProperties(t,r),Ot.doPath(t,e,i),t.stroke(),t.restore()}static fillText(t,e,i,r,s,n){if(s&&(t.save(),Ot.setProperties(t,s)),t.save(),t.translate(i,r),n)for(var a in n){var o=n[a];"translate"==a&&t.translate(o.x,o.y),"rotate"==a&&t.rotate(o.angle*Math.PI/180)}t.fillText(e,0,0),t.restore(),s&&t.restore()}static strokeText(t,e,i,r,s,n){if(t.save(),s&&Ot.setProperties(t,s),t.translate(i,r),n)for(var a in n){var o=n[a];"translate"==a&&t.translate(o.x,o.y),"rotate"==a&&t.rotate(o.angle*Math.PI/180)}t.strokeText(e,0,0),t.restore()}static strokeCircle(t,e,i,r){t.beginPath(),t.arc(e,i,r,0,2*Math.PI),t.stroke()}static fillCircle(t,e,i,r){t.beginPath(),t.arc(e,i,r,0,2*Math.PI),t.fill()}static drawArrowhead(t,e,i,r,s){t.save(),r||(r=5),s&&(t.lineWidth=s),t.beginPath(),t.moveTo(e,i-r/2),t.lineTo(e,i+r/2),t.lineTo(e+r,i),t.lineTo(e,i-r/2),t.closePath(),t.fill(),t.restore()}static dashedLine(t,e,i,r,s,n,a){t.save(),e=Math.round(e),i=Math.round(i),r=Math.round(r),s=Math.round(s),n=Math.round(n),log("dashedLine"),a&&Ot.setProperties(t,a),null==n&&(n=2),t.moveTo(e,i);for(var o=r-e,h=s-i,l=Math.floor(Math.sqrt(o*o+h*h)/n),c=o/l,f=h/l,u=0;u++<l;)e+=c,i+=f,t[u%2==0?"moveTo":"lineTo"](e,i);t[u%2==0?"moveTo":"lineTo"](r,s),t.restore()}static doPath(t,e,i){var r,s=e.length;for(r=0;r<s;r++)e[r]=Math.round(e[r]),i[r]=Math.round(i[r]);for(t.beginPath(),t.moveTo(e[0],i[0]),r=1;r<s;r++)t.lineTo(e[r],i[r]);t.closePath()}}Ot.nucleotideColors={A:"green",T:"red",G:"gray",C:"blue",a:"green",t:"red",c:"blue",g:"gray"};var Ut=0;class zt extends Lt{constructor(t){t.color||(t.color="#D3D3D3"),super(t),this._setFeatureSource(),this.config.bigwig&&(this.bigwig_track=new Pt({url:this.config.bigwig,type:"bigwig",discrete:!0,color:"#D3D3D3",scale:"dynamic",height:100})),this.config=t,void 0===t.coverageTrackHeight&&(t.coverageTrackHeight=50),this.visibilityWindow=t.visibilityWindow||3e4,this.viewAsPairs=!0,this.pairsSupported=void 0===t.pairsSupported,this.color=t.color||"rgb(185, 185, 185)",this.sortOption=t.sortOption||{sort:"NUCLEOTIDE"},this.sortDirection=!0,this.filterOption=t.filterOption||{name:"mappingQuality",params:[30,void 0]},this.display_alignments=!0}_setFeatureSource(){this.feature_source=new et(this.config,this),this.feature_source.setViewAsPairs(!0),this.coverageTrack=new Ht(this.config,this),this.alignmentTrack=new qt(this.config,this)}getFeatures(t,e,i,r,s){return i-e>5e5&&this.bigwig_track?(this.draw_bigwig=!0,this.bigwig_track.getFeatures(t,e,i,r,s)):(this.draw_bigwig=!1,this.feature_source.getAlignments(t,e,i))}altClick(t,e){this.alignmentTrack.sortAlignmentRows(t,this.sortOption),this.trackView.redrawTile(this.featureSource.alignmentContainer),$(this.trackView.viewportDiv).scrollTop(0),this.sortDirection=!this.sortDirection}computePixelHeight(t){return this.coverageTrack.computePixelHeight(t)+this.alignmentTrack.computePixelHeight(t)}drawFeatures(t){return this.top=t.top,this.draw_zoom_in?(this.bottom=this.top+this.config.height,this.bottom):this.draw_bigwig?void(this.bottom=this.bigwig_track.drawFeatures(t)):(this.coverageTrack.height>0&&this.coverageTrack.draw(t),this.bottom=this.alignmentTrack.draw(t),this.bottom)}paintAxis(t,e,i){this.coverageTrack.paintAxis(t,e,this.coverageTrackHeight)}getFeatureAt(t,e,i,r){if(!this.feature_source.alignmentContainer)return null;var s,n,a,o,h,l,c=this.feature_source.alignmentContainer.packedAlignmentRows,f=this.feature_source.alignmentContainer.downsampledIntervals;if(!c)return null;if((s=Math.floor((i.y-this.top-this.coverageTrack.height-Ut)/this.config.featureHeight))<0){for(o=0,h=f.length;o<h;o++)if(f[o].start<=t&&f[o].end>=t){a=f[o];break}}else if(s<c.length)for(a=void 0,o=0,h=(n=c[s]).alignments.length;o<h;o++)if((l=n.alignments[o]).start<=t&&l.start+l.lengthOnRef>=t){a=l;break}return a}popupData(t,e,i){return i>=this.coverageTrack.top&&i<this.coverageTrack.height?this.coverageTrack.popupData(t,e,this.coverageTrack.top):this.alignmentTrack.popupData(t,e,i-this.alignmentTrack.top)}popupMenuItems(t){var e,i,r=this,s=[],n=[],a="tag"+(r.alignmentTrack.colorByTag?" ("+r.alignmentTrack.colorByTag+")":"");return n.push({key:"none",label:"track color"}),r.viewAsPairs||n.push({key:"strand",label:"read strand"}),r.pairsSupported&&r.alignmentTrack.hasPairs&&n.push({key:"firstOfPairStrand",label:"first-of-pair strand"}),n.push({key:"tag",label:a}),s.push(igv.colorPickerMenuItem(t,this.trackView)),s.push('<div class="igv-track-menu-category igv-track-menu-border-top">Color by</div>'),n.forEach((function(t){i=r.alignmentTrack.colorBy===t.key,s.push(function(t,e,i){var s=[],n={};return s.push('<div class="igv-track-menu-item">'),s.push(e?'<i class="fa fa-check fa-check-shim"></i>':'<i class="fa fa-check fa-check-shim fa-check-hidden"></i>'),"tag"===t.key?s.push('<span id="color-by-tag">'):s.push("<span>"),s.push(t.label),s.push("</span>"),s.push("</div>"),n.object=$(s.join("")),n.click=function(){igv.popover.hide(),"tag"===t.key?(igv.dialog.configure((function(){return"Tag Name"}),r.alignmentTrack.colorByTag?r.alignmentTrack.colorByTag:"",(function(){var t=igv.dialog.$dialogInput.val().trim();r.alignmentTrack.colorBy="tag",t!==r.alignmentTrack.colorByTag&&(r.alignmentTrack.colorByTag=igv.dialog.$dialogInput.val().trim(),r.alignmentTrack.tagColors=new igv.PaletteColorTable("Set1"),$("#color-by-tag").text(r.alignmentTrack.colorByTag)),r.trackView.update()})),igv.dialog.show($(r.trackView.trackDiv))):(r.alignmentTrack.colorBy=t.key,r.trackView.update())},n}(t,i))})),e=[],r.pairsSupported&&r.alignmentTrack.hasPairs&&(e.push('<div class="igv-track-menu-item igv-track-menu-border-top">'),e.push(!0===r.viewAsPairs?'<i class="fa fa-check fa-check-shim">':'<i class="fa fa-check fa-check-shim fa-check-hidden">'),e.push("</i>"),e.push("View as pairs"),e.push("</div>"),s.push({object:$(e.join("")),click:function(){var e=$(this).find("i");t.hide(),r.viewAsPairs=!r.viewAsPairs,!0===r.viewAsPairs?e.removeClass("fa-check-hidden"):e.addClass("fa-check-hidden"),r.featureSource.setViewAsPairs(r.viewAsPairs),r.trackView.update()}})),s}}function Nt(t,e,i){var r,s=[0,255,255];if(s)return r=t<5?.1:Math.max(.1,Math.min(1,.1+.9*(t-5)/15)),(r=Math.round(10*r)/10)>=1?Ot.nucleotideColors[e]:"rgba("+s[0]+","+s[1]+","+s[2]+","+r+")"}class Ht{constructor(t,e){this.parent=e,this.featureSource=e.featureSource,this.height=20,this.dataRange={min:0}}computePixelHeight(t){return this.height}draw(t){var e,i,r,s,n,a,o,h,l,c,f,u=this,d=t.features,p=t.context,g=t.bpPerPixel,m=t.bpStart,_=m+t.pixelWidth*g+1,v=d.coverageMap;v.refSeq&&(f=v.refSeq.toUpperCase()),this.dataRange.max=v.maximum;var w=t.top;for(t.top+=this.height,s=Math.max(1,Math.ceil(1/g)),o=0,h=v.coverage.length;o<h;o++)if(!((e=v.bpStart+o)<m)){if(e>_)break;(l=v.coverage[o])&&(n=Math.round(l.total/this.dataRange.max*this.height),r=this.height-n,i=Math.floor((e-m)/g),Ot.setProperties(p,{fillStyle:this.parent.config.color,strokeStyle:this.color}),Ot.fillRect(p,i,r+w,s,n))}if(f)for(o=0,h=v.coverage.length;o<h;o++)if(!((e=v.bpStart+o)<m)){if(e>_)break;(l=v.coverage[o])&&(n=l.total/this.dataRange.max*this.height,r=this.height-n,i=Math.floor((e-m)/g),a=f[o],l.isMismatch(a)&&(Ot.setProperties(p,{fillStyle:Ot.nucleotideColors[a]}),Ot.fillRect(p,i,r+w,s,n),c=0,["A","C","T","G"].forEach((function(t){var e;e=(l["pos"+t]+l["neg"+t])/u.dataRange.max*u.height,r=u.height-e-c,c+=e,Ot.setProperties(p,{fillStyle:Ot.nucleotideColors[t]}),Ot.fillRect(p,i,r+w,s,e)}))))}}popupData(t,e,i){var r,s,n=this.featureSource.alignmentContainer.coverageMap,a=[];return r=t-n.bpStart,(s=n.coverage[r])&&(a.push(igv.browser.referenceFrame.chr+":"+igv.numberFormatter(1+t)),a.push({name:"Total Count",value:s.total}),tmp=s.posA+s.negA,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor((s.posA+s.negA)/s.total*100)+"%)"),a.push({name:"A",value:tmp}),tmp=s.posC+s.negC,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/s.total*100)+"%)"),a.push({name:"C",value:tmp}),tmp=s.posG+s.negG,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/s.total*100)+"%)"),a.push({name:"G",value:tmp}),tmp=s.posT+s.negT,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/s.total*100)+"%)"),a.push({name:"T",value:tmp}),tmp=s.posN+s.negN,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/s.total*100)+"%)"),a.push({name:"N",value:tmp})),a}}class qt{constructor(t,e){this.config=t,this.parent=e,this.featureSource=e.feature_source,this.alignmentRowHeight=t.alignmentRowHeight||6,this.negStrandColor=t.negStrandColor||"rgba(150, 150, 230, 0.75)",this.posStrandColor=t.posStrandColor||"rgba(230, 150, 150, 0.75)",this.insertionColor=t.insertionColor||"rgb(138, 94, 161)",this.deletionColor=t.deletionColor||"black",this.skippedColor=t.skippedColor||"rgb(150, 170, 170)",this.colorBy=t.colorBy||"none",this.colorByTag=t.colorByTag,this.bamColorTag=void 0===t.bamColorTag?"YC":t.bamColorTag,this.sortOption=t.sortOption||{sort:"NUCLEOTIDE"},this.sortDirection=!0,this.hasPairs=!1}computePixelHeight(t){if(t.packedAlignmentRows){var e=0;return t.hasDownsampledIntervals()&&(e+=10),e+this.config.featureHeight*t.packedAlignmentRows.length+5}return this.height}draw(t){var e=this,i=t.features,r=t.context,s=t.bpPerPixel,n=t.bpStart,a=t.pixelWidth,o=n+a*s+1,h=i.packedAlignmentRows,l=i.sequence,c="normal "+(this.config.featureHeight-2)+"px Arial";if(!h)return;let f=t.top;function u(t,i,a){var h=e.getAlignmentColor(t.firstAlignment),l=h,c=(t.connectingStart-n)/s,f=(t.connectingEnd-n)/s,u=i+a/2;t.connectingEnd<n||t.connectingStart>o||(t.mq<=0&&(h=W.addAlphaToRGB(h,"0.15")),Ot.setProperties(r,{fillStyle:h,strokeStyle:l}),Ot.strokeLine(r,c,u,f,u))}function d(t,a,h){var f,u,d,p=e.getAlignmentColor(t),g=p,m=t.blocks;if(p||(p="gray"),!(t.start+t.lengthOnRef<n||t.start>o))for(t.mq<=0&&(p=W.addAlphaToRGB(p,"0.15")),Ot.setProperties(r,{fillStyle:p,strokeStyle:g}),d=0;d<m.length;d++)if(!((u=m[d]).start+u.len<n)){if(_(u),u.start+u.len>o)break;t.insertions&&t.insertions.forEach((function(t){var i=(t.start-n)/s-1;Ot.fillRect(r,i,a-1,3,h+2,{fillStyle:e.insertionColor})}))}function _(o){var u,_,v,w,b,y,x,k=o.start-i.start,S=(o.start-n)/s,C=(o.start+o.len-n)/s,A=Math.max(1,C-S),T=e.config.featureHeight/2,I=o.seq.toUpperCase(),E=e.skippedColor,R=e.deletionColor,D=a+h/2;if(void 0!==o.gapType&&void 0!==C&&void 0!==f&&("D"===o.gapType?Ot.strokeLine(r,f,D,S,D,{strokeStyle:R}):Ot.strokeLine(r,f,D,S,D,{strokeStyle:E})),f=C,!0===t.strand&&d===m.length-1?(y=[S,C,C+T,C,S,S],x=[a,a,a+h/2,a+h,a+h,a],Ot.fillPolygon(r,y,x,{fillStyle:p}),t.mq<=0&&Ot.strokePolygon(r,y,x,{strokeStyle:g})):!1===t.strand&&0===d?(y=[C,S,S-T,S,C,C],x=[a,a,a+h/2,a+h,a+h,a],Ot.fillPolygon(r,y,x,{fillStyle:p}),t.mq<=0&&Ot.strokePolygon(r,y,x,{strokeStyle:g})):(Ot.fillRect(r,S,a,A,h,{fillStyle:p}),t.mq<=0&&(r.save(),r.strokeStyle=g,r.strokeRect(S,a,A,h),r.restore())),l&&"*"!==I)for(var L=0,M=I.length;L<M;L++)_=I.charAt(L),u=l.charAt(k+L),"="===_&&(_=u),"X"!==_&&u===_||(b=o.qual&&o.qual.length>L?Nt(o.qual[L],_,o.start):Ot.nucleotideColors[_])&&(v=(o.start+L-n)/s,w=Math.max(1,1/s),s<.15?Ot.strokeText(r,_,v+w/2,a+2,{strokeStyle:b,font:c,textAlign:"center",textBaseline:"hanging"}):Ot.fillRect(r,v,a,w,h,{fillStyle:b}))}}return l&&(l=l.toUpperCase()),i.hasDownsampledIntervals()?(Ut=10,i.downsampledIntervals.forEach((function(t){var e=(t.start-n)/s,i=(t.end-n)/s;i-e>5&&(e+=1,i-=1),Ot.fillRect(r,e,2,i-e,3,{fillStyle:"black"})}))):Ut=3,h&&h.forEach((function(t,i){var r,s=Ut+e.config.featureHeight*i+f,a=e.config.featureHeight-2;for(i=0;i<t.alignments.length;i++)if(r=t.alignments[i],e.hasPairs=e.hasPairs||r.isPaired(),!(r.start+r.lengthOnRef<n)){if(r.start>o)break;!0!==r.hidden&&(r instanceof gt?(u(r,s,a),d(r.firstAlignment,s,a),r.secondAlignment&&d(r.secondAlignment,s,a)):d(r,s,a))}})),Ut+e.config.featureHeight*h.length+f}sortAlignmentRows(t,e){var i=this,r=this.featureSource.alignmentContainer,s=r.packedAlignmentRows;s.forEach((function(i){i.updateScore(t,r,e)})),s.sort((function(t,e){return i.sortDirection?t.score-e.score:e.score-t.score}))}static doSortAlignmentRows(t,e,i,r){var s=e.packedAlignmentRows,n=e.sequence;n?(n=n.toUpperCase(),s.forEach((function(r){r.updateScore(t,e,i)})),s.sort((function(t,e){return r?t.score-e.score:e.score-t.score}))):console.log("No sequence, no traversal. No discussion!")}popupData(t,e,i){var r,s,n,a,o,h,l=this.featureSource.alignmentContainer.packedAlignmentRows,c=this.featureSource.alignmentContainer.downsampledIntervals;if((r=Math.floor((i-Ut)/this.config.featureHeight))<0){for(a=0,o=c.length;a<o;a++)if(c[a].start<=t&&c[a].end>=t){n=c[a];break}}else if(r<l.length)for(n=void 0,a=0,o=(s=l[r]).alignments.length;a<o;a++)if((h=s.alignments[a]).start<=t&&h.start+h.lengthOnRef>=t){n=h;break}return n?n.popupData(t):[]}getAlignmentColor(t){if(this.parent.color_function)return this.parent.color_function(t);var e,i,r=this,s=r.colorBy;switch(i=r.parent.config.color,s){case"strand":i=t.strand?r.posStrandColor:r.negStrandColor;break;case"firstOfPairStrand":t instanceof gt?i=t.firstOfPairStrand()?r.posStrandColor:r.negStrandColor:t.isPaired()&&(t.isFirstOfPair()?i=t.strand?r.posStrandColor:r.negStrandColor:t.isSecondOfPair()?i=t.strand?r.negStrandColor:r.posStrandColor:console.log("ERROR. Paired alignments are either first or second."));break;case"tag":void 0!==(e=t.tags()[r.colorByTag])&&(i=r.bamColorTag===r.colorByTag?"rgb("+e+")":r.tagColors.getColor(e));break;default:i=r.parent.config.color}return i}}zt.filters={noop:function(){return function(t){return!1}},strand:function(t){return function(e){return e.strand===t}},mappingQuality:function(t,e){return function(i){return!!(t&&i.mq<t)||!!(e&&i.mq>e)}}},Lt.custom_tracks.bam=zt,Lt.track_types.bam={class:zt,name:"BAM"};Lt.track_types.bam_sca_track={class:class extends Lt{constructor(t){super(t),this.catNumbers={},this.config.scale=this.config.scale||.1,this.config.size_filter=this.config.size_filter=50,this.config.size_filter_on=void 0!==this.config.size_filter_on&&t.size_filter_on,this.config.tag||(this.config.tag="CB"),this.feature_source=new K(this.config),this.setFragmentSizeFilter()}addIndex(t){this.feature_source.catIndex=t}getIdsInRange(t){return this.feature_source.getIdsInRange(t)}filterReads(t,e){this.feature_source.setFilter(t,e),this.feature_source.calculateCategories()}setCategories(t,e,i,r,s=!1,n=!1){if(null==t&&this.feature_source.setCategories(null,null),!this.catNumbers[t]||n){const r=new Array(i.length).fill(0);for(let t=0;t<e.length;t++)r[e[t]]++;this.catNumbers[t]=r}this.numbers=this.catNumbers[t],this.feature_source.setCategories(e,i),this.catColors=r,this.catNames=i,s&&this.feature_source.calculateCategories()}setFragmentSizeFilter(t,e){(t||!1===t)&&(this.config.size_filter_on=t),e&&(this.config.size_filter=e),this.feature_source.size_filter_on=this.config.size_filter_on,this.feature_source.size_filter=this.config.size_filter}async getFeatures(t,e,i,r,s){if(i-e>1e7)return"zoom in to see coverage";try{return await this.feature_source.getAlignments(t,e,i)}catch(t){return t.message}}drawScale(t,e,i){let r=this.top;const s=Math.round(this.config.height/this.catNames.length);e.strokeStyle=i,e.fillStyle=i;for(let t of this.catNames){let i=r+s;e.beginPath(),e.moveTo(0,r),e.lineTo(0,i),e.moveTo(0,r),e.lineTo(20,r),e.moveTo(0,i),e.lineTo(20,i),e.font="12px Arial",e.stroke(),e.textBaseline="top";let n=this.config.scale;e.fillText(n.toFixed(2),20,r),e.font="14px Arial",e.textBaseline="middle",e.fillText(t,2,r+s/2),e.font="12px Arial",r+=s}}drawFeatures(t){var e,i,r,s=t.features,n=t.context,a=t.bpPerPixel,o=t.bpStart,h=t.pixelWidth;const l=o-s.store[1],c=l+h*a+1,f=Math.round(this.config.height/s.length);let u=this.config.scale,d=t.top;this.top=t.top;let p=Math.max(1,Math.ceil(1/a)),g=a>5?5:1;for(let t=0;t<s.length;t++){let h=s[t];n.fillStyle=this.catColors[t];for(let m=l;m<c;m+=g){let l=m+s.store[1];-0!==h[m]&&(e=Math.round(h[m]/this.numbers[t]/u*f),i=f-(e=e>f?f:e),r=Math.floor((l-o)/a),n.fillRect(r,i+d,p,e))}d+=f}}getSettings(t){return super.getSettings(t).concat([{label:"Fragment Size Filter",type:"check",current_value:this.config.size_filter_on,func:e=>{this.setFragmentSizeFilter(e),this.feature_source.calculateCategories(),t.update()}},{type:"slider",min:0,max:300,step:1,label:"Fragment Size",current_value:this.config.size_filter,func:e=>{this.setFragmentSizeFilter(null,e),this.feature_source.calculateCategories(),t.update()}},{type:"slider",min:0,max:1,label:"Scale (cov/no cells)",current_value:this.config.scale,func:e=>{this.config.scale=e,t.update()}}])}},name:"BAM SCA Track"};var Wt=i(1445),Vt=i(5618);function Gt(t,e){var i,r=Object.keys(e);for(i=0;i<r.length;i++)t=t.replace(new RegExp("\\{"+r[i]+"\\}","gi"),e[r[i]]);return t}function Zt(t){var e,i,r;if(!t)throw new Error("cannot create a random attribute name for an undefined object");e="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",i="";do{for(i="",r=0;r<12;r++)i+=e[Math.floor(Math.random()*e.length)]}while(t[i]);return i}var jt={left:"start",right:"end",center:"middle",start:"start",end:"end"},Xt={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"},Kt=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return[t[0]/e,t[1]/e]},Yt=function(t,e){void 0===e&&(e=10);var i,r,s,n={},a="50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro".split(",");for(i=0;i<a.length;i+=2)r="&"+a[i+1]+";",s=parseInt(a[i],e),n[r]="&#"+s+";";return n["\\xa0"]="&#160;",n}(0,32),$t={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},Qt=function(){function t(t,e){this.__root=void 0,this.__ctx=void 0,this.__root=t,this.__ctx=e}return t.prototype.addColorStop=function(t,e){var i,r=this.__ctx.__createElement("stop");r.setAttribute("offset",t),-1!==e.indexOf("rgba")?(i=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(e))&&(r.setAttribute("stop-color",Gt("rgb({r},{g},{b})",{r:i[1],g:i[2],b:i[3]})),r.setAttribute("stop-opacity",i[4])):r.setAttribute("stop-color",e),this.__root.appendChild(r)},t}(),Jt=function(t,e){this.__root=void 0,this.__ctx=void 0,this.__root=t,this.__ctx=e},te={width:500,height:500,enableMirroring:!1},ee=function(){function t(t,e){var i,r,s,n;if(void 0===t&&(t=te),this.width=void 0,this.height=void 0,this.enableMirroring=void 0,this.canvas=void 0,this.__document=void 0,this.__canvas=void 0,this.__ctx=void 0,this.__ids=void 0,this.__root=void 0,this.__defs=void 0,this.__currentElement=void 0,this.__groupStack=void 0,this.__currentElementsToStyle=null,"number"==typeof t?(this.width=t,this.height=null!=e?e:te.height,this.enableMirroring=te.enableMirroring,this.__document=document):(this.width=null!=(r=t.width)?r:te.width,this.height=null!=(s=t.height)?s:te.height,this.enableMirroring=null!=(n=t.enableMirroring)?n:te.enableMirroring,this.__document=t.document||document,i=t.ctx),!(i||(this.__canvas=this.__document.createElement("canvas"),i=this.__canvas.getContext("2d"))))throw new Error("Unable to get canvas context");this.__ctx=i,this.canvas=this,this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version","1.1"),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width.toString()),this.__root.setAttribute("height",this.height.toString()),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)}var e=t.prototype;return e.__createElement=function(t,e,i){void 0===e&&(e={});var r,s,n=this.__document.createElementNS("http://www.w3.org/2000/svg",t),a=Object.keys(e);for(i&&(n.setAttribute("fill","none"),n.setAttribute("stroke","none")),r=0;r<a.length;r++)n.setAttribute(s=a[r],e[s]);return n},e.__setDefaultStyles=function(){for(var t in $t)this[t]=$t[t].canvas},e.__applyStyleState=function(t){var e,i,r=Object.keys(t);for(e=0;e<r.length;e++)this[i=r[e]]=t[i]},e.__getStyleState=function(){var t,e,i={},r=Object.keys($t);for(t=0;t<r.length;t++)i[e=r[t]]=this[e];return i},e.__applyStyleToCurrentElement=function(t){if(this.__currentElement){var e,i,r,s,n,a=this.__currentElement,o=Object.keys($t);for(e=0;e<o.length;e++)if(r=this[o[e]],"apply"in(i=$t[o[e]]))if(r instanceof Jt){if(r.__ctx)for(;r.__ctx.__defs.childNodes.length;)s=r.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[s]=s,this.__defs.appendChild(r.__ctx.__defs.childNodes[0]);a.setAttribute(i.apply,Gt("url(#{id})",{id:r.__root.getAttribute("id")}))}else if(r instanceof Qt)a.setAttribute(i.apply,Gt("url(#{id})",{id:r.__root.getAttribute("id")}));else if(-1!==i.apply.indexOf(t)&&i.svg!==r)if("stroke"!==i.svgAttr&&"fill"!==i.svgAttr||-1===r.indexOf("rgba")){var h=i.svgAttr;if("globalAlpha"===o[e]&&a.getAttribute(h=t+"-"+i.svgAttr))continue;a.setAttribute(h,r)}else if(n=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(r)){a.setAttribute(i.svgAttr,Gt("rgb({r},{g},{b})",{r:n[1],g:n[2],b:n[3]}));var l=parseFloat(n[4]),c=this.globalAlpha;null!=c&&(l*=c),a.setAttribute(i.svgAttr+"-opacity",l.toString())}}},e.__closestGroupOrSvg=function(t){if(void 0===t&&(t=this.__currentElement),t)return"g"===t.nodeName||"svg"===t.nodeName?t:this.__closestGroupOrSvg(t.parentNode)},e.getSerializedSvg=function(t){var e,i,r,s,n,a=(new XMLSerializer).serializeToString(this.__root);if(/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi.test(a)&&(a=a.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),t)for(e=Object.keys(Yt),i=0;i<e.length;i++)s=Yt[r=e[i]],(n=new RegExp(r,"gi")).test(a)&&(a=a.replace(n,s));return a},e.getSvg=function(){return this.__root},e.save=function(){var t=this.__createElement("g"),e=this.__closestGroupOrSvg();e&&this.__groupStack.push(e),e.appendChild(t),this.__currentElement=t,this.__stack.push(this.__getStyleState())},e.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var t=this.__stack.pop();this.__applyStyleState(t)},e.__addTransform=function(t){if(this.__currentElement){var e=this.__closestGroupOrSvg();if(e){if(e.childNodes.length>0){"path"===this.__currentElement.nodeName&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:e,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var i=this.__createElement("g");e.appendChild(i),this.__currentElement=i}if(this.__currentElement){var r=this.__currentElement.getAttribute("transform");r?r+=" ":r="",this.__currentElement.setAttribute("transform",r+=t)}}}},e.scale=function(t,e){void 0===e&&(e=t),this.__addTransform(Gt("scale({x},{y})",{x:t,y:e}))},e.rotate=function(t){var e=180*t/Math.PI;this.__addTransform(Gt("rotate({angle},{cx},{cy})",{angle:e,cx:0,cy:0}))},e.translate=function(t,e){this.__addTransform(Gt("translate({x},{y})",{x:t,y:e}))},e.transform=function(t,e,i,r,s,n){this.__addTransform(Gt("matrix({a},{b},{c},{d},{e},{f})",{a:t,b:e,c:i,d:r,e:s,f:n}))},e.beginPath=function(){var t,e;this.__currentDefaultPath="",this.__currentPosition={},t=this.__createElement("path",{},!0),(e=this.__closestGroupOrSvg())&&(e.appendChild(t),this.__currentElement=t)},e.__applyCurrentDefaultPath=function(){var t=this.__currentElement;t&&("path"===t.nodeName?t.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",t.nodeName))},e.__addPathCommand=function(t){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=t},e.moveTo=function(t,e){this.__currentElement&&("path"!==this.__currentElement.nodeName&&this.beginPath(),this.__currentPosition={x:t,y:e},this.__addPathCommand(Gt("M {x} {y}",{x:t,y:e})))},e.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")},e.lineTo=function(t,e){this.__currentPosition={x:t,y:e},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(Gt("L {x} {y}",{x:t,y:e})):this.__addPathCommand(Gt("M {x} {y}",{x:t,y:e}))},e.bezierCurveTo=function(t,e,i,r,s,n){this.__currentPosition={x:s,y:n},this.__addPathCommand(Gt("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:t,cp1y:e,cp2x:i,cp2y:r,x:s,y:n}))},e.quadraticCurveTo=function(t,e,i,r){this.__currentPosition={x:i,y:r},this.__addPathCommand(Gt("Q {cpx} {cpy} {x} {y}",{cpx:t,cpy:e,x:i,y:r}))},e.arcTo=function(t,e,i,r,s){var n=this.__currentPosition&&this.__currentPosition.x,a=this.__currentPosition&&this.__currentPosition.y;if(void 0!==n&&void 0!==a){if(s<0)throw new Error("IndexSizeError: The radius provided ("+s+") is negative.");if(n===t&&a===e||t===i&&e===r||0===s)this.lineTo(t,e);else{var o=Kt([n-t,a-e]),h=Kt([i-t,r-e]);if(o[0]*h[1]!=o[1]*h[0]){var l=Math.acos(Math.abs(o[0]*h[0]+o[1]*h[1])),c=Kt([o[0]+h[0],o[1]+h[1]]),f=s/Math.sin(l/2),u=t+f*c[0],d=e+f*c[1],p=[-o[1],o[0]],g=[h[1],-h[0]],m=function(t){var e=t[0];return t[1]>=0?Math.acos(e):-Math.acos(e)},_=m(p),v=m(g);this.lineTo(u+p[0]*s,d+p[1]*s),this.arc(u,d,s,_,v)}else this.lineTo(t,e)}}},e.stroke=function(){this.__currentElement&&("path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke"))},e.fill=function(){this.__currentElement&&("path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill"))},e.rect=function(t,e,i,r){this.__currentElement&&("path"!==this.__currentElement.nodeName&&this.beginPath(),this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+r),this.lineTo(t,e+r),this.lineTo(t,e),this.closePath())},e.fillRect=function(t,e,i,r){var s;s=this.__createElement("rect",{x:t,y:e,width:i,height:r},!0),this.__closestGroupOrSvg().appendChild(s),this.__currentElement=s,this.__applyStyleToCurrentElement("fill")},e.strokeRect=function(t,e,i,r){var s;s=this.__createElement("rect",{x:t,y:e,width:i,height:r},!0),this.__closestGroupOrSvg().appendChild(s),this.__currentElement=s,this.__applyStyleToCurrentElement("stroke")},e.__clearCanvas=function(){var t=this.__closestGroupOrSvg();if(t){for(var e=t.getAttribute("transform"),i=this.__root.childNodes[1],r=i.childNodes,s=r.length-1;s>=0;s--)r[s]&&i.removeChild(r[s]);this.__currentElement=i,this.__groupStack=[],e&&this.__addTransform(e)}},e.clearRect=function(t,e,i,r){if(0!==t||0!==e||i!==this.width||r!==this.height){var s,n=this.__closestGroupOrSvg();s=this.__createElement("rect",{x:t,y:e,width:i,height:r,fill:"#FFFFFF"},!0),n.appendChild(s)}else this.__clearCanvas()},e.createLinearGradient=function(t,e,i,r){var s=this.__createElement("linearGradient",{id:Zt(this.__ids),x1:t+"px",x2:i+"px",y1:e+"px",y2:r+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(s),new Qt(s,this)},e.createRadialGradient=function(t,e,i,r,s,n){var a=this.__createElement("radialGradient",{id:Zt(this.__ids),cx:r+"px",cy:s+"px",r:n+"px",fx:t+"px",fy:e+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(a),new Qt(a,this)},e.__parseFont=function(){var t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i.exec(this.font);if(t){var e={style:t[1]||"normal",size:t[4]||"10px",family:t[6]||"sans-serif",weight:t[3]||"normal",decoration:t[2]||"normal",href:null};return"underline"===this.__fontUnderline&&(e.decoration="underline"),this.__fontHref&&(e.href=this.__fontHref),e}},e.__wrapTextLink=function(t,e){if(t.href){var i=this.__createElement("a");return i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.href),i.appendChild(e),i}return e},e.__applyText=function(t,e,i,r){var s=this.__parseFont(),n=this.__closestGroupOrSvg();if(s){var a,o,h=this.__createElement("text",{"font-family":s.family,"font-size":s.size,"font-style":s.style,"font-weight":s.weight,"text-decoration":s.decoration,x:e,y:i,"text-anchor":(o=this.textAlign,jt[o]||jt.start),"dominant-baseline":(a=this.textBaseline,Xt[a]||Xt.alphabetic)},!0);h.appendChild(this.__document.createTextNode(t)),this.__currentElement=h,this.__applyStyleToCurrentElement(r),n.appendChild(this.__wrapTextLink(s,h))}},e.fillText=function(t,e,i){this.__applyText(t,e,i,"fill")},e.strokeText=function(t,e,i){this.__applyText(t,e,i,"stroke")},e.measureText=function(t){return this.__ctx.font=this.font,this.__ctx.measureText(t)},e.arc=function(t,e,i,r,s,n){if(r!==s){(r%=2*Math.PI)==(s%=2*Math.PI)&&(s=(s+2*Math.PI-.001*(n?-1:1))%(2*Math.PI));var a,o=t+i*Math.cos(s),h=e+i*Math.sin(s),l=t+i*Math.cos(r),c=e+i*Math.sin(r),f=n?0:1,u=s-r;u<0&&(u+=2*Math.PI),a=n?u>Math.PI?0:1:u>Math.PI?1:0,this.lineTo(l,c),this.__addPathCommand(Gt("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:i,ry:i,xAxisRotation:0,largeArcFlag:a,sweepFlag:f,endX:o,endY:h})),this.__currentPosition={x:o,y:h}}},e.clip=function(){var t=this.__closestGroupOrSvg(),e=this.__createElement("clipPath"),i=Zt(this.__ids),r=this.__createElement("g");t&&this.__currentElement&&(this.__applyCurrentDefaultPath(),t.removeChild(this.__currentElement),e.setAttribute("id",i),e.appendChild(this.__currentElement),this.__defs.appendChild(e),t.setAttribute("clip-path",Gt("url(#{id})",{id:i})),t.appendChild(r),this.__currentElement=r)},e.drawImage=function(){var e,i,r,s,n,a,o,h,l,c,f,u,d,p,g=Array.prototype.slice.call(arguments),m=g[0],_=0,v=0;if(3===g.length)e=g[1],i=g[2],r=n=m.width,s=a=m.height;else if(5===g.length)e=g[1],i=g[2],r=g[3],s=g[4],n=m.width,a=m.height;else{if(9!==g.length)throw new Error("Invalid number of arguments passed to drawImage: "+arguments.length);_=g[1],v=g[2],n=g[3],a=g[4],e=g[5],i=g[6],r=g[7],s=g[8]}o=this.__closestGroupOrSvg();var w="translate("+e+", "+i+")";if(m instanceof t){if((h=m.getSvg().cloneNode(!0)).childNodes&&h.childNodes.length>1){for(l=h.childNodes[0];l.childNodes.length;)p=l.childNodes[0].getAttribute("id"),this.__ids[p]=p,this.__defs.appendChild(l.childNodes[0]);if(c=h.childNodes[1]){var b=c.getAttribute("transform");c.setAttribute("transform",b?b+" "+w:w),o.appendChild(c)}}}else if("CANVAS"===m.nodeName||"IMG"===m.nodeName){if((f=this.__createElement("image")).setAttribute("width",r),f.setAttribute("height",s),f.setAttribute("preserveAspectRatio","none"),_||v||n!==m.width||a!==m.height){if((u=this.__document.createElement("canvas")).width=r,u.height=s,!(d=u.getContext("2d")))return;d.drawImage(m,_,v,n,a,0,0,r,s),m=u}f.setAttribute("transform",w),f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===m.nodeName?m.toDataURL():m.getAttribute("src")),o.appendChild(f)}},e.createPattern=function(e,i){var r,s=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),n=Zt(this.__ids);return s.setAttribute("id",n),s.setAttribute("width",e.width),s.setAttribute("height",e.height),"CANVAS"===e.nodeName||"IMG"===e.nodeName?((r=this.__document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("width",e.width),r.setAttribute("height",e.height),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===e.nodeName?e.toDataURL():e.getAttribute("src")),s.appendChild(r),this.__defs.appendChild(s)):e instanceof t&&(s.appendChild(e.__root.childNodes[1]),this.__defs.appendChild(s)),new Jt(s,this)},e.setLineDash=function(t){this.lineDash=t&&t.length>0?t.join(","):null},t}();class ie{constructor(t,e,i,r,s){this.chr=t,this.startBP=e,this.endBP=i,this.scale=r,this.image=s}containsRange(t,e,i,r){return e<0&&(e=0),this.scale.toFixed(3)===r.toFixed(3)&&e>=this.startBP&&i<=this.endBP&&t===this.chr}overlapsRange(t,e,i){return this.chr===t&&this.endBP>=e&&this.startBP<=i}}const re=class{constructor(t,e={},i=[]){this.trackDiv="string"==typeof t?document.getElementById("#"+t):t;const r=this.trackDiv.getBoundingClientRect();this.height=r.height,this.width=r.width,this.tracks={},this.track_order=[],this.trackLabels={},this.trackDialogs={};for(let t of i){let e=Lt.getTrack(t);this.tracks[e.config.track_id]=e,this.track_order.push(e.config.track_id),this._addTrackLabel(e.config)}this._tracksChanged(),this.legend=null,this.trackDiv.style.position="relative",this.canvas=(0,Wt.ut)("canvas",{classes:["igv-content-canvas"],width:this.width,height:this.height},this.trackDiv),this.ctx=this.canvas.getContext("2d"),e.show_scale&&(this.addScaleCanvas(this.height),this.show_scale=!0),this.is_dragging=!1,this.isMouseDown=!1,this.lastMouseX=void 0,this.mouseDownX=void 0,this.buffer_level=1,this.groups={},this.highlighted_regions={},this.listeners={},e.allow_user_interactions&&(this.allowUserDrag(),this.allowUserZoom(),this.allowUserFeatureClick(),this.allowUserFeatureOver(),this.allowUserRangeSelection(),this.trackDiv.addEventListener("dragover",(t=>{t.preventDefault()}))),e.ruler_track&&this.addRulerTrack(),e.new_layout&&(this.new_layout=!0),this.__doc__=document,this.retries=0,this.yOffset=0,this.loadingIcon=(0,Wt.ut)("i",{classes:["fas","fa-spinner","fa-spin","panel-loading-icon"]},this.trackDiv),this.messageAlert=(0,Wt.ut)("div",{classes:["panel-error-message"]},this.trackDiv)}closeAllDialogs(){for(let t in this.trackDialogs)this.trackDialogs[t].close();this.trackDialogs={}}_addTrackLabel(t){t.show_track_label;const e=(0,Wt.ut)("div",{classes:["panel-track-label"],text:t.short_label,draggable:!0},this.trackDiv);e.addEventListener("click",(e=>{this._openTrackDialog(e,t.track_id)})),e.addEventListener("drag",(t=>{this.trackDiv.style.cursor="ne-risize"})),e.addEventListener("mousedown",(t=>{t.stopImmediatePropagation()})),e.addEventListener("dragend",(e=>{let i=this._getCoords(e).y+this.yOffset,r=null;if(i<0)this.track_order[0];else for(let t in this.tracks){const e=this.tracks[t];if(i>=e.top&&i<=e.bottom){r=t;break}}r!==t.track_id&&(r=r||this.track_order[this.track_order.length-1],this.track_order.splice(this.track_order.indexOf(t.track_id),1),this.track_order.splice(this.track_order.indexOf(r)+1,0,t.track_id),this.update())})),this.trackLabels[t.track_id]=e}_openTrackDialog(t,e){if(this.trackDialogs[e])return;const i=this.tracks[e];this.trackDialogs[e]=new Vt.Z({maxHeight:400,doc:this.__doc__||document,width:300,title:i.config.short_label,position:[t.pageX,t.pageY],onclose:()=>delete this.trackDialogs[e]},i.getSettings(this))}_parseConfig(t){this.fixed_height_mode&&(t.height||(t.height=150))}addScaleCanvas(t){this.scale_canvas=(0,Wt.ut)("canvas",{styles:{position:"absolute",top:"0px",left:"5px"},width:100,height:this.height},this.trackDiv),this.scale_ctx=this.scale_canvas.getContext("2d")}setBufferLevel(t){this.buffer_level=t}getDiv(){return this.trackDiv}setHighlightedRegion(t,e,i){this.highlighted_regions[e]={chr:t.chr,start:t.start,end:t.end,color:i},this.force_redraw=!0}removeHighlightedRegion(t){delete this.highlighted_regions[t],this.force_redraw=!0}addRulerTrack(){let t=new Mt,e=t.getConfig();return this.tracks[e.track_id]=t,this.track_order.unshift(e.track_id),this._addTrackLabel(e),this}addListener(t,e){this.listeners[t]=e}removeListener(t){delete this.listeners[t]}addTrack(t,e,i){let r=Lt.getTrack(t);this.tracks[r.config.track_id]=r,e||0==e?this.track_order.splice(e,0,r.config.track_id):this.track_order.push(r.config.track_id),this._tracksChanged(),this._addTrackLabel(r.config),i||this._callListeners("track_added",r.config)}_callListeners(t,e){for(let i in this.listeners)this.listeners[i](t,e)}removeAllTracks(){let t=this.track_order.slice();for(let e of t)this.removeTrack(e,!0)}removeTrack(t,e,i){if(!this.tracks[t])return null;this.track_order=this.track_order.filter((e=>e!==t)),e||this.repaint(!0,!0),this.legend&&this.legend.removeTrack(t);let r=this.tracks[t].config;if(delete this.tracks[t],i||this._callListeners("track_removed",r),0===this.track_order.length)for(let t in this.listeners.panel_empty)this.listeners.panel_empty[t](this);return r}getTrackConfig(t){return this.tracks[t].getConfig()}getTrack(t){return this.tracks[t]}getAllTrackConfigs(){let t=[];for(let e of this.track_order)t.push(this.tracks[e].getConfig());return t}setTrackAttribute(t,e,i){let r=this.tracks[t];r&&(r.setConfigAttribute(e,i),"scale_link_to"===e&&(this.tracks[t].scale_link_to=this.tracks[i]),"color"!==e&&"display"!==e||!this.legend||this.legend.updateTrack(t))}setTrackAttributes(t,e){let i=this.tracks[t];for(let r in e)i.setConfigAttribute(r,e[r]),"color"===r&&this.legend&&this.legend.updateTrack(t)}setTrackFeatureFilter(t,e){this.tracks[t].setFilterFunction(e)}setTrackColorFunction(t,e){this.tracks[t].setColorFunction(e)}setTrackLabelFunction(t,e){let i=this.tracks[t];i&&(i.label_function=e)}_tracksChanged(){for(let t of this.track_order){let e=this.tracks[t],i=e.config.scale_link_to;if(i){let t=this.tracks[i];t&&(e.scale_link_to=t)}}}getCurrentTrackFeatures(t){return this.tracks[t].getCurrentFeatures(this.chr,this.start,this.end)}update(t,e,i,r){if(this.call_update_listener=r,e>i){const t=e;e=i,i=t}t?(this.chr=t,this.start=e,this.end=i,this.repaint()):this.repaint(!0,!0)}getTracksHeight(){let t=0,e={};for(let i of this.track_order){let r=this.tracks[i],s=r.config.group;r.config.hide||(s?e[s]||(t+=r.config.height,e[s]=!0):t+=r.config.height)}return t}async getAllFeatures(t,e,i,r){let s=[];this._display_order=[];for(let n of this.track_order){let a=this.tracks[n];a.config.hide||(this._display_order.push(n),s.push(a.getFeatures(this.chr,t,e,i,r)))}return await Promise.all(s.map((t=>t.catch((t=>t)))))}repaint(t,e,i){this.messageAlert.style.display="none";var r,s,n,a,o,h,l,c,f=this;h=this.chr,l=this.start,c=this.end,this.bpPerPixel=(this.end-this.start)/this.canvas.width;let u=!0;if(this.tile&&this.tile.containsRange(h,l,c,this.bpPerPixel)&&(u=!1),u||t||this.force_redraw){if(this.force_redraw=!1,i?(r=this.canvas.width,n=Math.max(0,Math.round(this.start))):(r=(2*this.buffer_level+1)*this.canvas.width,n=Math.max(0,Math.round(this.start-this.buffer_level*this.canvas.width*this.bpPerPixel))),s=Math.round(r*this.bpPerPixel),a=n+s,f.loading&&!i)return void(f.update_required=!(!t||!e)||"location");e&&this.tile&&(n=this.tile.startBP,a=this.tile.endBP),i||(f.loading={start:n,end:a},f.loadingIcon.style.display="block");const l=i?"black":getComputedStyle(f.trackDiv).getPropertyValue("color");f.getAllFeatures(n,a,!u,{pixelWidth:r,bpPerPixel:f.bpPerPixel}).then((function(t){if(t){let c=null;c=i?{}:document.createElement("canvas"),c.width=r,c.height=f.getTracksHeight(),o=i?new ee(c.width,c.height):c.getContext("2d"),f.show_scale&&!i&&(f.scale_buffer=document.createElement("canvas"),f.scale_buffer.width=200,f.scale_buffer.height=c.height,f.scale_buffer_ctx=f.scale_buffer.getContext("2d"));var e={context:o,bpStart:n,bpPerPixel:f.bpPerPixel,pixelWidth:c.width,pixelHeight:c.height,chr:h,textColor:l};let u=0;f.groups={},f.calculateMaxScale(t);for(let t in f.tracks){const e=f.tracks[t].config;e.hide&&(f.trackLabels[e.track_id].style.display="none")}for(var s in t){let r=f.tracks[f._display_order[s]];const n=f.trackLabels[r.config.track_id];n&&(n.style.display="block",n.style.top=u+f.yOffset+"px"),e.features=t[s];let a=r.config.group;if(a?(f.groups[a]||(f.groups[a]={top:u,height:r.config.height},u+=r.config.height),e.top=r.top=f.groups[a].top,e.height=f.groups[a].height,r.bottom=e.top+e.height):(e.top=u,r.top=u,e.height=r.config.height,u+=e.height,r.bottom=u),"string"!=typeof e.features||"fasta"===r.config.type){if(o.save(),o.rect(0,e.top,e.pixelWidth,e.height),o.clip(),o.beginPath(),r.drawFeatures(e),o.restore(),f.show_scale){const t=i?o:f.scale_buffer_ctx;r.drawScale(e.pixelHeight,t,l)}}else r.drawMessage(e)}for(let t in f.highlighted_regions){let i=f.highlighted_regions[t];f.chr===i.chr&&(i.end<n||i.start>a||f.drawHighlightedRegion(i,e))}if(i)return void i(o.getSerializedSvg());f.retries=0,f.loading=!1,f.tile=new ie(h,n,a,f.bpPerPixel,c),f.paintImage(),f.call_update_listener||f._callListeners("view_changed",{chr:f.chr,start:parseInt(f.start),end:parseInt(f.end)}),f.call_update_listener=!1}else f.ctx.clearRect(0,0,f.canvas.width,f.canvas.height);f.update_required&&("location"===f.update_required?(f.update(f.chr,f.start,f.end),f.update_required=!1):(f.update_required=!1,f.update())),f.loadingIcon.style.display="none"})).catch((function(i){f.loading=!1,console.log(i),f.retries<3&&"Timed out"!==i?(f.retries++,f.repaint(t,e)):(f.loading=!1,f.force_redraw=!0,f.loadingIcon.style.display="none",f.messageAlert.textContent=i,f.messageAlert.style.display="block")}))}else this.force_redraw=!1,this.paintImage(),f.call_update_listener||f._callListeners("view_changed",{chr:f.chr,start:parseInt(f.start),end:parseInt(f.end)}),f.call_update_listener=!1,f.retries=0}autoScale(t,e,i){return t&&"string"!=typeof t?(t.forEach((function(t){e=Math.min(e,t.value),i=Math.max(i,t.value)})),{min:e,max:i}):{min:0,max:1}}calculateMaxScale(t){let e={};for(var i in t){let r=this.tracks[this.track_order[i]];r.set_scale=null;let s=r.config.group;if(s&&"fixed"!==r.config.scale&&!r.config.scale_link_to&&(r.config.scale_group=s),s=r.config.scale_group,s){let n=e[s];n?(n.features.push(t[i]),n.tracks.push(r)):(n={tracks:[r],features:[t[i]]},e[s]=n)}}for(let t in e){let i=e[t];if(!i.ignore){let t=0,e=-Number.MAX_VALUE,r=null;for(let s of i.features)r=this.autoScale(s,t,e),t=r.min,e=r.max;for(let t of i.tracks)t.set_scale=r}}}drawHighlightedRegion(t,e){let i=(t.start-e.bpStart)/e.bpPerPixel;i=i<0?0:i;let r=(t.end-t.start)/e.bpPerPixel;r=r<3?3:r,r=r>e.pixelWidth?e.pixelWidth:r,e.context.globalAlpha=.1,e.context.fillStyle=t.color,e.context.fillRect(i,0,r,e.pixelHeight),e.context.globalAlpha=1}paintImage(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.show_scale&&(this.scale_ctx.clearRect(0,0,100,this.canvas.height),this.scale_ctx.drawImage(this.scale_buffer,0,this.yOffset)),this.tile&&(this.xOffset=Math.round((this.tile.startBP-this.start)/this.bpPerPixel),this.ctx.drawImage(this.tile.image,this.xOffset,this.yOffset),this.ctx.save(),this.ctx.restore())}allowUserFeatureOver(){this.foListener||(this.foListener=t=>{this.loading||(clearTimeout(this.moto),this.moto=setTimeout((()=>{if(!this.is_dragging){let e=this.getFeatureAt(t),i=this.mouse_over_feature;if(e.feature)i&&i.feature!==e.feature&&this._callListeners("featureout",{track:i.track,feature:i.feature,event:t}),i&&i.feature===e.feature||(this._callListeners("featureover",{track:e.track,feature:e.feature,event:t}),this.mouse_over_feature=e);else{let e=this.mouse_over_feature;e&&(this._callListeners("featureout",{track:e.track,feature:e.feature,event:t}),this.mouse_over_feature=null)}}}),10))},this.trackDiv.addEventListener("mousemove",this.foListener))}removeFeatureOverHandler(){this.trackDiv.removeEventListener("mouseover",this.foListener),this.foListener=null}allowUserFeatureClick(){this.fcListener||(this.allowUserFeatureOver(),this.listeners._fcfo||this.addListener("_fcfo",((t,e)=>{"featureout"===t&&(this.trackDiv.style.cursor="default"),"featureover"===t&&(this.trackDiv.style.cursor="pointer")})),this.fcListener=t=>{this.loading||(clearTimeout(this.foto),this.foto=setTimeout((()=>{if(!this.is_dragging){let e=this.getFeatureAt(t);e.track&&this._callListeners("featureclick",{track:e.track,feature:e.feature,event:t})}}),200))},this.trackDiv.addEventListener("click",this.fcListener))}removeFeatureClickHandler(){this.trackDiv.removeEventListener("click",this.fcListener),this.fcListener=null,this.removeListener("_fcfo")}allowUserDrag(){this.drmdListener=t=>{if(t.shiftKey)return;const e=this._getCoords(t);this.isMouseDown=!0,this.start_dragging=!0,this.lastMouseX=e.x,this.lastMouseY=e.y,this.mouseDownX=this.lastMouseX},this.trackDiv.addEventListener("mousedown",this.drmdListener),this.drmmListener=t=>{let e=this._getCoords(t);if(this.is_dragging||this.start_dragging){var i=e.x-this.lastMouseX,r=this.bpPerPixel*i;this.start-=r,this.end-=r;let t=this.canvas.height-this.tile.image.height,s=0;if(t<0||0!==this.yOffset){let i=e.y-this.lastMouseY;this.yOffset+=i,this.yOffset>0?this.yOffset=0:this.yOffset<t&&(this.yOffset=t);for(let t in this.tracks){const e=this.tracks[t],i=this.trackLabels[t];i&&(i.style.display="block",i.style.top=e.top+this.yOffset+"px")}}this.repaint(),this.lastMouseX=e.x,this.lastMouseY=e.y,this.start_dragging&&(i>5||s>5)&&(this.is_dragging=!0,this.start_dragging=!1)}},this.trackDiv.addEventListener("mousemove",this.drmmListener),this.drmuListener=t=>{this.is_dragging=!1,this.start_dragging=!1},this.trackDiv.addEventListener("mouseup",this.drmuListener)}removeDragHandler(){this.trackDiv.removeEventListener("mousedown",this.drmdListener),this.trackDiv.removeEventListener("mousemove",this.drmmListener),this.trackDiv.removeEventListener("mouseup",this.drmuListener),this.drmdListener=null,this.drmmListener=null,this.drmuListener=null}_getCoords(t){const e=this.canvas.getBoundingClientRect();return{x:t.clientX-Math.round(e.left),y:t.clientY-Math.round(e.top)}}allowUserZoom(){this.zmListener=t=>{t.preventDefault();let e=t.deltaY;if(void 0===e&&(e=t.detail),this.loading||this.bpPerPixel<.05&&e<0)return;let i=this._getCoords(t),r=e>0?2:.5,s=this.start+i.x*this.bpPerPixel,n=(this.end-this.start)*r,a=s-i.x/this.canvas.width*n;this.start=a,this.end=a+n,this.repaint()},this.trackDiv.addEventListener("wheel",this.zmListener)}disableUserZoom(){this.trackDiv.removeEventListener("wheel",this.zmListener)}allowUserRangeSelection(){this.rsmdListener=t=>{if(t.shiftKey){this.start_select=this._getCoords(t).x;let e=this.start_select+"px";this.select_div=(0,Wt.ut)("div",{styles:{position:"absolute",opacity:.2,"background-color":"blue",top:"0px",height:this.height+"px",left:e,width:"0px"}},this.trackDiv),t.stopPropagation()}},this.trackDiv.addEventListener("mousedown",this.rsmdListener),this.rsmmListener=t=>{if(t.shiftKey&&this.start_select){let e=this._getCoords(t).x;e<this.start_select?(this.select_div.style.left=e+"px",this.select_div.style.width=this.start_select-e+"px"):(this.select_div.style.left=this.start_select+"px",this.select_div.style.width=e-this.start_select+"px"),t.stopPropagation()}},this.trackDiv.addEventListener("mousemove",this.rsmmListener),this.rsmuListener=t=>{if(this.start_select){let e=this._getCoords(t).x,i=this.start+this.start_select*this.bpPerPixel,r=this.start+e*this.bpPerPixel;if(this.start_select=null,this.select_div.remove(),i>r){let t=r;r=i,i=t}this._callListeners("range_selected",{chr:this.chr,start:i,end:r})}},this.trackDiv.addEventListener("mouseup",this.rsmuListener)}removeAllowSelection(){this.trackDiv.removeEventListener("mousedown",this.rsmdListener),this.trackDiv.removeEventListener("mousemove",this.rsmmListener),this.trackDiv.removeEventListener("mouseup",this.rsmuListener),this.rsmdListener=null,this.rsmmListener=null,this.rsmuListener=null}getImage(){this.canvas[0].toDataURL(MIME_TYPE)}getFeatureAt(t){let e=this._getCoords(t);e.y-=this.yOffset;let i=Math.round(this.start+e.x*this.bpPerPixel);for(let t in this.tracks){let r=this.tracks[t];if(e.y>r.top&&e.y<r.bottom)return{track:r,feature:r.getFeatureAt(i,this.chr,e,this.bpPerPixel,this.ctx,this.yOffset)}}return{track:null,feature:null}}setSize(t,e){if(t)this.height=e,this.width=t,this.trackDiv.style.height=e+"px",this.trackDiv.style.width=t+"px";else{const t=this.trackDiv.getBoundingClientRect();this.width=t.width,this.height=t.height}this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this.show_scale&&this.scale_canvas.setAttribute("height",this.height)}redrawTile(t){if(this.tile){var e=this,i=e.tile.chr,r=e.tile.startBP,s=e.tile.endBP,n=document.createElement("canvas"),a=e.tile.scale;n.width=e.tile.image.width,n.height=e.tile.image.height;var o=n.getContext("2d");e.track.draw({features:t,context:o,bpStart:r,bpPerPixel:a,pixelWidth:n.width,pixelHeight:n.height}),e.tile=new ie(i,r,s,a,n),e.paintImage()}}}}}]);