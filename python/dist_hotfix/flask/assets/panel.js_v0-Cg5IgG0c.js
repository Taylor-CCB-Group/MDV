import{e as li,B as hi,f as R,i as fi,n as ot,j as lt}from"../js/mdv.js";import"./createSvgIcon-6gFOQ5xZ.js";var ci=15,Xt=ci,Yt=1440,re=15,ui=32,di=0,pi=4,gi=8,I=0,te=1,vi=2,j=-2,B=-3,ht=-4,se=-5,Qt=0,ft=1,ct=2,ut=3,dt=4,pt=5,Ye=6,we=7,gt=8,vt=9,mt=10,xt=11,De=12,Z=13,W=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],ve=0,Qe=1,_t=2,bt=3,wt=4,yt=5,Re=6,Te=7,mi=8,Ae=9,xi=9,_i=5,bi=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],wi=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],yi=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],ki=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],Si=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Ci=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function xe(){}xe.prototype.inflateInit=function(a,e){return a||(a=Xt),e&&(e=!1),this.istate=new ne,this.istate.inflateInit(this,e?-a:a)};xe.prototype.inflate=function(a){return this.istate==null?j:this.istate.inflate(this,a)};xe.prototype.inflateEnd=function(){if(this.istate==null)return j;var a=istate.inflateEnd(this);return this.istate=null,a};xe.prototype.inflateSync=function(){return istate.inflateSync(this)};xe.prototype.inflateSetDictionary=function(a,e){return istate.inflateSetDictionary(this,a,e)};function ne(){this.was=[0]}ne.prototype.inflateReset=function(a){return a==null||a.istate==null?j:(a.total_in=a.total_out=0,a.msg=null,a.istate.mode=a.istate.nowrap!=0?we:Qt,a.istate.blocks.reset(a,null),I)};ne.prototype.inflateEnd=function(a){return this.blocks!=null&&this.blocks.free(a),this.blocks=null,I};ne.prototype.inflateInit=function(a,e){return a.msg=null,this.blocks=null,e<0&&(e=-e),e<8||e>15?(this.inflateEnd(a),j):(this.wbits=e,a.istate.blocks=new ce(a,a.istate.nowrap!=0?null:this,1<<e),this.inflateReset(a),I)};ne.prototype.inflate=function(a,e){var t,i;if(a==null||a.istate==null||a.next_in==null)return j;for(e=e==pi?se:I,t=se;;)switch(a.istate.mode){case Qt:if(a.avail_in==0)return t;if(t=e,a.avail_in--,a.total_in++,((a.istate.method=a.next_in[a.next_in_index++])&15)!=gi){a.istate.mode=Z,a.msg="unknown compression method",a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=Z,a.msg="invalid window size",a.istate.marker=5;break}a.istate.mode=ft;case ft:if(a.avail_in==0)return t;if(t=e,a.avail_in--,a.total_in++,i=a.next_in[a.next_in_index++]&255,((a.istate.method<<8)+i)%31!=0){a.istate.mode=Z,a.msg="incorrect header check",a.istate.marker=5;break}if(!(i&ui)){a.istate.mode=we;break}a.istate.mode=ct;case ct:if(a.avail_in==0)return t;t=e,a.avail_in--,a.total_in++,a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080,a.istate.mode=ut;case ut:if(a.avail_in==0)return t;t=e,a.avail_in--,a.total_in++,a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680,a.istate.mode=dt;case dt:if(a.avail_in==0)return t;t=e,a.avail_in--,a.total_in++,a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280,a.istate.mode=pt;case pt:return a.avail_in==0?t:(t=e,a.avail_in--,a.total_in++,a.istate.need+=a.next_in[a.next_in_index++]&255,a.adler=a.istate.need,a.istate.mode=Ye,vi);case Ye:return a.istate.mode=Z,a.msg="need dictionary",a.istate.marker=0,j;case we:if(t=a.istate.blocks.proc(a,t),t==B){a.istate.mode=Z,a.istate.marker=0;break}if(t==I&&(t=e),t!=te)return t;if(t=e,a.istate.blocks.reset(a,a.istate.was),a.istate.nowrap!=0){a.istate.mode=De;break}a.istate.mode=gt;case gt:if(a.avail_in==0)return t;t=e,a.avail_in--,a.total_in++,a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080,a.istate.mode=vt;case vt:if(a.avail_in==0)return t;t=e,a.avail_in--,a.total_in++,a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680,a.istate.mode=mt;case mt:if(a.avail_in==0)return t;t=e,a.avail_in--,a.total_in++,a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280,a.istate.mode=xt;case xt:if(a.avail_in==0)return t;if(t=e,a.avail_in--,a.total_in++,a.istate.need+=a.next_in[a.next_in_index++]&255,a.istate.was[0]!=a.istate.need){a.istate.mode=Z,a.msg="incorrect data check",a.istate.marker=5;break}a.istate.mode=De;case De:return te;case Z:return B;default:return j}};ne.prototype.inflateSetDictionary=function(a,e,t){var i=0,r=t;return a==null||a.istate==null||a.istate.mode!=Ye?j:a._adler.adler32(1,e,0,t)!=a.adler?B:(a.adler=a._adler.adler32(0,null,0,0),r>=1<<a.istate.wbits&&(r=(1<<a.istate.wbits)-1,i=t-r),a.istate.blocks.set_dictionary(e,i,r),a.istate.mode=we,I)};var Ti=[0,0,255,255];ne.prototype.inflateSync=function(a){var e,t,i,r,s;if(a==null||a.istate==null)return j;if(a.istate.mode!=Z&&(a.istate.mode=Z,a.istate.marker=0),(e=a.avail_in)==0)return se;for(t=a.next_in_index,i=a.istate.marker;e!=0&&i<4;)a.next_in[t]==Ti[i]?i++:a.next_in[t]!=0?i=0:i=4-i,t++,e--;return a.total_in+=t-a.next_in_index,a.next_in_index=t,a.avail_in=e,a.istate.marker=i,i!=4?B:(r=a.total_in,s=a.total_out,this.inflateReset(a),a.total_in=r,a.total_out=s,a.istate.mode=we,I)};ne.prototype.inflateSyncPoint=function(a){return a==null||a.istate==null||a.istate.blocks==null?j:a.istate.blocks.sync_point()};var kt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function ce(a,e,t){this.hufts=new Int32Array(Yt*3),this.window=new Uint8Array(t),this.end=t,this.checkfn=e,this.mode=ve,this.reset(a,null),this.left=0,this.table=0,this.index=0,this.blens=null,this.bb=new Int32Array(1),this.tb=new Int32Array(1),this.codes=new ke,this.last=0,this.bitk=0,this.bitb=0,this.read=0,this.write=0,this.check=0,this.inftree=new Se}ce.prototype.reset=function(a,e){e&&(e[0]=this.check),this.mode==Re&&this.codes.free(a),this.mode=ve,this.bitk=0,this.bitb=0,this.read=this.write=0,this.checkfn&&(a.adler=this.check=a._adler.adler32(0,null,0,0))};ce.prototype.proc=function(a,e){var t,i,r,s,n,o,l;for(s=a.next_in_index,n=a.avail_in,i=this.bitb,r=this.bitk,o=this.write,l=o<this.read?this.read-o-1:this.end-o;;)switch(this.mode){case ve:for(;r<3;){if(n!=0)e=I;else return this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e);n--,i|=(a.next_in[s++]&255)<<r,r+=8}switch(t=i&7,this.last=t&1,t>>>1){case 0:i>>>=3,r-=3,t=r&7,i>>>=t,r-=t,this.mode=Qe;break;case 1:{var h=new Int32Array(1),f=new Int32Array(1),c=[],d=[];Ai(h,f,c,d),this.codes.init(h[0],f[0],c[0],0,d[0],0,a)}i>>>=3,r-=3,this.mode=Re;break;case 2:i>>>=3,r-=3,this.mode=bt;break;case 3:return i>>>=3,r-=3,this.mode=Z,a.msg="invalid block type",e=B,this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e)}break;case Qe:for(;r<32;){if(n!=0)e=I;else return this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e);n--,i|=(a.next_in[s++]&255)<<r,r+=8}if((~i>>>16&65535)!=(i&65535))return this.mode=Z,a.msg="invalid stored block lengths",e=B,this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e);this.left=i&65535,i=r=0,this.mode=left!=0?_t:this.last!=0?Te:ve;break;case _t:if(n==0)return this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,write=o,this.inflate_flush(a,e);if(l==0&&(o==end&&read!=0&&(o=0,l=o<this.read?this.read-o-1:this.end-o),l==0&&(this.write=o,e=this.inflate_flush(a,e),o=this.write,l=o<this.read?this.read-o-1:this.end-o,o==this.end&&this.read!=0&&(o=0,l=o<this.read?this.read-o-1:this.end-o),l==0)))return this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e);if(e=I,t=this.left,t>n&&(t=n),t>l&&(t=l),G(a.next_in,s,window,o,t),s+=t,n-=t,o+=t,l-=t,(this.left-=t)!=0)break;this.mode=this.last!=0?Te:ve;break;case bt:for(;r<14;){if(n!=0)e=I;else return this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e);n--,i|=(a.next_in[s++]&255)<<r,r+=8}if(this.table=t=i&16383,(t&31)>29||(t>>5&31)>29)return this.mode=Ae,a.msg="too many length or distance symbols",e=B,this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e);if(t=258+(t&31)+(t>>5&31),this.blens==null||this.blens.length<t)this.blens=new Int32Array(t);else for(var v=0;v<t;v++)this.blens[v]=0;i>>>=14,r-=14,this.index=0,this.mode=wt;case wt:for(;this.index<4+(this.table>>>10);){for(;r<3;){if(n!=0)e=I;else return this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e);n--,i|=(a.next_in[s++]&255)<<r,r+=8}this.blens[kt[this.index++]]=i&7,i>>>=3,r-=3}for(;this.index<19;)this.blens[kt[this.index++]]=0;if(this.bb[0]=7,t=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a),t!=I)return e=t,e==B&&(this.blens=null,this.mode=Ae),this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,write=o,this.inflate_flush(a,e);this.index=0,this.mode=yt;case yt:for(;t=this.table,this.index<258+(t&31)+(t>>5&31);){var v,x,g;for(t=this.bb[0];r<t;){if(n!=0)e=I;else return this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e);n--,i|=(a.next_in[s++]&255)<<r,r+=8}if(t=this.hufts[(this.tb[0]+(i&W[t]))*3+1],g=this.hufts[(this.tb[0]+(i&W[t]))*3+2],g<16)i>>>=t,r-=t,this.blens[this.index++]=g;else{for(v=g==18?7:g-14,x=g==18?11:3;r<t+v;){if(n!=0)e=I;else return this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e);n--,i|=(a.next_in[s++]&255)<<r,r+=8}if(i>>>=t,r-=t,x+=i&W[v],i>>>=v,r-=v,v=this.index,t=this.table,v+x>258+(t&31)+(t>>5&31)||g==16&&v<1)return this.blens=null,this.mode=Ae,a.msg="invalid bit length repeat",e=B,this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e);g=g==16?this.blens[v-1]:0;do this.blens[v++]=g;while(--x!=0);this.index=v}}this.tb[0]=-1;{var h=new Int32Array(1),f=new Int32Array(1),c=new Int32Array(1),d=new Int32Array(1);if(h[0]=9,f[0]=6,t=this.table,t=this.inftree.inflate_trees_dynamic(257+(t&31),1+(t>>5&31),this.blens,h,f,c,d,this.hufts,a),t!=I)return t==B&&(this.blens=null,this.mode=Z),e=t,this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e);this.codes.init(h[0],f[0],this.hufts,c[0],this.hufts,d[0],a)}this.mode=Re;case Re:if(this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,(e=this.codes.proc(this,a,e))!=te)return this.inflate_flush(a,e);if(e=I,this.codes.free(a),s=a.next_in_index,n=a.avail_in,i=this.bitb,r=this.bitk,o=this.write,l=o<this.read?this.read-o-1:this.end-o,this.last==0){this.mode=ve;break}this.mode=Te;case Te:if(this.write=o,e=this.inflate_flush(a,e),o=this.write,l=o<this.read?this.read-o-1:this.end-o,this.read!=this.write)return this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e);this.mode=De;case mi:return e=te,this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e);case Ae:return e=B,this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e);default:return e=j,this.bitb=i,this.bitk=r,a.avail_in=n,a.total_in+=s-a.next_in_index,a.next_in_index=s,this.write=o,this.inflate_flush(a,e)}};ce.prototype.free=function(a){this.reset(a,null),this.window=null,this.hufts=null};ce.prototype.set_dictionary=function(a,e,t){G(a,e,window,0,t),this.read=this.write=t};ce.prototype.sync_point=function(){return this.mode==Qe};ce.prototype.inflate_flush=function(a,e){var t,i,r;return i=a.next_out_index,r=this.read,t=(r<=this.write?this.write:this.end)-r,t>a.avail_out&&(t=a.avail_out),t!=0&&e==se&&(e=I),a.avail_out-=t,a.total_out+=t,this.checkfn!=null&&(a.adler=this.check=a._adler.adler32(this.check,this.window,r,t)),G(this.window,r,a.next_out,i,t),i+=t,r+=t,r==this.end&&(r=0,this.write==this.end&&(this.write=0),t=this.write-r,t>a.avail_out&&(t=a.avail_out),t!=0&&e==se&&(e=I),a.avail_out-=t,a.total_out+=t,this.checkfn!=null&&(a.adler=this.check=a._adler.adler32(this.check,this.window,r,t)),G(this.window,r,a.next_out,i,t),i+=t,r+=t),a.next_out_index=i,this.read=r,e};var Le=0,St=1,Ct=2,Tt=3,At=4,Et=5,It=6,Ne=7,Dt=8,Ee=9;function ke(){}ke.prototype.init=function(a,e,t,i,r,s,n){this.mode=Le,this.lbits=a,this.dbits=e,this.ltree=t,this.ltree_index=i,this.dtree=r,this.dtree_index=s,this.tree=null};ke.prototype.proc=function(a,e,t){var i,r,s,n=0,o=0,l=0,h,f,c,d;for(l=e.next_in_index,h=e.avail_in,n=a.bitb,o=a.bitk,f=a.write,c=f<a.read?a.read-f-1:a.end-f;;)switch(this.mode){case Le:if(c>=258&&h>=10&&(a.bitb=n,a.bitk=o,e.avail_in=h,e.total_in+=l-e.next_in_index,e.next_in_index=l,a.write=f,t=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,e),l=e.next_in_index,h=e.avail_in,n=a.bitb,o=a.bitk,f=a.write,c=f<a.read?a.read-f-1:a.end-f,t!=I)){this.mode=t==te?Ne:Ee;break}this.need=this.lbits,this.tree=this.ltree,this.tree_index=this.ltree_index,this.mode=St;case St:for(i=this.need;o<i;){if(h!=0)t=I;else return a.bitb=n,a.bitk=o,e.avail_in=h,e.total_in+=l-e.next_in_index,e.next_in_index=l,a.write=f,a.inflate_flush(e,t);h--,n|=(e.next_in[l++]&255)<<o,o+=8}if(r=(this.tree_index+(n&W[i]))*3,n>>>=this.tree[r+1],o-=this.tree[r+1],s=this.tree[r],s==0){this.lit=this.tree[r+2],this.mode=It;break}if(s&16){this.get=s&15,this.len=this.tree[r+2],this.mode=Ct;break}if(!(s&64)){this.need=s,this.tree_index=r/3+this.tree[r+2];break}if(s&32){this.mode=Ne;break}return this.mode=Ee,e.msg="invalid literal/length code",t=B,a.bitb=n,a.bitk=o,e.avail_in=h,e.total_in+=l-e.next_in_index,e.next_in_index=l,a.write=f,a.inflate_flush(e,t);case Ct:for(i=this.get;o<i;){if(h!=0)t=I;else return a.bitb=n,a.bitk=o,e.avail_in=h,e.total_in+=l-e.next_in_index,e.next_in_index=l,a.write=f,a.inflate_flush(e,t);h--,n|=(e.next_in[l++]&255)<<o,o+=8}this.len+=n&W[i],n>>=i,o-=i,this.need=this.dbits,this.tree=this.dtree,this.tree_index=this.dtree_index,this.mode=Tt;case Tt:for(i=this.need;o<i;){if(h!=0)t=I;else return a.bitb=n,a.bitk=o,e.avail_in=h,e.total_in+=l-e.next_in_index,e.next_in_index=l,a.write=f,a.inflate_flush(e,t);h--,n|=(e.next_in[l++]&255)<<o,o+=8}if(r=(this.tree_index+(n&W[i]))*3,n>>=this.tree[r+1],o-=this.tree[r+1],s=this.tree[r],s&16){this.get=s&15,this.dist=this.tree[r+2],this.mode=At;break}if(!(s&64)){this.need=s,this.tree_index=r/3+this.tree[r+2];break}return this.mode=Ee,e.msg="invalid distance code",t=B,a.bitb=n,a.bitk=o,e.avail_in=h,e.total_in+=l-e.next_in_index,e.next_in_index=l,a.write=f,a.inflate_flush(e,t);case At:for(i=this.get;o<i;){if(h!=0)t=I;else return a.bitb=n,a.bitk=o,e.avail_in=h,e.total_in+=l-e.next_in_index,e.next_in_index=l,a.write=f,a.inflate_flush(e,t);h--,n|=(e.next_in[l++]&255)<<o,o+=8}this.dist+=n&W[i],n>>=i,o-=i,this.mode=Et;case Et:for(d=f-this.dist;d<0;)d+=a.end;for(;this.len!=0;){if(c==0&&(f==a.end&&a.read!=0&&(f=0,c=f<a.read?a.read-f-1:a.end-f),c==0&&(a.write=f,t=a.inflate_flush(e,t),f=a.write,c=f<a.read?a.read-f-1:a.end-f,f==a.end&&a.read!=0&&(f=0,c=f<a.read?a.read-f-1:a.end-f),c==0)))return a.bitb=n,a.bitk=o,e.avail_in=h,e.total_in+=l-e.next_in_index,e.next_in_index=l,a.write=f,a.inflate_flush(e,t);a.window[f++]=a.window[d++],c--,d==a.end&&(d=0),this.len--}this.mode=Le;break;case It:if(c==0&&(f==a.end&&a.read!=0&&(f=0,c=f<a.read?a.read-f-1:a.end-f),c==0&&(a.write=f,t=a.inflate_flush(e,t),f=a.write,c=f<a.read?a.read-f-1:a.end-f,f==a.end&&a.read!=0&&(f=0,c=f<a.read?a.read-f-1:a.end-f),c==0)))return a.bitb=n,a.bitk=o,e.avail_in=h,e.total_in+=l-e.next_in_index,e.next_in_index=l,a.write=f,a.inflate_flush(e,t);t=I,a.window[f++]=this.lit,c--,this.mode=Le;break;case Ne:if(o>7&&(o-=8,h++,l--),a.write=f,t=a.inflate_flush(e,t),f=a.write,c=f<a.read?a.read-f-1:a.end-f,a.read!=a.write)return a.bitb=n,a.bitk=o,e.avail_in=h,e.total_in+=l-e.next_in_index,e.next_in_index=l,a.write=f,a.inflate_flush(e,t);this.mode=Dt;case Dt:return t=te,a.bitb=n,a.bitk=o,e.avail_in=h,e.total_in+=l-e.next_in_index,e.next_in_index=l,a.write=f,a.inflate_flush(e,t);case Ee:return t=B,a.bitb=n,a.bitk=o,e.avail_in=h,e.total_in+=l-e.next_in_index,e.next_in_index=l,a.write=f,a.inflate_flush(e,t);default:return t=j,a.bitb=n,a.bitk=o,e.avail_in=h,e.total_in+=l-e.next_in_index,e.next_in_index=l,a.write=f,a.inflate_flush(e,t)}};ke.prototype.free=function(a){};ke.prototype.inflate_fast=function(a,e,t,i,r,s,n,o){var l,h,f,c,d,v,x,g,p,m,_,w,b,k,y,S;x=o.next_in_index,g=o.avail_in,d=n.bitb,v=n.bitk,p=n.write,m=p<n.read?n.read-p-1:n.end-p,_=W[a],w=W[e];do{for(;v<20;)g--,d|=(o.next_in[x++]&255)<<v,v+=8;if(l=d&_,h=t,f=i,S=(f+l)*3,(c=h[S])==0){d>>=h[S+1],v-=h[S+1],n.window[p++]=h[S+2],m--;continue}do{if(d>>=h[S+1],v-=h[S+1],c&16){for(c&=15,b=h[S+2]+(d&W[c]),d>>=c,v-=c;v<15;)g--,d|=(o.next_in[x++]&255)<<v,v+=8;l=d&w,h=r,f=s,S=(f+l)*3,c=h[S];do if(d>>=h[S+1],v-=h[S+1],c&16){for(c&=15;v<c;)g--,d|=(o.next_in[x++]&255)<<v,v+=8;if(k=h[S+2]+(d&W[c]),d>>=c,v-=c,m-=b,p>=k)y=p-k,p-y>0&&2>p-y,n.window[p++]=n.window[y++],n.window[p++]=n.window[y++],b-=2;else{y=p-k;do y+=n.end;while(y<0);if(c=n.end-y,b>c){if(b-=c,p-y>0&&c>p-y)do n.window[p++]=n.window[y++];while(--c!=0);else G(n.window,y,n.window,p,c),p+=c,y+=c,c=0;y=0}}do n.window[p++]=n.window[y++];while(--b!=0);break}else if(!(c&64))l+=h[S+2],l+=d&W[c],S=(f+l)*3,c=h[S];else return o.msg="invalid distance code",b=o.avail_in-g,b=v>>3<b?v>>3:b,g+=b,x-=b,v-=b<<3,n.bitb=d,n.bitk=v,o.avail_in=g,o.total_in+=x-o.next_in_index,o.next_in_index=x,n.write=p,B;while(!0);break}if(c&64)return c&32?(b=o.avail_in-g,b=v>>3<b?v>>3:b,g+=b,x-=b,v-=b<<3,n.bitb=d,n.bitk=v,o.avail_in=g,o.total_in+=x-o.next_in_index,o.next_in_index=x,n.write=p,te):(o.msg="invalid literal/length code",b=o.avail_in-g,b=v>>3<b?v>>3:b,g+=b,x-=b,v-=b<<3,n.bitb=d,n.bitk=v,o.avail_in=g,o.total_in+=x-o.next_in_index,o.next_in_index=x,n.write=p,B);if(l+=h[S+2],l+=d&W[c],S=(f+l)*3,(c=h[S])==0){d>>=h[S+1],v-=h[S+1],n.window[p++]=h[S+2],m--;break}}while(!0)}while(m>=258&&g>=10);return b=o.avail_in-g,b=v>>3<b?v>>3:b,g+=b,x-=b,v-=b<<3,n.bitb=d,n.bitk=v,o.avail_in=g,o.total_in+=x-o.next_in_index,o.next_in_index=x,n.write=p,I};function Se(){}Se.prototype.huft_build=function(a,e,t,i,r,s,n,o,l,h,f){var c,d,v,x,g,p,m,_,w,b,k,y,S,A,C;b=0,g=t;do this.c[a[e+b]]++,b++,g--;while(g!=0);if(this.c[0]==t)return n[0]=-1,o[0]=0,I;for(_=o[0],p=1;p<=re&&this.c[p]==0;p++);for(m=p,_<p&&(_=p),g=re;g!=0&&this.c[g]==0;g--);for(v=g,_>g&&(_=g),o[0]=_,A=1<<p;p<g;p++,A<<=1)if((A-=this.c[p])<0)return B;if((A-=this.c[g])<0)return B;for(this.c[g]+=A,this.x[1]=p=0,b=1,S=2;--g!=0;)this.x[S]=p+=this.c[b],S++,b++;g=0,b=0;do(p=a[e+b])!=0&&(this.v[this.x[p]++]=g),b++;while(++g<t);for(t=this.x[v],this.x[0]=g=0,b=0,x=-1,y=-_,this.u[0]=0,k=0,C=0;m<=v;m++)for(c=this.c[m];c--!=0;){for(;m>y+_;){if(x++,y+=_,C=v-y,C=C>_?_:C,(d=1<<(p=m-y))>c+1&&(d-=c+1,S=m,p<C))for(;++p<C&&!((d<<=1)<=this.c[++S]);)d-=this.c[S];if(C=1<<p,this.hn[0]+C>Yt)return B;this.u[x]=k=this.hn[0],this.hn[0]+=C,x!=0?(this.x[x]=g,this.r[0]=p,this.r[1]=_,p=g>>>y-_,this.r[2]=k-this.u[x-1]-p,G(this.r,0,l,(this.u[x-1]+p)*3,3)):n[0]=k}for(this.r[1]=m-y,b>=t?this.r[0]=192:f[b]<i?(this.r[0]=this.v[b]<256?0:96,this.r[2]=this.v[b++]):(this.r[0]=s[this.v[b]-i]+16+64,this.r[2]=r[this.v[b++]-i]),d=1<<m-y,p=g>>>y;p<C;p+=d)G(this.r,0,l,(k+p)*3,3);for(p=1<<m-1;g&p;p>>>=1)g^=p;for(g^=p,w=(1<<y)-1;(g&w)!=this.x[x];)x--,y-=_,w=(1<<y)-1}return A!=0&&v!=1?se:I};Se.prototype.inflate_trees_bits=function(a,e,t,i,r){var s;return this.initWorkArea(19),this.hn[0]=0,s=this.huft_build(a,0,19,19,null,null,t,e,i,this.hn,this.v),s==B?r.msg="oversubscribed dynamic bit lengths tree":(s==se||e[0]==0)&&(r.msg="incomplete dynamic bit lengths tree",s=B),s};Se.prototype.inflate_trees_dynamic=function(a,e,t,i,r,s,n,o,l){var h;return this.initWorkArea(288),this.hn[0]=0,h=this.huft_build(t,0,a,257,yi,ki,s,i,o,this.hn,this.v),h!=I||i[0]==0?(h==B?l.msg="oversubscribed literal/length tree":h!=ht&&(l.msg="incomplete literal/length tree",h=B),h):(this.initWorkArea(288),h=this.huft_build(t,a,e,0,Si,Ci,n,r,o,this.hn,this.v),h!=I||r[0]==0&&a>257?(h==B?l.msg="oversubscribed distance tree":h==se?(l.msg="incomplete distance tree",h=B):h!=ht&&(l.msg="empty distance tree with lengths",h=B),h):I)};function Ai(a,e,t,i,r){return a[0]=xi,e[0]=_i,t[0]=bi,i[0]=wi,I}Se.prototype.initWorkArea=function(a){this.hn==null&&(this.hn=new Int32Array(1),this.v=new Int32Array(a),this.c=new Int32Array(re+1),this.r=new Int32Array(3),this.u=new Int32Array(re),this.x=new Int32Array(re+1)),this.v.length<a&&(this.v=new Int32Array(a));for(var e=0;e<a;e++)this.v[e]=0;for(var e=0;e<re+1;e++)this.c[e]=0;for(var e=0;e<3;e++)this.r[e]=0;G(this.c,0,this.u,0,re),G(this.c,0,this.x,0,re+1)};var Ei=new Uint8Array(1),Ii=typeof Ei.subarray=="function";function G(a,e,t,i,r){if(r!=0){if(a){if(!t)throw"Undef dest"}else throw"Undef src";e==0&&r==a.length?He(a,t,i):Ii?He(a.subarray(e,e+r),t,i):a.BYTES_PER_ELEMENT==1&&r>100?He(new Uint8Array(a.buffer,a.byteOffset+e,r),t,i):Di(a,e,t,i,r)}}function Di(a,e,t,i,r){for(var s=0;s<r;++s)t[i+s]=a[e+s]}function He(a,e,t){e.set(a,t)}function $t(a,e,t,i){e?a=new Uint8Array(a,e,t):a=new Uint8Array(a);var r=new xe;r.inflateInit(Xt,!0),r.next_in=a,r.next_in_index=0,r.avail_in=a.length;for(var s=[],n=0;;){var o=new Uint8Array(32e3);r.next_out=o,r.next_out_index=0,r.avail_out=o.length;var l=r.inflate(di);if(l!=I&&l!=te)throw r.msg;if(r.avail_out!=0){var h=new Uint8Array(o.length-r.avail_out);G(o,0,h,0,o.length-r.avail_out),o=h}if(s.push(o),n+=o.length,l==te)break}if(i&&(i[0]=(e||0)+r.next_in_index),s.length==1)return s[0].buffer;for(var f=new Uint8Array(n),c=0,d=0;d<s.length;++d){var v=s[d];G(v,0,f,c,v.length),c+=v.length}return f.buffer}const Ri=65e3;var u={Huffman:{},Util:{},CRC32:{}};u.CompressionMethod={DEFLATE:8,RESERVED:15};u.Zip=function(a){a=a||{},this.files=[],this.comment=a.comment,this.password};u.Zip.CompressionMethod={STORE:0,DEFLATE:8};u.Zip.OperatingSystem={MSDOS:0,UNIX:3,MACINTOSH:7};u.Zip.Flags={ENCRYPT:1,DESCRIPTOR:8,UTF8:2048};u.Zip.FileHeaderSignature=[80,75,1,2];u.Zip.LocalFileHeaderSignature=[80,75,3,4];u.Zip.CentralDirectorySignature=[80,75,5,6];u.Zip.prototype.addFile=function(a,e){e=e||{},e.filename;var t,i=a.length,r=0;if(a instanceof Array&&(a=new Uint8Array(a)),typeof e.compressionMethod!="number"&&(e.compressionMethod=u.Zip.CompressionMethod.DEFLATE),e.compress)switch(e.compressionMethod){case u.Zip.CompressionMethod.STORE:break;case u.Zip.CompressionMethod.DEFLATE:r=u.CRC32.calc(a),a=this.deflateWithOption(a,e),t=!0;break;default:throw new Error("unknown compression method:"+e.compressionMethod)}this.files.push({buffer:a,option:e,compressed:t,encrypted:!1,size:i,crc32:r})};u.Zip.prototype.setPassword=function(a){this.password=a};u.Zip.prototype.compress=function(){var a=this.files,e,t,i,r,s,n=0,o=0,l,h,f,c,d,v,x,g,p,m,_,w,b,k,y,S,A,C,D,E,O,X;for(D=0,E=a.length;D<E;++D){if(e=a[D],m=e.option.filename?e.option.filename.length:0,_=e.option.extraField?e.option.extraField.length:0,w=e.option.comment?e.option.comment.length:0,!e.compressed)switch(e.crc32=u.CRC32.calc(e.buffer),e.option.compressionMethod){case u.Zip.CompressionMethod.STORE:break;case u.Zip.CompressionMethod.DEFLATE:e.buffer=this.deflateWithOption(e.buffer,e.option),e.compressed=!0;break;default:throw new Error("unknown compression method:"+e.option.compressionMethod)}if(e.option.password!==void 0||this.password!==void 0){for(C=this.createEncryptionKey(e.option.password||this.password),S=e.buffer,A=new Uint8Array(S.length+12),A.set(S,12),S=A,O=0;O<12;++O)S[O]=this.encode(C,D===11?e.crc32&255:Math.random()*256|0);for(X=S.length;O<X;++O)S[O]=this.encode(C,S[O]);e.buffer=S}n+=30+m+e.buffer.length,o+=46+m+w}for(l=22+(this.comment?this.comment.length:0),t=new Uint8Array(n+o+l),i=0,r=n,s=r+o,D=0,E=a.length;D<E;++D)e=a[D],m=e.option.filename?e.option.filename.length:0,_=0,w=e.option.comment?e.option.comment.length:0,h=i,t[i++]=u.Zip.LocalFileHeaderSignature[0],t[i++]=u.Zip.LocalFileHeaderSignature[1],t[i++]=u.Zip.LocalFileHeaderSignature[2],t[i++]=u.Zip.LocalFileHeaderSignature[3],t[r++]=u.Zip.FileHeaderSignature[0],t[r++]=u.Zip.FileHeaderSignature[1],t[r++]=u.Zip.FileHeaderSignature[2],t[r++]=u.Zip.FileHeaderSignature[3],f=20,t[r++]=f&255,t[r++]=e.option.os||u.Zip.OperatingSystem.MSDOS,t[i++]=t[r++]=f&255,t[i++]=t[r++]=f>>8&255,c=0,(e.option.password||this.password)&&(c|=u.Zip.Flags.ENCRYPT),t[i++]=t[r++]=c&255,t[i++]=t[r++]=c>>8&255,d=e.option.compressionMethod,t[i++]=t[r++]=d&255,t[i++]=t[r++]=d>>8&255,v=e.option.date||new Date,t[i++]=t[r++]=(v.getMinutes()&7)<<5|(v.getSeconds()/2|0),t[i++]=t[r++]=v.getHours()<<3|v.getMinutes()>>3,t[i++]=t[r++]=(v.getMonth()+1&7)<<5|v.getDate(),t[i++]=t[r++]=(v.getFullYear()-1980&127)<<1|v.getMonth()+1>>3,x=e.crc32,t[i++]=t[r++]=x&255,t[i++]=t[r++]=x>>8&255,t[i++]=t[r++]=x>>16&255,t[i++]=t[r++]=x>>24&255,g=e.buffer.length,t[i++]=t[r++]=g&255,t[i++]=t[r++]=g>>8&255,t[i++]=t[r++]=g>>16&255,t[i++]=t[r++]=g>>24&255,p=e.size,t[i++]=t[r++]=p&255,t[i++]=t[r++]=p>>8&255,t[i++]=t[r++]=p>>16&255,t[i++]=t[r++]=p>>24&255,t[i++]=t[r++]=m&255,t[i++]=t[r++]=m>>8&255,t[i++]=t[r++]=_&255,t[i++]=t[r++]=_>>8&255,t[r++]=w&255,t[r++]=w>>8&255,t[r++]=0,t[r++]=0,t[r++]=0,t[r++]=0,t[r++]=0,t[r++]=0,t[r++]=0,t[r++]=0,t[r++]=h&255,t[r++]=h>>8&255,t[r++]=h>>16&255,t[r++]=h>>24&255,b=e.option.filename,b&&(t.set(b,i),t.set(b,r),i+=m,r+=m),k=e.option.extraField,k&&(t.set(k,i),t.set(k,r),i+=_,r+=_),y=e.option.comment,y&&(t.set(y,r),r+=w),t.set(e.buffer,i),i+=e.buffer.length;return t[s++]=u.Zip.CentralDirectorySignature[0],t[s++]=u.Zip.CentralDirectorySignature[1],t[s++]=u.Zip.CentralDirectorySignature[2],t[s++]=u.Zip.CentralDirectorySignature[3],t[s++]=0,t[s++]=0,t[s++]=0,t[s++]=0,t[s++]=E&255,t[s++]=E>>8&255,t[s++]=E&255,t[s++]=E>>8&255,t[s++]=o&255,t[s++]=o>>8&255,t[s++]=o>>16&255,t[s++]=o>>24&255,t[s++]=n&255,t[s++]=n>>8&255,t[s++]=n>>16&255,t[s++]=n>>24&255,w=this.comment?this.comment.length:0,t[s++]=w&255,t[s++]=w>>8&255,this.comment&&(t.set(this.comment,s),s+=w),t};u.Zip.prototype.deflateWithOption=function(a,e){var t=new u.RawDeflate(a,e.deflateOption);return t.compress()};u.Zip.prototype.getByte=function(a){var e=a[2]&65535|2;return e*(e^1)>>8&255};u.Zip.prototype.encode=function(a,e){var t=this.getByte(a);return this.updateKeys(a,e),t^e};u.Zip.prototype.updateKeys=function(a,e){a[0]=u.CRC32.single(a[0],e),a[1]=(((a[1]+(a[0]&255))*20173>>>0)*6681>>>0)+1>>>0,a[2]=u.CRC32.single(a[2],a[1]>>>24)};u.Zip.prototype.createEncryptionKey=function(a){var e=[305419896,591751049,878082192],t,i;for(e=new Uint32Array(e),t=0,i=a.length;t<i;++t)this.updateKeys(e,a[t]&255);return e};u.Huffman.buildHuffmanTable=function(a){var e=a.length,t=0,i=Number.POSITIVE_INFINITY,r,s,n,o,l,h,f,c,d,v,x;for(c=0,d=e;c<d;++c)a[c]>t&&(t=a[c]),a[c]<i&&(i=a[c]);for(r=1<<t,s=new Uint32Array(r),n=1,o=0,l=2;n<=t;){for(c=0;c<e;++c)if(a[c]===n){for(h=0,f=o,v=0;v<n;++v)h=h<<1|f&1,f>>=1;for(x=n<<16|c,v=h;v<r;v+=l)s[v]=x;++o}++n,o<<=1,l<<=1}return[s,t,i]};var Li=32768,K=u.Huffman.buildHuffmanTable;u.RawInflate=function(a,e){switch(this.buffer,this.blocks=[],this.bufferSize=Li,this.totalpos=0,this.ip=0,this.bitsbuf=0,this.bitsbuflen=0,this.input=new Uint8Array(a),this.output,this.op,this.bfinal=!1,this.bufferType=u.RawInflate.BufferType.ADAPTIVE,this.resize=!1,(e||!(e={}))&&(e.index&&(this.ip=e.index),e.bufferSize&&(this.bufferSize=e.bufferSize),e.bufferType&&(this.bufferType=e.bufferType),e.resize&&(this.resize=e.resize)),this.bufferType){case u.RawInflate.BufferType.BLOCK:this.op=u.RawInflate.MaxBackwardLength,this.output=new Uint8Array(u.RawInflate.MaxBackwardLength+this.bufferSize+u.RawInflate.MaxCopyLength);break;case u.RawInflate.BufferType.ADAPTIVE:this.op=0,this.output=new Uint8Array(this.bufferSize);break;default:throw new Error("invalid inflate mode")}};u.RawInflate.BufferType={BLOCK:0,ADAPTIVE:1};u.RawInflate.prototype.decompress=function(){for(;!this.bfinal;)this.parseBlock();switch(this.bufferType){case u.RawInflate.BufferType.BLOCK:return this.concatBufferBlock();case u.RawInflate.BufferType.ADAPTIVE:return this.concatBufferDynamic();default:throw new Error("invalid inflate mode")}};u.RawInflate.MaxBackwardLength=32768;u.RawInflate.MaxCopyLength=258;u.RawInflate.Order=function(a){return new Uint16Array(a)}([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);u.RawInflate.LengthCodeTable=function(a){return new Uint16Array(a)}([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]);u.RawInflate.LengthExtraTable=function(a){return new Uint8Array(a)}([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]);u.RawInflate.DistCodeTable=function(a){return new Uint16Array(a)}([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]);u.RawInflate.DistExtraTable=function(a){return new Uint8Array(a)}([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]);u.RawInflate.FixedLiteralLengthTable=function(a){return a}(function(){var a=new Uint8Array(288),e,t;for(e=0,t=a.length;e<t;++e)a[e]=e<=143?8:e<=255?9:e<=279?7:8;return K(a)}());u.RawInflate.FixedDistanceTable=function(a){return a}(function(){var a=new Uint8Array(30),e,t;for(e=0,t=a.length;e<t;++e)a[e]=5;return K(a)}());u.RawInflate.prototype.parseBlock=function(){var a=this.readBits(3);switch(a&1&&(this.bfinal=!0),a>>>=1,a){case 0:this.parseUncompressedBlock();break;case 1:this.parseFixedHuffmanBlock();break;case 2:this.parseDynamicHuffmanBlock();break;default:throw new Error("unknown BTYPE: "+a)}};u.RawInflate.prototype.readBits=function(a){var e=this.bitsbuf,t=this.bitsbuflen,i=this.input,r=this.ip,s=i.length,n;if(r+(a-t+7>>3)>=s)throw new Error("input buffer is broken");for(;t<a;)e|=i[r++]<<t,t+=8;return n=e&(1<<a)-1,e>>>=a,t-=a,this.bitsbuf=e,this.bitsbuflen=t,this.ip=r,n};u.RawInflate.prototype.readCodeByTable=function(a){for(var e=this.bitsbuf,t=this.bitsbuflen,i=this.input,r=this.ip,s=i.length,n=a[0],o=a[1],l,h;t<o&&!(r>=s);)e|=i[r++]<<t,t+=8;if(l=n[e&(1<<o)-1],h=l>>>16,h>t)throw new Error("invalid code length: "+h);return this.bitsbuf=e>>h,this.bitsbuflen=t-h,this.ip=r,l&65535};u.RawInflate.prototype.parseUncompressedBlock=function(){var a=this.input,e=this.ip,t=this.output,i=this.op,r=a.length,s,n,o=t.length,l;if(this.bitsbuf=0,this.bitsbuflen=0,e+1>=r)throw new Error("invalid uncompressed block header: LEN");if(s=a[e++]|a[e++]<<8,e+1>=r)throw new Error("invalid uncompressed block header: NLEN");if(n=a[e++]|a[e++]<<8,s===~n)throw new Error("invalid uncompressed block header: length verify");if(e+s>a.length)throw new Error("input buffer is broken");switch(this.bufferType){case u.RawInflate.BufferType.BLOCK:for(;i+s>t.length;)l=o-i,s-=l,t.set(a.subarray(e,e+l),i),i+=l,e+=l,this.op=i,t=this.expandBufferBlock(),i=this.op;break;case u.RawInflate.BufferType.ADAPTIVE:for(;i+s>t.length;)t=this.expandBufferAdaptive({fixRatio:2});break;default:throw new Error("invalid inflate mode")}t.set(a.subarray(e,e+s),i),i+=s,e+=s,this.ip=e,this.op=i,this.output=t};u.RawInflate.prototype.parseFixedHuffmanBlock=function(){switch(this.bufferType){case u.RawInflate.BufferType.ADAPTIVE:this.decodeHuffmanAdaptive(u.RawInflate.FixedLiteralLengthTable,u.RawInflate.FixedDistanceTable);break;case u.RawInflate.BufferType.BLOCK:this.decodeHuffmanBlock(u.RawInflate.FixedLiteralLengthTable,u.RawInflate.FixedDistanceTable);break;default:throw new Error("invalid inflate mode")}};u.RawInflate.prototype.parseDynamicHuffmanBlock=function(){var a=this.readBits(5)+257,e=this.readBits(5)+1,t=this.readBits(4)+4,i=new Uint8Array(u.RawInflate.Order.length),r,s,n,o,l,h,f,c,d;for(c=0;c<t;++c)i[u.RawInflate.Order[c]]=this.readBits(3);for(r=K(i),o=new Uint8Array(a+e),c=0,d=a+e;c<d;)switch(l=this.readCodeByTable(r),l){case 16:for(f=3+this.readBits(2);f--;)o[c++]=h;break;case 17:for(f=3+this.readBits(3);f--;)o[c++]=0;h=0;break;case 18:for(f=11+this.readBits(7);f--;)o[c++]=0;h=0;break;default:o[c++]=l,h=l;break}switch(s=K(o.subarray(0,a)),n=K(o.subarray(a)),this.bufferType){case u.RawInflate.BufferType.ADAPTIVE:this.decodeHuffmanAdaptive(s,n);break;case u.RawInflate.BufferType.BLOCK:this.decodeHuffmanBlock(s,n);break;default:throw new Error("invalid inflate mode")}};u.RawInflate.prototype.decodeHuffmanBlock=function(a,e){var t=this.output,i=this.op;this.currentLitlenTable=a;for(var r=t.length-u.RawInflate.MaxCopyLength,s,n,o,l,h=u.RawInflate.LengthCodeTable,f=u.RawInflate.LengthExtraTable,c=u.RawInflate.DistCodeTable,d=u.RawInflate.DistExtraTable;(s=this.readCodeByTable(a))!==256;){if(s<256){i>=r&&(this.op=i,t=this.expandBufferBlock(),i=this.op),t[i++]=s;continue}for(n=s-257,l=h[n],f[n]>0&&(l+=this.readBits(f[n])),s=this.readCodeByTable(e),o=c[s],d[s]>0&&(o+=this.readBits(d[s])),i>=r&&(this.op=i,t=this.expandBufferBlock(),i=this.op);l--;)t[i]=t[i++-o]}for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=i};u.RawInflate.prototype.decodeHuffmanAdaptive=function(a,e){var t=this.output,i=this.op;this.currentLitlenTable=a;for(var r=t.length,s,n,o,l,h=u.RawInflate.LengthCodeTable,f=u.RawInflate.LengthExtraTable,c=u.RawInflate.DistCodeTable,d=u.RawInflate.DistExtraTable;(s=this.readCodeByTable(a))!==256;){if(s<256){i>=r&&(t=this.expandBufferAdaptive(),r=t.length),t[i++]=s;continue}for(n=s-257,l=h[n],f[n]>0&&(l+=this.readBits(f[n])),s=this.readCodeByTable(e),o=c[s],d[s]>0&&(o+=this.readBits(d[s])),i+l>r&&(t=this.expandBufferAdaptive(),r=t.length);l--;)t[i]=t[i++-o]}for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=i};u.RawInflate.prototype.expandBufferBlock=function(a){var e=new Uint8Array(this.op-u.RawInflate.MaxBackwardLength),t=this.op-u.RawInflate.MaxBackwardLength,i=this.output;return e.set(i.subarray(u.RawInflate.MaxBackwardLength,e.length)),this.blocks.push(e),this.totalpos+=e.length,i.set(i.subarray(t,t+u.RawInflate.MaxBackwardLength)),this.op=u.RawInflate.MaxBackwardLength,i};u.RawInflate.prototype.expandBufferAdaptive=function(a){var e,t=this.input.length/this.ip+1|0,i,r,s,n=this.input,o=this.output;return a&&(typeof a.fixRatio=="number"&&(t=a.fixRatio),typeof a.addRatio=="number"&&(t+=a.addRatio)),t<2?(i=(n.length-this.ip)/this.currentLitlenTable[2],s=i/2*258|0,r=s<o.length?o.length+s:o.length<<1):r=o.length*t,e=new Uint8Array(r),e.set(o),this.output=e,this.output};u.RawInflate.prototype.concatBufferBlock=function(){var a=0,e=this.totalpos+(this.op-u.RawInflate.MaxBackwardLength),t=this.output,i=this.blocks,r,s=new Uint8Array(e),n,o,l,h;if(i.length===0)return this.output.subarray(u.RawInflate.MaxBackwardLength,this.op);for(n=0,o=i.length;n<o;++n)for(r=i[n],l=0,h=r.length;l<h;++l)s[a++]=r[l];for(n=u.RawInflate.MaxBackwardLength,o=this.op;n<o;++n)s[a++]=t[n];return this.blocks=[],this.buffer=s,this.buffer};u.RawInflate.prototype.concatBufferDynamic=function(){var a,e=this.op;return this.resize?(a=new Uint8Array(e),a.set(this.output.subarray(0,e))):a=this.output.subarray(0,e),this.buffer=a,this.buffer};var K=u.Huffman.buildHuffmanTable;u.RawInflateStream=function(a,e,t){this.blocks=[],this.bufferSize=t||Ri,this.totalpos=0,this.ip=e===void 0?0:e,this.bitsbuf=0,this.bitsbuflen=0,this.input=new Uint8Array(a),this.output=new Uint8Array(this.bufferSize),this.op=0,this.bfinal=!1,this.blockLength,this.resize=!1,this.litlenTable,this.distTable,this.sp=0,this.status=u.RawInflateStream.Status.INITIALIZED,this.ip_,this.bitsbuflen_,this.bitsbuf_};u.RawInflateStream.BlockType={UNCOMPRESSED:0,FIXED:1,DYNAMIC:2};u.RawInflateStream.Status={INITIALIZED:0,BLOCK_HEADER_START:1,BLOCK_HEADER_END:2,BLOCK_BODY_START:3,BLOCK_BODY_END:4,DECODE_BLOCK_START:5,DECODE_BLOCK_END:6};u.RawInflateStream.prototype.decompress=function(a,e){var t=!1;for(a!==void 0&&(this.input=a),e!==void 0&&(this.ip=e);!t;)switch(this.status){case u.RawInflateStream.Status.INITIALIZED:case u.RawInflateStream.Status.BLOCK_HEADER_START:this.readBlockHeader()<0&&(t=!0);break;case u.RawInflateStream.Status.BLOCK_HEADER_END:case u.RawInflateStream.Status.BLOCK_BODY_START:switch(this.currentBlockType){case u.RawInflateStream.BlockType.UNCOMPRESSED:this.readUncompressedBlockHeader()<0&&(t=!0);break;case u.RawInflateStream.BlockType.FIXED:this.parseFixedHuffmanBlock()<0&&(t=!0);break;case u.RawInflateStream.BlockType.DYNAMIC:this.parseDynamicHuffmanBlock()<0&&(t=!0);break}break;case u.RawInflateStream.Status.BLOCK_BODY_END:case u.RawInflateStream.Status.DECODE_BLOCK_START:switch(this.currentBlockType){case u.RawInflateStream.BlockType.UNCOMPRESSED:this.parseUncompressedBlock()<0&&(t=!0);break;case u.RawInflateStream.BlockType.FIXED:case u.RawInflateStream.BlockType.DYNAMIC:this.decodeHuffman()<0&&(t=!0);break}break;case u.RawInflateStream.Status.DECODE_BLOCK_END:this.bfinal?t=!0:this.status=u.RawInflateStream.Status.INITIALIZED;break}return this.concatBuffer()};u.RawInflateStream.MaxBackwardLength=32768;u.RawInflateStream.MaxCopyLength=258;u.RawInflateStream.Order=function(a){return new Uint16Array(a)}([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);u.RawInflateStream.LengthCodeTable=function(a){return new Uint16Array(a)}([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]);u.RawInflateStream.LengthExtraTable=function(a){return new Uint8Array(a)}([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]);u.RawInflateStream.DistCodeTable=function(a){return new Uint16Array(a)}([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]);u.RawInflateStream.DistExtraTable=function(a){return new Uint8Array(a)}([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]);u.RawInflateStream.FixedLiteralLengthTable=function(a){return a}(function(){var a=new Uint8Array(288),e,t;for(e=0,t=a.length;e<t;++e)a[e]=e<=143?8:e<=255?9:e<=279?7:8;return K(a)}());u.RawInflateStream.FixedDistanceTable=function(a){return a}(function(){var a=new Uint8Array(30),e,t;for(e=0,t=a.length;e<t;++e)a[e]=5;return K(a)}());u.RawInflateStream.prototype.readBlockHeader=function(){var a;if(this.status=u.RawInflateStream.Status.BLOCK_HEADER_START,this.save_(),(a=this.readBits(3))<0)return this.restore_(),-1;switch(a&1&&(this.bfinal=!0),a>>>=1,a){case 0:this.currentBlockType=u.RawInflateStream.BlockType.UNCOMPRESSED;break;case 1:this.currentBlockType=u.RawInflateStream.BlockType.FIXED;break;case 2:this.currentBlockType=u.RawInflateStream.BlockType.DYNAMIC;break;default:throw new Error("unknown BTYPE: "+a)}this.status=u.RawInflateStream.Status.BLOCK_HEADER_END};u.RawInflateStream.prototype.readBits=function(a){for(var e=this.bitsbuf,t=this.bitsbuflen,i=this.input,r=this.ip,s;t<a;){if(i.length<=r)return-1;s=i[r++],e|=s<<t,t+=8}return s=e&(1<<a)-1,e>>>=a,t-=a,this.bitsbuf=e,this.bitsbuflen=t,this.ip=r,s};u.RawInflateStream.prototype.readCodeByTable=function(a){for(var e=this.bitsbuf,t=this.bitsbuflen,i=this.input,r=this.ip,s=a[0],n=a[1],o,l,h;t<n;){if(i.length<=r)return-1;o=i[r++],e|=o<<t,t+=8}if(l=s[e&(1<<n)-1],h=l>>>16,h>t)throw new Error("invalid code length: "+h);return this.bitsbuf=e>>h,this.bitsbuflen=t-h,this.ip=r,l&65535};u.RawInflateStream.prototype.readUncompressedBlockHeader=function(){var a,e,t=this.input,i=this.ip;if(this.status=u.RawInflateStream.Status.BLOCK_BODY_START,i+4>=t.length)return-1;if(a=t[i++]|t[i++]<<8,e=t[i++]|t[i++]<<8,a===~e)throw new Error("invalid uncompressed block header: length verify");this.bitsbuf=0,this.bitsbuflen=0,this.ip=i,this.blockLength=a,this.status=u.RawInflateStream.Status.BLOCK_BODY_END};u.RawInflateStream.prototype.parseUncompressedBlock=function(){var a=this.input,e=this.ip,t=this.output,i=this.op,r=this.blockLength;for(this.status=u.RawInflateStream.Status.DECODE_BLOCK_START;r--;){if(i===t.length&&(t=this.expandBuffer({fixRatio:2})),e>=a.length)return this.ip=e,this.op=i,this.blockLength=r+1,-1;t[i++]=a[e++]}return r<0&&(this.status=u.RawInflateStream.Status.DECODE_BLOCK_END),this.ip=e,this.op=i,0};u.RawInflateStream.prototype.parseFixedHuffmanBlock=function(){return this.status=u.RawInflateStream.Status.BLOCK_BODY_START,this.litlenTable=u.RawInflateStream.FixedLiteralLengthTable,this.distTable=u.RawInflateStream.FixedDistanceTable,this.status=u.RawInflateStream.Status.BLOCK_BODY_END,0};u.RawInflateStream.prototype.save_=function(){this.ip_=this.ip,this.bitsbuflen_=this.bitsbuflen,this.bitsbuf_=this.bitsbuf};u.RawInflateStream.prototype.restore_=function(){this.ip=this.ip_,this.bitsbuflen=this.bitsbuflen_,this.bitsbuf=this.bitsbuf_};u.RawInflateStream.prototype.parseDynamicHuffmanBlock=function(){var a,e,t,i=new Uint8Array(u.RawInflateStream.Order.length),r;if(this.status=u.RawInflateStream.Status.BLOCK_BODY_START,this.save_(),a=this.readBits(5)+257,e=this.readBits(5)+1,t=this.readBits(4)+4,a<0||e<0||t<0)return this.restore_(),-1;try{s.call(this)}catch{return this.restore_(),-1}function s(){var n,o,l=0,h,f,c,d;for(c=0;c<t;++c){if((n=this.readBits(3))<0)throw new Error("not enough input");i[u.RawInflateStream.Order[c]]=n}for(r=K(i),f=new Uint8Array(a+e),c=0,d=a+e;c<d;){if(o=this.readCodeByTable(r),o<0)throw new Error("not enough input");switch(o){case 16:if((n=this.readBits(2))<0)throw new Error("not enough input");for(h=3+n;h--;)f[c++]=l;break;case 17:if((n=this.readBits(3))<0)throw new Error("not enough input");for(h=3+n;h--;)f[c++]=0;l=0;break;case 18:if((n=this.readBits(7))<0)throw new Error("not enough input");for(h=11+n;h--;)f[c++]=0;l=0;break;default:f[c++]=o,l=o;break}}this.litlenTable=K(f.subarray(0,a)),this.distTable=K(f.subarray(a))}return this.status=u.RawInflateStream.Status.BLOCK_BODY_END,0};u.RawInflateStream.prototype.decodeHuffman=function(){var a=this.output,e=this.op,t,i,r,s,n=this.litlenTable,o=this.distTable,l=a.length,h;for(this.status=u.RawInflateStream.Status.DECODE_BLOCK_START;;){if(this.save_(),t=this.readCodeByTable(n),t<0)return this.op=e,this.restore_(),-1;if(t===256)break;if(t<256){e===l&&(a=this.expandBuffer(),l=a.length),a[e++]=t;continue}if(i=t-257,s=u.RawInflateStream.LengthCodeTable[i],u.RawInflateStream.LengthExtraTable[i]>0){if(h=this.readBits(u.RawInflateStream.LengthExtraTable[i]),h<0)return this.op=e,this.restore_(),-1;s+=h}if(t=this.readCodeByTable(o),t<0)return this.op=e,this.restore_(),-1;if(r=u.RawInflateStream.DistCodeTable[t],u.RawInflateStream.DistExtraTable[t]>0){if(h=this.readBits(u.RawInflateStream.DistExtraTable[t]),h<0)return this.op=e,this.restore_(),-1;r+=h}for(e+s>=l&&(a=this.expandBuffer(),l=a.length);s--;)a[e]=a[e++-r];if(this.ip===this.input.length)return this.op=e,-1}for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=e,this.status=u.RawInflateStream.Status.DECODE_BLOCK_END};u.RawInflateStream.prototype.expandBuffer=function(a){var e,t=this.input.length/this.ip+1|0,i,r,s,n=this.input,o=this.output;return a&&(typeof a.fixRatio=="number"&&(t=a.fixRatio),typeof a.addRatio=="number"&&(t+=a.addRatio)),t<2?(i=(n.length-this.ip)/this.litlenTable[2],s=i/2*258|0,r=s<o.length?o.length+s:o.length<<1):r=o.length*t,e=new Uint8Array(r),e.set(o),this.output=e,this.output};u.RawInflateStream.prototype.concatBuffer=function(){var a,e=this.op,t;return this.resize?a=new Uint8Array(this.output.subarray(this.sp,e)):a=this.output.subarray(this.sp,e),this.sp=e,e>u.RawInflateStream.MaxBackwardLength+this.bufferSize&&(this.op=this.sp=u.RawInflateStream.MaxBackwardLength,t=this.output,this.output=new Uint8Array(this.bufferSize+u.RawInflateStream.MaxBackwardLength),this.output.set(t.subarray(e-u.RawInflateStream.MaxBackwardLength,e))),a};u.Inflate=function(a,e){var t,i;switch(this.input=a,this.ip=0,this.rawinflate,this.verify,(e||!(e={}))&&(e.index&&(this.ip=e.index),e.verify&&(this.verify=e.verify)),t=a[this.ip++],i=a[this.ip++],t&15){case u.CompressionMethod.DEFLATE:this.method=u.CompressionMethod.DEFLATE;break;default:throw new Error("unsupported compression method")}if(((t<<8)+i)%31!==0)throw new Error("invalid fcheck flag:"+((t<<8)+i)%31);if(i&32)throw new Error("fdict flag is not supported");this.rawinflate=new u.RawInflate(a,{index:this.ip,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})};u.Inflate.BufferType=u.RawInflate.BufferType;u.Inflate.prototype.decompress=function(){var a=this.input,e,t;if(e=this.rawinflate.decompress(),this.ip=this.rawinflate.ip,this.verify&&(t=(a[this.ip++]<<24|a[this.ip++]<<16|a[this.ip++]<<8|a[this.ip++])>>>0,t!==u.Adler32(e)))throw new Error("invalid adler-32 checksum");return e};u.InflateStream=function(a){this.input=a===void 0?new Uint8Array:a,this.ip=0,this.rawinflate=new u.RawInflateStream(this.input,this.ip),this.method,this.output=this.rawinflate.output};u.InflateStream.prototype.decompress=function(a){var e;if(a!==void 0){var t=new Uint8Array(this.input.length+a.length);t.set(this.input,0),t.set(a,this.input.length),this.input=t}return this.method===void 0&&this.readHeader()<0?new Uint8Array:(e=this.rawinflate.decompress(this.input,this.ip),this.rawinflate.ip!==0&&(this.input=this.input.subarray(this.rawinflate.ip),this.ip=0),e)};u.InflateStream.prototype.readHeader=function(){var a=this.ip,e=this.input,t=e[a++],i=e[a++];if(t===void 0||i===void 0)return-1;switch(t&15){case u.CompressionMethod.DEFLATE:this.method=u.CompressionMethod.DEFLATE;break;default:throw new Error("unsupported compression method")}if(((t<<8)+i)%31!==0)throw new Error("invalid fcheck flag:"+((t<<8)+i)%31);if(i&32)throw new Error("fdict flag is not supported");this.ip=a};u.Gunzip=function(a,e){this.input=a,this.ip=0,this.member=[],this.decompressed=!1};u.Gunzip.prototype.getMembers=function(){return this.decompressed||this.decompress(),this.member.slice()};u.Gunzip.prototype.decompress=function(){for(var a=this.input.length;this.ip<a;)this.decodeMember();return this.decompressed=!0,this.concatMember()};u.Gunzip.prototype.decodeMember=function(){var a=new u.GunzipMember,e,t,i,r,s,n,o,l,h,f=this.input,c=this.ip;if(a.id1=f[c++],a.id2=f[c++],a.id1!==31||a.id2!==139)throw new Error("invalid file signature:"+a.id1+","+a.id2);switch(a.cm=f[c++],a.cm){case 8:break;default:throw new Error("unknown compression method: "+a.cm)}if(a.flg=f[c++],l=f[c++]|f[c++]<<8|f[c++]<<16|f[c++]<<24,a.mtime=new Date(l*1e3),a.xfl=f[c++],a.os=f[c++],(a.flg&u.Gzip.FlagsMask.FEXTRA)>0&&(a.xlen=f[c++]|f[c++]<<8,c=this.decodeSubField(c,a.xlen)),(a.flg&u.Gzip.FlagsMask.FNAME)>0){for(o=[],n=0;(s=f[c++])>0;)o[n++]=String.fromCharCode(s);a.name=o.join("")}if((a.flg&u.Gzip.FlagsMask.FCOMMENT)>0){for(o=[],n=0;(s=f[c++])>0;)o[n++]=String.fromCharCode(s);a.comment=o.join("")}if((a.flg&u.Gzip.FlagsMask.FHCRC)>0&&(a.crc16=u.CRC32.calc(f,0,c)&65535,a.crc16!==(f[c++]|f[c++]<<8)))throw new Error("invalid header crc16");if(e=f[f.length-4]|f[f.length-3]<<8|f[f.length-2]<<16|f[f.length-1]<<24,f.length-c-4-4<e*512&&(r=e),t=new u.RawInflate(f,{index:c,bufferSize:r}),a.data=i=t.decompress(),c=t.ip,a.crc32=h=(f[c++]|f[c++]<<8|f[c++]<<16|f[c++]<<24)>>>0,u.CRC32.calc(i)!==h)throw new Error("invalid CRC-32 checksum: 0x"+u.CRC32.calc(i).toString(16)+" / 0x"+h.toString(16));if(a.isize=e=(f[c++]|f[c++]<<8|f[c++]<<16|f[c++]<<24)>>>0,(i.length&4294967295)!==e)throw new Error("invalid input size: "+(i.length&4294967295)+" / "+e);this.member.push(a),this.ip=c};u.Gunzip.prototype.decodeSubField=function(a,e){return a+e};u.Gunzip.prototype.concatMember=function(){var a=this.member,e,t,i=0,r=0,s;for(e=0,t=a.length;e<t;++e)r+=a[e].data.length;for(s=new Uint8Array(r),e=0;e<t;++e)s.set(a[e].data,i),i+=a[e].data.length;return s};u.GunzipMember=function(){this.id1,this.id2,this.cm,this.flg,this.mtime,this.xfl,this.os,this.crc16,this.xlen,this.crc32,this.isize,this.name,this.comment,this.data};u.GunzipMember.prototype.getName=function(){return this.name};u.GunzipMember.prototype.getData=function(){return this.data};u.GunzipMember.prototype.getMtime=function(){return this.mtime};u.Gzip=function(a,e){this.input=a,this.ip=0,this.output,this.op=0,this.flags={},this.filename,this.comment,this.deflateOptions,e&&(e.flags&&(this.flags=e.flags),typeof e.filename=="string"&&(this.filename=e.filename),typeof e.comment=="string"&&(this.comment=e.comment),e.deflateOptions&&(this.deflateOptions=e.deflateOptions)),this.deflateOptions||(this.deflateOptions={})};u.Gzip.DefaultBufferSize=32768;u.Gzip.prototype.compress=function(){var a,e,t,i,r,s,n,o,l=new Uint8Array(u.Gzip.DefaultBufferSize),h=0,f=this.input,c=this.ip,d=this.filename,v=this.comment;if(l[h++]=31,l[h++]=139,l[h++]=8,a=0,this.flags.fname&&(a|=u.Gzip.FlagsMask.FNAME),this.flags.fcomment&&(a|=u.Gzip.FlagsMask.FCOMMENT),this.flags.fhcrc&&(a|=u.Gzip.FlagsMask.FHCRC),l[h++]=a,e=(Date.now?Date.now():+new Date)/1e3|0,l[h++]=e&255,l[h++]=e>>>8&255,l[h++]=e>>>16&255,l[h++]=e>>>24&255,l[h++]=0,l[h++]=u.Gzip.OperatingSystem.UNKNOWN,this.flags.fname!==void 0){for(n=0,o=d.length;n<o;++n)s=d.charCodeAt(n),s>255&&(l[h++]=s>>>8&255),l[h++]=s&255;l[h++]=0}if(this.flags.comment){for(n=0,o=v.length;n<o;++n)s=v.charCodeAt(n),s>255&&(l[h++]=s>>>8&255),l[h++]=s&255;l[h++]=0}return this.flags.fhcrc&&(t=u.CRC32.calc(l,0,h)&65535,l[h++]=t&255,l[h++]=t>>>8&255),this.deflateOptions.outputBuffer=l,this.deflateOptions.outputIndex=h,r=new u.RawDeflate(f,this.deflateOptions),l=r.compress(),h=r.op,h+8>l.buffer.byteLength?(this.output=new Uint8Array(h+8),this.output.set(new Uint8Array(l.buffer)),l=this.output):l=new Uint8Array(l.buffer),i=u.CRC32.calc(f),l[h++]=i&255,l[h++]=i>>>8&255,l[h++]=i>>>16&255,l[h++]=i>>>24&255,o=f.length,l[h++]=o&255,l[h++]=o>>>8&255,l[h++]=o>>>16&255,l[h++]=o>>>24&255,this.ip=c,h<l.length&&(this.output=l=l.subarray(0,h)),l};u.Gzip.OperatingSystem={FAT:0,AMIGA:1,VMS:2,UNIX:3,VM_CMS:4,ATARI_TOS:5,HPFS:6,MACINTOSH:7,Z_SYSTEM:8,CP_M:9,TOPS_20:10,NTFS:11,QDOS:12,ACORN_RISCOS:13,UNKNOWN:255};u.Gzip.FlagsMask={FTEXT:1,FHCRC:2,FEXTRA:4,FNAME:8,FCOMMENT:16};u.Heap=function(a){this.buffer=new Uint16Array(a*2),this.length=0};u.Heap.prototype.getParent=function(a){return((a-2)/4|0)*2};u.Heap.prototype.getChild=function(a){return 2*a+2};u.Heap.prototype.push=function(a,e){var t,i,r=this.buffer,s;for(t=this.length,r[this.length++]=e,r[this.length++]=a;t>0&&(i=this.getParent(t),r[t]>r[i]);)s=r[t],r[t]=r[i],r[i]=s,s=r[t+1],r[t+1]=r[i+1],r[i+1]=s,t=i;return this.length};u.Heap.prototype.pop=function(){var a,e,t=this.buffer,i,r,s;for(e=t[0],a=t[1],this.length-=2,t[0]=t[this.length],t[1]=t[this.length+1],s=0;r=this.getChild(s),!(r>=this.length);){if(r+2<this.length&&t[r+2]>t[r]&&(r+=2),t[r]>t[s])i=t[s],t[s]=t[r],t[r]=i,i=t[s+1],t[s+1]=t[r+1],t[r+1]=i;else break;s=r}return{index:a,value:e,length:this.length}};u.RawDeflate=function(a,e){this.compressionType=u.RawDeflate.CompressionType.DYNAMIC,this.lazy=0,this.freqsLitLen,this.freqsDist,this.input=a instanceof Array?new Uint8Array(a):a,this.output,this.op=0,e&&(e.lazy&&(this.lazy=e.lazy),typeof e.compressionType=="number"&&(this.compressionType=e.compressionType),e.outputBuffer&&(this.output=e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),typeof e.outputIndex=="number"&&(this.op=e.outputIndex)),this.output||(this.output=new Uint8Array(32768))};u.RawDeflate.CompressionType={NONE:0,FIXED:1,DYNAMIC:2,RESERVED:3};u.RawDeflate.Lz77MinLength=3;u.RawDeflate.Lz77MaxLength=258;u.RawDeflate.WindowSize=32768;u.RawDeflate.MaxCodeLength=16;u.RawDeflate.HUFMAX=286;u.RawDeflate.FixedHuffmanTable=function(){var a=[],e;for(e=0;e<288;e++)switch(!0){case e<=143:a.push([e+48,8]);break;case e<=255:a.push([e-144+400,9]);break;case e<=279:a.push([e-256+0,7]);break;case e<=287:a.push([e-280+192,8]);break;default:throw"invalid literal: "+e}return a}();u.RawDeflate.prototype.compress=function(){var a,e,t,i=this.input;switch(this.compressionType){case u.RawDeflate.CompressionType.NONE:for(e=0,t=i.length;e<t;)a=i.subarray(e,e+65535),e+=a.length,this.makeNocompressBlock(a,e===t);break;case u.RawDeflate.CompressionType.FIXED:this.output=this.makeFixedHuffmanBlock(i,!0),this.op=this.output.length;break;case u.RawDeflate.CompressionType.DYNAMIC:this.output=this.makeDynamicHuffmanBlock(i,!0),this.op=this.output.length;break;default:throw"invalid compression type"}return this.output};u.RawDeflate.prototype.makeNocompressBlock=function(a,e){var t,i,r,s,n=this.output,o=this.op;{for(n=new Uint8Array(this.output.buffer);n.length<=o+a.length+5;)n=new Uint8Array(n.length<<1);n.set(this.output)}return t=e?1:0,i=u.RawDeflate.CompressionType.NONE,n[o++]=t|i<<1,r=a.length,s=~r+65536&65535,n[o++]=r&255,n[o++]=r>>>8&255,n[o++]=s&255,n[o++]=s>>>8&255,n.set(a,o),o+=a.length,n=n.subarray(0,o),this.op=o,this.output=n,n};u.RawDeflate.prototype.makeFixedHuffmanBlock=function(a,e){var t=new u.BitStream(new Uint8Array(this.output.buffer),this.op),i,r,s;return i=e?1:0,r=u.RawDeflate.CompressionType.FIXED,t.writeBits(i,1,!0),t.writeBits(r,2,!0),s=this.lz77(a),this.fixedHuffman(s,t),t.finish()};u.RawDeflate.prototype.makeDynamicHuffmanBlock=function(a,e){var t=new u.BitStream(new Uint8Array(this.output.buffer),this.op),i,r,s,n,o,l,h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f,c,d,v,x,g,p=new Array(19),m,_,w,b,k;for(i=e?1:0,r=u.RawDeflate.CompressionType.DYNAMIC,t.writeBits(i,1,!0),t.writeBits(r,2,!0),s=this.lz77(a),f=this.getLengths_(this.freqsLitLen,15),c=this.getCodesFromLengths_(f),d=this.getLengths_(this.freqsDist,7),v=this.getCodesFromLengths_(d),n=286;n>257&&f[n-1]===0;n--);for(o=30;o>1&&d[o-1]===0;o--);for(x=this.getTreeSymbols_(n,f,o,d),g=this.getLengths_(x.freqs,7),b=0;b<19;b++)p[b]=g[h[b]];for(l=19;l>4&&p[l-1]===0;l--);for(m=this.getCodesFromLengths_(g),t.writeBits(n-257,5,!0),t.writeBits(o-1,5,!0),t.writeBits(l-4,4,!0),b=0;b<l;b++)t.writeBits(p[b],3,!0);for(b=0,k=x.codes.length;b<k;b++)if(_=x.codes[b],t.writeBits(m[_],g[_],!0),_>=16){switch(b++,_){case 16:w=2;break;case 17:w=3;break;case 18:w=7;break;default:throw"invalid code: "+_}t.writeBits(x.codes[b],w,!0)}return this.dynamicHuffman(s,[c,f],[v,d],t),t.finish()};u.RawDeflate.prototype.dynamicHuffman=function(a,e,t,i){var r,s,n,o,l,h,f,c;for(l=e[0],h=e[1],f=t[0],c=t[1],r=0,s=a.length;r<s;++r)if(n=a[r],i.writeBits(l[n],h[n],!0),n>256)i.writeBits(a[++r],a[++r],!0),o=a[++r],i.writeBits(f[o],c[o],!0),i.writeBits(a[++r],a[++r],!0);else if(n===256)break;return i};u.RawDeflate.prototype.fixedHuffman=function(a,e){var t,i,r;for(t=0,i=a.length;t<i;t++)if(r=a[t],u.BitStream.prototype.writeBits.apply(e,u.RawDeflate.FixedHuffmanTable[r]),r>256)e.writeBits(a[++t],a[++t],!0),e.writeBits(a[++t],5),e.writeBits(a[++t],a[++t],!0);else if(r===256)break;return e};u.RawDeflate.Lz77Match=function(a,e){this.length=a,this.backwardDistance=e};u.RawDeflate.Lz77Match.LengthCodeTable=function(a){return new Uint32Array(a)}(function(){var a=[],e,t;for(e=3;e<=258;e++)t=i(e),a[e]=t[2]<<24|t[1]<<16|t[0];function i(r){switch(!0){case r===3:return[257,r-3,0];case r===4:return[258,r-4,0];case r===5:return[259,r-5,0];case r===6:return[260,r-6,0];case r===7:return[261,r-7,0];case r===8:return[262,r-8,0];case r===9:return[263,r-9,0];case r===10:return[264,r-10,0];case r<=12:return[265,r-11,1];case r<=14:return[266,r-13,1];case r<=16:return[267,r-15,1];case r<=18:return[268,r-17,1];case r<=22:return[269,r-19,2];case r<=26:return[270,r-23,2];case r<=30:return[271,r-27,2];case r<=34:return[272,r-31,2];case r<=42:return[273,r-35,3];case r<=50:return[274,r-43,3];case r<=58:return[275,r-51,3];case r<=66:return[276,r-59,3];case r<=82:return[277,r-67,4];case r<=98:return[278,r-83,4];case r<=114:return[279,r-99,4];case r<=130:return[280,r-115,4];case r<=162:return[281,r-131,5];case r<=194:return[282,r-163,5];case r<=226:return[283,r-195,5];case r<=257:return[284,r-227,5];case r===258:return[285,r-258,0];default:throw"invalid length: "+r}}return a}());u.RawDeflate.Lz77Match.prototype.getDistanceCode_=function(a){var e;switch(!0){case a===1:e=[0,a-1,0];break;case a===2:e=[1,a-2,0];break;case a===3:e=[2,a-3,0];break;case a===4:e=[3,a-4,0];break;case a<=6:e=[4,a-5,1];break;case a<=8:e=[5,a-7,1];break;case a<=12:e=[6,a-9,2];break;case a<=16:e=[7,a-13,2];break;case a<=24:e=[8,a-17,3];break;case a<=32:e=[9,a-25,3];break;case a<=48:e=[10,a-33,4];break;case a<=64:e=[11,a-49,4];break;case a<=96:e=[12,a-65,5];break;case a<=128:e=[13,a-97,5];break;case a<=192:e=[14,a-129,6];break;case a<=256:e=[15,a-193,6];break;case a<=384:e=[16,a-257,7];break;case a<=512:e=[17,a-385,7];break;case a<=768:e=[18,a-513,8];break;case a<=1024:e=[19,a-769,8];break;case a<=1536:e=[20,a-1025,9];break;case a<=2048:e=[21,a-1537,9];break;case a<=3072:e=[22,a-2049,10];break;case a<=4096:e=[23,a-3073,10];break;case a<=6144:e=[24,a-4097,11];break;case a<=8192:e=[25,a-6145,11];break;case a<=12288:e=[26,a-8193,12];break;case a<=16384:e=[27,a-12289,12];break;case a<=24576:e=[28,a-16385,13];break;case a<=32768:e=[29,a-24577,13];break;default:throw"invalid distance"}return e};u.RawDeflate.Lz77Match.prototype.toLz77Array=function(){var a=this.length,e=this.backwardDistance,t=[],i=0,r;return r=u.RawDeflate.Lz77Match.LengthCodeTable[a],t[i++]=r&65535,t[i++]=r>>16&255,t[i++]=r>>24,r=this.getDistanceCode_(e),t[i++]=r[0],t[i++]=r[1],t[i++]=r[2],t};u.RawDeflate.prototype.lz77=function(a){var e,t,i,r,s,n={},o=u.RawDeflate.WindowSize,l,h,f,c=new Uint16Array(a.length*2),d=0,v=0,x=new Uint32Array(286),g=new Uint32Array(30),p=this.lazy,m;x[256]=1;function _(w,b){var k=w.toLz77Array(),y,S;for(y=0,S=k.length;y<S;++y)c[d++]=k[y];x[k[0]]++,g[k[3]]++,v=w.length+b-1,f=null}for(e=0,t=a.length;e<t;++e){for(s=0,i=0,r=u.RawDeflate.Lz77MinLength;i<r&&e+i!==t;++i)s=s<<8|a[e+i];if(n[s]===void 0&&(n[s]=[]),l=n[s],v-- >0){l.push(e);continue}for(;l.length>0&&e-l[0]>o;)l.shift();if(e+u.RawDeflate.Lz77MinLength>=t){for(f&&_(f,-1),i=0,r=t-e;i<r;++i)m=a[e+i],c[d++]=m,++x[m];break}l.length>0?(h=this.searchLongestMatch_(a,e,l),f?f.length<h.length?(m=a[e-1],c[d++]=m,++x[m],_(h,0)):_(f,-1):h.length<p?f=h:_(h,0)):f?_(f,-1):(m=a[e],c[d++]=m,++x[m]),l.push(e)}return c[d++]=256,x[256]++,this.freqsLitLen=x,this.freqsDist=g,c.subarray(0,d)};u.RawDeflate.prototype.searchLongestMatch_=function(a,e,t){var i,r,s=0,n,o,l,h,f=a.length;e:for(o=0,h=t.length;o<h;o++){if(i=t[h-o-1],n=u.RawDeflate.Lz77MinLength,s>u.RawDeflate.Lz77MinLength){for(l=s;l>u.RawDeflate.Lz77MinLength;l--)if(a[i+l-1]!==a[e+l-1])continue e;n=s}for(;n<u.RawDeflate.Lz77MaxLength&&e+n<f&&a[i+n]===a[e+n];)++n;if(n>s&&(r=i,s=n),n===u.RawDeflate.Lz77MaxLength)break}return new u.RawDeflate.Lz77Match(s,e-r)};u.RawDeflate.prototype.getTreeSymbols_=function(a,e,t,i){var r=new Uint32Array(a+t),s,n,o,l,h=new Uint32Array(316),f,c,d=new Uint8Array(19);for(n=0,s=0;s<a;s++)r[n++]=e[s];for(s=0;s<t;s++)r[n++]=i[s];for(f=0,s=0,l=r.length;s<l;s+=n){for(n=1;s+n<l&&r[s+n]===r[s];++n);if(o=n,r[s]===0)if(o<3)for(;o-- >0;)h[f++]=0,d[0]++;else for(;o>0;)c=o<138?o:138,c>o-3&&c<o&&(c=o-3),c<=10?(h[f++]=17,h[f++]=c-3,d[17]++):(h[f++]=18,h[f++]=c-11,d[18]++),o-=c;else if(h[f++]=r[s],d[r[s]]++,o--,o<3)for(;o-- >0;)h[f++]=r[s],d[r[s]]++;else for(;o>0;)c=o<6?o:6,c>o-3&&c<o&&(c=o-3),h[f++]=16,h[f++]=c-3,d[16]++,o-=c}return{codes:h.subarray(0,f),freqs:d}};u.RawDeflate.prototype.getLengths_=function(a,e){var t=a.length,i=new u.Heap(2*u.RawDeflate.HUFMAX),r=new Uint8Array(t),s,n,o,l,h;for(l=0;l<t;++l)a[l]>0&&i.push(l,a[l]);if(s=new Array(i.length/2),n=new Uint32Array(i.length/2),s.length===1)return r[i.pop().index]=1,r;for(l=0,h=i.length/2;l<h;++l)s[l]=i.pop(),n[l]=s[l].value;for(o=this.reversePackageMerge_(n,n.length,e),l=0,h=s.length;l<h;++l)r[s[l].index]=o[l];return r};u.RawDeflate.prototype.reversePackageMerge_=function(a,e,t){var i=new Uint16Array(t),r=new Uint8Array(t),s=new Uint8Array(e),n=new Array(t),o=new Array(t),l=new Array(t),h=(1<<t)-e,f=1<<t-1,c,d,v,x,g;function p(m){var _=o[m][l[m]];_===e?(p(m+1),p(m+1)):--s[_],++l[m]}for(i[t-1]=e,d=0;d<t;++d)h<f?r[d]=0:(r[d]=1,h-=f),h<<=1,i[t-2-d]=(i[t-1-d]/2|0)+e;for(i[0]=r[0],n[0]=new Array(i[0]),o[0]=new Array(i[0]),d=1;d<t;++d)i[d]>2*i[d-1]+r[d]&&(i[d]=2*i[d-1]+r[d]),n[d]=new Array(i[d]),o[d]=new Array(i[d]);for(c=0;c<e;++c)s[c]=t;for(v=0;v<i[t-1];++v)n[t-1][v]=a[v],o[t-1][v]=v;for(c=0;c<t;++c)l[c]=0;for(r[t-1]===1&&(--s[0],++l[t-1]),d=t-2;d>=0;--d){for(c=0,x=0,g=l[d+1],v=0;v<i[d];v++)x=n[d+1][g]+n[d+1][g+1],x>a[c]?(n[d][v]=x,o[d][v]=e,g+=2):(n[d][v]=a[c],o[d][v]=c,++c);l[d]=0,r[d]===1&&p(d)}return s};u.RawDeflate.prototype.getCodesFromLengths_=function(a){var e=new Uint16Array(a.length),t=[],i=[],r=0,s,n,o,l;for(s=0,n=a.length;s<n;s++)t[a[s]]=(t[a[s]]|0)+1;for(s=1,n=u.RawDeflate.MaxCodeLength;s<=n;s++)i[s]=r,r+=t[s]|0,r<<=1;for(s=0,n=a.length;s<n;s++)for(r=i[a[s]],i[a[s]]+=1,e[s]=0,o=0,l=a[s];o<l;o++)e[s]=e[s]<<1|r&1,r>>>=1;return e};u.Unzip=function(a,e){e=e||{},this.input=a instanceof Array?new Uint8Array(a):a,this.ip=0,this.eocdrOffset,this.numberOfThisDisk,this.startDisk,this.totalEntriesThisDisk,this.totalEntries,this.centralDirectorySize,this.centralDirectoryOffset,this.commentLength,this.comment,this.fileHeaderList,this.filenameToIndex,this.verify=e.verify||!1,this.password=e.password};u.Unzip.CompressionMethod=u.Zip.CompressionMethod;u.Unzip.FileHeaderSignature=u.Zip.FileHeaderSignature;u.Unzip.LocalFileHeaderSignature=u.Zip.LocalFileHeaderSignature;u.Unzip.CentralDirectorySignature=u.Zip.CentralDirectorySignature;u.Unzip.FileHeader=function(a,e){this.input=a,this.offset=e,this.length,this.version,this.os,this.needVersion,this.flags,this.compression,this.time,this.date,this.crc32,this.compressedSize,this.plainSize,this.fileNameLength,this.extraFieldLength,this.fileCommentLength,this.diskNumberStart,this.internalFileAttributes,this.externalFileAttributes,this.relativeOffset,this.filename,this.extraField,this.comment};u.Unzip.FileHeader.prototype.parse=function(){var a=this.input,e=this.offset;if(a[e++]!==u.Unzip.FileHeaderSignature[0]||a[e++]!==u.Unzip.FileHeaderSignature[1]||a[e++]!==u.Unzip.FileHeaderSignature[2]||a[e++]!==u.Unzip.FileHeaderSignature[3])throw new Error("invalid file header signature");this.version=a[e++],this.os=a[e++],this.needVersion=a[e++]|a[e++]<<8,this.flags=a[e++]|a[e++]<<8,this.compression=a[e++]|a[e++]<<8,this.time=a[e++]|a[e++]<<8,this.date=a[e++]|a[e++]<<8,this.crc32=(a[e++]|a[e++]<<8|a[e++]<<16|a[e++]<<24)>>>0,this.compressedSize=(a[e++]|a[e++]<<8|a[e++]<<16|a[e++]<<24)>>>0,this.plainSize=(a[e++]|a[e++]<<8|a[e++]<<16|a[e++]<<24)>>>0,this.fileNameLength=a[e++]|a[e++]<<8,this.extraFieldLength=a[e++]|a[e++]<<8,this.fileCommentLength=a[e++]|a[e++]<<8,this.diskNumberStart=a[e++]|a[e++]<<8,this.internalFileAttributes=a[e++]|a[e++]<<8,this.externalFileAttributes=a[e++]|a[e++]<<8|a[e++]<<16|a[e++]<<24,this.relativeOffset=(a[e++]|a[e++]<<8|a[e++]<<16|a[e++]<<24)>>>0,this.filename=String.fromCharCode.apply(null,a.subarray(e,e+=this.fileNameLength)),this.extraField=a.subarray(e,e+=this.extraFieldLength),this.comment=a.subarray(e,e+this.fileCommentLength),this.length=e-this.offset};u.Unzip.LocalFileHeader=function(a,e){this.input=a,this.offset=e,this.length,this.needVersion,this.flags,this.compression,this.time,this.date,this.crc32,this.compressedSize,this.plainSize,this.fileNameLength,this.extraFieldLength,this.filename,this.extraField};u.Unzip.LocalFileHeader.Flags=u.Zip.Flags;u.Unzip.LocalFileHeader.prototype.parse=function(){var a=this.input,e=this.offset;if(a[e++]!==u.Unzip.LocalFileHeaderSignature[0]||a[e++]!==u.Unzip.LocalFileHeaderSignature[1]||a[e++]!==u.Unzip.LocalFileHeaderSignature[2]||a[e++]!==u.Unzip.LocalFileHeaderSignature[3])throw new Error("invalid local file header signature");this.needVersion=a[e++]|a[e++]<<8,this.flags=a[e++]|a[e++]<<8,this.compression=a[e++]|a[e++]<<8,this.time=a[e++]|a[e++]<<8,this.date=a[e++]|a[e++]<<8,this.crc32=(a[e++]|a[e++]<<8|a[e++]<<16|a[e++]<<24)>>>0,this.compressedSize=(a[e++]|a[e++]<<8|a[e++]<<16|a[e++]<<24)>>>0,this.plainSize=(a[e++]|a[e++]<<8|a[e++]<<16|a[e++]<<24)>>>0,this.fileNameLength=a[e++]|a[e++]<<8,this.extraFieldLength=a[e++]|a[e++]<<8,this.filename=String.fromCharCode.apply(null,a.subarray(e,e+=this.fileNameLength)),this.extraField=a.subarray(e,e+=this.extraFieldLength),this.length=e-this.offset};u.Unzip.prototype.searchEndOfCentralDirectoryRecord=function(){var a=this.input,e;for(e=a.length-12;e>0;--e)if(a[e]===u.Unzip.CentralDirectorySignature[0]&&a[e+1]===u.Unzip.CentralDirectorySignature[1]&&a[e+2]===u.Unzip.CentralDirectorySignature[2]&&a[e+3]===u.Unzip.CentralDirectorySignature[3]){this.eocdrOffset=e;return}throw new Error("End of Central Directory Record not found")};u.Unzip.prototype.parseEndOfCentralDirectoryRecord=function(){var a=this.input,e;if(this.eocdrOffset||this.searchEndOfCentralDirectoryRecord(),e=this.eocdrOffset,a[e++]!==u.Unzip.CentralDirectorySignature[0]||a[e++]!==u.Unzip.CentralDirectorySignature[1]||a[e++]!==u.Unzip.CentralDirectorySignature[2]||a[e++]!==u.Unzip.CentralDirectorySignature[3])throw new Error("invalid signature");this.numberOfThisDisk=a[e++]|a[e++]<<8,this.startDisk=a[e++]|a[e++]<<8,this.totalEntriesThisDisk=a[e++]|a[e++]<<8,this.totalEntries=a[e++]|a[e++]<<8,this.centralDirectorySize=(a[e++]|a[e++]<<8|a[e++]<<16|a[e++]<<24)>>>0,this.centralDirectoryOffset=(a[e++]|a[e++]<<8|a[e++]<<16|a[e++]<<24)>>>0,this.commentLength=a[e++]|a[e++]<<8,this.comment=a.subarray(e,e+this.commentLength)};u.Unzip.prototype.parseFileHeader=function(){var a=[],e={},t,i,r,s;if(!this.fileHeaderList){for(this.centralDirectoryOffset===void 0&&this.parseEndOfCentralDirectoryRecord(),t=this.centralDirectoryOffset,r=0,s=this.totalEntries;r<s;++r)i=new u.Unzip.FileHeader(this.input,t),i.parse(),t+=i.length,a[r]=i,e[i.filename]=r;if(this.centralDirectorySize<t-this.centralDirectoryOffset)throw new Error("invalid file header size");this.fileHeaderList=a,this.filenameToIndex=e}};u.Unzip.prototype.getFileData=function(a,e){e=e||{};var t=this.input,i=this.fileHeaderList,r,s,n,o,l,h,f,c;if(i||this.parseFileHeader(),i[a]===void 0)throw new Error("wrong index");if(s=i[a].relativeOffset,r=new u.Unzip.LocalFileHeader(this.input,s),r.parse(),s+=r.length,n=r.compressedSize,r.flags&u.Unzip.LocalFileHeader.Flags.ENCRYPT){if(!(e.password||this.password))throw new Error("please set password");for(h=this.createDecryptionKey(e.password||this.password),f=s,c=s+12;f<c;++f)this.decode(h,t[f]);for(s+=12,n-=12,f=s,c=s+n;f<c;++f)t[f]=this.decode(h,t[f])}switch(r.compression){case u.Unzip.CompressionMethod.STORE:o=this.input.subarray(s,s+n);break;case u.Unzip.CompressionMethod.DEFLATE:o=new u.RawInflate(this.input,{index:s,bufferSize:r.plainSize}).decompress();break;default:throw new Error("unknown compression type")}if(this.verify&&(l=u.CRC32.calc(o),r.crc32!==l))throw new Error("wrong crc: file=0x"+r.crc32.toString(16)+", data=0x"+l.toString(16));return o};u.Unzip.prototype.getFilenames=function(){var a=[],e,t,i;for(this.fileHeaderList||this.parseFileHeader(),i=this.fileHeaderList,e=0,t=i.length;e<t;++e)a[e]=i[e].filename;return a};u.Unzip.prototype.decompress=function(a,e){var t;if(this.filenameToIndex||this.parseFileHeader(),t=this.filenameToIndex[a],t===void 0)throw new Error(a+" not found");return this.getFileData(t,e)};u.Unzip.prototype.setPassword=function(a){this.password=a};u.Unzip.prototype.decode=function(a,e){return e^=this.getByte(a),this.updateKeys(a,e),e};u.Unzip.prototype.updateKeys=u.Zip.prototype.updateKeys;u.Unzip.prototype.createDecryptionKey=u.Zip.prototype.createEncryptionKey;u.Unzip.prototype.getByte=u.Zip.prototype.getByte;u.Util.stringToByteArray=function(a){var e=a.split(""),t,i;for(t=0,i=e.length;t<i;t++)e[t]=(e[t].charCodeAt(0)&255)>>>0;return e};u.Adler32=function(a){return typeof a=="string"&&(a=u.Util.stringToByteArray(a)),u.Adler32.update(1,a)};u.Adler32.update=function(a,e){for(var t=a&65535,i=a>>>16&65535,r=e.length,s,n=0;r>0;){s=r>u.Adler32.OptimizationParameter?u.Adler32.OptimizationParameter:r,r-=s;do t+=e[n++],i+=t;while(--s);t%=65521,i%=65521}return(i<<16|t)>>>0};u.Adler32.OptimizationParameter=1024;u.BitStream=function(a,e){if(this.index=typeof e=="number"?e:0,this.bitindex=0,this.buffer=a instanceof Uint8Array?a:new Uint8Array(u.BitStream.DefaultBlockSize),this.buffer.length*2<=this.index)throw new Error("invalid index");this.buffer.length<=this.index&&this.expandBuffer()};u.BitStream.DefaultBlockSize=32768;u.BitStream.prototype.expandBuffer=function(){var a=this.buffer,e=a.length,t=new Uint8Array(e<<1);return t.set(a),this.buffer=t};u.BitStream.prototype.writeBits=function(a,e,t){var i=this.buffer,r=this.index,s=this.bitindex,n=i[r],o;function l(h){return u.BitStream.ReverseTable[h&255]<<24|u.BitStream.ReverseTable[h>>>8&255]<<16|u.BitStream.ReverseTable[h>>>16&255]<<8|u.BitStream.ReverseTable[h>>>24&255]}if(t&&e>1&&(a=e>8?l(a)>>32-e:u.BitStream.ReverseTable[a]>>8-e),e+s<8)n=n<<e|a,s+=e;else for(o=0;o<e;++o)n=n<<1|a>>e-o-1&1,++s===8&&(s=0,i[r++]=u.BitStream.ReverseTable[n],n=0,r===i.length&&(i=this.expandBuffer()));i[r]=n,this.buffer=i,this.bitindex=s,this.index=r};u.BitStream.prototype.finish=function(){var a=this.buffer,e=this.index,t;return this.bitindex>0&&(a[e]<<=8-this.bitindex,a[e]=u.BitStream.ReverseTable[a[e]],e++),t=a.subarray(0,e),t};u.BitStream.ReverseTable=function(a){return a}(function(){var a=new Uint8Array(256),e;for(e=0;e<256;++e)a[e]=function(t){var i=t,r=7;for(t>>>=1;t;t>>>=1)i<<=1,i|=t&1,--r;return(i<<r&255)>>>0}(e);return a}());u.CRC32.calc=function(a,e,t){return u.CRC32.update(a,0,e,t)};u.CRC32.update=function(a,e,t,i){var r=u.CRC32.Table,s=typeof t=="number"?t:t=0,n=typeof i=="number"?i:a.length;for(e^=4294967295,s=n&7;s--;++t)e=e>>>8^r[(e^a[t])&255];for(s=n>>3;s--;t+=8)e=e>>>8^r[(e^a[t])&255],e=e>>>8^r[(e^a[t+1])&255],e=e>>>8^r[(e^a[t+2])&255],e=e>>>8^r[(e^a[t+3])&255],e=e>>>8^r[(e^a[t+4])&255],e=e>>>8^r[(e^a[t+5])&255],e=e>>>8^r[(e^a[t+6])&255],e=e>>>8^r[(e^a[t+7])&255];return(e^4294967295)>>>0};u.CRC32.single=function(a,e){return(u.CRC32.Table[(a^e)&255]^a>>>8)>>>0};u.CRC32.Table_=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];u.CRC32.Table=new Uint32Array(u.CRC32.Table_);u.Deflate=function(a,e){this.input=a,this.output=new Uint8Array(u.Deflate.DefaultBufferSize),this.compressionType=u.Deflate.CompressionType.DYNAMIC,this.rawDeflate;var t={},i;(e||!(e={}))&&typeof e.compressionType=="number"&&(this.compressionType=e.compressionType);for(i in e)t[i]=e[i];t.outputBuffer=this.output,this.rawDeflate=new u.RawDeflate(this.input,t)};u.Deflate.DefaultBufferSize=32768;u.Deflate.CompressionType=u.RawDeflate.CompressionType;u.Deflate.compress=function(a,e){return new u.Deflate(a,e).compress()};u.Deflate.prototype.compress=function(){var a,e,t,i,r,s,n,o,l,h=0;switch(l=this.output,a=u.CompressionMethod.DEFLATE,a){case u.CompressionMethod.DEFLATE:e=Math.LOG2E*Math.log(u.RawDeflate.WindowSize)-8;break;default:throw new Error("invalid compression method")}switch(t=e<<4|a,l[h++]=t,s=0,a){case u.CompressionMethod.DEFLATE:switch(this.compressionType){case u.Deflate.CompressionType.NONE:n=0;break;case u.Deflate.CompressionType.FIXED:n=1;break;case u.Deflate.CompressionType.DYNAMIC:n=2;break;default:throw new Error("unsupported compression type")}break;default:throw new Error("invalid compression method")}return i=n<<6|s<<5,r=31-(t*256+i)%31,i|=r,l[h++]=i,o=u.Adler32(this.input),this.rawDeflate.op=h,l=this.rawDeflate.compress(),h=l.length,l=new Uint8Array(l.buffer),l.length<=h+4&&(this.output=new Uint8Array(l.length+4),this.output.set(l),l=this.output),l=l.subarray(0,h+4),l[h++]=o>>24&255,l[h++]=o>>16&255,l[h++]=o>>8&255,l[h++]=o&255,l};let Fi=!1;const qe=0,We=1,Ge=2;class M{static load(e,t){return new Promise(function(i,r){var s=new XMLHttpRequest,n=t.sendData,o=t.method||(n?"POST":"GET"),l=t.range,h=t.responseType,f=t.contentType,c=t.mimeType,d=t.headers;Fi||navigator.vendor.indexOf("Apple")==0&&/\sSafari\//.test(navigator.userAgent);var v=t.withCredentials,x,g,p,m;if(s.open(o,e),l){var _=l.size?l.start+l.size-1:"";s.setRequestHeader("Range","bytes="+l.start+"-"+_)}if(f&&s.setRequestHeader("Content-Type",f),c&&s.overrideMimeType(c),h&&(s.responseType=h),d)for(x=Object.keys(d),m=0;m<x.length;m++)g=x[m],p=d[g],s.setRequestHeader(g,p);v===!0&&(s.withCredentials=!0),s.timeout=3e4,s.onload=function(b){s.status==0||s.status>=200&&s.status<=300?l&&s.status!=206?w("ERROR: range-byte header was ignored for url: "+e):i(s.response,s):s.status===416?w("Unsatisfiable range"):w("Error accessing resource: "+s.status)},s.onerror=function(b){w("Error accessing resource: "+e+" Status: "+s.status)},s.ontimeout=function(b){w("Timed out")},s.onabort=function(b){console.log("Aborted"),r(new igv.AbortLoad)};try{s.send(n)}catch(b){r(b)}function w(b){if(r)r(b);else throw Error(b)}})}static loadArrayBuffer(e,t){return t===void 0&&(t={}),t.responseType="arraybuffer",M.load(e,t)}static loadJson(e,t){var i=t.method||(t.sendData?"POST":"GET");return i=="POST"&&(t.contentType="application/json"),new Promise(function(r,s){M.load(e,t).then(function(n){r(n&&JSON.parse(n))}).catch(s)})}static loadString(e,t){var i,r,s;return t===void 0&&(t={}),s=e.indexOf("?"),r=s>0?e.substring(0,s):e,t.bgz?i=Ge:r.endsWith(".gz")?i=We:i=qe,i===qe?(t.mimeType="text/plain; charset=x-user-defined",M.load(e,t)):(t.responseType="arraybuffer",new Promise(function(n,o){M.load(e,t).then(function(l){var h=M.arrayBufferToString(l,i);n(h)}).catch(o)}))}static loadStringFromFile(e,t){return new Promise(function(i,r){var s=new FileReader;t.range,s.onload=function(n){var o,l;t.bgz?o=Ge:e.name.endsWith(".gz")?o=We:o=qe,l=M.arrayBufferToString(s.result,o),i(l,e)},s.onerror=function(n){console.log("reject uploading local file "+e.name),r(null,s)},s.readAsArrayBuffer(e)})}static isCrossDomain(e){var t=window.location.origin;return!e.startsWith(t)}static arrayBufferToString(e,t){var i,r;t===We?(r=new u.Gunzip(new Uint8Array(e)),i=r.decompress()):t===Ge?i=new Uint8Array(Jt(e)):i=new Uint8Array(e);for(var s="",n=0,o=i.length;n<o;n++)s=s+String.fromCharCode(i[n]);return s}}let Jt=function(a,e){var t=[],i=[0],r=0;e=e||a.byteLength-18;const s=[];for(;i[0]<e;){var n=new Uint8Array(a,i[0],18),o=n[11]<<8|n[10];n[12],n[13],n[15]<<8|n[14];var l=n[17]<<8|n[16]+1;s.push(l);var h=12+o+i[0],f=a.byteLength-h;if(f<l+8)break;var c=$t(a,h,f,i);i[0]+=8,r+=c.byteLength,t.push(c)}if(t.length==1)return t.blockLengths=s,t[0];for(var d=new Uint8Array(r),v=0,x=0;x<t.length;++x){var g=new Uint8Array(t[x]);G(g,0,d,v,g.length),v+=g.length}return d.buffer.blockLengths=s,d.buffer};class $e{constructor(e,t,i){this.path=e.url,this.contentLength=t,this.bufferSize=i||512e3,this.range={start:-1,size:-1},this.config=e}dataViewForRange(e,t){var i=this;return new Promise(function(r,s){var n=i.data&&i.range.start<=e.start&&i.range.start+i.range.size>=e.start+e.size,o,l;n?h(i,e,t):(o=Math.max(i.bufferSize,e.size),i.contentLength>0&&e.start+o>i.contentLength?l={start:e.start}:l={start:e.start,size:o},M.loadArrayBuffer(i.path,Object.assign(i.config,{range:l})).then(function(f){i.data=f,i.range=l,h(i,e,t)}).catch(s));function h(f,c,d){var v=f.data.byteLength,x=c.start-f.range.start,g=d?new Uint8Array(f.data,x,v-x):new DataView(f.data,x,v-x);r(g)}})}}class he{constructor(e,t){this.reader=new Ui(e),this.bufferedReader=new $e(e),t?this.create_feature=t:this.create_feature=he.createFeature}async getFeatures(e,t,i,r,s){if(this.st=new Date().getTime(),this.features&&r)return this.features;const n=await this.reader.getZoomHeaders(),o=this.reader,l=this.bufferedReader,h=s.bpPerPixel,f=he.zoomLevelForScale(h,n);let c;f&&o.type==="BigWig"?(c=f.indexOffset,this.decodeFunction=he.decodeZoomData):(c=o.header.fullIndexOffset,o.type==="BigWig"?this.decodeFunction=he.decodeWigData:this.decodeFunction=this.decodeBedData);const d=await o.loadRPTree(c),v=this.reader.chromTree.dictionary[e];if(v===void 0){const x=Object.keys(this.reader.chromTree.dictionary),g=x.slice(0,3).join(", ")+(x.length>3?", ...":"");throw new Error(`Chromosome '${e}' not found in BigWig file. Expected one of ${g}`)}else{const x=await d.findLeafItemsOverlapping(v,t,i);if(!x||x.length==0)return[];const g=await Promise.all(x.map(async m=>{const _=[],w=await l.dataViewForRange({start:m.dataOffset,size:m.dataSize},!0),k=new u.Inflate(w).decompress();return this.decodeFunction(new DataView(k.buffer),e,v,t,i,_),_}));new Date().getTime();let p=g[0];if(g.length>1)for(let m=1;m<g.length;m++)p=p.concat(g[m]);return p.sort(function(m,_){return m.start-_.start}),this.features=p,p}}getDefaultRange(){if(this.reader.totalSummary!=null)return this.reader.totalSummary.defaultRange}static zoomLevelForScale(e,t){let i=null,r,s;for(r=0;r<t.length;r++)if(s=t[r],s.reductionLevel>e){i=s;break}return i==null&&(i=t[t.length-1]),i&&i.reductionLevel<4*e?i:null}static decodeWigData(e,t,i,r,s,n){let o=new ae(e),l=o.getInt(),h=o.getInt(),f=o.getInt(),c=o.getInt(),d=o.getInt(),v=o.getByte();o.getByte();let x=o.getUShort(),g;if(l===i)for(;x-- >0;){switch(v){case 1:h=o.getInt(),f=o.getInt(),g=o.getFloat();break;case 2:h=o.getInt(),g=o.getFloat(),f=h+d;break;case 3:g=o.getFloat(),f=h+d,h+=c;break}if(h>=s)break;f>r&&Number.isFinite(g)&&n.push({chr:t,start:h,end:f,value:g})}}static decodeZoomData(e,t,i,r,s,n){let o=new ae(e),l=8*4;for(;o.remLength()>=l;)if(o.getInt()===i){const f=o.getInt(),c=o.getInt(),d=o.getInt(),v=o.getFloat(),x=o.getFloat(),g=o.getFloat();o.getFloat();const p=d==0?0:g/d;if(f>=s&&f<1e9)break;c>r&&Number.isFinite(p)&&n.push({chr:t,start:f,end:c,value:p,minVal:v,maxVal:x})}}decodeBedData(e,t,i,r,s,n){for(var o=new ae(e),l=3*4+1,h,f,c,d,v,x;o.remLength()>=l;)h=o.getInt(),h==i&&(f=o.getInt(),c=o.getInt(),d=o.getString(),x={chr:t,start:f,end:c},f<s&&c>=r&&(n.push(x),v=d.split("	"),this.create_feature(v,x)))}static createFeature(e,t){if(e.length>0&&(t.name=e[0]),e.length>1&&(t.score=parseFloat(e[1])),e.length>2&&(t.strand=e[2]),e.length>3&&(t.cdStart=parseInt(e[3])),e.length>4&&(t.cdEnd=parseInt(e[4])),e.length>5,e.length>8){exonCount=parseInt(e[6]),exonSizes=e[7].split(","),exonStarts=e[8].split(","),exons=[];for(var i=0;i<exonCount;i++)eStart=start+parseInt(exonStarts[i]),eEnd=eStart+parseInt(exonSizes[i]),exons.push({start:eStart,end:eEnd});t.exons=exons}}}const Mi=2291137574,Bi=654085990,Pi=2273964779,Oi=3958540679,Rt=64;class Ui{constructor(e){this.path=e.url,this.headPath=e.headURL||this.path,this.rpTreeCache={},this.config=JSON.parse(JSON.stringify(e))}async getZoomHeaders(){return this.zoomLevelHeaders?this.zoomLevelHeaders:(await this.loadHeader(),this.zoomLevelHeaders)}async loadHeader(){const e=await M.loadArrayBuffer(this.path,Object.assign(this.config,{range:{start:0,size:Rt}}));if(!e)return;this.littleEndian=!0;const t=new ae(new DataView(e)),i=t.getUInt();return i===Mi?this.type="BigWig":i==Pi?this.type="BigBed":(this.littleEndian=!1,t.littleEndian=!1,t.position=0,i===Bi?this.type="BigWig":i==Oi&&(this.type="BigBed")),this.header={},this.header.bwVersion=t.getUShort(),this.header.nZoomLevels=t.getUShort(),this.header.chromTreeOffset=t.getLong(),this.header.fullDataOffset=t.getLong(),this.header.fullIndexOffset=t.getLong(),this.header.fieldCount=t.getUShort(),this.header.definedFieldCount=t.getUShort(),this.header.autoSqlOffset=t.getLong(),this.header.totalSummaryOffset=t.getLong(),this.header.uncompressBuffSize=t.getInt(),this.header.reserved=t.getLong(),await this.loadZoomHeadersAndChrTree()}async loadZoomHeadersAndChrTree(){const e=Rt,t={start:e,size:this.header.fullDataOffset-e+5},i=await M.loadArrayBuffer(this.path,Object.assign(this.config,{range:t}));let r=this.header.nZoomLevels,s=new ae(new DataView(i)),n,o,l;for(this.zoomLevelHeaders=[],this.firstZoomDataOffset=Number.MAX_VALUE,n=0;n<r;n++)o=r-n,l=new Ni(o,s),this.firstZoomDataOffset=Math.min(l.dataOffset,this.firstZoomDataOffset),this.zoomLevelHeaders.push(l);this.header.autoSqlOffset>0&&(s.position=this.header.autoSqlOffset-e,this.autoSql=s.getString()),this.header.totalSummaryOffset>0&&(s.position=this.header.totalSummaryOffset-e,this.totalSummary=new Vi(s)),this.header.chromTreeOffset>0?(s.position=this.header.chromTreeOffset-e,this.chromTree=new Zi(s,e)):console.error("No chrom tree found in BW header",JSON.stringify(this.header)),s.position=this.header.fullDataOffset-e,this.dataCount=s.getInt()}async loadRPTree(e){let t=this.rpTreeCache[e];return!t&&t.rootNode&&(t=new Fe(e,this.contentLength,this.config,this.littleEndian),this.rpTreeCache[e]=t,await t.load()),t}}class Ni{constructor(e,t){this.index=e,this.reductionLevel=t.getInt(),this.reserved=t.getInt(),this.dataOffset=t.getLong(),this.indexOffset=t.getLong()}}const Hi=48,qi=32,Wi=24,Lt=512e3;class Fe{constructor(e,t,i,r){this.config=i,this.filesize=t,this.fileOffset=e,this.path=i.url,this.littleEndian=r}async load(){const e=this.fileOffset+Hi,t=new $e(this.config,this.filesize,Lt),i=await this.readNode(e,t);return this.rootNode=i,this}async readNode(e,t){const i=await t.dataViewForRange({start:e,size:4},!1),r=new ae(i,this.littleEndian),n=r.getByte()===1;r.getByte();const o=r.getUShort();e+=4;const l=o*(n?qi:Wi),h={start:e,size:l},f=await t.dataViewForRange(h,!1),c=new Array(o),d=new ae(f);if(n){for(let v=0;v<o;v++){const x={isLeaf:!0,startChrom:d.getInt(),startBase:d.getInt(),endChrom:d.getInt(),endBase:d.getInt(),dataOffset:d.getLong(),dataSize:d.getLong()};c[v]=x}return new Ft(c)}else{for(let v=0;v<o;v++){const x={isLeaf:!1,startChrom:d.getInt(),startBase:d.getInt(),endChrom:d.getInt(),endBase:d.getInt(),childOffset:d.getLong()};c[v]=x}return new Ft(c)}}async findLeafItemsOverlapping(e,t,i){const r=[],s=new $e(this.config,this.filesize,Lt),n=async o=>(Fe.overlaps(o,e,t,i)&&await Promise.all(o.items.map(async l=>{if(Fe.overlaps(l,e,t,i))if(l.isLeaf)r.push(l);else if(l.childNode)await n(l.childNode);else{const h=await this.readNode(l.childOffset,s);l.childNode=h,await n(h,l.childOffset)}})),r);return await n(this.rootNode)}static overlaps(e,t,i,r){return e?(t>e.startChrom||t==e.startChrom&&r>=e.startBase)&&(t<e.endChrom||t==e.endChrom&&i<e.endBase):(console.log("null item"),!1)}}class Ft{constructor(e){this.items=e;let t=Number.MAX_VALUE,i=0,r=Number.MAX_VALUE,s=0,n,o;for(n=0;n<e.length;n++)o=e[n],t=Math.min(t,o.startChrom),i=Math.max(i,o.endChrom),r=Math.min(r,o.startBase),s=Math.max(s,o.endBase);this.startChrom=t,this.endChrom=i,this.startBase=r,this.endBase=s}}class ae{constructor(e,t){this.littleEndian=t||!0,this.position=0,this.view=e,this.length=e.byteLength}available(){return this.length-this.position}remLength(){return this.length-this.position}hasNext(){return this.position<this.length-1}getByte(){var e=this.view.getUint8(this.position,this.littleEndian);return this.position++,e}getShort(){var e=this.view.getInt16(this.position,this.littleEndian);return this.position+=2,e}getUShort(){var e=this.view.getUint16(this.position,this.littleEndian);return this.position+=2,e}getInt(){var e=this.view.getInt32(this.position,this.littleEndian);return this.position+=4,e}getUInt(){var e=this.view.getUint32(this.position,this.littleEndian);return this.position+=4,e}getLong(){var e=[];e[0]=this.view.getUint8(this.position),e[1]=this.view.getUint8(this.position+1),e[2]=this.view.getUint8(this.position+2),e[3]=this.view.getUint8(this.position+3),e[4]=this.view.getUint8(this.position+4),e[5]=this.view.getUint8(this.position+5),e[6]=this.view.getUint8(this.position+6),e[7]=this.view.getUint8(this.position+7);var t=0;if(this.littleEndian)for(var i=e.length-1;i>=0;i--)t=t*256+e[i];else for(var i=0;i<e.length;i++)t=t*256+e[i];return this.position+=8,t}getString(e){for(var t="",i;(i=this.view.getUint8(this.position++))!=0&&(t+=String.fromCharCode(i),!(e&&t.length==e)););return t}getFixedLengthString(e){var t="",i,r;for(i=0;i<e;i++)r=this.view.getUint8(this.position++),r>0&&(t+=String.fromCharCode(r));return t}getFixedLengthTrimmedString(e){var t="",i,r;for(i=0;i<e;i++)r=this.view.getUint8(this.position++),r>32&&(t+=String.fromCharCode(r));return t}getFloat(){var e=this.view.getFloat32(this.position,this.littleEndian);return this.position+=4,e}getDouble(){var e=this.view.getFloat64(this.position,this.littleEndian);return this.position+=8,e}skip(e){return this.position+=e,this.position}getVPointer(){var e=this.position,t=this.view.getUint8(e+1)<<8|this.view.getUint8(e),i=(this.view.getUint8(e+6)&255)*4294967296,r=(this.view.getUint8(e+5)&255)*16777216,s=(this.view.getUint8(e+4)&255)*65536,n=(this.view.getUint8(e+3)&255)*256,o=this.view.getUint8(e+2)&255,l=i+r+s+n+o;return this.position+=8,new Gi(l,t)}}class Gi{constructor(e,t){this.block=e,this.offset=t}isLessThan(e){return this.block<e.block||this.block===e.block&&this.offset<e.offset}isGreaterThan(e){return this.block>e.block||this.block===e.block&&this.offset>e.offset}print(){return""+this.block+":"+this.offset}}class Vi{constructor(e){e?(this.basesCovered=e.getLong(),this.minVal=e.getDouble(),this.maxVal=e.getDouble(),this.sumData=e.getDouble(),this.sumSquares=e.getDouble(),this.computeStats()):(this.basesCovered=0,this.minVal=0,this.maxVal=0,this.sumData=0,this.sumSquares=0,this.mean=0,this.stddev=0)}computeStats(){var e=this.basesCovered;e>0&&(this.mean=this.sumData/e,this.stddev=Math.sqrt(this.sumSquares/(e-1)),this.minVal<0&&this.mean-2*this.stddev,this.maxVal>0&&this.mean+2*this.stddev,this.defaultRange={min:0,max:this.mean+3*this.stddev})}updateStats(e){this.basesCovered+=e.count,this.sumData+=e.sumData,this.sumSquares+=sumSquares,this.minVal=MIN(_minVal,min),this.maxVal=MAX(_maxVal,max),computeStats.call(this)}}class Zi{constructor(e,t){this.header={},this.header.magic=e.getInt(),this.header.blockSize=e.getInt(),this.header.keySize=e.getInt(),this.header.valSize=e.getInt(),this.header.itemCount=e.getLong(),this.header.reserved=e.getLong(),this.dictionary={},i(e,-1,this.header.keySize,this.dictionary),8+this.header.keySize;function i(r,s,n,o){s>=0&&(r.position=s);var l=r.getByte();r.getByte();var h=r.getUShort(),f,c,d,v,x,g;if(l==1)for(f=0;f<h;f++)c=r.getFixedLengthTrimmedString(n),d=r.getInt(),r.getInt(),o[c]=d;else for(f=0;f<h;f++)c=r.getFixedLengthTrimmedString(n),v=r.getLong(),x=v-t,g=r.position,i(r,x,n,o),r.position=g}}}let ji={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};class Je{static addAlphaToRGB(e,t){return e.startsWith("rgb")?e.replace("rgb","rgba").replace(")",", "+t+")"):(console.log(e+" is not an rgb style string"),e)}static presentAlert(e,t){let i=$("<div>").css({position:"absolute","background-color":"white"}).attr("class","mlv-alert").appendTo(e);$("<div>").css({display:"flex","justify-content":"center"}).appendTo(i).append($('<i class="fas fa-exclamation-circle"></i>').css({color:"red","font-size":"16px","text-align":"center"})),i.append($("<div>"+t+"</div>").css({color:"red","font-size":"14px","text-align":"center"}));let s=Math.round(e.width()/2-i.width()/2),n=Math.round(e.height()/2-i.height()/2);i.css({left:s+"px",top:n+"px"})}static spinner(e){var t;return t=$('<i class="fa fa-lg fa-spinner fa-spin igv-spinner">').css({position:"absolute",top:"50%",left:"50%"}),e&&t.css("font-size",e),t[0]}static getSpinnerObjectWithParentElement(e){return e.find("div.igv-spinner-container")}static startSpinnerAtParentElement(e){e.children(".fa-spinner").show()}static stopSpinnerAtParentElement(e){e.children(".fa-spinner").hide()}static parseUri(e){for(var t=ji,i=t.parser.loose.exec(e),r={},s=14;s--;)r[t.key[s]]=i[s]||"";return r[t.q.name]={},r[t.key[12]].replace(t.q.parser,function(n,o,l){o&&(r[t.q.name][o]=l)}),r}static domElementRectAsString(e){return" x "+e.clientLeft+" y "+e.clientTop+" w "+e.clientWidth+" h "+e.clientHeight}static isNumber(e){return e===""||e===void 0?!1:!isNaN(parseFloat(e))&&isFinite(e)}static guid(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}static random(e,t){return Math.random()*(t-e)+e}static numberFormatter(e){var t=String(e).split(/[.,]/),i=",",r=".";return t[0].split("").reverse().reduce(function(s,n,o){return o%3===0?s+i+n:s+n}).split("").reverse().join("")+(t[1]?r+t[1]:"")}static numberUnFormatter(e){return e.split(",").join().replace(",","","g")}static translateMouseCoordinates(e,t){var i=$.event.fix(e),r=i.pageX-$(t).offset().left,s=i.pageY-$(t).offset().top;return{x:r,y:s}}static formatPopoverText(e){var t='<table class="igv-popover-table">';return e.forEach(function(i){i.name?t+='<tr><td class="igv-popover-td"><div class="igv-popoverNameValue"><span class="igv-popoverName">'+i.name+'</span><span class="igv-popoverValue">'+i.value+"</span></div></td></tr>":t+="<tr><td>"+i.toString()+"</td></tr>"}),t+="</table>",t}static throttle(e,t,i){t||(t=200);var r,s;return function(){var n=i||this,o=+new Date,l=arguments;r&&o<r+t?(clearTimeout(s),s=setTimeout(function(){r=o,e.apply(n,l)},t)):(r=o,e.apply(n,l))}}static splitStringRespectingQuotes(e,t){var i=[],r=e.length,s,n=0,o=!1,l;if(r>0)for(i[n]=e.charAt(0),s=1;s<r;s++)l=e.charAt(s),l==='"'?o=!o:!o&&l===t?(n++,i[n]=""):i[n]+=l;return i}static addAjaxExtensions(){$.ajaxTransport("+binary",function(e,t,i){return{send:function(r,s){var n=new XMLHttpRequest,o=e.url,l=e.type,h="arraybuffer";if(e.data,n.addEventListener("load",function(){var c={};c[e.dataType]=n.response,s(n.status,n.statusText,c,n.getAllResponseHeaders())}),n.open(l,o),n.responseType=h,e.headers)for(var f in e.headers)e.headers.hasOwnProperty(f)&&n.setRequestHeader(f,e.headers[f])},abort:function(){i.abort()}}})}static isStringOrNumber(e){return!!(e.substring||e.toFixed)}static constrainBBox(e,t){var i,r,s={},n={};return n.left=n.top=0,n.right=t.outerWidth(),n.bottom=t.outerHeight(),r=e.offset(),s.left=r.left-t.offset().left,s.top=r.top-t.offset().top,s.right=s.left+e.outerWidth(),s.bottom=s.top+e.outerHeight(),i=s.bottom-n.bottom,i>0&&(r.top-=i,s.top-=i,s.bottom-=i,i=s.top-n.top,i<0&&(r.top-=i)),r}static log(e){igv.enableLogging&&console&&console.log&&console.log(e)}}const Ki=21578050,Xi=21578324;let zt=function(a,e,t){return new Promise(function(i,r){M.loadArrayBuffer(a,{headers:e.headers,withCredentials:e.withCredentials}).then(function(s){var n=[],o,l,h,f,c,d=Number.MAX_VALUE,v=0,x,g,p,m,_,w,b,k,y;if(!s){i(null);return}if(t){var S=new u.Gunzip(new Uint8Array(s));s=S.decompress().buffer}if(c=new ae(new DataView(s)),o=c.getInt(),o===Ki||t&&o===Xi){if(f=c.getInt(),t)for(c.getInt(),c.getInt(),c.getInt(),c.getInt(),c.getInt(),c.getInt(),c.getInt(),y={},b=0;b<f;b++){var A=c.getString();y[A]=b}for(k=0;k<f;++k){for(x={},g=[],l=c.getInt(),w=0;w<l;++w)if(p=c.getInt(),p==37450)C=c.getInt(),m=c.getVPointer(),_=c.getVPointer(),c.getLong(),c.getLong();else{x[p]=[];var C=c.getInt();for(b=0;b<C;b++)m=c.getVPointer(),_=c.getVPointer(),m&&_&&(m.block<d&&(d=m.block),_.block>v&&(v=_.block),x[p].push([m,_]))}for(h=c.getInt(),b=0;b<h;b++)m=c.getVPointer(),g.push(m);l>0&&(n[k]={binIndex:x,linearIndex:g})}}else throw new Error(a+" is not a "+(t?"tabix":"bai")+" file");i(new it(n,d,v,y,t))}).catch(r)})};class it{constructor(e,t,i,r,s){this.firstAlignmentBlock=t,this.indices=e,this.lastAlignmentBlock=i,this.sequenceIndexMap=r,this.tabix=s}getBlocksForRange(e,t,i){const r=this.indices[e];if(!r)return[];const s=r.linearIndex,n=s.length,o=Math.min(t>>14,n-1),l=Math.min(i>>14,n-1);return[{minv:s[o],maxv:s[l],bin:1}]}blocksForRange(e,t,i){var r=this,s=r.indices[e],n,o,l,h,f,c,d,v;if(s){for(n=it.reg2bins(t,i),o=[],n.forEach(function(x){if(s.binIndex[x])for(var g=s.binIndex[x],p=g.length,m=0;m<p;++m){var _=g[m][0],w=g[m][1];o.push({minv:_,maxv:w,bin:x})}}),l=s.linearIndex.length,h=null,f=Math.min(t>>14,l-1),c=Math.min(i>>14,l-1),v=f;v<=c;++v)d=s.linearIndex[v],d&&(!h||d.isLessThan(h))&&(h=d);return Yi(o,h)}else return[]}static reg2bins(e,t){var i,r=[];for(t>=1<<29&&(t=1<<29),--t,r.push(0),i=1+(e>>26);i<=1+(t>>26);++i)r.push(i);for(i=9+(e>>23);i<=9+(t>>23);++i)r.push(i);for(i=73+(e>>20);i<=73+(t>>20);++i)r.push(i);for(i=585+(e>>17);i<=585+(t>>17);++i)r.push(i);for(i=4681+(e>>14);i<=4681+(t>>14);++i)r.push(i);return r}}function Yi(a,e){var t=[],i=null;return a.length===0?a:(a.sort(function(r,s){var n=r.minv.block-s.minv.block;return n!=0?n:r.minv.offset-s.minv.offset}),a.forEach(function(r){(!e||r.maxv.isGreaterThan(e))&&(i===null?(t.push(r),i=r):r.minv.block-i.maxv.block<65e3?r.maxv.isGreaterThan(i.maxv)&&(i.maxv=r.maxv):(t.push(r),i=r))}),t)}var Mt=["=","A","C","x","G","x","x","x","T","x","x","x","x","x","x","N"],ei=["M","I","D","N","S","H","P","=","X","?","?","?","?","?","?","?"],rt=16,ti=32,Qi=64,$i=128,Ji=4,zi=8,er=1,tr=2,ir=256,rr=2048,ar=512,sr=1024;const Me=65536,nr=100,or=2500,Bt=2500;class lr{constructor(e){this.bamPath=e.url,this.baiPath=e.indexURL||this.bamPath+".bai",this.headPath=e.headURL||this.bamPath,this.alignments=[],this.features=[],this.alignmentBuffer=new SharedArrayBuffer(2e7),this.alignments=new Int32Array(this.alignmentBuffer),this.pointer=0,this.config=e,this.fragmentThreshold=50}async getAlignments(e,t,i){if(this.store&&e===this.store[0]&&t>=this.store[1]&&i<=this.store[2])return this.features;this.index||await this.readHeader(),this.pointer=0;const r=this.chrToIndex[e],s=this.index.blocksForRange(r,t,i);return s?s.length===0?[]:(await Promise.all(s.map(async n=>{var o=n.minv.block,l=n.maxv.block+Me,h={start:o,size:l-o+1};const f=await M.loadArrayBuffer(this.bamPath,{headers:this.config.headers,range:h,withCredentials:this.config.withCredentials});var c=new Uint8Array(new Be(f));this.addAlignments(c,n.minv.offset,t,i,r)})),this.store=[e,t,i],this.calculateCategories(),this.features):[]}setCategories(e,t){this.catData=e,this.catNames=t}setFilter(e,t){this.filter=e,this.localFilter=t}calculateFragmentSize(){const e=this.store[1],t=this.store[2]-this.store[1];this.features=[];for(let i=0;i<3;i++)this.features.push(new Uint16Array(t));for(let i=0;i<this.pointer;i+=4){let r=this.alignments[i]-e;const s=r+this.alignments[i+1];r<0&&(r=0);let n=this.features[0];if(this.alignments[i+3]>this.fragmentThreshold&&(n=this.features[1]),s>r)for(let o=r;o<s;o++)n[o]++,this.features[2][o]++;else for(let o=s;o<r;o++)n[o]++,this.features[2][o]++}this.features.store=this.store}calculateCategories(){const e=this.catNames.length,t=this.store[1],i=this.store[2]-this.store[1];this.features=[];for(let r=0;r<e;r++)this.features.push(new Uint16Array(i));if(this.cut_window=0,performance.now(),this.cut_window){const r=this.cut_window;for(let s=0;s<this.pointer;s+=4){let n=this.alignments[s]-t,o=n-r;const l=n+r;o<0&&(o=0);const h=this.alignments[s+2];if(this.filter&&this.filter[h]!==0&&this.filter[h]!==this.localFilter[h])continue;const f=this.features[this.catData[h]];for(let c=o;c<l;c++)f[c]++}}else for(let r=0;r<this.pointer;r+=4){if(this.size_filter_on&&this.alignments[r+3]>this.size_filter)continue;let s=this.alignments[r]-t;const n=s+this.alignments[r+1];s<0&&(s=0);const o=this.alignments[r+2];if(this.filter&&this.filter[o]!==0&&this.filter[o]!==this.localFilter[o])continue;const l=this.features[this.catData[o]];if(n>s)for(let h=s;h<n;h++)l[h]++;else for(let h=n;h<s;h++)l[h]++}this.features.store=this.store}getIdsInRange(e){const t=Math.round(e.start),i=Math.round(e.end),r=this.alignments,s=new Set;for(let n=0;n<this.alignments.length;n+=3)if(!(r[n]<t)){if(r[n]>i)break;s.add(r[n+2])}return s}addAlignments(e,t,i,r,s){for(var n,o,l,h,f,c,d,v,x,g,p,m,_,w;;){if(n=L(e,t),o=t+n+4,o>e.length||(h=L(e,t+4),f=L(e,t+8),h<0))return;if(h>s||f>r)return;if(h<s)continue;c=L(e,t+12),d=c&255,v=L(e,t+16);const S=(v&4294901760)>>16;g=v&65535;const A=!(S&rt);p=L(e,t+20);const C=Math.abs(L(e,t+32));for(_=t+36+d,m=0,x=0;x<g;++x){var b=L(e,_),k=b>>4,y=ei[b&15];(y=="M"||y=="EQ"||y=="X"||y=="D"||y=="N"||y=="=")&&(m+=k),_+=4}if(f+m<i){t=o;continue}A||(f=f+m,m=-m),this.alignments[this.pointer++]=f,this.alignments[this.pointer++]=m,w=p+1>>1,_+=w,_+=p,l=ai(new Uint8Array(e.buffer.slice(_,o))),this.catIndex[l.CB],this.alignments[this.pointer++]=this.catIndex[l.CB],this.alignments[this.pointer++]=Math.abs(C),_+=o,t=o}}async readHeader(){var e=this,i=(await ze(this)).firstAlignmentBlock+Me;const r=await M.loadArrayBuffer(e.bamPath,{headers:e.config.headers,range:{start:0,size:i},withCredentials:e.config.withCredentials});var s=new Be(r,i),n=new Uint8Array(s);L(n,0);for(var o=L(n,4),l="",h=0;h<o;++h)l+=String.fromCharCode(n[h+8]);var f=L(n,o+8),c=o+12;e.chrToIndex={},e.indexToChr=[];for(var h=0;h<f;++h){for(var d=L(n,c),v="",x=0;x<d-1;++x)v+=String.fromCharCode(n[c+4+x]);L(n,c+d+4),e.chrToIndex[v]=h,e.indexToChr.push(v),c=c+8+d}}}class hr{constructor(e,t){this.config=e,this.parent=t,this.ac_class=gr,t.ac_class&&(this.ac_class=parent_class),this.filter=e.filter||new pr,this.bamPath=e.url,this.baiPath=e.indexURL||this.bamPath+".bai",this.headPath=e.headURL||this.bamPath,this.samplingWindowSize=e.samplingWindowSize===void 0?nr:e.samplingWindowSize,this.samplingDepth=e.samplingDepth===void 0?or:e.samplingDepth,this.samplingDepth>Bt&&(igv.log("Warning: attempt to set sampling depth > maximum value of 2500"),this.samplingDepth=Bt),e.viewAsPairs?this.pairsSupported=!0:this.pairsSupported=e.pairsSupported===void 0?!0:e.pairsSupported}readAlignments(e,t,i){var r=this;return new Promise(function(o,l){fr(r).then(function(h){var f=h[e],c=new r.ac_class(e,t,i,r.samplingWindowSize,r.samplingDepth,r.pairsSupported,r.parent);f===void 0?o(c):ze(r).then(function(d){var v=d.blocksForRange(f,t,i),x=[];if(!v){o(null),l("Error reading bam index");return}if(v.length===0){o(c);return}v.forEach(function(g){x.push(new Promise(function(p,m){var _=g.minv.block,w=g.maxv.block+Me,b={start:_,size:w-_+1};M.loadArrayBuffer(r.bamPath,{headers:r.config.headers,range:b,withCredentials:r.config.withCredentials}).then(function(k){var y=new Uint8Array(new Be(k));s(y,g.minv.offset,c,t,i,f,r.filter),p(c)}).catch(function(k){m(k)})}))}),Promise.all(x).then(function(g){c.finish(),o(c)}).catch(function(g){l(g)})}).catch(l)}).catch(l)});function s(o,l,h,f,c,d,v){for(var x,g,p,m,_,w,b,k,y,S,A,C,D,E,O,X,U,q,_e,ue,oe,V,Y,le;;){if(x=L(o,l),g=l+x+4,g>o.length||(p=new dr,_=L(o,l+4),w=L(o,l+8),_<0))return;if(_>d||w>c)return;if(_<d)continue;for(b=L(o,l+12),k=(b&65280)>>8,y=b&255,S=L(o,l+16),A=(S&4294901760)>>16,C=S&65535,p.flags=A,p.strand=!(A&rt),D=L(o,l+20),E=L(o,l+24),O=L(o,l+28),p.fragmentLength=L(o,l+32),X="",U=0;U<y-1;++U)X+=String.fromCharCode(o[l+36+U]);for(q=l+36+y,_e=0,ue="",V=[],oe=0;oe<C;++oe){var de=L(o,q),Q=de>>4,N=ei[de&15];(N=="M"||N=="EQ"||N=="X"||N=="D"||N=="N"||N=="=")&&(_e+=Q),ue=ue+Q+N,q+=4,V.push({len:Q,ltr:N})}if(p.cigar=ue,p.lengthOnRef=_e,!(p.start+p.lengthOnRef<f)){for(Y="",le=D+1>>1,U=0;U<le;++U){var J=o[q+U];Y+=Mt[(J&240)>>4],Y+=Mt[J&15]}if(Y=Y.substring(0,D),q+=le,p.seq=Y,!(D===1&&String.fromCharCode(o[q+U]+33)==="*"))for(p.qual=[],U=0;U<D;++U)p.qual.push(o[q+U]);q+=D,p.start=w,p.mq=k,p.readName=X,p.chr=r.indexToChr[_],E>=0&&(p.mate={chr:r.indexToChr[E],position:O,strand:!(A&ti)}),p.tagBA=new Uint8Array(o.buffer.slice(q,g)),q+=g,(!f||p.start<=c&&p.start+p.lengthOnRef>=f&&v.pass(p))&&(d===void 0||_==d)&&(m=n(p,V),p.blocks=m.blocks,p.insertions=m.insertions,h.push(p)),l=g}}}function n(o,l){for(var h=[],f,c=0,d=o.start,v=l.length,x,g,p,m=0;m<v;m++){var _=l[m];switch(_.ltr){case"H":break;case"P":break;case"S":c+=_.len,p="S";break;case"N":d+=_.len,p="N";break;case"D":d+=_.len,p="D";break;case"I":x=o.seq==="*"?"*":o.seq.substr(c,_.len),g=o.qual?o.qual.slice(c,_.len):void 0,f===void 0&&(f=[]),f.push({start:d,len:_.len,seq:x,qual:g}),c+=_.len;break;case"M":case"EQ":case"=":case"X":x=o.seq==="*"?"*":o.seq.substr(c,_.len),g=o.qual?o.qual.slice(c,_.len):void 0,h.push({start:d,len:_.len,seq:x,qual:g,gapType:p}),c+=_.len,d+=_.len;break;default:console.log("Error processing cigar element: "+_.len+_.ltr)}}return{blocks:h,insertions:f}}}readHeader(){var e=this;return new Promise(function(t,i){ze(e).then(function(r){var s=r.firstAlignmentBlock+Me;M.loadArrayBuffer(e.bamPath,{headers:e.config.headers,range:{start:0,size:s},withCredentials:e.config.withCredentials}).then(function(n){var o=new Be(n,s),l=new Uint8Array(o);L(l,0);for(var h=L(l,4),f="",c=0;c<h;++c)f+=String.fromCharCode(l[c+8]);var d=L(l,h+8),v=h+12;e.chrToIndex={},e.indexToChr=[];for(var c=0;c<d;++c){for(var x=L(l,v),g="",p=0;p<x-1;++p)g+=String.fromCharCode(l[v+4+p]);L(l,v+x+4),e.chrToIndex[g]=c,e.indexToChr.push(g),v=v+8+x}t()}).catch(i)}).catch(i)})}}function ze(a){return new Promise(function(e,t){a.index?e(a.index):zt(a.baiPath,a.config).then(function(i){a.index=i,e(a.index)}).catch(t)})}function fr(a){return new Promise(function(e,t){a.chrToIndex?e(a.chrToIndex):a.readHeader().then(function(){e(a.chrToIndex)}).catch(t)})}function L(a,e){return a[e+3]<<24|a[e+2]<<16|a[e+1]<<8|a[e]}function ii(a,e){return a[e+1]<<8|a[e]}class cr{constructor(e,t){this.config=e,this.alignmentContainer=void 0,this.maxRows=e.maxRows||1e3,e.seq_url&&(this.sequence_source=new ni(e.seq_url)),this.parent=t,this.pack_alignments=!0,e.sourceType==="ga4gh"?this.bamReader=new igv.Ga4ghAlignmentReader(e):this.bamReader=new hr(e,t),this.viewAsPairs=!0}setViewAsPairs(e){var t=this;if(this.viewAsPairs!==e&&(this.viewAsPairs=e,this.alignmentContainer)){var i=this.alignmentContainer,r;e?r=ur(i.packedAlignmentRows):r=Pt(i.packedAlignmentRows),i.packedAlignmentRows=Ot(r,i.start,i.end,t.maxRows)}}getAlignments(e,t,i){var r=this;return new Promise(function(s,n){r.alignmentContainer&&r.alignmentContainer.contains(e,t,i)?s(r.alignmentContainer):r.bamReader.readAlignments(e,t,i).then(function(o){var l=r.config.maxRows||500,h=o.alignments;r.viewAsPairs||(h=Pt([{alignments:h}])),r.parent.display_alignments&&(o.packedAlignmentRows=Ot(h,o.start,o.end,l)),o.alignments=void 0,r.alignmentContainer=o,r.sequence_source?r.sequence_source.getSequence(o.chr,o.start,o.end).then(function(f){f&&(o.coverageMap.refSeq=f,o.sequence=f,s(o))}).catch(n):s(o)}).catch(n)})}}function ur(a){var e={},t=[];return a.forEach(function(i){i.alignments.forEach(function(r){var s;et(r)?(s=e[r.readName],s?(s.setSecondAlignment(r),e[r.readName]=void 0):(s=new igv.PairedAlignment(r),e[r.readName]=s,t.push(s))):t.push(r)})}),t}function Pt(a){var e=[];return a.forEach(function(t){t.alignments.forEach(function(i){i instanceof ye?(i.firstAlignment&&e.push(i.firstAlignment),i.secondAlignment&&e.push(i.secondAlignment)):e.push(i)})}),e}function et(a){return a.isPaired()&&a.isMateMapped()&&a.chr===a.mate.chr&&(a.isFirstOfPair()||a.isSecondOfPair())&&!(a.isSecondary()||a.isSupplementary())}function Ot(a,e,t,i){if(a){if(a.sort(function(g,p){return g.start-p.start}),a.length===0)return[];var r=[],s=0,n=0,o=e,l,h,f,c,d=4*2,v=[],x=Math.max(e,a[0].start);for(a.forEach(function(g){var p=Math.max(0,g.start-x);r[p]===void 0&&(r[p]=[]),r[p].push(g)});s<a.length&&v.length<i;){for(l=new xr;o<=t;){for(f=void 0;!f&&o<=t;)h=o-x,r[h]===void 0?++o:f=r[h];if(!f)break;c=f.pop(),f.length===0&&(r[h]=void 0),l.alignments.push(c),o=c.start+c.lengthOnRef+d,++s}if(l.alignments.length>0&&v.push(l),o=x,s===n)break;n=s}return v}}class dr{constructor(){this.hidden=!1}isMapped(){return(this.flags&Ji)==0}isPaired(){return(this.flags&er)!=0}isProperPair(){return(this.flags&tr)!=0}isFirstOfPair(){return(this.flags&Qi)!=0}isSecondOfPair(){return(this.flags&$i)!=0}isSecondary(){return(this.flags&ir)!=0}isSupplementary(){return(this.flags&rr)!=0}isFailsVendorQualityCheck(){return(this.flags&ar)!=0}isDuplicate(){return(this.flags&sr)!=0}isMateMapped(){return(this.flags&zi)==0}isNegativeStrand(){return(this.flags&rt)!=0}isMateNegativeStrand(){return(this.flags&ti)!=0}tags(){function e(t){for(var i=0,r=t.length,s={};i<r;){var n=String.fromCharCode(t[i])+String.fromCharCode(t[i+1]),o=String.fromCharCode(t[i+2]),l;if(o=="A")l=String.fromCharCode(t[i+3]),i+=4;else if(o==="i"||o==="I")l=L(t,i+3),i+=7;else if(o==="c"||o==="C")l=t[i+3],i+=4;else if(o==="s"||o==="S")l=ii(t,i+3),i+=5;else if(o==="f")l=ri(t,i+3),i+=7;else if(o==="Z")for(i+=3,l="";;){var h=t[i++];if(h===0)break;l+=String.fromCharCode(h)}else{l="Error unknown type: "+o,s[n]=l;break}s[n]=l}return s}return this.tagDict||(this.tagBA?(this.tagDict=e(this.tagBA),this.tagBA=void 0):this.tagDict={}),this.tagDict}popupData(e){var t=[],i,r;if(this.insertions)for(var s=0;s<this.insertions.length;s+=1){var n=this.insertions[s].start;if(e==n||e==n-1)return t.push({name:"Insertion",value:this.insertions[s].seq}),t.push({name:"Location",value:n}),t}t.push({name:"Read Name",value:this.readName}),t.push("<hr>"),t.push({name:"Alignment Start",value:igv.numberFormatter(1+this.start),borderTop:!0}),t.push({name:"Read Strand",value:this.strand===!0?"(+)":"(-)",borderTop:!0}),t.push({name:"Cigar",value:this.cigar}),t.push({name:"Mapped",value:l(this.isMapped())}),t.push({name:"Mapping Quality",value:this.mq}),t.push({name:"Secondary",value:l(this.isSecondary())}),t.push({name:"Supplementary",value:l(this.isSupplementary())}),t.push({name:"Duplicate",value:l(this.isDuplicate())}),t.push({name:"Failed QC",value:l(this.isFailsVendorQualityCheck())}),this.isPaired()&&(t.push("<hr>"),t.push({name:"First in Pair",value:!this.isSecondOfPair(),borderTop:!0}),t.push({name:"Mate is Mapped",value:l(this.isMateMapped())}),this.isMateMapped()&&(t.push({name:"Mate Chromosome",value:this.mate.chr}),t.push({name:"Mate Start",value:this.mate.position+1}),t.push({name:"Mate Strand",value:this.mate.strand===!0?"(+)":"(-)"}),t.push({name:"Insert Size",value:this.fragmentLength}))),t.push("<hr>"),r=this.tags(),i=!0;for(var o in r)r.hasOwnProperty(o)&&(i?(t.push({name:o,value:r[o],borderTop:!0}),i=!1):t.push({name:o,value:r[o]}));return t;function l(h){return h?"Yes":"No"}}}function ri(a,e){var t=new DataView(a.buffer),i=!0;return t.getFloat32(e,i)}class pr{constructor(e){e||(e={}),this.vendorFailed=e.vendorFailed===void 0?!0:e.vendorFailed,this.duplicates=e.duplicates===void 0?!0:e.duplicates,this.secondary=e.secondary||!1,this.supplementary=e.supplementary||!1,this.mqThreshold=e.mqThreshold===void 0?0:e.mqThreshold}pass(e){return!(this.vendorFailed&&e.isFailsVendorQualityCheck()||this.duplicates&&e.isDuplicate()||this.secondary&&e.isSecondary()||this.supplementary&&e.isSupplementary()||e.mq<this.mqThreshold)}}class Be{constructor(e,t){for(let p in e)console.log(p);var i=[],r=[0],s=0;for(t=t||e.byteLength-18;r[0]<t;){var n=new Uint8Array(e,r[0],18),o=n[11]<<8|n[10];n[12],n[13],n[15]<<8|n[14];var l=n[17]<<8|n[16]+1,h=12+o+r[0],f=e.byteLength-h;if(f<l+8)break;var c=$t(e,h,f,r);r[0]+=8,s+=c.byteLength,i.push(c)}if(i.length==1)return i[0];for(var d=new Uint8Array(s),v=0,x=0;x<i.length;++x){var g=new Uint8Array(i[x]);G(g,0,d,v,g.length),v+=g.length}return d.buffer}}class gr{constructor(e,t,i,r,s,n,o){this.parent=o,this.chr=e,this.start=t,this.end=i,this.length=i-t,this.parent.cm_class?this.coverageMap=new this.parent.cm_class(e,t,i,o):this.coverageMap=new me(e,t,i,o),this.alignments=[],this.raw_alignments=[],this.downsampledIntervals=[],this.samplingWindowSize=r===void 0?100:r,this.samplingDepth=s===void 0?50:s,this.pairsSupported=n,this.paired=!1,this.pairsCache={},this.downsampledReads=new Set,this.currentBucket=new Nt(this.start,this.start+this.samplingWindowSize,this),this.filter=function(h){return h.isMapped()&&!h.isFailsVendorQualityCheck()}}push(e){this.filter(e)!==!1&&(e.tagBA&&(e.tagBA=ai(e.tagBA)),this.parent.keep_raw_alignments&&this.raw_alignments.push(e),this.coverageMap.incCounts(e),this.parent.display_alignments&&(this.pairsSupported&&this.downsampledReads.has(e.readName)||(e.start>=this.currentBucket.end&&(Ut.call(this),this.currentBucket=new Nt(e.start,e.start+this.samplingWindowSize,this)),this.currentBucket.addAlignment(e))))}forEach(e){this.alignments.forEach(e)}finish(){if(this.currentBucket!==void 0&&Ut.call(this),this.pairsSupported){var e=[],t=this.downsampledReads;this.alignments.forEach(function(i){t.has(i.readName)||e.push(i)}),this.alignments=e}this.alignments.sort(function(i,r){return i.start-r.start}),this.pairsCache=void 0,this.downsampledReads=void 0}contains(e,t,i){return this.chr==e&&this.start<=t&&this.end>=i}hasDownsampledIntervals(){return this.downsampledIntervals&&this.downsampledIntervals.length>0}}function Ut(){this.alignments=this.alignments.concat(this.currentBucket.alignments),this.currentBucket.downsampledCount>0&&this.downsampledIntervals.push(new mr(this.currentBucket.start,this.currentBucket.end,this.currentBucket.downsampledCount)),this.paired=this.paired||this.currentBucket.paired}class Nt{constructor(e,t,i){this.start=e,this.end=t,this.alignments=[],this.downsampledCount=0,this.samplingDepth=i.samplingDepth,this.pairsSupported=i.pairsSupported,this.downsampledReads=i.downsampledReads,this.pairsCache=i.pairsCache}addAlignment(e){var t,i,r,s;this.alignments.length<this.samplingDepth?this.pairsSupported&&et(e)?(s=this.pairsCache[e.readName],s?(s.setSecondAlignment(e),this.pairsCache[e.readName]=void 0):(s=new ye(e),this.paired=!0,this.pairsCache[e.readName]=s,this.alignments.push(s))):this.alignments.push(e):(t=this.samplingDepth/(this.samplingDepth+this.downsampledCount+1),Math.random()<t?(i=Math.floor(Math.random()*(this.alignments.length-1)),r=this.alignments[i],this.pairsSupported&&et(e)?(this.pairsCache[r.readName]!==void 0&&(this.pairsCache[r.readName]=void 0),s=new ye(e),this.paired=!0,this.pairsCache[e.readName]=s,this.alignments[i]=s):this.alignments[i]=e,this.downsampledReads.add(r.readName)):this.downsampledReads.add(e.readName),this.downsampledCount++)}}class me{constructor(e,t,i,r){this.chr=e,this.bpStart=t,this.length=i-t,this.parent=r,this.coverage=new Array(this.length),this.maximum=0}incCounts(e){var t=this;e.blocks===void 0?i(e):e.blocks.forEach(function(r){i(r)});function i(r){var s,n,o,l,h;for(o=r.start-t.bpStart,l=0;l<r.len;o++,l++)t.coverage[o]||(t.coverage[o]=new vr),n=r.seq.charAt(l),s=e.strand?"pos"+n:"neg"+n,h=r.qual[l],t.coverage[o][s]+=1,t.coverage[o]["qual"+n]+=h,t.coverage[o].total+=1,t.coverage[o].qual+=h,t.maximum=Math.max(t.coverage[o].total,t.maximum)}}}me.threshold=.2;me.qualityWeight=!0;class vr{constructor(){this.posA=0,this.negA=0,this.posT=0,this.negT=0,this.posC=0,this.negC=0,this.posG=0,this.negG=0,this.posN=0,this.negN=0,this.pos=0,this.neg=0,this.qualA=0,this.qualT=0,this.qualC=0,this.qualG=0,this.qualN=0,this.qual=0,this.total=0}isMismatch(e){var t=this,i,r=me.threshold*(me.qualityWeight&&this.qual?this.qual:this.total);return i=0,["A","T","C","G"].forEach(function(s){s!==e&&(i+=me.qualityWeight&&t.qual?t["qual"+s]:t["pos"+s]+t["neg"+s])}),i>=r}}class mr{constructor(e,t,i){this.start=e,this.end=t,this.counts=i}popupData(e){return[{name:"start",value:this.start+1},{name:"end",value:this.end},{name:"# downsampled:",value:this.counts}]}}class ye{constructor(e){this.firstAlignment=e,this.chr=e.chr,this.readName=e.readName,e.start<e.mate.position?(this.start=e.start,this.end=Math.max(e.mate.position,e.start+e.lengthOnRef),this.connectingStart=e.start+e.lengthOnRef,this.connectingEnd=e.mate.position):(this.start=e.mate.position,this.end=e.start+e.lengthOnRef,this.connectingStart=e.mate.position,this.connectingEnd=e.start),this.lengthOnRef=this.end-this.start}setSecondAlignment(e){this.secondAlignment=e,e.start>this.firstAlignment.start?(this.end=e.start+e.lengthOnRef,this.connectingEnd=e.start):(this.start=e.start,this.connectingStart=e.start+e.lengthOnRef),this.lengthOnRef=this.end-this.start}popupData(e){var t=[];return t=t.concat(this.firstAlignment.popupData(e)),this.secondAlignment&&(t.push("-------------------------------"),t=t.concat(this.secondAlignment.popupData(e))),t}isPaired(){return!0}firstOfPairStrand(){return this.firstAlignment.isFirstOfPair()?this.firstAlignment.strand:this.secondAlignment?this.secondAlignment.strand:this.firstAlignment.strand}}class xr{constructor(){this.alignments=[],this.score=void 0}findCenterAlignment(e,t){var i=void 0;return this.alignments.forEach(function(r){i===void 0&&(r.start+r.lengthOnRef<e||r.start>t||(i=r))}),i}updateScore(e,t,i){this.score=this.caculateScore(e,1+e,t,i)}caculateScore(e,t,i,r){var s,n;return n=this.findCenterAlignment(e,t),n===void 0?Number.MAX_VALUE:r.sort==="NUCLEOTIDE"?(s=void 0,n.blocks.forEach(function(o){var l=i.sequence,h=i.coverageMap,f,c,d,v,x;if(o.seq!=="*")for(var g=0,p=o.start-i.start,m=o.start,_=o.seq.length;g<_;g++,p++,m++)e===m&&(f=l.charAt(p),c=o.seq.charAt(g),c==="="&&(c=f),c==="N"?s=2:c===f?s=3:c==="X"||c!==f?(d=h.coverage[m-h.bpStart],v=d["pos"+c]+d["neg"+c],x=d.qual?d.qual:0,s=-(v+x/1e3)):console.log("BamAlignmentRow.caculateScore - huh?"));else s=3}),s===void 0?Number.MAX_VALUE:s):r.sort==="STRAND"?n.strand?1:-1:r.sort==="START"?n.start:Number.MAX_VALUE}}function ai(a){for(var e=0,t=a.length,i={};e<t;){var r=String.fromCharCode(a[e])+String.fromCharCode(a[e+1]),s=String.fromCharCode(a[e+2]),n;if(s=="A")n=String.fromCharCode(a[e+3]),e+=4;else if(s==="i"||s==="I")n=L(a,e+3),e+=7;else if(s==="c"||s==="C")n=a[e+3],e+=4;else if(s==="s"||s==="S")n=ii(a,e+3),e+=5;else if(s==="f")n=ri(a,e+3),e+=7;else if(s==="Z")for(e+=3,n="";;){var o=a[e++];if(o===0)break;n+=String.fromCharCode(o)}else{n="Error unknown type: "+s,i[r]=n;break}i[r]=n}return i}class Ue{constructor(e){this.config=e||{}}getFileHeader(){return this.is_indexed=!0,new Promise(function(e,t){e()})}getFeatures(e,t,i,r,s){if(this.is_indexed)return this._getFeatures(e,t,i,r,s);var n=this;return new Promise(function(o,l){n.getFileHeader().then(function(){n._getFeatures(e,t,i,r,s).then(function(h){o(h)}).catch(l)}).catch(l)})}_getFeatures(e,t,i,r,s){t===0&&(t=1);var n=this;return n.time=Date.now(),new Promise(function(o,l){n.featureCache&&e!==n.featureCache.range.chr&&(n.featureCache=null);var h=new tt(e,t,i),f=n.featureCache,c=n.config.maxRows||500;let d=!1;if(f?f.range!==void 0&&(d=f.range.rangesToGet(h)):d={all:[t,i]},!d)o(n.featureCache.queryFeatures(e,t,i));else{let v=[],x=[];for(let g in d){let p=d[g];v.push(n.retrieveFeatures(e,p[0],p[1],r,s)),x.push([g,p])}Promise.all(v).then(function(g){let p=[];n.featureCache&&(p=n.featureCache.allFeatures());let m=0;for(let w of g){if(w===null&&(w=[]),x[m][0]==="left"){let b=x[m][1][1],k=0;for(let y=w.length-1;y>=0;y--)w[y].end>=b&&(w[y].remove=!0,k++);k!==0&&(w=w.filter(y=>!y.remove))}if(x[m][0]==="right"){let b=x[m][1][0],k=0;for(k=0;k<w.length&&!(w[k].start>b);k++);k!==0&&w.splice(0,k)}m++,p=p.concat(w)}let _=n.featureCache?n.featureCache.range:h;n.featureCache=new Oe(p,_),Ue.packFeatures(p,c),o(n.featureCache.queryFeatures(e,t,i))}).catch(function(g){l(g)})}})}static packFeatures(e,t){if(e==null||e.length===0)return;var i={},r=[];e.forEach(function(n){var o=n.chr,l=i[o];l||(l=[],i[o]=l,r.push(o)),l.push(n)}),r.forEach(function(n){s(i[n],t)});function s(n,o){var l=[];n.sort(function(h,f){return h.start-f.start}),l.push(-1e3),n.forEach(function(h){var f,c=Math.min(l.length,o),d=h.start;for(f=0;f<c;f++)if(d>=l[f]){h.row=f,l[f]=h.end;return}h.row=f,l[f]=h.end})}}}class si extends Ue{constructor(e,t){super(e),this.reader=new wr(e,t)}retrieveFeatures(e,t,i){return console.log("getting features",e,t,i),this.reader.readFeatures(e,t,i)}getFileHeader(){var e=this;return new Promise(function(t,i){e.reader.readHeader().then(function(){e.is_indexed=!0,t()}).catch(i)})}}class _r extends Ue{constructor(e,t){e.sourceType="gtex",super(e),this.header=!0,this.feature_source=new he(e,t)}retrieveFeatures(e,t,i,r,s){return this.feature_source.getFeatures(e,t,i,!1,s)}}const br=65536;class wr{constructor(e,t){if(this.config=e||{},e.localFile)this.localFile=e.localFile,this.filename=e.localFile.name;else{this.url=li(e.url,!1),this.indexURL=e.indexURL,this.headURL=e.headURL||this.filename;var i=Je.parseUri(e.url);this.filename=i.file,this.path=i.path}this.format=e.format,this.parser=this.getParser(this.format,t)}getParser(e,t){switch(e){case"vcf":return new VcfParser;case"seg":return new SegParser;default:return new Pe(e,t,this.config)}}isIndexable(){var e=this.config.indexURL,t=this.type,i=this.config.indexed;return e||t!="wig"&&i!=!1}loadIndex(){var e=this.indexURL;return this.filename.endsWith(".gz")?(e||(e=this.url+".tbi"),zt(e,this.config,!0)):(e||(e=this.url+".idx"),loadTribbleIndex(e,this.config))}loadFeaturesNoIndex(){var e=this;return new Promise(function(t,i){var r=e.parser,s={headers:e.config.headers,withCredentials:e.config.withCredentials};e.localFile?M.loadStringFromFile(e.localFile,s).then(n).catch(i):M.loadString(e.url,s).then(n).catch(i);function n(o){e.header=r.parseHeader(o),e.header instanceof String&&e.header.startsWith("##gff-version 3")&&(e.format="gff3"),t(r.parseFeatures(o))}})}loadFeaturesWithIndex(e,t,i){var r=this;return new Promise(function(s,n){var o,l=r.index,h=l&&l.tabix,f=h?l.sequenceIndexMap[e]:e,c=[];o=l.blocksForRange(f,t,i),!o||o.length===0?s(null):(o.forEach(function(d){d&&c.push(new Promise(function(v,x){var g=d.minv.block,p=d.minv.offset,m=d.maxv.block+(l.tabix?br:0),_={headers:r.config.headers,range:{start:g,size:m-g+1},withCredentials:r.config.withCredentials},w;w=function(b){var k,y;l.tabix?k=M.arrayBufferToString(Jt(b)):k=b,y=p?k.slice(p):k;var S=r.parser.parseFeatures(y,e,t,i);v(S)},r.localFile?M.loadStringFromFile(r.localFile,_).then(w).catch(x):l.tabix?M.loadArrayBuffer(r.url,_).then(w).catch(x):M.loadString(r.url,_).then(w).catch(x)}))}),Promise.all(c).then(function(d){var v,x;if(d.length===1)x=d[0];else{for(x=d[0],v=1;v<d.length;v++)x=x.concat(d[v]);x.sort(function(g,p){return g.start-p.start})}s(x)}).catch(d=>{console.log(d),n(d)}))})}getIndex(){var e=this,t=this.isIndexable();return new Promise(function(i,r){e.indexed===void 0&&t?e.loadIndex().then(function(s){s?(e.index=s,e.indexed=!0):e.indexed=!1,i(e.index)}).catch(r):i(e.index)})}readHeader(){var e=this;return new Promise(function(t,i){e.header?t(e.header):e.getIndex().then(function(r){if(r){var s={headers:e.config.headers,bgz:r.tabix,range:{start:0,size:65e3},withCredentials:e.config.withCredentials},n=function(o){e.header=e.parser.parseHeader(o),t(e.header)};if(e.localFile)M.loadStringFromFile(e.localFile,s).then(n);else{const o=e.url;M.loadString(o,s).then(n).catch(i)}}else e.loadFeaturesNoIndex(void 0).then(function(o){var l=e.header||{};l.features=o,t(l)}).catch(error)}).catch(i)})}readFeatures(e,t,i){var r=this;return new Promise(function(s,n){r.index?r.loadFeaturesWithIndex(e,t,i).then(o).catch(n):r.loadFeaturesNoIndex().then(o);function o(l){s(l)}})}}const Ht=Number.MAX_VALUE,Ve=["Name","gene_name","gene","gene_id","alias","locus"];class Pe{constructor(e,t,i){this.format=e,this.nameField=i?i.nameField:void 0,this.skipRows=0,t?(this.delimiter=/\s+/,this.decode=function(r,s){let n={chr:r[0],start:parseInt(r[1]),end:parseInt(r[2])};return t(r.slice(3),n),n}):i.decode_function==="generic"?this.decode=function(r,s){let n={chr:r[0],start:parseInt(r[1]),end:parseInt(r[2])};return n.data=r.slice(3),n}:(this.decode=i.decode_function==="decodeRefflat"?Pe.decodeRefflat:Pe.decodeBed,this.delimiter=/\s+/)}parseHeader(e){var t=e.split(`
`),i=t.length,r,s,n;for(s=0;s<i;s++)if(r=t[s],r.startsWith("track")||r.startsWith("#")||r.startsWith("browser"))r.startsWith("track")?n=this.parseTrackLine(r):r.startsWith("##gff-version 3")&&(this.format="gff3",n||(n={}),n.format="gff3");else{n={};break}return n}parseFeatures(e,t,i,r){if(!e)return null;var s,n,o=e.split(`
`),l=o.length,h,f=[],c,d,v=0,x;this.decode;var g=this.format,p=this.delimiter||"	";for(d=this.skipRows;d<l;d++)if(c=o[d],!(c.startsWith("track")||c.startsWith("#")||c.startsWith("browser"))){if(g==="wig"&&c.startsWith("fixedStep")){s=this.parseFixedStep(c);continue}else if(g==="wig"&&c.startsWith("variableStep")){s=this.parseVariableStep(c);continue}if(h=o[d].split(p),!(h.length<1||g!=="wig"&&h.length<3)&&(n=this.decode(h,s),n)){if(n.chr!==t||n.end<i||n.start>r)continue;f.length<Ht?f.push(n):(x=Math.floor(Math.random()*v),x<Ht&&(f[x]=n)),v++}}return f}static parseFixedStep(e){var t=e.split(/\s+/),i=t[1].split("=")[1],r=parseInt(t[2].split("=")[1],10),s=parseInt(t[3].split("=")[1],10),n=t.length>4?parseInt(t[4].split("=")[1],10):1;return{format:"fixedStep",chrom:i,start:r,step:s,span:n,index:0}}static parseVariableStep(e){var t=e.split(/\s+/),i=t[1].split("=")[1],r=t.length>2?parseInt(t[2].split("=")[1],10):1;return{format:"variableStep",chrom:i,span:r}}static parseTrackLine(e){var t={},i=e.split(/(?:")([^"]+)(?:")|([^\s"]+)(?=\s+|$)/g),r=[],s,n,o;for(s=1;s<i.length;s++)!i[s]||i[s].trim().length===0||(n=i[s].trim(),n.endsWith("=")>0?o=n:o?(r.push(o+n),o=void 0):r.push(n));return r.forEach(function(l){if(l){var h=l.split("=",2);h.length==2&&(t[h[0]]=h[1])}}),t}static decodeBed(e,t){var i,r,s,n,o,l,h,f,c,d,v,x,g,p,m;if(e.length<3)return null;if(i=e[0],r=parseInt(e[1]),s=e.length>2?parseInt(e[2]):r+1,g={chr:i,start:r,end:s,score:1e3},e.length>3){l=e[3].replace(/"/g,""),h=l.split(";");for(var _=0;_<h.length;_++){var w=h[_].split("=");w[0]=="gene_id"&&(n=w[1]),w[0]=="gene_name"&&(o=w[1])}g.id=n||l,g.name=o||l}if(e.length>4&&(g.score=parseFloat(e[4])),e.length>5&&(g.strand=e[5]),e.length>6&&(g.cdStart=parseInt(e[6])),e.length>7&&(g.cdEnd=parseInt(e[7])),e.length>8,e.length>11){f=parseInt(e[9]),c=e[10].split(","),d=e[11].split(","),v=[];for(var _=0;_<f;_++){p=r+parseInt(d[_]),m=p+parseInt(c[_]);var x={start:p,end:m};(g.cdStart>m||g.cdEnd<g.cdStart)&&(x.utr=!0),g.cdStart>=p&&g.cdStart<=m&&(x.cdStart=g.cdStart),g.cdEnd>=p&&g.cdEnd<=m&&(x.cdEnd=g.cdEnd),v.push(x)}g.exons=v}return g}static decodeRefflat(e,t){if(e.length<10)return null;if(e[10]===void 0)return console.log(e[1]),null;for(var i={chr:e[2],start:parseInt(e[4]),end:parseInt(e[5]),id:e[1],name:e[0],strand:e[3],cdStart:parseInt(e[6]),cdEnd:parseInt(e[7])},r=parseInt(e[8]),s=e[9].split(","),n=e[10].split(","),o=[],l=0;l<r;l++){let h={start:parseInt(s[l]),end:parseInt(n[l])};(i.cdStart>h.end||i.cdEnd<i.cdStart)&&(h.utr=!0),i.cdStart>=h.start&&i.cdStart<=h.end&&(h.cdStart=i.cdStart),i.cdEnd>=h.start&&i.cdEnd<=h.end&&(h.cdEnd=i.cdEnd),o.push(h)}return i.exons=o,i}static decodePeak(e,t){var i,r,s,n,o,l,h,f,c,d;return i=e.length,i<9?null:(r=e[0],s=parseInt(e[1]),n=parseInt(e[2]),l=e[3],h=parseFloat(e[4]),o=e[5].trim(),c=parseFloat(e[6]),d=parseFloat(e[7]),f=parseFloat(e[8]),h===0&&(h=c),{chr:r,start:s,end:n,name:l,score:h,strand:o,signal:c,pValue:d,qValue:f})}static decodeBedGraph(e,t){var i,r,s,n;return e.length<3?null:(i=e[0],r=parseInt(e[1]),s=parseInt(e[2]),n=parseFloat(e[3]),{chr:i,start:r,end:s,value:n})}static decodeWig(e,t){var i,r,s;return t.format==="fixedStep"?(i=t.index*t.step+t.start,r=i+t.span,s=parseFloat(e[0]),++t.index,isNaN(s)?null:{chr:t.chrom,start:i,end:r,value:s}):t.format==="variableStep"?e.length<2?null:(i=parseInt(e[0],10),r=i+t.span,s=parseFloat(e[1]),isNaN(s)?null:{chr:t.chrom,start:i,end:r,value:s}):decodeBedGraph(e)}static decodeAneu(e,t){var i,r,s,n;return e.length<4?null:(i=e[1],r=parseInt(e[2]),s=e.length>3?parseInt(e[3]):r+1,n={chr:i,start:r,end:s},e.length>4&&(n.score=parseFloat(e[4]),n.value=n.score),n.popupData=function(){return[{name:"Name",value:n.name}]},n)}static decodeFusionJuncSpan(e,t){var i=e[0],r=e[1],s=parseInt(e[2]),n=parseInt(e[3]),o=parseInt(e[4]),l=parseInt(e[5]),h=e[6],f={chr:i,name:r,junction_left:s,junction_right:n,num_junction_reads:o,num_spanning_frags:l,spanning_frag_coords:[],start:-1,end:-1},c=s,d=n;if(l>0)for(var v=h.split(","),x=0;x<v.length;x++){var g=v[x].split("-"),p=g[0],m=g[1];p<c&&(c=p),m>d&&(d=m),f.spanning_frag_coords.push({left:p,right:m})}return f.start=c,f.end=d,f.popupData=function(){return[{name:"Name",value:f.name}]},f}static decodeGtexGWAS(e,t){var i,r,s,n,o;return i=e.length,i<8?null:(r=e[0],s=parseInt(e[1])-1,n=parseInt(e[3].split(":")[1]),o=parseFloat(e[5]),{chr:r,start:s,end:n,pvalue:o})}static decodeGFF(e,t){var i,r,s,n,o,l,h,f,c,d,v,x,g,p=this.format;if(i=e.length,i<9)return null;r=e[0],l=e[2],s=parseInt(e[3])-1,n=parseInt(e[4]),h=e[5]==="."?0:parseFloat(e[5]),o=e[6],e[7]==="."||parseInt(e[7]),f=e[8];var m=p==="gff3"?"=":/\s+/,_={};if(f.split(";").forEach(function(w){var b=w.trim().split(m,2),k,y;b.length==2&&(k=b[0].trim(),y=b[1].trim(),y.startsWith('"')&&y.endsWith('"')&&(y=y.substr(1,y.length-2)),b[0]==="ID"?c=b[1]:b[0]==="Parent"?d=b[1]:b[0].toLowerCase()==="color"?v=igv.createColorString(b[1]):b[0]==="transcript_id"&&(c=b[1]),_[k]=y)}),this.nameField)x=_[this.nameField];else for(g=0;g<Ve.length;g++)if(_.hasOwnProperty(Ve[g])){this.nameField=Ve[g],x=_[this.nameField];break}return{id:c,parent:d,name:x,type:l,chr:r,start:s,end:n,score:h,strand:o,color:v,attributeString:f,popupData:function(){var w=this.attributeString.split(";"),b=[],k,y;return w.forEach(function(S){var A=S.trim().split(m,2);A.length===2&&A[1]!==void 0&&(k=A[0].trim(),y=A[1].trim(),y.startsWith('"')&&y.endsWith('"')&&(y=y.substr(1,y.length-2)),b.push({name:k,value:y}))}),b}}}decodeCustom(e,t){var i,r,s,n,o=this.format,l=o.coords||0;return e.length<3?null:(r=e[o.chr],s=parseInt(e[o.start])-l,n=o.end!==void 0?parseInt(e[o.end]):s+1,i={chr:r,start:s,end:n},o.fields&&o.fields.forEach(function(h,f){f!=o.chr&&f!=o.start&&f!=o.end&&(i[h]=e[f])}),i)}}class Oe{constructor(e,t){this.treeMap=Oe.buildTreeMap(e),this.range=t}queryFeatures(e,t,i){var r,s,n,o,l,h,f;return h=this.treeMap[e],h?(f=h.findOverlapping(t,i),f.length==0?[]:(r=[],f.forEach(function(c){for(s=c.value,o=s.length,l=0;l<o&&(n=s[l],!(n.start>i));l++)n.end>=t&&r.push(n)}),r)):[]}allFeatures(){var e=[],t=this.treeMap;if(t){for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];r.mapIntervals(function(s){e=e.concat(s.value)})}}return e}static buildTreeMap(e){var t={},i=[],r={};if(e){e.forEach(function(s){var n=s.chr,o;o=t[n],o||(i.push(n),o=[],t[n]=o),o.push(s)});for(let s=0;s<i.length;s++){let n=i[s];r[n]=Oe.buildIntervalTree(t[n])}}return r}static buildIntervalTree(e){var t,i,r,s,n,o,l,h;for(n=new yr,l=e.length,o=Math.max(10,Math.round(l/100)),e.sort(function(f,c){return f.start===c.start?0:f.start>c.start?1:-1}),t=0;t<l;t+=o)i=Math.min(l,t+o),h=e.slice(t,i),r=h[0].start,s=r,h.forEach(function(f){s=Math.max(s,f.end)}),n.insert(r,s,h);return n}}const ie=1,ee=2;let F={};F.color=ie;F.parent=F;F.left=F;F.right=F;class yr{constructor(){this.root=F}insert(e,t,i){var r=new qt(e,t,i),s=new kr(r);for(this.treeInsert(s),s.color=ee;s!=this.root&&s.parent.color==ee;)if(s.parent==s.parent.parent.left){var n=s.parent.parent.right;n.color==ee?(s.parent.color=ie,n.color=ie,s.parent.parent.color=ee,s=s.parent.parent):(s==s.parent.right&&(s=s.parent,this.leftRotate(s)),s.parent.color=ie,s.parent.parent.color=ee,this.rightRotate(s.parent.parent))}else{var n=s.parent.parent.left;n.color==ee?(s.parent.color=ie,n.color=ie,s.parent.parent.color=ee,s=s.parent.parent):(s==s.parent.left&&(s=s.parent,this.rightRotate(s)),s.parent.color=ie,s.parent.parent.color=ee,this.leftRotate(s.parent.parent))}this.root.color=ie}findOverlapping(e,t){var i=new qt(e,t,0);if(this.root===F)return[];var r=this.searchAll(i,this.root,[]);return r.length>1&&r.sort(function(s,n){return s.low-n.low}),r}logIntervals(){e(this.root,0);function e(t,i){for(var r="",s=0;s<i;s++)r+=" ";console.log(r+t.interval.low+" "+t.interval.high),i+=5,t.left!=F&&e(t.left,i),t.right!=F&&e(t.right,i)}}mapIntervals(e){t(this.root);function t(i){e(i.interval),i.left!=F&&t(i.left),i.right!=F&&t(i.right)}}searchAll(e,t,i){return t.interval.overlaps(e)&&i.push(t.interval),t.left!=F&&t.left.max>=e.low&&this.searchAll(e,t.left,i),t.right!=F&&t.right.min<=e.high&&this.searchAll(e,t.right,i),i}leftRotate(e){var t=e.right;e.right=t.left,t.left!=F&&(t.left.parent=e),t.parent=e.parent,e.parent==F?this.root=t:e.parent.left==e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,this.applyUpdate(e)}rightRotate(e){var t=e.left;e.left=t.right,t.right!=F&&(t.right.parent=e),t.parent=e.parent,e.parent==F?this.root=t:e.parent.right==e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t,this.applyUpdate(e)}treeInsert(e){for(var t=this.root,i=F;t!=F;)i=t,e.interval.low<=t.interval.low?t=t.left:t=t.right;e.parent=i,i==F?(this.root=e,e.left=e.right=F):e.interval.low<=i.interval.low?i.left=e:i.right=e,this.applyUpdate(e)}applyUpdate(e){for(;e!=F;){var t=e.left.max>e.right.max?e.left.max:e.right.max,i=e.interval.high;e.max=t>i?t:i;var r=e.left.min<e.right.min?e.left.min:e.right.min,s=e.interval.low;e.min=r<s?r:s,e=e.parent}}}class qt{constructor(e,t,i){this.low=e,this.high=t,this.value=i}equals(e){return e?this==e?!0:this.low==otherInterval.low&&this.high==otherInterval.high:!1}compareTo(e){return this.low<e.low?-1:this.low>e.low?1:this.high<e.high?-1:this.high>e.high?1:0}overlaps(e){try{return this.low<=e.high&&e.low<=this.high}catch(t){igv.presentAlert(t)}}}class kr{constructor(e){this.parent=F,this.left=F,this.right=F,this.interval=e,this.color=ee}}class tt{constructor(e,t,i,r){this.chr=e,this.start=t,this.end=i,this.features=r}contains(e,t,i){return this.chr==e&&this.start<=t&&this.end>=i}containsRange(e){return this.chr===e.chr&&this.start<=e.start&&this.end>=e.end}rangesToGet(e){let t=!1,i={};return this.chr!==e.chr?(i.all=[e.start,e.end],t=!0,this.start=e.start,this.end=e.end):(e.start<this.start&&(i.left=[e.start,this.start],t=!0,this.start=e.start),e.end>this.end&&(i.right=[this.end,e.end],t=!0,this.end=e.end)),t?i:!1}}class ni{constructor(e){this.file=e,this.indexed=!0,this.indexed&&(this.indexFile=this.file+".fai")}init(){var e=this;return e.indexed?new Promise(function(t,i){e.getIndex().then(function(r){var s=0;e.chromosomes={},e.chromosomeNames.forEach(function(n){var o=e.index[n].size;e.chromosomes[n]=new igv.Chromosome(n,s++,o)}),t()}).catch(i)}):e.loadAll()}getSequence(e,t,i){return this.indexed?this.getSequenceIndexed(e,t,i):getSequenceNonIndexed.this(e,t,i)}getSequenceIndexed(e,t,i){var r=this;return new Promise(function(s,n){var o=r.interval;if(o&&o.contains(e,t,i))s(d(o,t,i));else{var l=t,h=i;if(i-t<1e5){var f=i-t,c=Math.round(t+f/2);l=Math.max(0,c-5e4),h=c+5e4}r.readSequence(e,l,h).then(function(v){r.interval=new tt(e,l,h,v),s(d(r.interval,t,i))}).catch(n)}function d(v,x,g){var p=x-v.start,m=g-x,_=v.features?v.features.substr(p,m):null;return _}})}getSequenceNonIndexed(e,t,i){var r=this;return new Promise(function(s,n){var o=r.sequences[e];o&&o.length>i&&s(o.substring(t,i))})}getIndex(){var e=this;return new Promise(function(t,i){e.index?t(e.index):M.load(e.indexFile,{}).then(function(r){var s=r.split(`
`),n=s.length,o=0;for(e.chromosomeNames=[],e.index={};o<n;){var l=s[o++].split("	"),h=l.length;if(h==5){var f=l[0],c=parseInt(l[1]),d=parseInt(l[2]),v=parseInt(l[3]),x=parseInt(l[4]),g={size:c,position:d,basesPerLine:v,bytesPerLine:x};e.chromosomeNames.push(f),e.index[f]=g}}t&&t(e.index)}).catch(i)})}loadAll(){var e=this;return new Promise(function(t,i){e.chromosomeNames=[],e.chromosomes={},e.sequences={},M.load(e.file,{withCredentials:e.withCredentials}).then(function(r){for(var s=r.splitLines(),n=s.length,o=0,l,h="",f,c=0;o<n;)l=s[o++].trim(),!(l.startsWith("#")||l.length===0)&&(l.startsWith(">")?(h&&(e.chromosomeNames.push(f),e.sequences[f]=h,e.chromosomes[f]=new igv.Chromosome(f,c++,h.length)),f=l.substr(1).split("\\s+")[0],h=""):h+=l);t()})})}readSequence(e,t,i){var r=this;return new Promise(function(s,n){r.getIndex().then(function(){var o=r.index[e];if(!o)console.log("No index entry for chr: "+e),r.interval=new tt(e,t,i,null),s(null);else{var l=Math.max(0,t),h=Math.min(o.size,i),f=o.bytesPerLine,c=o.basesPerLine,d=o.position,v=f-c,x=Math.floor(l/c),g=Math.floor(h/c),p=x*c,m=l-p,_=d+x*f+m,w=g*c,b=h-w,k=d+g*f+b-1,y=k-_+1;y<=0&&s(null),M.load(r.file,{range:{start:_,size:y}}).then(function(S){var A,C="",D=0,E=S.length;for(m>0&&(A=Math.min(h-l,c-m),C+=S.substr(D,A),D+=A+v);D<E;)A=Math.min(c,E-D),C+=S.substr(D,A),D+=A+v;s(C)}).catch(n)}}).catch(n)})}}class P{constructor(e){this.config=e}_setFeatureSource(){}drawScale(e){}getConfig(){return JSON.parse(JSON.stringify(this.config))}setConfigAttribute(e,t){if(t==null){delete this.config[e];return}this.config[e]=t,e==="url"&&this._setFeatureSource()}setColorFunction(e){this.color_function=e}getFeatureAt(e,t,i,r){return null}setConfig(e){this.config.url!==e.url?(this.config=e,this._setFeatureSource()):this._setFeatureSource()}getFeatures(e,t,i,r,s){return this.feature_source.getFeatures(e,t,i,r,s)}getSettings(e){return[{type:"text",label:"Label",current_value:this.config.short_label,func:t=>{this.setConfigAttribute("short_label",t),e.update()}},{type:"slider",min:10,max:1e3,label:"Height",current_value:this.config.height,func:t=>{this.setConfigAttribute("height",t),e.update()}},{type:"colorChooser",label:"Color",current_value:this.config.color,func:t=>{this.setConfigAttribute("color",t),e.update()}},{type:"button",label:"Delete",func:()=>{e.removeTrack(this.config.track_id)}}]}static calculateLabel(e){typeof e!="string"&&(e=e[0]);let t=e.split("/"),i=t[t.length-1];return t=i.split("."),i=t[0],i}addExtraControls(e,t){}static getTypeFromURL(e){let t={};return typeof e!="string"||(e.endsWith("bw")?(t.type="bigwig",t.format="wig"):e.endsWith(".bed.gz")?(t.type="bed",t.format="feature"):e.endsWith(".bb")&&!t.type?(t.type="bigbed",t.format="feature"):e.endsWith(".fasta")?(t.type="fasta",t.format="sequence"):e.endsWith(".bam")&&(t.type="bam",t.format="alignment")),t}static parseConfig(e){let t=JSON.parse(JSON.stringify(e));if(!t.type&&t.url){let i=P.getTypeFromURL(t.url);i.type&&(t.type=i.type,t.format=i.format)}return(t.type==="bed"||t.type==="bigbed")&&(t.format="feature"),!t.short_label&&t.url&&(t.short_label=P.calculateLabel(t.url)),t.track_id||(t.track_id=t.url),t.format==="feature"&&(t.displayMode=t.displayMode||"COLLAPSED",t.labelDisplayMode="SLANT",t.squishedCallHeight=t.squishedCallHeight||30,t.expandedCallHeight=t.expandedCallHeight||15,t.featureHeight=t.featureHeight||12),(t.format==="wig"||t.type==="bigwig")&&(t.scale||(t.scale="dynamic"),t.min_y||(t.min_y=0),t.max_y||(t.max_y=100),t.height||(t.height=100)),t.type==="bam"&&(t.featureHeight||(t.featureHeight=12)),t.height||(t.height=100),t.color||t.type==="bam"&&(t.color="#D3D3D3"),t.opacity||(t.opacity=1),t}drawMessage(e){const t=e.context;t.save(),t.font="15px Verdana";const i=t.measureText(e.features),r=e.top+e.height/2+20;t.fillStyle=e.textColor;for(let s=0;s<e.pixelWidth;s+=i.width+10)t.fillText(e.features,s,r);t.restore()}static getTrack(e){e=P.parseConfig(e);let t=P.track_types[e.type];if(!t)throw new Error("Track type "+e.type+" not recognised");return new t.class(e)}}P.custom_tracks={};P.track_types={};class fe extends P{constructor(e){e||(e={track_id:"ruler"+fe.count,format:"ruler",short_label:"Ruler",type:"ruler"}),super(e),this.height=30,this.config.height=30,this.name="",this.disableButtons=!0,this.ignoreTrackMenu=!0,this.order=-Number.MAX_VALUE,fe.count++}getFeatures(e,t,i){return new Promise(function(r,s){r([])})}drawFeatures(e){const t=e.context,i={textAlign:"center",font:"10px PT Sans",fillStyle:e.textColor,strokeStyle:e.textColor},r=Math.floor(1100*e.bpPerPixel),s=fe.findSpacing(r),n=s.majorTick;let o=Math.floor(e.bpStart/n)-1,l=0,h=e.top+this.height;T.setProperties(t,i);const f=2;for(;l<e.pixelWidth;){const d=Math.floor(o*n);l=Math.round((d-1-e.bpStart+.5)/e.bpPerPixel);const v=c(d/s.unitMultiplier,0)+" "+s.majorUnit;o%1==0&&T.fillText(t,v,l,h-15),T.strokeLine(t,l,h-10,l,h-f),o++}T.strokeLine(t,0,h-f,e.pixelWidth,h-f);function c(d,v){let x=10;switch(v){case 0:x=1;break;case 1:x=10;break;case 2:x=100;break;default:x=1e3}let p=""+Math.abs(Math.round(d*x)/x);p.indexOf(".")==-1&&(p+=".");let m=p.substring(0,p.indexOf("."));const _=m-0;let w=p.substring(p.indexOf("."));for(;w.length-1<v;)w+="0";if(w=="."&&(w=""),_>=1e3){var b=m.length;m=parseInt(""+_/1e3)+","+m.substring(b-3,b)}_>=1e6&&(b=m.length,m=parseInt(""+_/1e6)+","+m.substring(b-7,b));let k=m+w;return d<0&&(k="("+k+")"),k}return h}static findSpacing(e){if(e<10)return new Ze(1,"",1);var t=Math.floor(n(e)),i="",r=1;t>9&&(i="gb",r=1e9),t>6?(i="mb",r=1e6):t>3&&(i="kb",r=1e3);var s=e/Math.pow(10,t-1);if(s<25)return new Ze(Math.pow(10,t-1),i,r);return new Ze(Math.pow(10,t)/2,i,r);function n(o){var l=Math.log(10);return Math.log(o)/l}}}fe.count=0;P.track_types.ruler={class:fe,name:"Ruler"};class Ze{constructor(e,t,i){this.majorTick=e,this.majorUnit=t,this.unitMultiplier=i}}class at extends P{constructor(e){super(e),this._setFeatureSource(),this.filter_function=null,this.color_function=null}_setFeatureSource(){this.feature_source=new si(this.config)}setFilterFunction(e){this.filter_function=e}getCurrentFeatures(e,t,i){return this.feature_source.featureCache.queryFeatures(e,t,i)}drawFeatures(e){let t=0;var i,r=e.features,s=e.context,n=e.bpPerPixel,o=e.bpStart,l=e.pixelWidth;e.pixelHeight;var h=o+l*n+1;let f=0;e.top&&(f=e.top),this.top=f;let c=this.config,d=0,v=d+l;this.config.squishedCallHeight=this.config.featureHeight+10,this.config.expandedCallHeight=this.config.featureHeight/2+2;let x=null;if(r.length>5e4&&(x=Math.round(r.length/5e4)+1),r){let _=this.config.opacity?this.config.opacity:1;s.globalAlpha=_;for(var g,p=0,m=r.length;p<m;p++){if(x&&p%x!==0)continue;if(g=r[p],this.filter_function&&!this.filter_function(g)){g.display=!1;continue}if(g.display=!0,g.end<o)continue;if(g.start>h)break;let w=this.calculateFeatureCoordinates(g,o,n),b=c.featureHeight;c.displayMode==="SQUISHED"&&g.row!=null?(b=c.featureHeight/2,i=c.expandedCallHeight*g.row+2):c.displayMode==="EXPANDED"&&g.row!=null?i=c.squishedCallHeight*g.row+5:i=5,i+=f,i+b>t&&(t=i+b),w.py=i,w.h=b;let k={bpPerPixel:n,bpStart:o,pixelWidth:l};this.color_function&&(g.color=this.color_function(g)),this.renderFeature(g,w,s,k,e.textColor),this.renderFeatureLabel(s,g,w.px,w.px1,i,d,v,e.textColor)}s.globalAlpha=1}else console.log("No feature list");return this.bottom=t,this.config.displayMode==="COLLAPSED"&&(t+=25),t}renderFeatureLabel(e,t,i,r,s,n,o,l){let h=this.config;var f,c,d,v,x,g,p;r<n||i>o?(d=i,v=r):(d=Math.max(i,n),v=Math.min(r,o));let m=t.name;this.label_function&&(m=this.label_function(t)),p=v-d>e.measureText(m).width,p&&h.displayMode!="SQUISHED"&&m&&(f={font:"10px PT Sans",textAlign:"center",fillStyle:h.color||l,strokeStyle:h.color||l},h.displayMode==="COLLAPSED"&&h.labelDisplayMode==="SLANT"&&(c={rotate:{angle:45}},delete f.textAlign),x=d+(v-d)/2,g=_(s,c),T.fillText(e,m,x,g,f,c));function _(w,b){return b?w+h.featureHeight+14:w+h.featureHeight+7}}calculateFeatureCoordinates(e,t,i){var r=Math.round((e.start-1-t)/i),s=Math.round((e.end-t)/i),n=s-r;return n<3&&(n=3,r-=1),{px:r,px1:s,pw:n}}renderFeature(e,t,i,r,s){var n,o,l,h,f,c,d,v,x,g,p,m=20,_=this.config.color||s;e.color&&(_=e.color),i.fillStyle=_,i.strokeStyle=_,l=t.py+t.h/2,p=t.h/2,g=l-p/2;let w=e.exons?e.exons.length:0;if(w==0)i.fillRect(t.px,t.py,t.pw,t.h);else{for(t.px=Math.max(t.px,0),t.px1=Math.min(t.px1,r.pixelWidth),T.strokeLine(i,t.px+1,l,t.px1-1,l),h=e.strand=="+"?1:-1,o=t.px+m/2;o<t.px1;o+=m)T.strokeLine(i,o-h*2,l-2,o,l),T.strokeLine(i,o-h*2,l+2,o,l);for(n=0;n<w;n++)if(f=e.exons[n],c=Math.round((f.start-r.bpStart)/r.bpPerPixel),d=Math.round((f.end-r.bpStart)/r.bpPerPixel),x=Math.max(1,d-c),f.utr)i.fillRect(c,g,x,p);else if(f.cdStart&&(v=Math.round((f.cdStart-r.bpStart)/r.bpPerPixel),i.fillRect(c,g,v-c,p),x-=v-c,c=v),f.cdEnd&&(v=Math.round((f.cdEnd-r.bpStart)/r.bpPerPixel),i.fillRect(v,g,d-v,p),x-=d-v,d=v),i.fillRect(c,t.py,x,t.h),x>m+5){for(i.fillStyle="white",i.strokeStyle="white",o=c+m/2;o<d;o+=m)T.strokeLine(i,o-h*2,l-2,o,l),T.strokeLine(i,o-h*2,l+2,o,l);i.fillStyle=_,i.strokeStyle=_}}}getFeatureAt(e,t,i,r){let s=i.y-this.top;if(this.feature_source.featureCache){var n=2*r,o=this.feature_source.featureCache.queryFeatures(t,e-n,e+n),l;if(this.config.displayMode!="COLLAPSED")l=Math.floor(this.config.displayMode==="SQUISHED"?s/this.config.expandedCallHeight:s/this.config.squishedCallHeight);else if(s<5||s>5+this.config.featureHeight)return;if(o&&o.length>0){for(let h of o)if(h.end>=e-n&&h.start<=e+n&&(l===void 0||h.row===void 0||l===h.row)&&h.display)return h}}return null}}P.track_types.bed={class:at,name:"bed(tabix)"};class Sr extends at{constructor(e){super(e)}_setFeatureSource(){this.feature_source=new _r(this.config)}}P.track_types.bigbed={class:Sr,name:"BigBed"};class st extends P{constructor(e){e.format="wig",super(e),this._setFeatureSource()}_setFeatureSource(){this.feature_source=new he(this.config)}getSettings(e){return[...super.getSettings(e),{type:"check",label:"Show data range",value:this.config.showDataRange,func:t=>{this.setConfigAttribute("showDataRange",t),e.update()}}]}drawScale(e,t,i){if(this.config.scale_link_to&&this.config.group)return;let r=this.top,s=this.bottom;t.fillStyle=i,t.strokeStyle=i,t.beginPath(),t.moveTo(0,r),t.lineTo(0,s),t.moveTo(0,r),t.lineTo(20,r),t.moveTo(0,s),t.lineTo(20,s),t.font="12px Arial",t.stroke(),t.textBaseline="top",this.max_y!=null&&(t.fillText(this.max_y.toFixed(2),20,r),t.textBaseline="alphabetic",t.fillText(this.min_y,20,s))}drawFeatures(e){let t=this,i=e.features,r=this.config.color,s=e.context,n=e.bpPerPixel,o=e.bpStart,l=e.pixelWidth,h=e.pixelHeight,f=e.top,c=o+l*n+1,d;if(this.config.group?h=e.height:h=this.config.height,r||(r="black"),this.prev_coords={x:0,y:0},i){if(this.scale_link_to){let m=this.scale_link_to.config;m&&(this.config.scale=m.scale,this.max_y=this.scale_link_to.max_y,this.min_y=this.scale_link_to.min_y)}else if(this.set_scale)this.min_y=this.set_scale.min,this.max_y=this.set_scale.max;else if(this.max_y===void 0&&this.config.scale==="automatic"||this.config.scale==="dynamic"){var v=g(i);this.min_y=v.min,this.max_y=v.max}else this.config.scale==="fixed"&&(this.min_y=this.config.min_y,this.max_y=this.config.max_y);if(d=this.max_y-this.min_y,s.globalAlpha=this.config.opacity?this.config.opacity:1,this.is_line){let m=(1-this.config.value/d)*h;T.strokeLine(s,0,m,l,m,{strokeStyle:this.config.color,lineWidth:this.config.width?this.config.width:1})}else{if(!Array.isArray(i))throw i;i.forEach(x),this.config.showDataRange&&(s.save(),i.forEach(m=>{m.valueBak=m.value,m.value=m.minVal}),s.globalAlpha*=.4,i.forEach(x),i.forEach(m=>m.value=m.maxVal),i.forEach(x),i.forEach(m=>m.value=m.valueBak),s.restore())}if(s.globalAlpha=1,this.config.threshold){let m=f+(1-this.config.threshold/d)*h;T.strokeLine(s,0,m,l,m,{strokeStyle:"black",lineWidth:1})}}function x(m){let _,w,b,k,y,S,A;if(!(m.end<o)&&!(m.start>c))if(m.end===m.start&&(m.start-=1),b=Math.floor((m.start-o)/n),A=Math.floor((m.end-o)/n),y=Math.max(0,A-b),p(t.min_y,t.max_y)?m.value<0?(_=t.max_y/d,w=-m.value/d):(_=(t.max_y-m.value)/d,w=m.value/d):t.min_y<0?(_=0,w=-m.value/d):(_=1-(m.value-t.min_y)/d,w=(m.value+t.min_y)/d),k=_*h+f,k=k<f?f:k,S=w*h,S=S>h?h:S,t.config.display==="line")t.prev_coords.x&&T.strokeLine(s,b,k,t.prev_coords.x,t.prev_coords.y,{strokeStyle:r,lineWidth:3}),t.prev_coords.x=b,t.prev_coords.y=k;else{const C=t.config.phase_data;if(C){const D=n*b+o;if(D>C.st&&D<C.en){const E=C.ratio*S;T.fillRect(s,b,k,y,E,{fillStyle:"blue"}),T.fillRect(s,b,k+E,y,S-E,{fillStyle:"red"})}else T.fillRect(s,b,k,y,S,{fillStyle:r})}else T.fillRect(s,b,k,y,S,{fillStyle:r})}}function g(m){let _=Number.MAX_VALUE,w=-Number.MAX_VALUE;return Array.isArray(m)?(m.forEach(function(b){_=Math.min(_,b.value),w=Math.max(w,b.value)}),{min:_,max:w}):(console.warn("features is not an array"),{min:0,max:100})}function p(m,_){return m>0&&_<0||m<0&&_>0}return this.top=f,this.bottom=f+h,this.bottom}}P.track_types.bigwig={class:st,name:"BigWig"};class Cr extends st{constructor(e){super(e),this.is_line=!0}getFeatures(e,t,i){return new Promise(function(r,s){r([])})}}P.track_types.line={class:Cr,name:"Line Track"};class Tr extends P{constructor(e){super(e),this._setFeatureSource(e),this.sequenceType=e.sequenceType||"dna",this.height=15}_setFeatureSource(e){this.feature_source=new ni(e.url)}getFeatures(e,t,i,r,s){let n=this;return new Promise(function(o,l){s.bpPerPixel>1?o(null):n.feature_source.getSequence(e,t,i).then(o).catch(l)})}drawFeatures(e){var t=e.features,i=e.context,r=e.bpPerPixel,s=e.bpStart,n=e.pixelWidth,o=s+n*r+1,l,h,f,c,d,v,x,g,p,m;let _=e.top;if(t)for(l=t.length,h=1/r,f=_+this.height/2,c=s;c<=o;c++)d=c-s,d<l&&(v=t[d],x=Math.floor(d*h),g=Math.floor((d+1)*h),p=Math.round((x+g)/2),this.color?m=this.color:this.sequenceType==="dna"?m=T.nucleotideColors[v]:m="rgb(0, 0, 150)",m||(m="gray"),r>.18?T.fillRect(i,x,_,g-x,10,{fillStyle:m}):T.strokeText(i,v,p,f,{strokeStyle:m,font:"normal 10px Arial",textAlign:"center"}));return _+10}}P.track_types.fasta={class:Tr,name:"Fasta"};class T{static setProperties(e,t){for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];e[i]=r}}static strokeLine(e,t,i,r,s,n){t=Math.floor(t)+.5,i=Math.floor(i)+.5,r=Math.floor(r)+.5,s=Math.floor(s)+.5,e.save(),n&&T.setProperties(e,n),e.beginPath(),e.moveTo(t,i),e.lineTo(r,s),e.stroke(),e.restore()}static fillRect(e,t,i,r,s,n){t=Math.round(t),i=Math.round(i),n&&(e.save(),T.setProperties(e,n)),e.fillRect(t,i,r,s),n&&e.restore()}static fillPolygon(e,t,i,r){e.save(),r&&T.setProperties(e,r),T.doPath(e,t,i),e.fill(),e.restore()}static strokePolygon(e,t,i,r){e.save(),r&&T.setProperties(e,r),T.doPath(e,t,i),e.stroke(),e.restore()}static fillText(e,t,i,r,s,n){if(s&&(e.save(),T.setProperties(e,s)),e.save(),e.translate(i,r),n)for(var o in n){var l=n[o];o=="translate"&&e.translate(l.x,l.y),o=="rotate"&&e.rotate(l.angle*Math.PI/180)}e.fillText(t,0,0),e.restore(),s&&e.restore()}static strokeText(e,t,i,r,s,n){if(e.save(),s&&T.setProperties(e,s),e.translate(i,r),n)for(var o in n){var l=n[o];o=="translate"&&e.translate(l.x,l.y),o=="rotate"&&e.rotate(l.angle*Math.PI/180)}e.strokeText(t,0,0),e.restore()}static strokeCircle(e,t,i,r){e.beginPath(),e.arc(t,i,r,0,2*Math.PI),e.stroke()}static fillCircle(e,t,i,r){e.beginPath(),e.arc(t,i,r,0,2*Math.PI),e.fill()}static drawArrowhead(e,t,i,r,s){e.save(),r||(r=5),s&&(e.lineWidth=s),e.beginPath(),e.moveTo(t,i-r/2),e.lineTo(t,i+r/2),e.lineTo(t+r,i),e.lineTo(t,i-r/2),e.closePath(),e.fill(),e.restore()}static dashedLine(e,t,i,r,s,n,o){e.save(),t=Math.round(t),i=Math.round(i),r=Math.round(r),s=Math.round(s),n=Math.round(n),log("dashedLine"),o&&T.setProperties(e,o),n==null&&(n=2),e.moveTo(t,i);for(var l=r-t,h=s-i,f=Math.floor(Math.sqrt(l*l+h*h)/n),c=l/f,d=h/f,v=0;v++<f;)t+=c,i+=d,e[v%2==0?"moveTo":"lineTo"](t,i);e[v%2==0?"moveTo":"lineTo"](r,s),e.restore()}static doPath(e,t,i){var r,s=t.length;for(r=0;r<s;r++)t[r]=Math.round(t[r]),i[r]=Math.round(i[r]);for(e.beginPath(),e.moveTo(t[0],i[0]),r=1;r<s;r++)e.lineTo(t[r],i[r]);e.closePath()}}T.nucleotideColors={A:"green",T:"red",G:"gray",C:"blue",a:"green",t:"red",c:"blue",g:"gray"};var ge=0,Wt=5,je=5;const Ar=50;class nt extends P{constructor(e){e.color||(e.color="#D3D3D3"),super(e),this._setFeatureSource(),this.config.bigwig&&(this.bigwig_track=new st({url:this.config.bigwig,type:"bigwig",discrete:!0,color:"#D3D3D3",scale:"dynamic",height:100})),this.config=e,e.coverageTrackHeight===void 0&&(e.coverageTrackHeight=Ar),this.visibilityWindow=e.visibilityWindow||3e4,this.viewAsPairs=!0,this.pairsSupported=e.pairsSupported===void 0,this.color=e.color||"rgb(185, 185, 185)",this.sortOption=e.sortOption||{sort:"NUCLEOTIDE"},this.sortDirection=!0,this.filterOption=e.filterOption||{name:"mappingQuality",params:[30,void 0]},this.display_alignments=!0}_setFeatureSource(){this.feature_source=new cr(this.config,this),this.feature_source.setViewAsPairs(!0),this.coverageTrack=new Ir(this.config,this),this.alignmentTrack=new Dr(this.config,this)}getFeatures(e,t,i,r,s){return i-t>5e5&&this.bigwig_track?(this.draw_bigwig=!0,this.bigwig_track.getFeatures(e,t,i,r,s)):(this.draw_bigwig=!1,this.feature_source.getAlignments(e,t,i))}altClick(e,t){this.alignmentTrack.sortAlignmentRows(e,this.sortOption),this.trackView.redrawTile(this.featureSource.alignmentContainer),$(this.trackView.viewportDiv).scrollTop(0),this.sortDirection=!this.sortDirection}computePixelHeight(e){return this.coverageTrack.computePixelHeight(e)+this.alignmentTrack.computePixelHeight(e)}drawFeatures(e){if(this.top=e.top,this.draw_zoom_in)return this.bottom=this.top+this.config.height,this.bottom;if(this.draw_bigwig){this.bottom=this.bigwig_track.drawFeatures(e);return}return this.coverageTrack.height>0&&this.coverageTrack.draw(e),this.bottom=this.alignmentTrack.draw(e),this.bottom}paintAxis(e,t,i){this.coverageTrack.paintAxis(e,t,this.coverageTrackHeight)}getFeatureAt(e,t,i,r){if(!this.feature_source.alignmentContainer)return null;var s=this.feature_source.alignmentContainer.packedAlignmentRows,n=this.feature_source.alignmentContainer.downsampledIntervals,o,l,h,f,c,d;if(!s)return null;if(o=Math.floor((i.y-this.top-this.coverageTrack.height-ge)/this.config.featureHeight),o<0){for(f=0,c=n.length;f<c;f++)if(n[f].start<=e&&n[f].end>=e){h=n[f];break}}else if(o<s.length){for(l=s[o],h=void 0,f=0,c=l.alignments.length,d;f<c;f++)if(d=l.alignments[f],d.start<=e&&d.start+d.lengthOnRef>=e){h=d;break}}return h}popupData(e,t,i){return i>=this.coverageTrack.top&&i<this.coverageTrack.height?this.coverageTrack.popupData(e,t,this.coverageTrack.top):this.alignmentTrack.popupData(e,t,i-this.alignmentTrack.top)}popupMenuItems(e){var t=this,i,r=[],s=[],n="tag"+(t.alignmentTrack.colorByTag?" ("+t.alignmentTrack.colorByTag+")":""),o;return s.push({key:"none",label:"track color"}),t.viewAsPairs||s.push({key:"strand",label:"read strand"}),t.pairsSupported&&t.alignmentTrack.hasPairs&&s.push({key:"firstOfPairStrand",label:"first-of-pair strand"}),s.push({key:"tag",label:n}),r.push(igv.colorPickerMenuItem(e,this.trackView)),r.push('<div class="igv-track-menu-category igv-track-menu-border-top">Color by</div>'),s.forEach(function(h){o=t.alignmentTrack.colorBy===h.key,r.push(l(h,o))}),i=[],t.pairsSupported&&t.alignmentTrack.hasPairs&&(i.push('<div class="igv-track-menu-item igv-track-menu-border-top">'),i.push(t.viewAsPairs===!0?'<i class="fa fa-check fa-check-shim">':'<i class="fa fa-check fa-check-shim fa-check-hidden">'),i.push("</i>"),i.push("View as pairs"),i.push("</div>"),r.push({object:$(i.join("")),click:function(){var h=$(this).find("i");e.hide(),t.viewAsPairs=!t.viewAsPairs,t.viewAsPairs===!0?h.removeClass("fa-check-hidden"):h.addClass("fa-check-hidden"),t.featureSource.setViewAsPairs(t.viewAsPairs),t.trackView.update()}})),r;function l(h,f,c){var d=[],v={};return d.push('<div class="igv-track-menu-item">'),d.push(f?'<i class="fa fa-check fa-check-shim"></i>':'<i class="fa fa-check fa-check-shim fa-check-hidden"></i>'),h.key==="tag"?d.push('<span id="color-by-tag">'):d.push("<span>"),d.push(h.label),d.push("</span>"),d.push("</div>"),v.object=$(d.join("")),v.click=function(){igv.popover.hide(),h.key==="tag"?(igv.dialog.configure(function(){return"Tag Name"},t.alignmentTrack.colorByTag?t.alignmentTrack.colorByTag:"",function(){var x=igv.dialog.$dialogInput.val().trim();t.alignmentTrack.colorBy="tag",x!==t.alignmentTrack.colorByTag&&(t.alignmentTrack.colorByTag=igv.dialog.$dialogInput.val().trim(),t.alignmentTrack.tagColors=new igv.PaletteColorTable("Set1"),$("#color-by-tag").text(t.alignmentTrack.colorByTag)),t.trackView.update()}),igv.dialog.show($(t.trackView.trackDiv))):(t.alignmentTrack.colorBy=h.key,t.trackView.update())},v}}}function Er(a,e,t){var i,r,s=5,n=20,o=[0,255,255];if(o)return a<s?r=.1:r=Math.max(.1,Math.min(1,.1+.9*(a-s)/(n-s))),r=Math.round(r*10)/10,r>=1?i=T.nucleotideColors[e]:i="rgba("+o[0]+","+o[1]+","+o[2]+","+r+")",i}class Ir{constructor(e,t){this.parent=t,this.featureSource=t.featureSource,this.height=20,this.dataRange={min:0}}computePixelHeight(e){return this.height}draw(e){var t=this,i=e.features,r=e.context,s=e.bpPerPixel,n=e.bpStart,o=e.pixelWidth,l=n+o*s+1,h=i.coverageMap,f,c,d,v,x,g,p,m,_,w,b;h.refSeq&&(b=h.refSeq.toUpperCase()),this.dataRange.max=h.maximum;var k=e.top;for(e.top+=this.height,v=Math.max(1,Math.ceil(1/s)),p=0,m=h.coverage.length;p<m;p++)if(f=h.bpStart+p,!(f<n)){if(f>l)break;_=h.coverage[p],_&&(x=Math.round(_.total/this.dataRange.max*this.height),d=this.height-x,c=Math.floor((f-n)/s),T.setProperties(r,{fillStyle:this.parent.config.color,strokeStyle:this.color}),T.fillRect(r,c,d+k,v,x))}if(b){for(p=0,m=h.coverage.length;p<m;p++)if(f=h.bpStart+p,!(f<n)){if(f>l)break;_=h.coverage[p],_&&(x=_.total/this.dataRange.max*this.height,d=this.height-x,c=Math.floor((f-n)/s),g=b[p],_.isMismatch(g)&&(T.setProperties(r,{fillStyle:T.nucleotideColors[g]}),T.fillRect(r,c,d+k,v,x),w=0,["A","C","T","G"].forEach(function(y){var S,A;S=_["pos"+y]+_["neg"+y],A=S/t.dataRange.max*t.height,d=t.height-A-w,w+=A,T.setProperties(r,{fillStyle:T.nucleotideColors[y]}),T.fillRect(r,c,d+k,v,A)})))}}}popupData(e,t,i){var r=this.featureSource.alignmentContainer.coverageMap,s,n,o=[];return s=e-r.bpStart,n=r.coverage[s],n&&(o.push(igv.browser.referenceFrame.chr+":"+igv.numberFormatter(1+e)),o.push({name:"Total Count",value:n.total}),tmp=n.posA+n.negA,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor((n.posA+n.negA)/n.total*100)+"%)"),o.push({name:"A",value:tmp}),tmp=n.posC+n.negC,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/n.total*100)+"%)"),o.push({name:"C",value:tmp}),tmp=n.posG+n.negG,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/n.total*100)+"%)"),o.push({name:"G",value:tmp}),tmp=n.posT+n.negT,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/n.total*100)+"%)"),o.push({name:"T",value:tmp}),tmp=n.posN+n.negN,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/n.total*100)+"%)"),o.push({name:"N",value:tmp})),o}}class Dr{constructor(e,t){this.config=e,this.parent=t,this.featureSource=t.feature_source,this.alignmentRowHeight=e.alignmentRowHeight||6,this.negStrandColor=e.negStrandColor||"rgba(150, 150, 230, 0.75)",this.posStrandColor=e.posStrandColor||"rgba(230, 150, 150, 0.75)",this.insertionColor=e.insertionColor||"rgb(138, 94, 161)",this.deletionColor=e.deletionColor||"black",this.skippedColor=e.skippedColor||"rgb(150, 170, 170)",this.colorBy=e.colorBy||"none",this.colorByTag=e.colorByTag,this.bamColorTag=e.bamColorTag===void 0?"YC":e.bamColorTag,this.sortOption=e.sortOption||{sort:"NUCLEOTIDE"},this.sortDirection=!0,this.hasPairs=!1}computePixelHeight(e){if(e.packedAlignmentRows){var t=0;return e.hasDownsampledIntervals()&&(t+=je+Wt),t+this.config.featureHeight*e.packedAlignmentRows.length+5}else return this.height}draw(e){var t=this,i=e.features,r=e.context,s=e.bpPerPixel,n=e.bpStart,o=e.pixelWidth,l=n+o*s+1,h=i.packedAlignmentRows,f=i.sequence,c="normal "+(this.config.featureHeight-2)+"px Arial";if(!h)return;let d=e.top;f&&(f=f.toUpperCase()),i.hasDownsampledIntervals()?(ge=je+Wt,i.downsampledIntervals.forEach(function(g){var p=(g.start-n)/s,m=(g.end-n)/s;m-p>5&&(p+=1,m-=1),T.fillRect(r,p,2,m-p,je-2,{fillStyle:"black"})})):ge=3,h&&h.forEach(function(p,b){var _=ge+t.config.featureHeight*b+d,w=t.config.featureHeight-2,b,k;for(b=0;b<p.alignments.length;b++)if(k=p.alignments[b],t.hasPairs=t.hasPairs||k.isPaired(),!(k.start+k.lengthOnRef<n)){if(k.start>l)break;k.hidden!==!0&&(k instanceof ye?(v(k,_,w),x(k.firstAlignment,_,w),k.secondAlignment&&x(k.secondAlignment,_,w)):x(k,_,w))}});function v(g,p,m){var _=t.getAlignmentColor(g.firstAlignment),w=_,b=(g.connectingStart-n)/s,k=(g.connectingEnd-n)/s,y=p+m/2;g.connectingEnd<n||g.connectingStart>l||(g.mq<=0&&(_=Je.addAlphaToRGB(_,"0.15")),T.setProperties(r,{fillStyle:_,strokeStyle:w}),T.strokeLine(r,b,y,k,y))}function x(g,p,m){var _=t.getAlignmentColor(g),w=_,b,k=g.blocks,y,S;if(_||(_="gray"),g.start+g.lengthOnRef<n||g.start>l)return;for(g.mq<=0&&(_=Je.addAlphaToRGB(_,"0.15")),T.setProperties(r,{fillStyle:_,strokeStyle:w}),S=0;S<k.length;S++)if(y=k[S],!(y.start+y.len<n)){if(A(y),y.start+y.len>l)break;g.insertions&&g.insertions.forEach(function(C){var D=C.start-n,E=D/s-1,O=3;T.fillRect(r,E,p-1,O,m+2,{fillStyle:t.insertionColor})})}function A(C){var D=C.start-i.start,E=(C.start-n)/s,O=(C.start+C.len-n)/s,X=Math.max(1,O-E),U=t.config.featureHeight/2,q=C.seq.toUpperCase(),_e=t.skippedColor,ue=t.deletionColor,oe,V,Y,le,de,Q,N,J,z,Ce=p+m/2;if(C.gapType!==void 0&&O!==void 0&&b!==void 0&&(C.gapType==="D"?T.strokeLine(r,b,Ce,E,Ce,{strokeStyle:ue}):T.strokeLine(r,b,Ce,E,Ce,{strokeStyle:_e})),b=O,g.strand===!0&&S===k.length-1?(N=[E,O,O+U,O,E,E],J=[p,p,p+m/2,p+m,p+m,p],T.fillPolygon(r,N,J,{fillStyle:_}),g.mq<=0&&T.strokePolygon(r,N,J,{strokeStyle:w})):g.strand===!1&&S===0?(N=[O,E,E-U,E,O,O],J=[p,p,p+m/2,p+m,p+m,p],T.fillPolygon(r,N,J,{fillStyle:_}),g.mq<=0&&T.strokePolygon(r,N,J,{strokeStyle:w})):(T.fillRect(r,E,p,X,m,{fillStyle:_}),g.mq<=0&&(r.save(),r.strokeStyle=w,r.strokeRect(E,p,X,m),r.restore())),f&&q!=="*")for(var z=0,oi=q.length;z<oi;z++)V=q.charAt(z),oe=f.charAt(D+z),V==="="&&(V=oe),(V==="X"||oe!==V)&&(C.qual&&C.qual.length>z?(Y=C.qual[z],Q=Er(Y,V,z+C.start)):Q=T.nucleotideColors[V],Q&&(le=(C.start+z-n)/s,de=Math.max(1,1/s),s<.15?T.strokeText(r,V,le+de/2,p+2,{strokeStyle:Q,font:c,textAlign:"center",textBaseline:"hanging"}):T.fillRect(r,le,p,de,m,{fillStyle:Q})))}}return ge+t.config.featureHeight*h.length+d}sortAlignmentRows(e,t){var i=this,r=this.featureSource.alignmentContainer,s=r.packedAlignmentRows;s.forEach(function(n){n.updateScore(e,r,t)}),s.sort(function(n,o){return i.sortDirection?n.score-o.score:o.score-n.score})}static doSortAlignmentRows(e,t,i,r){var s=t.packedAlignmentRows,n=t.sequence;if(n)n=n.toUpperCase();else{console.log("No sequence, no traversal. No discussion!");return}s.forEach(function(o){o.updateScore(e,t,i)}),s.sort(function(o,l){return r?o.score-l.score:l.score-o.score})}popupData(e,t,i){var r=this.featureSource.alignmentContainer.packedAlignmentRows,s=this.featureSource.alignmentContainer.downsampledIntervals,n,o,l,h,f,c;if(n=Math.floor((i-ge)/this.config.featureHeight),n<0){for(h=0,f=s.length;h<f;h++)if(s[h].start<=e&&s[h].end>=e){l=s[h];break}}else if(n<r.length){for(o=r[n],l=void 0,h=0,f=o.alignments.length,c;h<f;h++)if(c=o.alignments[h],c.start<=e&&c.start+c.lengthOnRef>=e){l=c;break}}return l?l.popupData(e):[]}getAlignmentColor(e){if(this.parent.color_function)return this.parent.color_function(e);var t=this,i=t.colorBy,r,s;switch(s=t.parent.config.color,i){case"strand":s=e.strand?t.posStrandColor:t.negStrandColor;break;case"firstOfPairStrand":e instanceof ye?s=e.firstOfPairStrand()?t.posStrandColor:t.negStrandColor:e.isPaired()&&(e.isFirstOfPair()?s=e.strand?t.posStrandColor:t.negStrandColor:e.isSecondOfPair()?s=e.strand?t.negStrandColor:t.posStrandColor:console.log("ERROR. Paired alignments are either first or second."));break;case"tag":r=e.tags()[t.colorByTag],r!==void 0&&(t.bamColorTag===t.colorByTag?s="rgb("+r+")":s=t.tagColors.getColor(r));break;default:s=t.parent.config.color}return s}}nt.filters={noop:function(){return function(a){return!1}},strand:function(a){return function(e){return e.strand===a}},mappingQuality:function(a,e){return function(t){return!!(a&&t.mq<a||e&&t.mq>e)}}};P.custom_tracks.bam=nt;P.track_types.bam={class:nt,name:"BAM"};class Rr extends P{constructor(e){super(e),this.catNumbers={},this.config.scale=this.config.scale||.1,this.config.size_filter=this.config.size_filter=50,this.config.size_filter_on=this.config.size_filter_on===void 0?!1:e.size_filter_on,this.config.tag||(this.config.tag="CB"),this.feature_source=new lr(this.config),this.setFragmentSizeFilter()}addIndex(e){this.feature_source.catIndex=e}getIdsInRange(e){return this.feature_source.getIdsInRange(e)}filterReads(e,t){this.feature_source.setFilter(e,t),this.feature_source.calculateCategories()}setCategories(e,t,i,r,s=!1,n=!1){if(e==null&&this.feature_source.setCategories(null,null),!this.catNumbers[e]||n){const o=new Array(i.length).fill(0);for(let l=0;l<t.length;l++)o[t[l]]++;this.catNumbers[e]=o}this.numbers=this.catNumbers[e],this.feature_source.setCategories(t,i),this.catColors=r,this.catNames=i,s&&this.feature_source.calculateCategories()}setFragmentSizeFilter(e,t){(e||e===!1)&&(this.config.size_filter_on=e),t&&(this.config.size_filter=t),this.feature_source.size_filter_on=this.config.size_filter_on,this.feature_source.size_filter=this.config.size_filter}async getFeatures(e,t,i,r,s){if(i-t>4e4)return"zoom in to see coverage";try{return await this.feature_source.getAlignments(e,t,i)}catch(n){return n.message}}drawScale(e,t,i){let r=this.top;const s=Math.round(this.config.height/this.catNames.length);t.strokeStyle=i,t.fillStyle=i;for(let n of this.catNames){let o=r+s;t.beginPath(),t.moveTo(0,r),t.lineTo(0,o),t.moveTo(0,r),t.lineTo(20,r),t.moveTo(0,o),t.lineTo(20,o),t.font="12px Arial",t.stroke(),t.textBaseline="top";let l=this.config.scale;t.fillText(l.toFixed(2),20,r),t.font="14px Arial",t.textBaseline="middle",t.fillText(n,2,r+s/2),t.font="12px Arial",r+=s}}drawFeatures(e){var t=e.features,i=e.context,r=e.bpPerPixel,s=e.bpStart,n=e.pixelWidth,o,l,h;const f=s-t.store[1],c=f+n*r+1,d=Math.round(this.config.height/t.length);let v=this.config.scale,x=e.top;this.top=e.top;let g=Math.max(1,Math.ceil(1/r)),p=r>5?5:1;for(let m=0;m<t.length;m++){let _=t[m];i.fillStyle=this.catColors[m];for(let w=f;w<c;w+=p){let b=w+t.store[1];_[w]!==-0&&(o=Math.round(_[w]/this.numbers[m]/v*d),o=o>d?d:o,l=d-o,h=Math.floor((b-s)/r),i.fillRect(h,l+x,g,o))}x+=d}}getSettings(e){return super.getSettings(e).concat([{label:"Fragment Size Filter",type:"check",current_value:this.config.size_filter_on,func:i=>{this.setFragmentSizeFilter(i),this.feature_source.calculateCategories(),e.update()}},{type:"slider",min:0,max:300,step:1,label:"Fragment Size",current_value:this.config.size_filter,func:i=>{this.setFragmentSizeFilter(null,i),this.feature_source.calculateCategories(),e.update()}},{type:"slider",min:0,max:1,label:"Scale (cov/no cells)",current_value:this.config.scale,func:i=>{this.config.scale=i,e.update()}}])}}P.track_types.bam_sca_track={class:Rr,name:"BAM SCA Track"};let Lr=function(a,e){e.data=[parseInt(a[0])],e.end1=parseInt(a[1]),e.start2=parseInt(a[2]),e.val=parseFloat(a[3])};class Fr extends at{_setFeatureSource(){this.feature_source=new si(this.config,Lr)}getFeatureAt(e,t,i,r,s){const n=s.getImageData(i.x,i.y,1,1).data;if(n[0]!==0||n[1]!==0||n[2]!==255)return null;const o=r,l=[],h=this.feature_source.featureCache.queryFeatures(t,e-o,e+o);for(let f of h)(e>=f.start-o&&e<=f.end1+o||e>=f.start2-o&&e<=f.end+o)&&l.push(f);return l.length>0?l:null}onFeatureOver(e,{track:t,feature:i,event:r}){this.drawCurves({ctx:e.ctx,features:i,bpStart:e.start,yOffset:e.yOffset,bpEnd:e.end,bpPerPixel:(e.end-e.start)/e.canvas.width,color:"red",region:!1})}onFeatureOut(e,{track:t,feature:i,event:r}){this.drawCurves({ctx:e.ctx,features:i,yOffset:e.yOffset,bpStart:e.start,bpEnd:e.end,bpPerPixel:(e.end-e.start)/e.canvas.width,region:!1})}getSettings(e){const t=super.getSettings(e);return this.config.value,t.concat([{type:"check",label:"Only show local",current_value:this.config.onlyShowLocal,func:i=>{this.config.onlyShowLocal=i,e.update()}}])}drawCurves({ctx:e,features:t,bpStart:i,bpPerPixel:r,color:s,region:n,pixelWidth:o,yOffset:l=0}){const h=o*r+i,c=this.bottom+l-6,d=this.config.onlyShowLocal;if(this.config.value){const x=this.config.value.cutoff,g=this.config.range[0]*1e3,p=this.config.range[1]*1e3,m=this.config.onlyShowLocal;t=t.filter(_=>_.val>x[0]&&_.val<x[1]&&_.end-_.start>g&&_.end-_.start<p&&(!m||_.end1>i&&_.start2<h))}let v=1;t.length>2e3&&this.filter_function,e.beginPath();for(let x=0;x<t.length;x+=v){const g=t[x];if(this.filter_function&&!this.filter_function(g)||d&&(g.end>h||g.start<i)){g.display=!1;continue}let p=(g.start-i)/r;const m=(g.end1-i)/r;let _=(g.start2-i)/r;const w=(g.end-i)/r,b=p+(m-p)/2;let k=_+(w-_)/2,y=(g.end-g.start)/(r*200)*this.config.height;y=y>this.config.height*1.2?this.config.height*1.2:y,y=y<10?10:y;const S=s||(this.color_function?this.color_function(g):"gray");e.strokeStyle=S,e.beginPath(),e.moveTo(b,c),k-b<3&&(k=b+3);const A=b+(k-b)/2;if(e.bezierCurveTo(A,c-y,A,c-y,k,c),e.stroke(),n){e.fillStyle="blue";let C=m-p;C<5&&(C=5,p-=2),e.fillRect(p,this.bottom-6,C,6),C=w-_,C<5&&(C=5,_-=2),e.fillRect(_,this.bottom-6,C,6)}}}drawFeatures(e){this.drawCurves({ctx:e.context,features:e.features,bpStart:e.bpStart,bpPerPixel:e.bpPerPixel,region:!0,pixelWidth:e.pixelWidth})}}P.track_types.interaction_track={class:Fr};class Mr extends hi{constructor(e,t){const i=e.onclose;e.onclose=()=>{i&&i(),e.chart&&e.chart.dialogs.splice(e.chart.dialogs.indexOf(this),1)},super(e,t)}init(e){this.controls||(this.controls=[]);const t=this.dialog;for(const i of e){const r=R("div",{styles:{}},t);if(i.type!=="button"&&R("label",{text:i.label},r),i.info&&this.addInfoIcon(i.info,r),!this[i.type]){console.warn(`SettingsDialog doesn't have a method '${i.type}'`);continue}this.config.useMobx&&i.func&&(i.func=fi(`${i.label} <action>`,i.func)),this.controls[i.label]=this[i.type](i,r)}}initLilGui(e){const t=new lgui({container:this.dialog});for(const i of e)switch(i.type){case"dropdown":t.add(i,"current_value",i.values[0].map(r=>r[i.values[1]])).name(i.label).onChange(i.func);break;case"check":i.current_value===void 0&&(i.current_value=!1),t.add(i,"current_value").name(i.label).onChange(i.func);break;case"button":t.add(i,"func").name(i.label);break;case"slider":t.add(i,"current_value",i.min,i.max).name(i.label).onChange(i.func);break;case"spinner":t.add(i,"current_value",i.min,i.max).name(i.label).onChange(i.func);break;case"radiobuttons":t.add(i,"current_value",i.choices).name(i.label).onChange(i.func);break;default:t.add(i,"current_value").name(i.label).onChange(i.func)}}folder(e,t){this.init(e.current_value)}spinner(e,t){const i=R("input",{type:"number",value:e.current_value,max:e.max||null,min:e.min||0,step:e.step||1},t);i.addEventListener("change",r=>{e.func(Number.parseInt(i.value))})}radiobuttons(e,t){const i=R("div",{classes:["ciview-radio-group"]},t);for(const r of e.choices){R("span",{text:r[0]},i);const s=R("input",{type:"radio",name:e.label,value:r[1]},i);s.checked=e.current_value===r[1],s.addEventListener("click",n=>{e.func(n.currentTarget.value)})}}colorChooser(e,t){const i=R("input",{type:"color",value:e.current_value},t);i.addEventListener("change",r=>{e.func(i.value)})}button(e,t){t.style.textAlign="center",R("button",{classes:["ciview-button"],text:e.label},t).addEventListener("click",i=>{e.func()})}slider(e,t){const i=R("div",{},t);ot.create(i,{start:[e.current_value||0],range:{min:[e.min||0],max:[e.max||1]},step:e.step||null,tooltips:!0,documentElement:e.doc||this.config.doc});const r=s=>{e.func(Number.parseFloat(s[0]))};return i.noUiSlider.on("end",r),e.continuous&&(console.log("adding update listener for ",e.label),i.noUiSlider.on("update",r)),i}check(e,t){const i=R("input",{type:"checkbox"},t);i.checked=e.current_value,i.addEventListener("click",r=>{e.func(i.checked)})}multidropdown(e,t){const i=R("div"),r=R("select",{multiple:!0,styles:{maxWidth:"200px",height:"100px"}},i);R("br",{},t);for(const n of e.values[0]){const o=e.values.length>1?n[e.values[1]]:n,l=e.values.length>1?n[e.values[2]]:n,h={text:o,value:l};e.current_value.indexOf(l)!==-1&&(h.selected=!0),R("option",h,r)}return R("br",{},t),R("button",{classes:["ciview-button-sm"],text:"Change"},t).addEventListener("click",n=>{e.func(Array.from(r.selectedOptions).map(o=>o.value))}),lt(r,i),t.append(i),r}dropdown(e,t){const i=R("div"),r=R("select",{styles:{maxWidth:"200px"}},i);for(const s of e.values[0]){const n=e.values.length>1?s[e.values[1]]:s,o=e.values.length>1?s[e.values[2]]:s;R("option",{text:n,value:o},r)}return r.value=e.current_value,r.addEventListener("change",s=>{e.func(r.value,this.controls),r.title=r.value,e.onchange&&e.onchange(this.controls,r.value)}),lt(r,i),t.append(i),i}doubleslider(e,t){const i=R("div",{styles:{}},t);ot.create(i,{tooltips:!0,start:[e.current_value[0],e.current_value[1]],range:{min:[e.min],max:[e.max]},documentElement:e.doc});const r=s=>{e.func(Number.parseFloat(s[0]),Number.parseFloat(s[1]))};return i.noUiSlider.on("end",r),e.continuous&&i.noUiSlider.on("update",r),i}text(e,t){const i=R("input",{value:e.current_value,size:10,styles:{flex:1}},t);i.addEventListener("keyup",r=>{if(e.only_update_on_enter){r.key==="Enter"&&e.func(i.value);return}e.func(i.value)})}textbox(e,t){const i=R("textarea",{styles:{width:"100%"}},t);i.value=e.current_value,i.addEventListener("input",r=>{e.func(i.value)}),i.addEventListener("blur",r=>{e.func(i.value)})}addInfoIcon(e,t){const i=R("span",{"aria-label":e.text,role:"tooltip","data-microtip-size":"medium","data-microtip-position":e.position,styles:{marginLeft:"5px"},classes:["ttt"]},t);return R("i",{classes:["fas","fa-info"]},i),i}}function H(a,e){var t,i=Object.keys(e);for(t=0;t<i.length;t++)a=a.replace(new RegExp("\\{"+i[t]+"\\}","gi"),e[i[t]]);return a}function Ie(a){var e,t,i;if(!a)throw new Error("cannot create a random attribute name for an undefined object");e="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",t="";do for(t="",i=0;i<12;i++)t+=e[Math.floor(Math.random()*e.length)];while(a[t]);return t}var Gt={left:"start",right:"end",center:"middle",start:"start",end:"end"},Vt={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"},Ke=function(a){var e=Math.sqrt(a[0]*a[0]+a[1]*a[1]);return[a[0]/e,a[1]/e]},Zt=function(a,e){var t,i,r,s={},n="50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro".split(",");for(t=0;t<n.length;t+=2)i="&"+n[t+1]+";",r=parseInt(n[t],e),s[i]="&#"+r+";";return s["\\xa0"]="&#160;",s}(0,32),be={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},Xe=function(){function a(e,t){this.__root=void 0,this.__ctx=void 0,this.__root=e,this.__ctx=t}return a.prototype.addColorStop=function(e,t){var i,r=this.__ctx.__createElement("stop");r.setAttribute("offset",e),t.indexOf("rgba")!==-1?(i=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(t))&&(r.setAttribute("stop-color",H("rgb({r},{g},{b})",{r:i[1],g:i[2],b:i[3]})),r.setAttribute("stop-opacity",i[4])):r.setAttribute("stop-color",t),this.__root.appendChild(r)},a}(),jt=function(a,e){this.__root=void 0,this.__ctx=void 0,this.__root=a,this.__ctx=e},pe={width:500,height:500,enableMirroring:!1},Br=function(){function a(t,i){var r,s,n,o;if(t===void 0&&(t=pe),this.width=void 0,this.height=void 0,this.enableMirroring=void 0,this.canvas=void 0,this.__document=void 0,this.__canvas=void 0,this.__ctx=void 0,this.__ids=void 0,this.__root=void 0,this.__defs=void 0,this.__currentElement=void 0,this.__groupStack=void 0,this.__currentElementsToStyle=null,typeof t=="number"?(this.width=t,this.height=i??pe.height,this.enableMirroring=pe.enableMirroring,this.__document=document):(this.width=(s=t.width)!=null?s:pe.width,this.height=(n=t.height)!=null?n:pe.height,this.enableMirroring=(o=t.enableMirroring)!=null?o:pe.enableMirroring,this.__document=t.document||document,r=t.ctx),!(r||(this.__canvas=this.__document.createElement("canvas"),r=this.__canvas.getContext("2d"))))throw new Error("Unable to get canvas context");this.__ctx=r,this.canvas=this,this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version","1.1"),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width.toString()),this.__root.setAttribute("height",this.height.toString()),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)}var e=a.prototype;return e.__createElement=function(t,i,r){i===void 0&&(i={});var s,n,o=this.__document.createElementNS("http://www.w3.org/2000/svg",t),l=Object.keys(i);for(r&&(o.setAttribute("fill","none"),o.setAttribute("stroke","none")),s=0;s<l.length;s++)o.setAttribute(n=l[s],i[n]);return o},e.__setDefaultStyles=function(){for(var t in be)this[t]=be[t].canvas},e.__applyStyleState=function(t){var i,r,s=Object.keys(t);for(i=0;i<s.length;i++)this[r=s[i]]=t[r]},e.__getStyleState=function(){var t,i,r={},s=Object.keys(be);for(t=0;t<s.length;t++)r[i=s[t]]=this[i];return r},e.__applyStyleToCurrentElement=function(t){if(this.__currentElement){var i,r,s,n,o,l=this.__currentElement,h=Object.keys(be);for(i=0;i<h.length;i++)if(s=this[h[i]],"apply"in(r=be[h[i]])){if(s instanceof jt){if(s.__ctx)for(;s.__ctx.__defs.childNodes.length;)n=s.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[n]=n,this.__defs.appendChild(s.__ctx.__defs.childNodes[0]);l.setAttribute(r.apply,H("url(#{id})",{id:s.__root.getAttribute("id")}))}else if(s instanceof Xe)l.setAttribute(r.apply,H("url(#{id})",{id:s.__root.getAttribute("id")}));else if(r.apply.indexOf(t)!==-1&&r.svg!==s){if(r.svgAttr!=="stroke"&&r.svgAttr!=="fill"||s.indexOf("rgba")===-1){var f=r.svgAttr;if(h[i]==="globalAlpha"&&l.getAttribute(f=t+"-"+r.svgAttr))continue;l.setAttribute(f,s)}else if(o=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(s)){l.setAttribute(r.svgAttr,H("rgb({r},{g},{b})",{r:o[1],g:o[2],b:o[3]}));var c=parseFloat(o[4]),d=this.globalAlpha;d!=null&&(c*=d),l.setAttribute(r.svgAttr+"-opacity",c.toString())}}}}},e.__closestGroupOrSvg=function(t){if(t===void 0&&(t=this.__currentElement),t)return t.nodeName==="g"||t.nodeName==="svg"?t:this.__closestGroupOrSvg(t.parentNode)},e.getSerializedSvg=function(t){var i,r,s,n,o,l=new XMLSerializer().serializeToString(this.__root);if(/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi.test(l)&&(l=l.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),t)for(i=Object.keys(Zt),r=0;r<i.length;r++)n=Zt[s=i[r]],(o=new RegExp(s,"gi")).test(l)&&(l=l.replace(o,n));return l},e.getSvg=function(){return this.__root},e.save=function(){var t=this.__createElement("g"),i=this.__closestGroupOrSvg();i&&this.__groupStack.push(i),i.appendChild(t),this.__currentElement=t,this.__stack.push(this.__getStyleState())},e.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var t=this.__stack.pop();this.__applyStyleState(t)},e.__addTransform=function(t){if(this.__currentElement){var i=this.__closestGroupOrSvg();if(i){if(i.childNodes.length>0){this.__currentElement.nodeName==="path"&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:i,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var r=this.__createElement("g");i.appendChild(r),this.__currentElement=r}if(this.__currentElement){var s=this.__currentElement.getAttribute("transform");s?s+=" ":s="",this.__currentElement.setAttribute("transform",s+=t)}}}},e.scale=function(t,i){i===void 0&&(i=t),this.__addTransform(H("scale({x},{y})",{x:t,y:i}))},e.rotate=function(t){var i=180*t/Math.PI;this.__addTransform(H("rotate({angle},{cx},{cy})",{angle:i,cx:0,cy:0}))},e.translate=function(t,i){this.__addTransform(H("translate({x},{y})",{x:t,y:i}))},e.transform=function(t,i,r,s,n,o){this.__addTransform(H("matrix({a},{b},{c},{d},{e},{f})",{a:t,b:i,c:r,d:s,e:n,f:o}))},e.beginPath=function(){var t,i;this.__currentDefaultPath="",this.__currentPosition={},t=this.__createElement("path",{},!0),(i=this.__closestGroupOrSvg())&&(i.appendChild(t),this.__currentElement=t)},e.__applyCurrentDefaultPath=function(){var t=this.__currentElement;t&&(t.nodeName==="path"?t.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",t.nodeName))},e.__addPathCommand=function(t){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=t},e.moveTo=function(t,i){this.__currentElement&&(this.__currentElement.nodeName!=="path"&&this.beginPath(),this.__currentPosition={x:t,y:i},this.__addPathCommand(H("M {x} {y}",{x:t,y:i})))},e.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")},e.lineTo=function(t,i){this.__currentPosition={x:t,y:i},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(H("L {x} {y}",{x:t,y:i})):this.__addPathCommand(H("M {x} {y}",{x:t,y:i}))},e.bezierCurveTo=function(t,i,r,s,n,o){this.__currentPosition={x:n,y:o},this.__addPathCommand(H("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:t,cp1y:i,cp2x:r,cp2y:s,x:n,y:o}))},e.quadraticCurveTo=function(t,i,r,s){this.__currentPosition={x:r,y:s},this.__addPathCommand(H("Q {cpx} {cpy} {x} {y}",{cpx:t,cpy:i,x:r,y:s}))},e.arcTo=function(t,i,r,s,n){var o=this.__currentPosition&&this.__currentPosition.x,l=this.__currentPosition&&this.__currentPosition.y;if(o!==void 0&&l!==void 0){if(n<0)throw new Error("IndexSizeError: The radius provided ("+n+") is negative.");if(o===t&&l===i||t===r&&i===s||n===0)this.lineTo(t,i);else{var h=Ke([o-t,l-i]),f=Ke([r-t,s-i]);if(h[0]*f[1]!=h[1]*f[0]){var c=Math.acos(Math.abs(h[0]*f[0]+h[1]*f[1])),d=Ke([h[0]+f[0],h[1]+f[1]]),v=n/Math.sin(c/2),x=t+v*d[0],g=i+v*d[1],p=[-h[1],h[0]],m=[f[1],-f[0]],_=function(k){var y=k[0];return k[1]>=0?Math.acos(y):-Math.acos(y)},w=_(p),b=_(m);this.lineTo(x+p[0]*n,g+p[1]*n),this.arc(x,g,n,w,b)}else this.lineTo(t,i)}}},e.stroke=function(){this.__currentElement&&(this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke"))},e.fill=function(){this.__currentElement&&(this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill"))},e.rect=function(t,i,r,s){this.__currentElement&&(this.__currentElement.nodeName!=="path"&&this.beginPath(),this.moveTo(t,i),this.lineTo(t+r,i),this.lineTo(t+r,i+s),this.lineTo(t,i+s),this.lineTo(t,i),this.closePath())},e.fillRect=function(t,i,r,s){var n;n=this.__createElement("rect",{x:t,y:i,width:r,height:s},!0),this.__closestGroupOrSvg().appendChild(n),this.__currentElement=n,this.__applyStyleToCurrentElement("fill")},e.strokeRect=function(t,i,r,s){var n;n=this.__createElement("rect",{x:t,y:i,width:r,height:s},!0),this.__closestGroupOrSvg().appendChild(n),this.__currentElement=n,this.__applyStyleToCurrentElement("stroke")},e.__clearCanvas=function(){var t=this.__closestGroupOrSvg();if(t){for(var i=t.getAttribute("transform"),r=this.__root.childNodes[1],s=r.childNodes,n=s.length-1;n>=0;n--)s[n]&&r.removeChild(s[n]);this.__currentElement=r,this.__groupStack=[],i&&this.__addTransform(i)}},e.clearRect=function(t,i,r,s){if(t!==0||i!==0||r!==this.width||s!==this.height){var n,o=this.__closestGroupOrSvg();n=this.__createElement("rect",{x:t,y:i,width:r,height:s,fill:"#FFFFFF"},!0),o.appendChild(n)}else this.__clearCanvas()},e.createLinearGradient=function(t,i,r,s){var n=this.__createElement("linearGradient",{id:Ie(this.__ids),x1:t+"px",x2:r+"px",y1:i+"px",y2:s+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(n),new Xe(n,this)},e.createRadialGradient=function(t,i,r,s,n,o){var l=this.__createElement("radialGradient",{id:Ie(this.__ids),cx:s+"px",cy:n+"px",r:o+"px",fx:t+"px",fy:i+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(l),new Xe(l,this)},e.__parseFont=function(){var t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i.exec(this.font);if(t){var i={style:t[1]||"normal",size:t[4]||"10px",family:t[6]||"sans-serif",weight:t[3]||"normal",decoration:t[2]||"normal",href:null};return this.__fontUnderline==="underline"&&(i.decoration="underline"),this.__fontHref&&(i.href=this.__fontHref),i}},e.__wrapTextLink=function(t,i){if(t.href){var r=this.__createElement("a");return r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.href),r.appendChild(i),r}return i},e.__applyText=function(t,i,r,s){var n=this.__parseFont(),o=this.__closestGroupOrSvg();if(n){var l,h,f=this.__createElement("text",{"font-family":n.family,"font-size":n.size,"font-style":n.style,"font-weight":n.weight,"text-decoration":n.decoration,x:i,y:r,"text-anchor":(h=this.textAlign,Gt[h]||Gt.start),"dominant-baseline":(l=this.textBaseline,Vt[l]||Vt.alphabetic)},!0);f.appendChild(this.__document.createTextNode(t)),this.__currentElement=f,this.__applyStyleToCurrentElement(s),o.appendChild(this.__wrapTextLink(n,f))}},e.fillText=function(t,i,r){this.__applyText(t,i,r,"fill")},e.strokeText=function(t,i,r){this.__applyText(t,i,r,"stroke")},e.measureText=function(t){return this.__ctx.font=this.font,this.__ctx.measureText(t)},e.arc=function(t,i,r,s,n,o){if(s!==n){(s%=2*Math.PI)==(n%=2*Math.PI)&&(n=(n+2*Math.PI-.001*(o?-1:1))%(2*Math.PI));var l,h=t+r*Math.cos(n),f=i+r*Math.sin(n),c=t+r*Math.cos(s),d=i+r*Math.sin(s),v=o?0:1,x=n-s;x<0&&(x+=2*Math.PI),l=o?x>Math.PI?0:1:x>Math.PI?1:0,this.lineTo(c,d),this.__addPathCommand(H("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:r,ry:r,xAxisRotation:0,largeArcFlag:l,sweepFlag:v,endX:h,endY:f})),this.__currentPosition={x:h,y:f}}},e.clip=function(){var t=this.__closestGroupOrSvg(),i=this.__createElement("clipPath"),r=Ie(this.__ids),s=this.__createElement("g");t&&this.__currentElement&&(this.__applyCurrentDefaultPath(),t.removeChild(this.__currentElement),i.setAttribute("id",r),i.appendChild(this.__currentElement),this.__defs.appendChild(i),t.setAttribute("clip-path",H("url(#{id})",{id:r})),t.appendChild(s),this.__currentElement=s)},e.drawImage=function(){var t,i,r,s,n,o,l,h,f,c,d,v,x,g,p=Array.prototype.slice.call(arguments),m=p[0],_=0,w=0;if(p.length===3)t=p[1],i=p[2],r=n=m.width,s=o=m.height;else if(p.length===5)t=p[1],i=p[2],r=p[3],s=p[4],n=m.width,o=m.height;else{if(p.length!==9)throw new Error("Invalid number of arguments passed to drawImage: "+arguments.length);_=p[1],w=p[2],n=p[3],o=p[4],t=p[5],i=p[6],r=p[7],s=p[8]}l=this.__closestGroupOrSvg();var b="translate("+t+", "+i+")";if(m instanceof a){if((h=m.getSvg().cloneNode(!0)).childNodes&&h.childNodes.length>1){for(f=h.childNodes[0];f.childNodes.length;)g=f.childNodes[0].getAttribute("id"),this.__ids[g]=g,this.__defs.appendChild(f.childNodes[0]);if(c=h.childNodes[1]){var k=c.getAttribute("transform");c.setAttribute("transform",k?k+" "+b:b),l.appendChild(c)}}}else if(m.nodeName==="CANVAS"||m.nodeName==="IMG"){if((d=this.__createElement("image")).setAttribute("width",r),d.setAttribute("height",s),d.setAttribute("preserveAspectRatio","none"),_||w||n!==m.width||o!==m.height){if((v=this.__document.createElement("canvas")).width=r,v.height=s,!(x=v.getContext("2d")))return;x.drawImage(m,_,w,n,o,0,0,r,s),m=v}d.setAttribute("transform",b),d.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m.nodeName==="CANVAS"?m.toDataURL():m.getAttribute("src")),l.appendChild(d)}},e.createPattern=function(t,i){var r,s=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),n=Ie(this.__ids);return s.setAttribute("id",n),s.setAttribute("width",t.width),s.setAttribute("height",t.height),t.nodeName==="CANVAS"||t.nodeName==="IMG"?((r=this.__document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("width",t.width),r.setAttribute("height",t.height),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.nodeName==="CANVAS"?t.toDataURL():t.getAttribute("src")),s.appendChild(r),this.__defs.appendChild(s)):t instanceof a&&(s.appendChild(t.__root.childNodes[1]),this.__defs.appendChild(s)),new jt(s,this)},e.setLineDash=function(t){this.lineDash=t&&t.length>0?t.join(","):null},a}();class Ur{constructor(e,t={},i=[]){this.__doc__=document,typeof e=="string"?this.trackDiv=document.getElementById("#"+e):this.trackDiv=e;const r=this.trackDiv.getBoundingClientRect();this.height=r.height,this.width=r.width,this.tracks={},this.track_order=[],this.trackLabels={},this.trackDialogs={};for(let s of i)try{let n=P.getTrack(s);this.tracks[n.config.track_id]=n,this.track_order.push(n.config.track_id),this._addTrackLabel(n.config)}catch(n){console.error(n)}this._tracksChanged(),this.legend=null,this.trackDiv.style.position="relative",this.canvas=R("canvas",{classes:["igv-content-canvas"],width:this.width,height:this.height},this.trackDiv),this.ctx=this.canvas.getContext("2d"),t.show_scale&&(this.addScaleCanvas(this.height),this.show_scale=!0),this.is_dragging=!1,this.isMouseDown=!1,this.lastMouseX=void 0,this.mouseDownX=void 0,this.buffer_level=1,this.groups={},this.highlighted_regions={},this.listeners={},t.allow_user_interactions&&(this.allowUserDrag(),this.allowUserZoom(),this.allowUserFeatureClick(),this.allowUserFeatureOver(),this.allowUserRangeSelection(),this.trackDiv.addEventListener("dragover",s=>{s.preventDefault()})),t.ruler_track&&this.addRulerTrack(),t.new_layout&&(this.new_layout=!0),this.__doc__=document,this.config=t,this.retries=0,this.yOffset=0,this.loadingIcon=R("i",{classes:["fas","fa-spinner","fa-spin","panel-loading-icon"]},this.trackDiv),this.messageAlert=R("div",{classes:["panel-error-message"]},this.trackDiv)}changeBaseDocument(e){this.config.allow_user_interactions&&(this.removeDragHandler(),this.disableUserZoom()),this.remove,this.__doc__=e,this.config.allow_user_interactions&&(this.allowUserDrag(),this.allowUserZoom())}closeAllDialogs(){for(let e in this.trackDialogs)this.trackDialogs[e].close();this.trackDialogs={}}_addTrackLabel(e){e.show_track_label;const t=R("div",{classes:["panel-track-label"],text:e.short_label,draggable:!0},this.trackDiv);t.addEventListener("click",i=>{this._openTrackDialog(i,e.track_id)}),t.addEventListener("drag",i=>{this.trackDiv.style.cursor="ne-risize"}),t.addEventListener("mousedown",i=>{i.stopImmediatePropagation()}),t.addEventListener("dragend",i=>{let r=this._getCoords(i).y+this.yOffset,s=null;if(r<0)s==this.track_order[0];else for(let n in this.tracks){const o=this.tracks[n];if(r>=o.top&&r<=o.bottom){s=n;break}}s!==e.track_id&&(s=s||this.track_order[this.track_order.length-1],this.track_order.splice(this.track_order.indexOf(e.track_id),1),this.track_order.splice(this.track_order.indexOf(s)+1,0,e.track_id),this.update())}),this.trackLabels[e.track_id]=t}_openTrackDialog(e,t){if(this.trackDialogs[t])return;const i=this.tracks[t];this.trackDialogs[t]=new Mr({maxHeight:400,doc:this.__doc__||document,width:300,title:i.config.short_label,position:[e.pageX,e.pageY],onclose:()=>delete this.trackDialogs[t]},i.getSettings(this))}_parseConfig(e){this.fixed_height_mode&&(e.height||(e.height=150))}addScaleCanvas(e){this.scale_canvas=R("canvas",{styles:{position:"absolute",top:"0px",left:"5px"},width:100,height:this.height},this.trackDiv),this.scale_ctx=this.scale_canvas.getContext("2d")}setBufferLevel(e){this.buffer_level=e}getDiv(){return this.trackDiv}setHighlightedRegion(e,t,i){this.highlighted_regions[t]={chr:e.chr,start:e.start,end:e.end,color:i},this.force_redraw=!0}removeHighlightedRegion(e){delete this.highlighted_regions[e],this.force_redraw=!0}removeAllHighlightedRegions(){this.highlighted_regions={},this.force_redraw=!0}addRulerTrack(){let e=new fe,t=e.getConfig();return this.tracks[t.track_id]=e,this.track_order.unshift(t.track_id),this._addTrackLabel(t),this}addListener(e,t){this.listeners[e]=t}removeListener(e){delete this.listeners[e]}addTrack(e,t,i){let r=P.getTrack(e);this.tracks[r.config.track_id]=r,t||t==0?this.track_order.splice(t,0,r.config.track_id):this.track_order.push(r.config.track_id),this._tracksChanged(),this._addTrackLabel(r.config),i||this._callListeners("track_added",r.config)}_callListeners(e,t,i){for(let r in this.listeners)this.listeners[r](e,t,i)}removeAllTracks(){let e=this.track_order.slice();for(let t of e)this.removeTrack(t,!0)}removeTrack(e,t,i){if(!this.tracks[e])return null;this.track_order=this.track_order.filter(s=>s!==e),t||this.repaint(!0,!0),this.trackLabels[e].remove(),delete this.trackLabels[e],this.trackDialogs[e]&&this.trackDialogs[e].close(),delete this.trackDialogs[e],this.legend&&this.legend.removeTrack(e);let r=this.tracks[e].config;if(delete this.tracks[e],i||this._callListeners("track_removed",r),this.track_order.length===0)for(let s in this.listeners.panel_empty)this.listeners.panel_empty[s](this);return r}getTrackConfig(e){return this.tracks[e].getConfig()}getTrack(e){return this.tracks[e]}getAllTrackConfigs(){let e=[];for(let t of this.track_order)e.push(this.tracks[t].getConfig());return e}setTrackAttribute(e,t,i){let r=this.tracks[e];r&&(r.setConfigAttribute(t,i),t==="scale_link_to"&&(this.tracks[e].scale_link_to=this.tracks[i]),(t==="color"||t==="display")&&this.legend&&this.legend.updateTrack(e))}setTrackAttributes(e,t){let i=this.tracks[e];for(let r in t)i.setConfigAttribute(r,t[r]),r==="color"&&this.legend&&this.legend.updateTrack(e)}setTrackFeatureFilter(e,t){this.tracks[e].setFilterFunction(t)}setTrackColorFunction(e,t){this.tracks[e].setColorFunction(t)}setTrackLabelFunction(e,t){let i=this.tracks[e];i&&(i.label_function=t)}_tracksChanged(){for(let e of this.track_order){let t=this.tracks[e],i=t.config.scale_link_to;if(i){let r=this.tracks[i];r&&(t.scale_link_to=r)}}}getCurrentTrackFeatures(e){return this.tracks[e].getCurrentFeatures(this.chr,this.start,this.end)}update(e,t,i,r){if(this.call_update_listener=r,t>i){const s=t;t=i,i=s}e?(this.chr=e,this.start=t,this.end=i,this.repaint()):this.repaint(!0,!0)}getTracksHeight(){let e=0,t={};for(let i of this.track_order){let r=this.tracks[i],s=r.config.group;r.config.hide||(s?t[s]||(e+=r.config.height,t[s]=!0):e+=r.config.height)}return e}async getAllFeatures(e,t,i,r){let s=[];this._display_order=[];for(let n of this.track_order){let o=this.tracks[n];o.config.hide||(this._display_order.push(n),s.push(o.getFeatures(this.chr,e,t,i,r)))}return await Promise.all(s.map(n=>n.catch(o=>o)))}repaint(e,t,i){this.messageAlert.style.display="none";var r,s,n,o,l=this,h,f,c,d;f=this.chr,c=this.start,d=this.end,this.bpPerPixel=(this.end-this.start)/this.canvas.width;let v=!0;if(this.tile&&this.tile.containsRange(f,c,d,this.bpPerPixel)&&(v=!1),!v&&!e&&!this.force_redraw)this.force_redraw=!1,this.paintImage(),l.call_update_listener||l._callListeners("view_changed",{chr:l.chr,start:parseInt(l.start),end:parseInt(l.end)}),l.call_update_listener=!1,l.retries=0;else{if(this.force_redraw=!1,i?(r=this.canvas.width,n=Math.max(0,Math.round(this.start))):(r=(this.buffer_level*2+1)*this.canvas.width,n=Math.max(0,Math.round(this.start-this.buffer_level*this.canvas.width*this.bpPerPixel))),s=Math.round(r*this.bpPerPixel),o=n+s,l.loading&&!i){e&&t?l.update_required=!0:l.update_required="location";return}t&&this.tile&&(n=this.tile.startBP,o=this.tile.endBP),i||(l.loading={start:n,end:o},l.loadingIcon.style.display="block");const x=i?"black":getComputedStyle(l.trackDiv).getPropertyValue("color");l.getAllFeatures(n,o,!v,{pixelWidth:r,bpPerPixel:l.bpPerPixel}).then(function(g){if(g){let m=null;i?m={}:m=document.createElement("canvas"),m.width=r,m.height=l.getTracksHeight(),i?h=new Br(m.width,m.height):h=m.getContext("2d"),l.show_scale&&!i&&(l.scale_buffer=document.createElement("canvas"),l.scale_buffer.width=200,l.scale_buffer.height=m.height,l.scale_buffer_ctx=l.scale_buffer.getContext("2d"));var p={context:h,bpStart:n,bpEnd:o,bpPerPixel:l.bpPerPixel,pixelWidth:m.width,pixelHeight:m.height,chr:f,textColor:x};let _=0;l.groups={},l.calculateMaxScale(g);for(let w in l.tracks){const b=l.tracks[w].config;b.hide&&(l.trackLabels[b.track_id].style.display="none")}for(const w in g){let b=l.tracks[l._display_order[w]];const k=l.trackLabels[b.config.track_id];k&&(k.style.display="block",k.style.top=_+l.yOffset+"px"),p.features=g[w];let y=b.config.group;if(y?(l.groups[y]||(l.groups[y]={top:_,height:b.config.height},_+=b.config.height),p.top=b.top=l.groups[y].top,p.height=l.groups[y].height,b.bottom=p.top+p.height):(p.top=_,b.top=_,p.height=b.config.height,_+=p.height,b.bottom=_),typeof p.features=="string"&&b.config.type!=="fasta"){b.drawMessage(p);continue}h.save(),h.rect(0,p.top,p.pixelWidth,p.height),h.clip(),h.beginPath();try{b.drawFeatures(p)}catch(S){console.error(S);const A={...p,features:S.message};b.drawMessage(A)}if(h.restore(),l.show_scale){const S=i?h:l.scale_buffer_ctx;b.drawScale(p.pixelHeight,S,x)}}for(let w in l.highlighted_regions){let b=l.highlighted_regions[w];l.chr===b.chr&&(b.end<n||b.start>o||l.drawHighlightedRegion(b,p))}if(i){i(h.getSerializedSvg());return}l.retries=0,l.loading=!1,l.tile=new Kt(f,n,o,l.bpPerPixel,m),l.paintImage(),l.call_update_listener||l._callListeners("view_changed",{chr:l.chr,start:parseInt(l.start),end:parseInt(l.end)}),l.call_update_listener=!1}else l.ctx.clearRect(0,0,l.canvas.width,l.canvas.height);l.update_required&&(l.update_required==="location"?(l.update(l.chr,l.start,l.end),l.update_required=!1):(l.update_required=!1,l.update())),l.loadingIcon.style.display="none"}).catch(function(g){l.loading=!1,console.log(g),l.retries<3&&g!=="Timed out"?(l.retries++,l.repaint(e,t)):(l.loading=!1,l.force_redraw=!0,l.loadingIcon.style.display="none",l.messageAlert.textContent=g,l.messageAlert.style.display="block")})}}autoScale(e,t,i){return!e||typeof e=="string"?{min:0,max:1}:(e.forEach(function(r){t=Math.min(t,r.value),i=Math.max(i,r.value)}),{min:t,max:i})}calculateMaxScale(e){let t={};for(var i in e){let r=this.tracks[this.track_order[i]];r.set_scale=null;let s=r.config.group;if(s&&r.config.scale!=="fixed"&&!r.config.scale_link_to&&(r.config.scale_group=s),s=r.config.scale_group,s){let n=t[s];n?(n.features.push(e[i]),n.tracks.push(r)):(n={tracks:[r],features:[e[i]]},t[s]=n)}}for(let r in t){let s=t[r];if(!s.ignore){let n=0,o=-Number.MAX_VALUE,l=null;for(let h of s.features)l=this.autoScale(h,n,o),n=l.min,o=l.max;for(let h of s.tracks)h.set_scale=l}}}drawHighlightedRegion(e,t){let i=(e.start-t.bpStart)/t.bpPerPixel;i=i<0?0:i;let r=(e.end-e.start)/t.bpPerPixel;r=r<3?3:r,r=r>t.pixelWidth?t.pixelWidth:r,t.context.globalAlpha=.1,t.context.fillStyle=e.color,t.context.fillRect(i,0,r,t.pixelHeight),t.context.globalAlpha=1}paintImage(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.show_scale&&(this.scale_ctx.clearRect(0,0,100,this.canvas.height),this.scale_ctx.drawImage(this.scale_buffer,0,this.yOffset)),this.tile&&(this.xOffset=Math.round((this.tile.startBP-this.start)/this.bpPerPixel),this.ctx.drawImage(this.tile.image,this.xOffset,this.yOffset),this.ctx.save(),this.ctx.restore())}allowUserFeatureOver(){this.foListener||(this.foListener=e=>{this.loading||(clearTimeout(this.moto),this.moto=setTimeout(()=>{if(!this.is_dragging){let t=this.getFeatureAt(e),i=this.mouse_over_feature;if(t.feature){if(i&&i.feature!==t.feature){const r={track:i.track,feature:i.feature,event:e};this._callListeners("featureout",r),i.track.onFeatureOut&&i.track.onFeatureOut(this,r)}if(!i||i.feature!==t.feature){const r={track:t.track,feature:t.feature,event:e};this._callListeners("featureover",r),t.track.onFeatureOver&&t.track.onFeatureOver(this,r),this.mouse_over_feature=t}}else if(i){const r={track:i.track,feature:i.feature,event:e};this._callListeners("featureout",r),i.track.onFeatureOut&&i.track.onFeatureOut(this,r),this.mouse_over_feature=null}}},10))},this.trackDiv.addEventListener("mousemove",this.foListener))}removeFeatureOverHandler(){this.trackDiv.removeEventListener("mouseover",this.foListener),this.foListener=null}allowUserFeatureClick(){this.fcListener||(this.allowUserFeatureOver(),this.listeners._fcfo||this.addListener("_fcfo",(e,t)=>{e==="featureout"&&(this.trackDiv.style.cursor="default"),e==="featureover"&&(this.trackDiv.style.cursor="pointer")}),this.fcListener=e=>{this.loading||(clearTimeout(this.foto),this.foto=setTimeout(()=>{if(!this.is_dragging){let t=this.getFeatureAt(e);t.track&&t.feature&&this._callListeners("featureclick",{track:t.track,feature:t.feature,event:e})}},200))},this.trackDiv.addEventListener("click",this.fcListener))}removeFeatureClickHandler(){this.trackDiv.removeEventListener("click",this.fcListener),this.fcListener=null,this.removeListener("_fcfo")}allowUserDrag(){this.drmdListener=e=>{if(e.shiftKey)return;const t=this._getCoords(e);this.isMouseDown=!0,this.start_dragging=!0,this.lastMouseX=t.x,this.lastMouseY=t.y,this.mouseDownX=this.lastMouseX},this.trackDiv.addEventListener("mousedown",this.drmdListener),this.drmmListener=e=>{let t=this._getCoords(e);if(this.is_dragging||this.start_dragging){var i=t.x-this.lastMouseX,r=this.bpPerPixel*i;this.start-=r,this.end-=r;let s=this.canvas.height-this.tile.image.height,n=0;if(s<0||this.yOffset!==0){let o=t.y-this.lastMouseY;this.yOffset+=o,this.yOffset>0?this.yOffset=0:this.yOffset<s&&(this.yOffset=s);for(let l in this.tracks){const h=this.tracks[l],f=this.trackLabels[l];f&&(f.style.display="block",f.style.top=h.top+this.yOffset+"px")}}this.repaint(),this.lastMouseX=t.x,this.lastMouseY=t.y,this.start_dragging&&(i>5||n>5)&&(this.is_dragging=!0,this.start_dragging=!1)}},this.__doc__.addEventListener("mousemove",this.drmmListener),this.drmuListener=e=>{this.is_dragging=!1,this.start_dragging=!1},this.__doc__.addEventListener("mouseup",this.drmuListener)}removeDragHandler(){this.trackDiv.removeEventListener("mousedown",this.drmdListener),this.__doc__.removeEventListener("mousemove",this.drmmListener),this.__doc__.removeEventListener("mouseup",this.drmuListener),this.drmdListener=null,this.drmmListener=null,this.drmuListener=null}_getCoords(e){const t=this.canvas.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top;return{x:i,y:r}}allowUserZoom(){this.zmListener=e=>{e.preventDefault();let t=e.deltaY;if(t===void 0&&(t=e.detail),this.loading||this.bpPerPixel<.05&&t<0)return;let i=this._getCoords(e),r=t>0?1.25:.8;e.wheelDelta!==void 0&&(r=Math.pow(2,-e.wheelDelta/36));let s=this.start+i.x*this.bpPerPixel,n=(this.end-this.start)*r,o=s-i.x/this.canvas.width*n;this.start=o,this.end=o+n,this.repaint()},this.trackDiv.addEventListener("wheel",this.zmListener)}disableUserZoom(){this.trackDiv.removeEventListener("wheel",this.zmListener)}allowUserRangeSelection(){this.rsmdListener=e=>{if(e.shiftKey){this.start_select=this._getCoords(e).x;let t=this.start_select+"px";this.select_div=R("div",{styles:{position:"absolute",opacity:.2,"background-color":"blue",top:"0px",height:this.height+"px",left:t,width:"0px"}},this.trackDiv),e.stopPropagation()}},this.trackDiv.addEventListener("mousedown",this.rsmdListener),this.rsmmListener=e=>{if(e.shiftKey&&this.start_select){let t=this._getCoords(e).x;t<this.start_select?(this.select_div.style.left=t+"px",this.select_div.style.width=this.start_select-t+"px"):(this.select_div.style.left=this.start_select+"px",this.select_div.style.width=t-this.start_select+"px"),e.stopPropagation()}},this.trackDiv.addEventListener("mousemove",this.rsmmListener),this.rsmuListener=e=>{if(this.start_select){let t=this._getCoords(e).x,i=this.start+this.start_select*this.bpPerPixel,r=this.start+t*this.bpPerPixel;if(this.start_select=null,this.select_div.remove(),i>r){let s=r;r=i,i=s}this._callListeners("range_selected",{chr:this.chr,start:i,end:r},e)}},this.trackDiv.addEventListener("mouseup",this.rsmuListener)}removeAllowSelection(){this.trackDiv.removeEventListener("mousedown",this.rsmdListener),this.trackDiv.removeEventListener("mousemove",this.rsmmListener),this.trackDiv.removeEventListener("mouseup",this.rsmuListener),this.rsmdListener=null,this.rsmmListener=null,this.rsmuListener=null}getImage(){this.canvas[0].toDataURL(MIME_TYPE)}getFeatureAt(e){let t=this._getCoords(e);t.y-=this.yOffset;let i=Math.round(this.start+t.x*this.bpPerPixel);for(let r in this.tracks){let s=this.tracks[r];if(t.y>s.top&&t.y<s.bottom)return{track:s,feature:s.getFeatureAt(i,this.chr,t,this.bpPerPixel,this.ctx,this.yOffset)}}return{track:null,feature:null}}getBpStart(){return Math.max(0,Math.round(this.start-this.buffer_level*this.canvas.width*this.bpPerPixel))}setSize(e,t){if(e)this.height=t,this.width=e,this.trackDiv.style.height=t+"px",this.trackDiv.style.width=e+"px";else{const i=this.trackDiv.getBoundingClientRect();this.width=i.width,this.height=i.height}this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this.show_scale&&this.scale_canvas.setAttribute("height",this.height)}redrawTile(e){if(this.tile){var t=this,i=t.tile.chr,r=t.tile.startBP,s=t.tile.endBP,n=document.createElement("canvas"),o=t.tile.scale;n.width=t.tile.image.width,n.height=t.tile.image.height;var l=n.getContext("2d");t.track.draw({features:e,context:l,bpStart:r,bpPerPixel:o,pixelWidth:n.width,pixelHeight:n.height}),t.tile=new Kt(i,r,s,o,n),t.paintImage()}}}class Kt{constructor(e,t,i,r,s){this.chr=e,this.startBP=t,this.endBP=i,this.scale=r,this.image=s}containsRange(e,t,i,r){return t<0&&(t=0),this.scale.toFixed(3)===r.toFixed(3)&&t>=this.startBP&&i<=this.endBP&&e===this.chr}overlapsRange(e,t,i){return this.chr===e&&this.endBP>=t&&this.startBP<=i}}export{Ur as default};
//# sourceMappingURL=panel.js_v0-Cg5IgG0c.js.map
