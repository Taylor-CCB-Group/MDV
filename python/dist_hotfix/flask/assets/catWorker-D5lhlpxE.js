(function(){"use strict";onmessage=m=>{const s=m.data[3],o=s.datatype==="text16"||s.datatype==="multitext"?Uint16Array:Uint8Array,a=new o(m.data[2]),n=new Uint8Array(m.data[0]),c=new Uint8Array(m.data[1]);let e=null;if(s.method==="sankey"){const t=new Uint8Array(m.data[4]);e=_(n,c,a,t,s)}else if(s.method==="venn")e=L(n,c,a,s);else if(s.method==="proportion"){const t=new Uint8Array(m.data[4]);e=b(n,c,a,t,s)}else if(s.method==="stacked"){const t=new Uint8Array(m.data[4]);e=D(n,c,a,t,s)}else if(s.method==="double_cat"){const t=s.datatype2==="multitext"?new Uint16Array(m.data(4)):new Uint8Array(m.data(4));e=k(n,c,a,t,s)}else e=S(n,c,a,s);postMessage(e)};function k(m,s,o,a,n){const c=o.length,e=n.datatype2==="multitext",t=Array.from(n.values,(i,r)=>Array.from(n.values2,(u,d)=>({i1:r,i2:d,c:0})));for(let i=0;i<c;i++)if(!(s[i]!==0&&s[i]!==m[i]))if(e){const r=i*n.stringLength2;for(let u=r;u<n.stringLength2&&o[u]!==65535;u++)t[o[i]][a[u]].c++}else t[o[i]][a[i]].c++;return t}function b(m,s,o,a,n){const c=n.values.length,e=n.values2.length,t=n.cats?new Uint8Array(n.cats):null,i=o.length,r=new Array(c),u=n.diviser?n.diviser:new Array(c);for(let f=0;f<c;f++)r[f]=new Array(e).fill(0),u[f]=new Array(e).fill(0);const d=n.category;for(let f=0;f<i;f++)if(u[o[f]][a[f]]++,s[f]===0){if(t&&t[f]!==d)continue;r[o[f]][a[f]]++}let y=0,w=1e7;for(let f=0;f<u.length;f++){const x=u[f],U=r[f],p=[],M=[];let l=0,h=0,v=1e7;for(let A=0;A<x.length;A++){if(x[A]===0)continue;const g=n.denominators?U[A]/n.denominators[A]:U[A]/x[A]*100;p.push([g,f,A,Math.floor(Math.random()*6)]),M.push(g),l+=g,h=Math.max(h,g),v=Math.min(v,g)}p.av=l/p.length,p.std=z(M,p.av),p.max=h,p.min=v,r[f]=p,y=Math.max(y,h),w=Math.min(w,v)}return r.max=y,r.min=w,r}function L(m,s,o,a){const n=performance.now(),c=o.length/a.stringLength,e=new Map,t=a.stringLength;for(let r=0;r<c;r++){if(s[r]!==0&&s[r]!==m[r])continue;const u=r*t,d=o.slice(u,u+t).toString(),y=e.get(d);y?e.set(d,y+1):e.set(d,1)}const i=[];for(const[r,u]of e.entries(e)){const d=r.split(",").map(y=>a.values[y]).filter(y=>y!==void 0);i.push({sets:d,size:u})}return console.log(`calc ven : ${performance.now()-n}`),i}function S(m,s,o,a){const n=a.datatype==="multitext"?o.length/a.stringLength:o.length,c=new Array(a.values.length).fill(0);if(a.datatype==="multitext"){const e=a.stringLength;for(let t=0;t<n;t++){if(s[t]!==0&&s[t]!==m[t])continue;const i=t*e;for(let r=i;r<i+e&&o[r]!==65535;r++)c[o[r]]++}}else for(let e=0;e<n;e++)s[e]!==0&&s[e]!==m[e]||c[o[e]]++;return c}function D(m,s,o,a,n){const c=o.length,e=Array.from(n.values,(t,i)=>({id:i,values:Array.from(n.values2,(r,u)=>({id:u,count:0})),total:0}));for(let t=0;t<c;t++)s[t]!==0&&s[t]!==m[t]||(e[o[t]].values[a[t]].count++,e[o[t]].total++);for(const t of e){let i=0,r=0;for(const u of t.values){const d=t.total===0?0:u.count/t.total;u.pos=i,u.per=d,u.perpos=r,i+=u.count,r+=d}}return e}function _(m,s,o,a,n){const c=n.values.length,e=n.values2.length,t=o.length,i=new Array(c),r=n.values.map((l,h)=>`A${h}`),u=n.values2.map((l,h)=>`B${h}`);for(let l=0;l<c;l++)i[l]=new Array(e).fill(0);const d=[];let y=0;for(let l=0;l<t;l++)s[l]!==0&&s[l]!==m[l]||(i[o[l]][a[l]]++,y++);const w=new Set,f=new Set,x=Math.round(y/300);for(let l=0;l<c;l++)for(let h=0;h<e;h++){const v=i[l][h];v!==0&&(w.add(r[l]),f.add(u[h]),d.push({source:r[l],target:u[h],value:v<x?x:v,trueValue:v}))}const U=Math.min(w.size,f.size),p=Array.from(w).map(l=>({id:l,ind:l.substring(1),param:0})),M=Array.from(f).map(l=>({id:l,ind:l.substring(1),param:1}));return{links:d,nodes:p.concat(M),minNodes:U}}function z(m,s){let o=m.length-1;o=o===0?1:o;const a=m.reduce((n,c)=>n+(c-s)**2,0);return Math.sqrt(a/o)}})();
//# sourceMappingURL=catWorker-D5lhlpxE.js.map
