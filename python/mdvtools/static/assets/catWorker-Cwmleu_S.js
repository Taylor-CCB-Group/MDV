(function(){"use strict";onmessage=function(f){const s=f.data[3],o=s.datatype=="text16"||s.datatype=="multitext"?Uint16Array:Uint8Array,a=new o(f.data[2]),e=new Uint8Array(f.data[0]),c=new Uint8Array(f.data[1]);let n=null;if(s.method==="sankey"){const t=new Uint8Array(f.data[4]);n=_(e,c,a,t,s)}else if(s.method==="venn")n=L(e,c,a,s);else if(s.method==="proportion"){const t=new Uint8Array(f.data[4]);n=b(e,c,a,t,s)}else if(s.method==="stacked"){const t=new Uint8Array(f.data[4]);n=D(e,c,a,t,s)}else if(s.method==="double_cat"){const t=s.datatype2==="multitext"?new Uint16Array(f.data(4)):new Uint8Array(f.data(4));n=k(e,c,a,t,s)}else n=S(e,c,a,s);postMessage(n)};function k(f,s,o,a,e){const c=o.length,n=e.datatype2==="multitext",t=Array.from(e.values,(i,r)=>Array.from(e.values2,(u,d)=>({i1:r,i2:d,c:0})));for(let i=0;i<c;i++)if(!(s[i]!==0&&s[i]!==f[i]))if(n){const r=i*e.stringLength2;for(let u=r;u<e.stringLength2&&o[u]!==65535;u++)t[o[i]][a[u]].c++}else t[o[i]][a[i]].c++;return t}function b(f,s,o,a,e){const c=e.values.length,n=e.values2.length,t=e.cats?new Uint8Array(e.cats):null,i=o.length,r=new Array(c),u=e.diviser?e.diviser:new Array(c);for(let m=0;m<c;m++)r[m]=new Array(n).fill(0),u[m]=new Array(n).fill(0);const d=e.category;for(let m=0;m<i;m++)if(u[o[m]][a[m]]++,s[m]===0){if(t&&t[m]!==d)continue;r[o[m]][a[m]]++}let y=0,w=1e7;for(let m=0;m<u.length;m++){const x=u[m],M=r[m],p=[],U=[];let l=0,h=0,v=1e7;for(let A=0;A<x.length;A++){if(x[A]===0)continue;const g=e.denominators?M[A]/e.denominators[A]:M[A]/x[A]*100;p.push([g,m,A,Math.floor(Math.random()*6)]),U.push(g),l+=g,h=Math.max(h,g),v=Math.min(v,g)}p.av=l/p.length,p.std=z(U,p.av),p.max=h,p.min=v,r[m]=p,y=Math.max(y,h),w=Math.min(w,v)}return r.max=y,r.min=w,r}function L(f,s,o,a){const e=performance.now(),c=o.length/a.stringLength,n=new Map,t=a.stringLength;for(let r=0;r<c;r++){if(s[r]!==0&&s[r]!==f[r])continue;const u=r*t;let d=o.slice(u,u+t).toString();const y=n.get(d);y?n.set(d,y+1):n.set(d,1)}const i=[];for(const[r,u]of n.entries(n)){const d=r.split(",").map(y=>a.values[y]).filter(y=>y!==void 0);i.push({sets:d,size:u})}return console.log(`calc ven : ${performance.now()-e}`),i}function S(f,s,o,a){const e=a.datatype==="multitext"?o.length/a.stringLength:o.length,c=new Array(a.values.length).fill(0);if(a.datatype==="multitext"){const n=a.stringLength;for(let t=0;t<e;t++){if(s[t]!==0&&s[t]!==f[t])continue;const i=t*n;for(let r=i;r<i+n&&o[r]!==65535;r++)c[o[r]]++}}else for(let n=0;n<e;n++)s[n]!==0&&s[n]!==f[n]||c[o[n]]++;return c}function D(f,s,o,a,e){const c=o.length,n=Array.from(e.values,(t,i)=>({id:i,values:Array.from(e.values2,(r,u)=>({id:u,count:0})),total:0}));for(let t=0;t<c;t++)s[t]!==0&&s[t]!==f[t]||(n[o[t]].values[a[t]].count++,n[o[t]].total++);for(let t of n){let i=0,r=0;for(let u of t.values){const d=t.total===0?0:u.count/t.total;u.pos=i,u.per=d,u.perpos=r,i+=u.count,r+=d}}return n}function _(f,s,o,a,e){const c=e.values.length,n=e.values2.length,t=o.length,i=new Array(c),r=e.values.map((l,h)=>"A"+h),u=e.values2.map((l,h)=>"B"+h);for(let l=0;l<c;l++)i[l]=new Array(n).fill(0);const d=[];let y=0;for(let l=0;l<t;l++)s[l]!==0&&s[l]!==f[l]||(i[o[l]][a[l]]++,y++);const w=new Set,m=new Set,x=Math.round(y/300);for(let l=0;l<c;l++)for(let h=0;h<n;h++){const v=i[l][h];v!==0&&(w.add(r[l]),m.add(u[h]),d.push({source:r[l],target:u[h],value:v<x?x:v,trueValue:v}))}const M=Math.min(w.size,m.size),p=Array.from(w).map(l=>({id:l,ind:l.substring(1),param:0})),U=Array.from(m).map(l=>({id:l,ind:l.substring(1),param:1}));return{links:d,nodes:p.concat(U),minNodes:M}}function z(f,s){let o=f.length-1;o=o===0?1:o;let a=f.reduce((e,c)=>e+Math.pow(c-s,2),0);return Math.sqrt(a/o)}})();
//# sourceMappingURL=catWorker-Cwmleu_S.js.map
